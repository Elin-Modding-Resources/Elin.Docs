---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 16 files modified.
version: EA 23.183 Nightly Patch 1
changes: ActEffect/AttackProcess/Biography/ButtonChara/Cell/CharaRenderer/CraftUtil/FactionBranch/Map/MapMetaData/Person/SpawnPosition/SpawnSetting/TraitMoongate/Zone/Zone_User
---

# EA 23.183 Nightly Patch 1

August 18, 2025

16 files modified.

## Important Changes

Possible breaking changes. Click the filename to view the chunk.
### [Biography (1)](#biography)
```cs:no-line-numbers
public void SetAge(Chara c, int a, bool allowUnique = false) // [!code --]
public void SetAge(Chara c, int a) // [!code ++]
```
### [CraftUtil (1)](#craftutil)
```cs:no-line-numbers
public static void AddIngredient(Card product, Chara c, Card ing, bool writeCrafter = true) // [!code --]
public static void WrapIngredient(Card product, Chara c, Card ing, WrapType wrapType) // [!code ++]
```
## ActEffect

[`public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/ActEffect.cs#L1383-L1397)
```cs:line-numbers=1383
		{
			break;
		}
		int hex = 0; // [!code --]
		int hex2 = 0; // [!code ++]
		foreach (Condition condition4 in TC.conditions)
		{
			if (condition4.Type == ConditionType.Debuff)
			{
				hex++; // [!code --]
				hex2++; // [!code ++]
			}
		}
		if (hex == 0) // [!code --]
		if (hex2 == 0) // [!code ++]
		{
			CC.SayNothingHappans();
			break;
```

[`public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/ActEffect.cs#L1414-L1420)
```cs:line-numbers=1414
				if (!item3.IsFriendOrAbove(CC))
				{
					int num9 = Dice.Create("SpShutterHex", power, CC, (actRef.refThing != null) ? null : actRef.act).Roll();
					item3.DamageHP(num9 * hex, 919, power, AttackSource.None, CC); // [!code --]
					item3.DamageHP(num9 * hex2, 919, power, AttackSource.None, CC); // [!code ++]
				}
			}
		});
```

[`public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/ActEffect.cs#L1460-L1485)
```cs:line-numbers=1460
			TC.Say((actRef.n1 == "money") ? "abStealNegateMoney" : "abStealNegate", TC);
			break;
		}
		Thing thing5 = null; // [!code --]
		bool flag9 = actRef.n1 == "food"; // [!code --]
		Thing thing4 = null; // [!code ++]
		bool flag7 = actRef.n1 == "food"; // [!code ++]
		if (actRef.n1 == "money")
		{
			int currency = TC.GetCurrency();
			if (currency > 0)
			{
				currency = Mathf.Clamp(EClass.rnd(currency / 10), 1, 100 + EClass.rndHalf(CC.LV * 200));
				thing5 = ThingGen.Create("money").SetNum(currency); // [!code --]
				thing4 = ThingGen.Create("money").SetNum(currency); // [!code ++]
				TC.ModCurrency(-currency);
			}
		}
		else
		{
			Func<Thing, bool> func = (Thing t) => true;
			if (flag9) // [!code --]
			if (flag7) // [!code ++]
			{
				func = (Thing t) => t.IsFood;
			}
			List<Thing> list6 = TC.things.List(delegate(Thing t) // [!code --]
			List<Thing> list4 = TC.things.List(delegate(Thing t) // [!code ++]
			{
				if (t.parentCard?.trait is TraitChestMerchant || t.trait is TraitTool || t.IsThrownWeapon)
				{
```

[`public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/ActEffect.cs#L1487-L1516)
```cs:line-numbers=1487
				}
				return t.trait.CanBeDestroyed && t.things.Count == 0 && t.invY != 1 && t.trait.CanBeStolen && !t.trait.CanOnlyCarry && !t.IsUnique && !t.isEquipped && t.blessedState == BlessedState.Normal && func(t);
			}, onlyAccessible: true);
			if (list6.Count > 0) // [!code --]
			if (list4.Count > 0) // [!code ++]
			{
				thing5 = list6.RandomItem(); // [!code --]
				if (thing5.Num > 1) // [!code --]
				thing4 = list4.RandomItem(); // [!code ++]
				if (thing4.Num > 1) // [!code ++]
				{
					thing5 = thing5.Split(1); // [!code --]
					thing4 = thing4.Split(1); // [!code ++]
				}
			}
			CC.AddCooldown(6640, 200);
		}
		if (thing5 == null) // [!code --]
		if (thing4 == null) // [!code ++]
		{
			CC.Say("abStealNothing", CC, TC);
			break;
		}
		thing5.SetInt(116, 1); // [!code --]
		TC.PlaySound(thing5.material.GetSoundDrop(thing5.sourceCard)); // [!code --]
		CC.Pick(thing5, msg: false); // [!code --]
		CC.Say("abSteal", CC, TC, thing5.Name); // [!code --]
		thing4.SetInt(116, 1); // [!code ++]
		TC.PlaySound(thing4.material.GetSoundDrop(thing4.sourceCard)); // [!code ++]
		CC.Pick(thing4, msg: false); // [!code ++]
		CC.Say("abSteal", CC, TC, thing4.Name); // [!code ++]
		if (actRef.n1 == "food")
		{
			if (CC.hunger.value != 0)
			{
				CC.InstantEat(thing5); // [!code --]
				CC.InstantEat(thing4); // [!code ++]
			}
		}
		else
```

[`public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/ActEffect.cs#L1656-L1669)
```cs:line-numbers=1656
	case EffectId.KizuamiTrick:
	{
		EClass.game.religions.Trickery.Talk("ability");
		bool hex2 = CC.IsHostile(TC); // [!code --]
		List<SourceStat.Row> list4 = EClass.sources.stats.rows.Where((SourceStat.Row con) => con.tag.Contains("random") && con.group == (hex2 ? "Debuff" : "Buff")).ToList(); // [!code --]
		bool hex = CC.IsHostile(TC); // [!code ++]
		List<SourceStat.Row> list6 = EClass.sources.stats.rows.Where((SourceStat.Row con) => con.tag.Contains("random") && con.group == (hex ? "Debuff" : "Buff")).ToList(); // [!code ++]
		int power2 = power;
		for (int l = 0; l < 4 + EClass.rnd(2); l++)
		{
			SourceStat.Row row2 = list4.RandomItem(); // [!code --]
			list4.Remove(row2); // [!code --]
			Proc(hex2 ? EffectId.DebuffKizuami : EffectId.Buff, CC, TC, power2, new ActRef // [!code --]
			SourceStat.Row row2 = list6.RandomItem(); // [!code ++]
			list6.Remove(row2); // [!code ++]
			Proc(hex ? EffectId.DebuffKizuami : EffectId.Buff, CC, TC, power2, new ActRef // [!code ++]
			{
				n1 = row2.alias
			});
```

[`public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/ActEffect.cs#L1798-L1813)
```cs:line-numbers=1798
		tc.bio.SetGender(gender2);
		tc.Say("transGender", tc, Gender.Name(tc.bio.gender));
		tc.Talk("tail");
		int age3 = tc.bio.GetAge(tc.Chara); // [!code --]
		if (blessed && age3 > 1) // [!code --]
		int age = tc.bio.GetAge(tc.Chara); // [!code ++]
		if (blessed && age > 1) // [!code ++]
		{
			tc.Say("ageDown", tc);
			tc.bio.SetAge(tc.Chara, age3 - 1, allowUnique: true); // [!code --]
			tc.bio.SetAge(tc.Chara, age - 1); // [!code ++]
		}
		else if (flag)
		{
			tc.Say("ageUp", tc);
			tc.bio.SetAge(tc.Chara, age3 + 1, allowUnique: true); // [!code --]
			tc.bio.SetAge(tc.Chara, age + 1); // [!code ++]
		}
		break;
	}
```

[`public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/ActEffect.cs#L1815-L1829)
```cs:line-numbers=1815
	{
		tc.PlaySound("mutation");
		tc.PlayEffect("mutation");
		int age2 = tc.bio.GetAge(tc.Chara); // [!code --]
		if (!flag && age2 <= 1) // [!code --]
		int age3 = tc.bio.GetAge(tc.Chara); // [!code ++]
		if (!flag && age3 <= 0) // [!code ++]
		{
			tc.SayNothingHappans();
			break;
		}
		age2 = Mathf.Max(1, age2 * 100 / (flag ? 75 : (blessed ? 400 : 200))); // [!code --]
		age3 = Mathf.Max(0, age3 * 100 / (flag ? 75 : (blessed ? 400 : 200))) + (flag ? 1 : 0); // [!code ++]
		tc.Say(flag ? "ageUp" : "ageDown", tc);
		tc.bio.SetAge(tc.Chara, age2, allowUnique: true); // [!code --]
		tc.bio.SetAge(tc.Chara, age3); // [!code ++]
		break;
	}
	case EffectId.EternalYouth:
```

[`public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/ActEffect.cs#L1835-L1841)
```cs:line-numbers=1835
			tc.SayNothingHappans();
			break;
		}
		int age = tc.bio.GetAge(tc.Chara); // [!code --]
		int age2 = tc.bio.GetAge(tc.Chara); // [!code ++]
		if (flag)
		{
			if (tc.c_lockedAge != 0)
```

[`public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/ActEffect.cs#L1843-L1849)
```cs:line-numbers=1843
				tc.Say("eternalYouth2", tc);
				tc.c_lockedAge = 0;
				tc.elements.Remove(1243);
				tc.bio.SetAge(tc.Chara, age); // [!code --]
				tc.bio.SetAge(tc.Chara, age2); // [!code ++]
			}
			Redirect(EffectId.Youth, BlessedState.Cursed, default(ActRef));
		}
```

[`public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/ActEffect.cs#L1855-L1861)
```cs:line-numbers=1855
		{
			tc.PlaySound("dropRewardXmas");
			tc.Say("eternalYouth1", tc);
			tc.c_lockedAge = age; // [!code --]
			tc.c_lockedAge = age2 + 1; // [!code ++]
			tc.elements.SetBase(1243, 1);
			if (blessed)
			{
```

[`public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/ActEffect.cs#L1910-L1922)
```cs:line-numbers=1910
	case EffectId.DamageMindGreat:
	case EffectId.Weaken:
	{
		bool flag7 = id == EffectId.DamageBody || id == EffectId.DamageBodyGreat; // [!code --]
		bool flag8 = id == EffectId.DamageBody || id == EffectId.DamageBodyGreat; // [!code ++]
		bool mind = id == EffectId.DamageMind || id == EffectId.DamageMindGreat;
		int num8 = ((id == EffectId.DamageBody || id == EffectId.DamageMind) ? 1 : (4 + EClass.rnd(4)));
		if (id == EffectId.Weaken)
		{
			flag7 = EClass.rnd(2) == 0; // [!code --]
			mind = !flag7; // [!code --]
			flag8 = EClass.rnd(2) == 0; // [!code ++]
			mind = !flag8; // [!code ++]
			num8 = 1;
		}
		else
```

[`public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/ActEffect.cs#L1924-L1933)
```cs:line-numbers=1924
			TC.PlayEffect("debuff");
			TC.PlaySound("debuff");
		}
		TC.Say(flag7 ? "damageBody" : "damageMind", TC); // [!code --]
		TC.Say(flag8 ? "damageBody" : "damageMind", TC); // [!code ++]
		for (int k = 0; k < num8; k++)
		{
			TC.DamageTempElements(power, flag7, mind, id != EffectId.Weaken); // [!code --]
			TC.DamageTempElements(power, flag8, mind, id != EffectId.Weaken); // [!code ++]
		}
		if (TC.IsPC)
		{
```

[`public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/ActEffect.cs#L1940-L1955)
```cs:line-numbers=1940
	case EffectId.EnhanceBodyGreat:
	case EffectId.EnhanceMindGreat:
	{
		bool flag8 = id == EffectId.EnhanceBody || id == EffectId.EnhanceBodyGreat; // [!code --]
		bool flag9 = id == EffectId.EnhanceBody || id == EffectId.EnhanceBodyGreat; // [!code ++]
		bool mind2 = id == EffectId.EnhanceMind || id == EffectId.EnhanceMindGreat;
		if (id != EffectId.EnhanceBody && id != EffectId.EnhanceMind)
		{
			EClass.rnd(4);
		}
		TC.Say(flag8 ? "enhanceBody" : "enhanceMind", TC); // [!code --]
		TC.Say(flag9 ? "enhanceBody" : "enhanceMind", TC); // [!code ++]
		TC.PlayEffect("buff");
		TC.PlaySound("buff");
		TC.EnhanceTempElements(power, flag8, mind2, onlyRenew: true); // [!code --]
		TC.EnhanceTempElements(power, flag9, mind2, onlyRenew: true); // [!code ++]
		break;
	}
	case EffectId.RestoreBody:
```

[`public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/ActEffect.cs#L2271-L2287)
```cs:line-numbers=2271
		List<Thing> list5 = TC.things.List((Thing t) => (t.Num <= 1 && t.IsEquipmentOrRanged && !t.IsToolbelt && !t.IsLightsource && t.isEquipped) ? true : false);
		if (list5.Count != 0)
		{
			Thing thing4 = list5.RandomItem(); // [!code --]
			Thing thing5 = list5.RandomItem(); // [!code ++]
			TC.Say("acid_hit", TC);
			if (thing4.isAcidproof) // [!code --]
			if (thing5.isAcidproof) // [!code ++]
			{
				TC.Say("acid_nullify", thing4); // [!code --]
				TC.Say("acid_nullify", thing5); // [!code ++]
			}
			else if (thing4.encLV > -5) // [!code --]
			else if (thing5.encLV > -5) // [!code ++]
			{
				TC.Say("acid_rust", TC, thing4); // [!code --]
				thing4.ModEncLv(-1); // [!code --]
				LayerInventory.SetDirty(thing4); // [!code --]
				TC.Say("acid_rust", TC, thing5); // [!code ++]
				thing5.ModEncLv(-1); // [!code ++]
				LayerInventory.SetDirty(thing5); // [!code ++]
			}
			if (TC.IsPCParty)
			{
```

## AttackProcess

[`public void Prepare(Chara _CC, Thing _weapon, Card _TC = null, Point _TP = null,`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/AttackProcess.cs#L161-L167)
```cs:line-numbers=161
		int num3 = Mathf.Clamp(weapon.material.hardness, flag ? 40 : 20, 200);
		weaponSkill = CC.elements.GetOrCreateElement(108);
		attackType = AttackType.Blunt;
		dBonus = CC.DMG + (CC.IsPCParty ? 3 : 7); // [!code --]
		dBonus = CC.DMG + (CC.IsPCParty ? 3 : 7) + Math.Min(weapon.encLV, 99); // [!code ++]
		dNum = 2;
		dDim = (((!CC.IsPCParty) ? CC.LV : 0) + CC.STR + CC.Evalue(108)) * num2 / 100 * num3 / 100 / 2;
		dMulti = 1f;
```

## Biography

[`public bool IsUnderAge(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/Biography.cs#L270-L296)
```cs:line-numbers=270

	public string TextAge(Chara c)
	{
		object obj; // [!code --]
		if (GetAge(c) < 1000) // [!code --]
		{ // [!code --]
			obj = GetAge(c).ToString(); // [!code --]
			if (obj == null) // [!code --]
			{ // [!code --]
				return ""; // [!code --]
			} // [!code --]
		} // [!code --]
		else // [!code --]
		{ // [!code --]
			obj = "???"; // [!code --]
		} // [!code --]
		return (string)obj; // [!code --]
		return Lang.Parse("age", (GetAge(c) >= 1000) ? "???" : (GetAge(c).ToString() ?? "")); // [!code ++]
	}

	public int GetAge(Chara c)
	{
		if (c.c_lockedAge != 0)
		{
			return c.c_lockedAge; // [!code --]
			return c.c_lockedAge - 1; // [!code ++]
		}
		if (c.IsUnique)
		{
```

[`public int GetAge(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/Biography.cs#L303-L327)
```cs:line-numbers=303
		return EClass.world.date.year - birthYear;
	}

	public void SetAge(Chara c, int a, bool allowUnique = false) // [!code --]
	public void SetAge(Chara c, int a) // [!code ++]
	{
		if (c.IsUnique)
		{
			if (allowUnique) // [!code --]
			c.c_lockedAge = a + 1; // [!code ++]
			string[] array = c.source.bio.Split('/'); // [!code ++]
			if (array.Length > 1) // [!code ++]
			{
				c.c_lockedAge = a; // [!code --]
				SetBirthYear(c, int.Parse(array[1])); // [!code ++]
			}
		}
		else if (c.c_lockedAge == 0)
		{
			birthYear = EClass.world.date.year - a; // [!code --]
			SetBirthYear(c, a); // [!code ++]
		}
		else
		{
			c.c_lockedAge = a; // [!code --]
			c.c_lockedAge = a + 1; // [!code ++]
		}
	}

	public void SetBirthYear(Chara c, int a) // [!code ++]
	{ // [!code ++]
		birthYear = EClass.world.date.year - a; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void Generate(Chara c)
	{
		string bio = c.source.bio;
```

[`public void Generate(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/Biography.cs#L354-L360)
```cs:line-numbers=354
			{
				flag = false;
			}
			SetAge(c, int.Parse(array[1])); // [!code --]
			SetBirthYear(c, int.Parse(array[1])); // [!code ++]
			c.pccData = IO.LoadFile<PCCData>(CorePath.packageCore + "Data/PCC/" + c.id + ".txt");
		}
		if (array.Length > 2)
```

[`public void Generate(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/Biography.cs#L384-L390)
```cs:line-numbers=384
	}
	if (c.id == "prostitute" && GetAge(c) < 15)
	{
		SetAge(c, 15); // [!code --]
		SetBirthYear(c, 15); // [!code ++]
	}
	SourceThing.Row row = EClass.sources.things.rows.RandomItem();
	idLike = row.id;
```

[`public void GenerateBirthday(Chara c, int ageIndex = 0)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/Biography.cs#L412-L422)
```cs:line-numbers=412
	if (ageIndex != 0)
	{
		int num3 = (num2 - num) / 4;
		SetAge(c, Rand.Range(num + num3 * (ageIndex - 1), num + num3 * ageIndex)); // [!code --]
		SetBirthYear(c, Rand.Range(num + num3 * (ageIndex - 1), num + num3 * ageIndex)); // [!code ++]
	}
	else
	{
		SetAge(c, Rand.Range(num, num2)); // [!code --]
		SetBirthYear(c, Rand.Range(num, num2)); // [!code ++]
	}
	birthDay = EClass.rnd(30) + 1;
	birthMonth = EClass.rnd(12) + 1;
```

[`public void SetPortrait(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/Biography.cs#L504-L510)
```cs:line-numbers=504

	public string TextBio(Chara c)
	{
		return c.race.GetText().ToTitleCase(wholeText: true) + " " + Lang.Parse("age", TextAge(c)) + " " + Lang._gender(gender); // [!code --]
		return c.race.GetText().ToTitleCase(wholeText: true) + " " + TextAge(c) + " " + Lang._gender(gender); // [!code ++]
	}

	public string TextBio2(Chara c)
```

[`public string TextBio2(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/Biography.cs#L514-L525)
```cs:line-numbers=514

	public string TextBioSlave(Chara c)
	{
		return " (" + Lang.GetList("genders_animal")[c.bio.gender] + " " + "age".lang(c.bio.TextAge(c)) + ")"; // [!code --]
		return " (" + Lang.GetList("genders_animal")[c.bio.gender] + " " + TextAge(c) + ")"; // [!code ++]
	}

	public string TextBirthDate(Chara c, bool _age = false)
	{
		return Lang.Parse("birthText", (birthYear >= 0) ? (birthYear.ToString() ?? "") : "???", birthMonth.ToString() ?? "", birthDay.ToString() ?? "") + (_age ? (" (" + Lang.Parse("age", TextAge(c)) + ")") : ""); // [!code --]
		return Lang.Parse("birthText", (birthYear >= 0) ? (birthYear.ToString() ?? "") : "???", birthMonth.ToString() ?? "", birthDay.ToString() ?? "") + (_age ? (" (" + TextAge(c) + ")") : ""); // [!code ++]
	}

	public string TextAppearance()
```

## ButtonChara

[`public void SetChara(Chara c, Mode m)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/ButtonChara.cs#L47-L53)
```cs:line-numbers=47
		textAlias.text = c.Aka;
		if ((bool)textBio)
		{
			textBio.text = c.race.GetText().ToTitleCase(wholeText: true) + " " + Lang.Parse("age", c.bio.TextAge(c)) + " " + Lang._gender(c.bio.gender); // [!code --]
			textBio.text = c.race.GetText().ToTitleCase(wholeText: true) + " " + c.bio.TextAge(c) + " " + Lang._gender(c.bio.gender); // [!code ++]
		}
	}
	textName.text = c.Name;
```

## Cell

[`public Point GetSharedPoint()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/Cell.cs#L1110-L1116)
```cs:line-numbers=1110

	public bool CanSuffocate()
	{
		if (EClass._zone.IsUnderwater) // [!code --]
		if (EClass._zone.IsUnderwater && !EClass._zone.IsUserZone) // [!code ++]
		{
			return true;
		}
```

## CharaRenderer

[`public void DrawHat()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/CharaRenderer.cs#L335-L340)
```cs:line-numbers=335
	RenderObject.currentParam.y += num + 0.01f * (float)(pref.equipY + cardRow.pref.equipY);
	RenderObject.currentParam.z -= pref.hatY;
	RenderObject.currentParam.tile = cardRow._tiles[owner.uid % cardRow._tiles.Length] * ((!flag) ? 1 : (-1));
	RenderObject.currentParam.mat = cardRow.DefaultMaterial; // [!code ++]
	RenderObject.currentParam.matColor = cardRow.GetColorInt(RenderObject.currentParam.mat); // [!code ++]
	cardRow.renderData.Draw(RenderObject.currentParam);
	RenderObject.currentParam.x -= 0.01f * (float)pref.equipX;
	RenderObject.currentParam.y -= num + 0.01f * (float)(pref.equipY + cardRow.pref.equipY);
```

## CraftUtil

[`public enum MixType`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/CraftUtil.cs#L11-L16)
```cs:line-numbers=11
		NoMix
	}

	public enum WrapType // [!code ++]
	{ // [!code ++]
		Love, // [!code ++]
		Dark // [!code ++]
	} // [!code ++]
 // [!code ++]
	public static string[] ListFoodEffect = new string[2] { "exp", "pot" };

	public static void ModRandomFoodEnc(Thing t)
```

[`public static Thing MakeDarkSoup()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/CraftUtil.cs#L99-L105)
```cs:line-numbers=99
	for (int i = 0; i < 4 + EClass.rnd(4); i++)
	{
		Chara c = EClass._map.charas.RandomItem();
		AddIngredient(thing, c, GetRandomDarkSoupIngredient(c)); // [!code --]
		WrapIngredient(thing, c, GetRandomDarkSoupIngredient(c), WrapType.Dark); // [!code ++]
	}
	if (!EClass.debug.autoIdentify)
	{
```

[`public static Thing MakeLoveLunch(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/CraftUtil.cs#L127-L133)
```cs:line-numbers=127
	for (int i = 0; (float)i < num2; i++)
	{
		Rand.SetSeed(num + i);
		AddIngredient(thing, c, GetRandomLoveLunchIngredient(c), writeCrafter: false); // [!code --]
		WrapIngredient(thing, c, GetRandomLoveLunchIngredient(c), WrapType.Love); // [!code ++]
	}
	thing.elements.SetBase(701, 0);
	if (thing.Evalue(753) < 0)
```

[`public static Thing MakeLoveLunch(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/CraftUtil.cs#L141-L166)
```cs:line-numbers=141
	public static Thing GetRandomLoveLunchIngredient(Chara c)
	{
		Thing thing = null;
		int lV = c.LV; // [!code --]
		for (int i = 0; i < 3; i++)
		{
			thing = ThingGen.Create("dish", -1, lV + i * 3); // [!code --]
			thing = ThingGen.Create("dish", -1, c.Evalue(287) + 5 + (EClass.debug.enable ? c.LV : 0)); // [!code ++]
			if (!thing.HasTag(CTAG.dish_fail))
			{
				break;
			}
		}
		MakeDish(thing, lV, c); // [!code --]
		MakeDish(thing, c.LV, c); // [!code ++]
		return thing;
	}

	public static void AddIngredient(Card product, Chara c, Card ing, bool writeCrafter = true) // [!code --]
	public static void WrapIngredient(Card product, Chara c, Card ing, WrapType wrapType) // [!code ++]
	{
		if (product.c_mixedFoodData == null)
		{
			product.c_mixedFoodData = new MixedFoodData();
		}
		product.c_mixedFoodData.texts.Add(ing.Name + (writeCrafter ? "isMixedBy".lang(c.NameSimple) : "")); // [!code --]
		product.c_mixedFoodData.texts.Add(ing.Name + ((wrapType == WrapType.Dark) ? "isMixedBy".lang(c.NameSimple) : "")); // [!code ++]
		foreach (Element value in ing.elements.dict.Values)
		{
			if (!IsValidTrait(value))
```

[`public static void AddIngredient(Card product, Chara c, Card ing, bool writeCraf`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/CraftUtil.cs#L170-L176)
```cs:line-numbers=170
		if (value.IsFoodTraitMain)
		{
			int num = value.Value;
			if (product.id == "lunch_dystopia") // [!code --]
			if (product.id == "lunch_dystopia" && (wrapType == WrapType.Dark || num < 0)) // [!code ++]
			{
				num *= -1;
			}
```

[`public static Card MixIngredients(Card product, List<Thing> ings, MixType type,`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/CraftUtil.cs#L379-L385)
```cs:line-numbers=379
			product.elements.SetTo(10, 1);
		}
	}
	if (creative && isFood) // [!code --]
	if (creative && isFood && product.category.IsChildOf("meal")) // [!code ++]
	{
		product.elements.SetBase(764, 1);
	}
```

## FactionBranch

[`public void OnSimulateHour(VirtualDate date)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/FactionBranch.cs#L392-L398)
```cs:line-numbers=392
			if (luckyMonth || (policies.IsActive(2822) && Mathf.Sqrt(Evalue(2822) / 2) + 5f >= (float)EClass.rnd(100)))
			{
				chara = CharaGen.CreateWealthy(ContentLV);
				EClass._zone.AddCard(chara, EClass._zone.GetSpawnPos(SpawnPosition.Random) ?? EClass._map.GetRandomSurface()); // [!code --]
				EClass._zone.AddCard(chara, EClass._zone.GetSpawnPos(SpawnPosition.Guest) ?? EClass._map.GetRandomSurface()); // [!code ++]
			}
			else
			{
```

## Map

[`public void ExportMetaData(string _path, string id, PartialMap partial = null)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/Map.cs#L724-L730)
```cs:line-numbers=724
		name = EClass._zone.Name,
		version = BaseCore.Instance.version.GetInt(),
		tag = (EClass._map.exportSetting?.tag ?? ""),
		partial = partial // [!code --]
		partial = partial, // [!code ++]
		underwater = EClass._zone.IsUnderwater // [!code ++]
	};
	custom.id = (mapMetaData.id = id);
	IO.SaveFile(_path + "meta", mapMetaData);
```

## MapMetaData

[`public class MapMetaData : EClass`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/MapMetaData.cs#L21-L26)
```cs:line-numbers=21
	[JsonProperty]
	public PartialMap partial;

	[JsonProperty] // [!code ++]
	public bool underwater; // [!code ++]
 // [!code ++]
	public string path;

	public DateTime date;
```

## Person

[`public string GetDramaTitle()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/Person.cs#L118-L124)
```cs:line-numbers=118
		{
			text = text + " " + dramaText;
		}
		return chara.Name.ToTitleCase() + " - " + chara.race.GetText().ToTitleCase() + " " + Lang.Parse("age", bio.TextAge(chara)) + " " + Lang._gender(bio.gender) + text; // [!code --]
		return chara.Name.ToTitleCase() + " - " + chara.race.GetText().ToTitleCase() + " " + bio.TextAge(chara) + " " + Lang._gender(bio.gender) + text; // [!code ++]
	}
	if (Name.IsEmpty())
	{
```

## SpawnPosition

[`public enum SpawnPosition`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/SpawnPosition.cs#L1-L5)
```cs:line-numbers=1
public enum SpawnPosition
{
	Random,
	Outside // [!code --]
	Outside, // [!code ++]
	Guest // [!code ++]
}
```

## SpawnSetting

[`public static SpawnSetting HomeGuest(int lv)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/SpawnSetting.cs#L107-L113)
```cs:line-numbers=107
		filterLv = lv,
		hostility = SpawnHostility.Neutral,
		idSpawnList = "c_guest",
		position = SpawnPosition.Outside, // [!code --]
		position = SpawnPosition.Guest, // [!code ++]
		rarity = Rarity.Normal
	};
}
```

## TraitMoongate

[`public void LoadMap(MapMetaData m)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/TraitMoongate.cs#L141-L146)
```cs:line-numbers=141
		zone_User.idUser = m.id;
		zone_User.dateExpire = EClass.world.date.GetRaw(1);
		zone_User.name = m.name;
		if (m.underwater) // [!code ++]
		{ // [!code ++]
			zone_User.elements.SetBase(3606, 1); // [!code ++]
		} // [!code ++]
	}
	Debug.Log(zone_User);
	MoveZone(zone_User);
```

## Zone

[`public Point GetSpawnPos(SpawnPosition type, int tries = 100)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/Zone.cs#L2649-L2658)
```cs:line-numbers=2649
	for (int i = 0; i < tries; i++)
	{
		point = EClass._map.bounds.GetRandomSurface(centered: false, walkable: true, allowWater: true);
		if (point.IsValid && !point.cell.hasDoor && !point.IsSync && (type != SpawnPosition.Outside || (!point.cell.HasRoof && point.cell.light <= 0))) // [!code --]
		if (!point.IsValid || point.cell.hasDoor || point.IsSync) // [!code ++]
		{
			return point; // [!code --]
			continue; // [!code ++]
		} // [!code ++]
		switch (type) // [!code ++]
		{ // [!code ++]
		case SpawnPosition.Guest: // [!code ++]
		{ // [!code ++]
			Room room = point.cell.room; // [!code ++]
			if (room != null && room.data.accessType != 0) // [!code ++]
			{ // [!code ++]
				continue; // [!code ++]
			} // [!code ++]
			break; // [!code ++]
		} // [!code ++]
		case SpawnPosition.Outside: // [!code ++]
			if (point.cell.HasRoof || point.cell.light > 0) // [!code ++]
			{ // [!code ++]
				continue; // [!code ++]
			} // [!code ++]
			break; // [!code ++]
		}
		return point; // [!code ++]
	}
	return null;
}
```

## Zone_User

[`public class Zone_User : Zone`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0ba7526282bc14c62dac481c0eb9b92b0a6b5b8d/Elin/Zone_User.cs#L21-L26)
```cs:line-numbers=21

	public override bool RevealRoom => true;

	public override bool IsUnderwater => elements.Has(3606); // [!code ++]
 // [!code ++]
	public override void OnActivate()
	{
		base.OnActivate();
```

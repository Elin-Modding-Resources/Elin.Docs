---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 31 files modified. 5 new files created.
version: EA 23.132 Nightly Patch 1
changes: ActEffect/ActMultihit/BaseListPeople/BaseTileMap/CSTR/Card/Chara/CharaRenderer/+ConBrightnessOfLife/Core/CoreDebug/ELEMENT/FACTION/FEAT/FOOD/GameLang/GoalAutoCombat/GoalCombat/+LayerEditSkin/Party/Player/Region/SKILL/SLOT/SPELL/SourceElement/TaskHarvest/TileMapElona/TileType/TileTypePillar/+TileTypeWallFake/Trait/+TraitCitizenExile/+TraitExileElder/TraitStoryBookHome/TraitWindow
---

# EA 23.132 Nightly Patch 1

May 2, 2025

31 files modified. 5 new files created.

## Important Changes

**None.**
## ActEffect

[`@@ -209,7 +209,7 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/ActEffect.cs#L209-L215)
```cs:line-numbers=209
			{
				num4 = CC.MaxHP * 2;
				num4 = num4 * 100 / (50 + point.Distance(p) * 75);
				if (c.HasTag(CTAG.suicide) && !c.HasCondition<ConWet>()) // [!code --]
				if ((c.HasCondition<ConBrightnessOfLife>() || c.HasTag(CTAG.suicide)) && !c.HasCondition<ConWet>() && !c.IsPowerful) // [!code ++]
				{
					list.Add(c);
				}
```

[`@@ -423,10 +423,10 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/ActEffect.cs#L423-L432)
```cs:line-numbers=423
	{
	case EffectId.Earthquake:
	{
		List<Point> list3 = EClass._map.ListPointsInCircle(CC.pos, 12f, mustBeWalkable: false); // [!code --]
		if (list3.Count == 0) // [!code --]
		List<Point> list7 = EClass._map.ListPointsInCircle(CC.pos, 12f, mustBeWalkable: false); // [!code ++]
		if (list7.Count == 0) // [!code ++]
		{
			list3.Add(CC.pos.Copy()); // [!code --]
			list7.Add(CC.pos.Copy()); // [!code ++]
		}
		CC.Say("spell_earthquake", CC, element.Name.ToLower());
		TryDelay(delegate
```

[`@@ -438,7 +438,7 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/ActEffect.cs#L438-L444)
```cs:line-numbers=438
			Shaker.ShakeCam("ball");
		}
		EClass.Wait(1f, CC);
		DamageEle(CC, id, power, element, list3, actRef, "spell_earthquake"); // [!code --]
		DamageEle(CC, id, power, element, list7, actRef, "spell_earthquake"); // [!code ++]
		break;
	}
	case EffectId.Meteor:
```

[`@@ -469,8 +469,8 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/ActEffect.cs#L469-L476)
```cs:line-numbers=469
	case EffectId.DrainMana:
	case EffectId.Sword:
	{
		List<Point> list5 = new List<Point>(); // [!code --]
		list5.Add(tp.Copy()); // [!code --]
		List<Point> list = new List<Point>(); // [!code ++]
		list.Add(tp.Copy()); // [!code ++]
		EClass.Wait(0.3f, CC);
		TryDelay(delegate
		{
```

[`@@ -494,7 +494,7 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/ActEffect.cs#L494-L500)
```cs:line-numbers=494
			lang = "";
			break;
		}
		if (!DamageEle(cC, id3, power, e, list5, actref, (string)lang)) // [!code --]
		if (!DamageEle(cC, id3, power, e, list, actref, (string)lang)) // [!code ++]
		{
			CC.Say("spell_hand_miss", CC, element.Name.ToLower());
		}
```

[`@@ -502,15 +502,15 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/ActEffect.cs#L502-L516)
```cs:line-numbers=502
	}
	case EffectId.Arrow:
	{
		List<Point> list = new List<Point>(); // [!code --]
		list.Add(tp.Copy()); // [!code --]
		List<Point> list5 = new List<Point>(); // [!code ++]
		list5.Add(tp.Copy()); // [!code ++]
		CC.Say("spell_arrow", CC, element.Name.ToLower());
		EClass.Wait(0.5f, CC);
		TryDelay(delegate
		{
			CC.PlaySound("spell_arrow");
		});
		DamageEle(CC, id, power, element, list, actRef, "spell_arrow"); // [!code --]
		DamageEle(CC, id, power, element, list5, actRef, "spell_arrow"); // [!code ++]
		return;
	}
	case EffectId.Summon:
```

[`@@ -558,7 +558,7 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/ActEffect.cs#L558-L564)
```cs:line-numbers=558
			{
				continue;
			}
			Chara chara2 = null; // [!code --]
			Chara chara = null; // [!code ++]
			if (num5 != -1)
			{
				CardBlueprint.Set(new CardBlueprint
```

[`@@ -566,7 +566,7 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/ActEffect.cs#L566-L572)
```cs:line-numbers=566
					lv = num5
				});
			}
			chara2 = actRef.n1 switch // [!code --]
			chara = actRef.n1 switch // [!code ++]
			{
				"yeek" => CharaGen.CreateFromFilter(SpawnListChara.Get("summon_yeek", (SourceChara.Row r) => r.race == "yeek"), power / 10), 
				"orc" => CharaGen.CreateFromFilter(SpawnListChara.Get("summon_orc", (SourceChara.Row r) => r.race == "orc"), power / 10), 
```

[`@@ -578,41 +578,41 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/ActEffect.cs#L578-L618)
```cs:line-numbers=578
				"octopus" => CharaGen.CreateFromFilter(SpawnListChara.Get("summon_octopus", (SourceChara.Row r) => r.race == "octopus"), power / 10), 
				_ => CharaGen.Create(id4, power / 10), 
			};
			if (chara2 == null) // [!code --]
			if (chara == null) // [!code ++]
			{
				continue;
			}
			int num6 = -1;
			num6 = ((!(actRef.n1 == "shadow")) ? (chara2.LV * (100 + power / 10) / 100 + power / 30) : (power / 10 + 1)); // [!code --]
			if (chara2.LV < num6) // [!code --]
			num6 = ((!(actRef.n1 == "shadow")) ? (chara.LV * (100 + power / 10) / 100 + power / 30) : (power / 10 + 1)); // [!code ++]
			if (chara.LV < num6) // [!code ++]
			{
				chara2.SetLv(num6); // [!code --]
				chara.SetLv(num6); // [!code ++]
			}
			chara2.interest = 0; // [!code --]
			if (chara2.HaveFur()) // [!code --]
			chara.interest = 0; // [!code ++]
			if (chara.HaveFur()) // [!code ++]
			{
				chara2.c_fur = -1; // [!code --]
				chara.c_fur = -1; // [!code ++]
			}
			string n = actRef.n1;
			if (!(n == "shadow"))
			{
				if (n == "special_force")
				{
					chara2.homeZone = EClass._zone; // [!code --]
					chara.homeZone = EClass._zone; // [!code ++]
				}
			}
			else
			{
				chara2.hp = chara2.MaxHP / 2; // [!code --]
				chara.hp = chara.MaxHP / 2; // [!code ++]
			}
			EClass._zone.AddCard(chara2, point); // [!code --]
			EClass._zone.AddCard(chara, point); // [!code ++]
			if (!(actRef.n1 == "monster") || actRef.refThing == null)
			{
				chara2.MakeMinion(CC); // [!code --]
				chara.MakeMinion(CC); // [!code ++]
			}
			if (num4 != -1)
			{
				chara2.SetSummon(num4); // [!code --]
				chara.SetSummon(num4); // [!code ++]
			}
			flag3 = true;
		}
```

[`@@ -631,22 +631,22 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/ActEffect.cs#L631-L652)
```cs:line-numbers=631
		}
		CC.Say("spell_funnel", CC, element.Name.ToLower());
		CC.PlaySound("spell_funnel");
		Chara chara = CharaGen.Create("bit"); // [!code --]
		chara.SetMainElement(element.source.alias, element.Value, elemental: true); // [!code --]
		chara.SetSummon(20 + power / 20 + EClass.rnd(10)); // [!code --]
		chara.SetLv(power / 15); // [!code --]
		chara.interest = 0; // [!code --]
		EClass._zone.AddCard(chara, tp.GetNearestPoint(allowBlock: false, allowChara: false)); // [!code --]
		chara.PlayEffect("teleport"); // [!code --]
		chara.MakeMinion(CC); // [!code --]
		Chara chara2 = CharaGen.Create("bit"); // [!code ++]
		chara2.SetMainElement(element.source.alias, element.Value, elemental: true); // [!code ++]
		chara2.SetSummon(20 + power / 20 + EClass.rnd(10)); // [!code ++]
		chara2.SetLv(power / 15); // [!code ++]
		chara2.interest = 0; // [!code ++]
		EClass._zone.AddCard(chara2, tp.GetNearestPoint(allowBlock: false, allowChara: false)); // [!code ++]
		chara2.PlayEffect("teleport"); // [!code ++]
		chara2.MakeMinion(CC); // [!code ++]
		return;
	}
	case EffectId.Breathe:
	{
		List<Point> list7 = EClass._map.ListPointsInArc(CC.pos, tp, 7, 35f); // [!code --]
		if (list7.Count == 0) // [!code --]
		List<Point> list3 = EClass._map.ListPointsInArc(CC.pos, tp, 7, 35f); // [!code ++]
		if (list3.Count == 0) // [!code ++]
		{
			list7.Add(CC.pos.Copy()); // [!code --]
			list3.Add(CC.pos.Copy()); // [!code ++]
		}
		CC.Say("spell_breathe", CC, element.Name.ToLower());
		EClass.Wait(0.8f, CC);
```

[`@@ -658,7 +658,7 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/ActEffect.cs#L658-L664)
```cs:line-numbers=658
		{
			Shaker.ShakeCam("breathe");
		}
		DamageEle(CC, id, power, element, list7, actRef, "spell_breathe"); // [!code --]
		DamageEle(CC, id, power, element, list3, actRef, "spell_breathe"); // [!code ++]
		return;
	}
	case EffectId.Scream:
```

[`@@ -693,6 +693,10 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/ActEffect.cs#L693-L698)
```cs:line-numbers=693
			{
				element = CC.MainElement;
			}
			if (CC.HasCondition<ConBrightnessOfLife>()) // [!code ++]
			{ // [!code ++]
				element = Element.Create(919, 10); // [!code ++]
			} // [!code ++]
			if (CC.HasTag(CTAG.kamikaze))
			{
				radius2 = 1.5f;
```

[`@@ -2195,6 +2199,10 @@ public static void Poison(Chara tc, Chara c, int power)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/ActEffect.cs#L2195-L2200)
```cs:line-numbers=2195
{
	tc.Say("eat_poison", tc);
	tc.Talk("scream");
	if (power > 100000000) // [!code ++]
	{ // [!code ++]
		power = 100000000; // [!code ++]
	} // [!code ++]
	int num = (int)Mathf.Sqrt(power * 100);
	tc.DamageHP(num * 2 + EClass.rnd(num), 915, power);
	if (!tc.isDead && !tc.IsPC)
```

## ActMultihit

[`@@ -6,7 +6,7 @@ public override bool CanPerform()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/ActMultihit.cs#L6-L12)
```cs:line-numbers=6
		{
			return false;
		}
		return base.CanPerform(); // [!code --]
		return ACT.Melee.CanPerform(); // [!code ++]
	}

	public override bool Perform()
```

## BaseListPeople

[`@@ -310,6 +310,18 @@ public override void OnClick(Chara c, ItemGeneral i)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/BaseListPeople.cs#L310-L315)
```cs:line-numbers=310
					{
						EClass.ui.AddLayer<LayerEditPortrait>().Activate(c);
					});
					if (!c.IsPC) // [!code ++]
					{ // [!code ++]
						uIContextMenu.AddButton("editSkin", delegate // [!code ++]
						{ // [!code ++]
							LayerEditSkin layerEditSkin = EClass.ui.AddLayer<LayerEditSkin>(); // [!code ++]
							layerEditSkin.SetOnKill(delegate // [!code ++]
							{ // [!code ++]
								list.Refresh(); // [!code ++]
							}); // [!code ++]
							layerEditSkin.Activate(c); // [!code ++]
						}); // [!code ++]
					} // [!code ++]
					uIContextMenu.AddButton("togglePCC", delegate
					{
						bool isSynced2 = c.isSynced;
```

## BaseTileMap

[`@@ -2913,7 +2913,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/BaseTileMap.cs#L2913-L2919)
```cs:line-numbers=2913
					param.mat = matBlock;
				}
				this.tileType = _sourceBlock.tileType;
				param.tile = (tile = _sourceBlock._tiles[0] + ((flag10 && !this.tileType.IsFence) ? 32 : 0)); // [!code --]
				param.tile = (tile = _sourceBlock._tiles[0] + ((flag10 && this.tileType.UseLowBlock) ? 32 : 0)); // [!code ++]
				if (_sourceBlock.useAltColor)
				{
					param.matColor = ((_sourceBlock.colorMod == 0) ? 104025 : GetColorInt(ref param.mat.altColor, _sourceBlock.colorMod));
```

[`@@ -2940,7 +2940,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/BaseTileMap.cs#L2940-L2946)
```cs:line-numbers=2940
					{
						param.snow = true;
					}
					param.tile = _sourceBlock._tiles[0] + ((flag10 && flag11 && !this.tileType.IsFence && !flag9) ? 32 : 0) + (this.tileType.IsFence ? 32 : 64); // [!code --]
					param.tile = _sourceBlock._tiles[0] + ((flag10 && flag11 && this.tileType.UseLowBlock && !flag9) ? 32 : 0) + (this.tileType.IsFence ? 32 : 64); // [!code ++]
					if (roomHeight == 0f || !this.tileType.RepeatBlock || (flag10 && flag11 && !flag9))
					{
						_sourceBlock.renderData.Draw(param);
```

[`@@ -2953,7 +2953,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/BaseTileMap.cs#L2953-L2959)
```cs:line-numbers=2953
				if (!flag10 && !showRoof && this.cell.Left.HasWallOrFence && this.cell.Left.blockDir != 0 && !this.cell.isToggleWallPillar)
				{
					orgX = param.x;
					param.tile = _sourceBlock._tiles[0] + ((flag10 && !this.tileType.IsFence && !flag9) ? 32 : 0) + (this.tileType.IsFence ? 32 : 64); // [!code --]
					param.tile = _sourceBlock._tiles[0] + ((flag10 && this.tileType.UseLowBlock && !flag9) ? 32 : 0) + (this.tileType.IsFence ? 32 : 64); // [!code ++]
					param.x += cornerWallFix3.x;
					param.y += cornerWallFix3.y;
					param.z += cornerWallFix3.z;
```

[`@@ -2970,7 +2970,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/BaseTileMap.cs#L2970-L2976)
```cs:line-numbers=2970
				else if (this.cell.FrontLeft.HasWallOrFence && this.cell.FrontLeft.blockDir != 0 && (!flag10 || !this.cell.Left.HasWall) && !this.cell.isToggleWallPillar)
				{
					orgX = param.x;
					param.tile = _sourceBlock._tiles[0] + ((flag10 && !this.tileType.IsFence && !flag9) ? 32 : 0) + (this.tileType.IsFence ? 32 : 64); // [!code --]
					param.tile = _sourceBlock._tiles[0] + ((flag10 && this.tileType.UseLowBlock && !flag9) ? 32 : 0) + (this.tileType.IsFence ? 32 : 64); // [!code ++]
					param.x += cornerWallFix.x;
					param.y += cornerWallFix.y;
					param.z += cornerWallFix.z;
```

[`@@ -3042,7 +3042,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/BaseTileMap.cs#L3042-L3048)
```cs:line-numbers=3042
					param.mat = matBlock;
				}
				this.tileType = _sourceBlock.tileType;
				param.tile = (tile = -_sourceBlock._tiles[0] + ((flag11 && !this.tileType.IsFence) ? (-32) : 0)); // [!code --]
				param.tile = (tile = -_sourceBlock._tiles[0] + ((flag11 && this.tileType.UseLowBlock) ? (-32) : 0)); // [!code ++]
				if (_sourceBlock.useAltColor)
				{
					param.matColor = ((_sourceBlock.colorMod == 0) ? 104025 : GetColorInt(ref param.mat.altColor, _sourceBlock.colorMod));
```

[`@@ -3070,7 +3070,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/BaseTileMap.cs#L3070-L3076)
```cs:line-numbers=3070
						param.snow = true;
					}
					orgX = param.x;
					param.tile = _sourceBlock._tiles[0] + ((flag11 && !this.tileType.IsFence && !flag9) ? 32 : 0) + (this.tileType.IsFence ? 32 : 64); // [!code --]
					param.tile = _sourceBlock._tiles[0] + ((flag11 && this.tileType.UseLowBlock && !flag9) ? 32 : 0) + (this.tileType.IsFence ? 32 : 64); // [!code ++]
					if (!flag9 && (roomHeight == 0f || !this.tileType.RepeatBlock || flag11))
					{
						_sourceBlock.renderData.Draw(param);
```

[`@@ -3117,7 +3117,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/BaseTileMap.cs#L3117-L3123)
```cs:line-numbers=3117
		}
		default:
			param.color = floorLight;
			param.tile = sourceBlock._tiles[this.cell.blockDir % sourceBlock._tiles.Length] + ((_lowblock && this.tileType.UseLowWallTiles) ? 3000000 : 0); // [!code --]
			param.tile = sourceBlock._tiles[this.cell.blockDir % sourceBlock._tiles.Length] + ((_lowblock && this.tileType.UseLowBlock) ? 3000000 : 0); // [!code ++]
			param.matColor = ((sourceBlock.colorMod == 0) ? 104025 : GetColorInt(ref matBlock.matColor, sourceBlock.colorMod));
			if (roomHeight == 0f)
			{
```

## CSTR

[`@@ -24,6 +24,8 @@ public class CSTR`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/CSTR.cs#L24-L29)
```cs:line-numbers=24

	public const int extraNameRef = 12;

	public const int idSpriteReplacer = 13; // [!code ++]
 // [!code ++]
	public const int context = 20;

	public const int idTalk = 21;
```

## Card

[`@@ -1489,6 +1489,18 @@ public string c_color`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Card.cs#L1489-L1494)
```cs:line-numbers=1489
		}
	}

	public string c_idSpriteReplacer // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			return GetStr(13); // [!code ++]
		} // [!code ++]
		set // [!code ++]
		{ // [!code ++]
			SetStr(13, value); // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public string c_idTalk
	{
		get
```

[`@@ -4182,6 +4194,7 @@ public void DamageHP(int dmg, int ele, int eleP = 100, AttackSource attackSource`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Card.cs#L4182-L4187)
```cs:line-numbers=4182
				{
					EClass.pc.hp = 0;
					Heal();
					EClass.player.ModFame(-10 - (int)((float)EClass.player.fame * 0.05f)); // [!code ++]
					target.ShowDialog("_chara", "bout_lose");
					return;
				}
```

## Chara

[`@@ -143,6 +143,8 @@ public class Chara : Card, IPathfindWalker`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Chara.cs#L143-L148)
```cs:line-numbers=143

	public bool ignoreSPAbsorb;

	public SpriteReplacer spriteReplacer; // [!code ++]
 // [!code ++]
	private Faction _faction;

	public SourceChara.Row source;
```

[`@@ -6056,10 +6058,6 @@ public override CardRenderer _CreateRenderer()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Chara.cs#L6056-L6065)
```cs:line-numbers=6056
	{
		base.idSkin = (EClass.core.config.game.antiSpider ? 1 : 0);
	}
	if (source.moveAnime == "hop") // [!code --]
	{ // [!code --]
		charaRenderer.hopCurve = EClass.setting.render.anime.hop; // [!code --]
	} // [!code --]
	if (host != null)
	{
		charaRenderer.pccData = PCCData.Create("ride");
```

[`@@ -6109,6 +6107,10 @@ public override Sprite GetSprite(int dir = 0)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Chara.cs#L6109-L6114)
```cs:line-numbers=6109
			pCC.Build();
			return pCC.variation.idle[0, 0];
		}
		if (spriteReplacer != null) // [!code ++]
		{ // [!code ++]
			return spriteReplacer.data.GetSprite(); // [!code ++]
		} // [!code ++]
		return sourceCard.GetSprite(0, (sourceCard._tiles.Length > 1) ? ((base.idSkin != 0 || source.staticSkin) ? base.idSkin : (base.uid % sourceCard._tiles.Length / 2 * 2 + ((!base.IsMale) ? 1 : 0))) : 0);
	}

```

## CharaRenderer

[`@@ -59,10 +59,24 @@ public int currentDir`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/CharaRenderer.cs#L59-L68)
```cs:line-numbers=59
	public override void SetOwner(Card c)
	{
		owner = c as Chara;
		owner.spriteReplacer = null; // [!code ++]
		if (pccData != null)
		{
			data = ((pccData.GetBodySet2().id == "unique") ? EClass.core.refs.renderers.pcc_L : EClass.core.refs.renderers.pcc);
		}
		else if (replacer == null && !owner.c_idSpriteReplacer.IsEmpty()) // [!code ++]
		{ // [!code ++]
			SpriteReplacer spriteReplacer = SpriteReplacer.dictSkins.TryGetValue(owner.c_idSpriteReplacer); // [!code ++]
			if (spriteReplacer != null) // [!code ++]
			{ // [!code ++]
				data = ResourceCache.Load<RenderData>("Scene/Render/Data/chara_custom"); // [!code ++]
				owner.spriteReplacer = spriteReplacer; // [!code ++]
			} // [!code ++]
		} // [!code ++]
		if (owner.source.moveAnime == "hop") // [!code ++]
		{ // [!code ++]
			hopCurve = EClass.setting.render.anime.hop; // [!code ++]
		} // [!code ++]
		base.SetOwner(c);
	}

```

[`@@ -110,7 +124,7 @@ public override void NextFrame()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/CharaRenderer.cs#L110-L116)
```cs:line-numbers=110
public override void UpdatePosition(ref Vector3 destPos, RenderParam p)
{
	bool isPC = owner.IsPC;
	int num = (isPC ? _animeFramePC : (hasActor ? _animeFramePCC : _animeFrame)); // [!code --]
	int num = (isPC ? _animeFramePC : ((pccData != null) ? _animeFramePCC : _animeFrame)); // [!code ++]
	bool flag = isPC || num >= 10;
	if (num == 0 || Scene.skipAnime || first || !data.animate || (owner.IsDeadOrSleeping && pccData != null && !owner.IsPC))
	{
```

[`@@ -296,26 +310,34 @@ public override void UpdatePosition(ref Vector3 destPos, RenderParam p)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/CharaRenderer.cs#L296-L321)
```cs:line-numbers=296

	public void DrawHat()
	{
		if (pccData == null || !owner.IsDeadOrSleeping) // [!code --]
		if (pccData != null) // [!code ++]
		{
			CardRow cardRow = Zone.sourceHat ?? owner.hat; // [!code --]
			SourcePref pref = GetPref(); // [!code --]
			bool flag = currentDir == 1 || currentDir == 3; // [!code --]
			int liquidLv = RenderObject.currentParam.liquidLv; // [!code --]
			float num = ((replacer != null) ? replacer.pref.hatY : pref.hatY); // [!code --]
			if (pccData != null) // [!code --]
			if (owner.IsDeadOrSleeping) // [!code ++]
			{
				num += RenderObject.renderSetting.hatPos[actor.GetFrame()].y; // [!code --]
				return; // [!code ++]
			}
			RenderObject.currentParam.liquidLv = 0; // [!code --]
			RenderObject.currentParam.x += 0.01f * (float)pref.equipX; // [!code --]
			RenderObject.currentParam.y += num + 0.01f * (float)pref.equipY; // [!code --]
			RenderObject.currentParam.z -= pref.hatY; // [!code --]
			RenderObject.currentParam.tile = cardRow._tiles[owner.uid % cardRow._tiles.Length] * ((!flag) ? 1 : (-1)); // [!code --]
			cardRow.renderData.Draw(RenderObject.currentParam); // [!code --]
			RenderObject.currentParam.y -= num; // [!code --]
			RenderObject.currentParam.liquidLv = liquidLv; // [!code --]
		}
		else if (owner.conSleep != null && owner.host == null && owner.pos.Equals(EClass.pc.pos) && owner.IsHuman && owner.GetBool(123)) // [!code ++]
		{ // [!code ++]
			return; // [!code ++]
		} // [!code ++]
		CardRow cardRow = Zone.sourceHat ?? owner.hat; // [!code ++]
		SourcePref pref = GetPref(); // [!code ++]
		bool flag = currentDir == 1 || currentDir == 3; // [!code ++]
		int liquidLv = RenderObject.currentParam.liquidLv; // [!code ++]
		float num = ((replacer != null) ? replacer.pref.hatY : pref.hatY); // [!code ++]
		if (pccData != null) // [!code ++]
		{ // [!code ++]
			num += RenderObject.renderSetting.hatPos[actor.GetFrame()].y; // [!code ++]
		} // [!code ++]
		RenderObject.currentParam.liquidLv = 0; // [!code ++]
		RenderObject.currentParam.x += 0.01f * (float)pref.equipX; // [!code ++]
		RenderObject.currentParam.y += num + 0.01f * (float)pref.equipY; // [!code ++]
		RenderObject.currentParam.z -= pref.hatY; // [!code ++]
		RenderObject.currentParam.tile = cardRow._tiles[owner.uid % cardRow._tiles.Length] * ((!flag) ? 1 : (-1)); // [!code ++]
		cardRow.renderData.Draw(RenderObject.currentParam); // [!code ++]
		RenderObject.currentParam.y -= num; // [!code ++]
		RenderObject.currentParam.liquidLv = liquidLv; // [!code ++]
	}

	public override void DrawHeld()
```

## +ConBrightnessOfLife

::: details File Created
```cs
public class ConBrightnessOfLife : BaseBuff
{
	public override void OnStart()
	{
		(owner.ai as GoalCombat)?.TryAddAbility(6410);
	}

	public override void OnRemoved()
	{
		(owner.ai as GoalCombat)?.TryRemoveAbility(6410);
	}
}
```

:::
## Core

[`@@ -221,6 +221,8 @@ public void StartCase()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Core.cs#L221-L226)
```cs:line-numbers=221
		StartCoroutine(mods.RefreshMods(delegate
		{
			MOD.actorSources.Initialize();
			SpriteReplacer.dictSkins.Clear(); // [!code ++]
			SpriteReplacer.ListSkins(); // [!code ++]
			StartCase();
		}, !ModManager.disableMod && !BaseCore.IsOffline && !debug.skipModSync && (config == null || config.other.syncMods)));
		return;
```

## CoreDebug

[`@@ -993,6 +993,13 @@ public void UpdateInput()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/CoreDebug.cs#L993-L998)
```cs:line-numbers=993
		foreach (Chara member in EClass.pc.party.members)
		{
			member.InstantEat();
			if (!member.IsPC) // [!code ++]
			{ // [!code ++]
				string id = "test"; // [!code ++]
				member.spriteReplacer = new SpriteReplacer(); // [!code ++]
				member.spriteReplacer.HasSprite(id); // [!code ++]
				member._CreateRenderer(); // [!code ++]
			} // [!code ++]
		}
		for (int j = 0; j < 10; j++)
		{
```

[`@@ -1022,9 +1029,9 @@ public void UpdateInput()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/CoreDebug.cs#L1022-L1030)
```cs:line-numbers=1022
	{
		EClass.core.WaitForEndOfFrame(delegate
		{
			string id = (Input.GetKey(KeyCode.LeftControl) ? "quick3" : (Input.GetKey(KeyCode.LeftShift) ? "quick2" : "quick")); // [!code --]
			string id2 = (Input.GetKey(KeyCode.LeftControl) ? "quick3" : (Input.GetKey(KeyCode.LeftShift) ? "quick2" : "quick")); // [!code ++]
			EClass.scene.Init(Scene.Mode.None);
			Game.Load(id, cloud: false); // [!code --]
			Game.Load(id2, cloud: false); // [!code ++]
		});
	}
	if (Input.GetKeyDown(KeyCode.F7))
```

## ELEMENT

[`@@ -1038,7 +1038,7 @@ public virtual Act.Cost GetCost(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/ELEMENT.cs#L1038-L1044)
```cs:line-numbers=1038
		switch (source.id)
		{
		case 6020:
			result2.cost = c.stamina.max / 3 + 10; // [!code --]
			result2.cost = Mathf.Min(c.stamina.max / 3 + 10, 30); // [!code ++]
			break;
		case 6664:
		{
```

## FACTION

[`@@ -38,7 +38,7 @@ public class FACTION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/FACTION.cs#L38-L44)
```cs:line-numbers=38

	public const int fElec = 2201;

	public const int fSoil = 2200; // [!code --]
	public const int fHeirloom = 2120; // [!code ++]

	public const int bfTranquil = 3703;

```

[`@@ -106,16 +106,16 @@ public class FACTION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/FACTION.cs#L106-L121)
```cs:line-numbers=106

	public const int fConstruction = 2003;

	public const int fHeirloom = 2120; // [!code --]
	public const int fSoil = 2200; // [!code ++]

	public static readonly int[] IDS = new int[52]
	{
		3700, 3701, 3604, 3605, 3500, 3702, 3603, 3602, 3601, 3600,
		2207, 4005, 2205, 2204, 2203, 2202, 2201, 2200, 3703, 2119, // [!code --]
		2207, 4005, 2205, 2204, 2203, 2202, 2201, 2120, 3703, 2119, // [!code ++]
		2118, 2117, 2116, 2206, 3704, 3802, 3706, 4006, 4003, 4002,
		2115, 4001, 4000, 3900, 3805, 3804, 3803, 3705, 4004, 3800,
		3784, 3783, 3782, 3781, 3780, 3710, 3709, 3708, 3707, 3801,
		2003, 2120 // [!code --]
		2003, 2200 // [!code ++]
	};
}
public class Faction : EClass
```

## FEAT

[`@@ -227,10 +227,10 @@ public class FEAT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/FEAT.cs#L227-L236)
```cs:line-numbers=227

	public const int featFairysan = 1413;

	public const int featBoost = 1409; // [!code --]
 // [!code --]
	public const int featPaladin2 = 1408;

	public const int featBoost = 1409; // [!code ++]
 // [!code ++]
	public const int featWhiteVixen = 1414;

	public static readonly int[] IDS = new int[115]
```

[`@@ -246,7 +246,7 @@ public class FEAT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/FEAT.cs#L246-L252)
```cs:line-numbers=246
		1404, 1233, 1231, 1416, 1213, 1214, 1215, 1216, 1217, 1218,
		1219, 1220, 1232, 1221, 1223, 1212, 1224, 1225, 1226, 1227,
		1228, 1229, 1230, 1222, 1405, 1310, 1407, 1406, 1410, 1411,
		1412, 1413, 1409, 1408, 1414 // [!code --]
		1412, 1413, 1408, 1409, 1414 // [!code ++]
	};
}
public class Feat : Element
```

## FOOD

[`@@ -1,6 +1,6 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/FOOD.cs#L1-L6)
```cs:line-numbers=1
public class FOOD
{
	public const int food_CHA = 700; // [!code --]
	public const int food_undead = 709; // [!code ++]

	public const int justcooked = 757;

```

[`@@ -8,7 +8,7 @@ public class FOOD`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/FOOD.cs#L8-L14)
```cs:line-numbers=8

	public const int food_cat = 701;

	public const int food_undead = 709; // [!code --]
	public const int food_CHA = 700; // [!code ++]

	public const int food_love = 703;

```

[`@@ -26,7 +26,7 @@ public class FOOD`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/FOOD.cs#L26-L32)
```cs:line-numbers=26

	public static readonly int[] IDS = new int[12]
	{
		700, 757, 758, 701, 709, 703, 702, 707, 706, 708, // [!code --]
		709, 757, 758, 701, 700, 703, 702, 707, 706, 708, // [!code ++]
		704, 705
	};
}
```

## GameLang

[`@@ -90,6 +90,7 @@ public static string ConvertDrama(string text, Chara c = null)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/GameLang.cs#L90-L95)
```cs:line-numbers=90
	stringBuilder.Replace("#zone", EClass._zone.Name);
	stringBuilder.Replace("#guild_title", Guild.Current.relation.TextTitle);
	stringBuilder.Replace("#guild", Guild.Current.Name);
	stringBuilder.Replace("#race", EClass.pc.race.GetName().AddArticle()); // [!code ++]
	stringBuilder.Replace("#pc", EClass.pc.NameSimple);
	stringBuilder.Replace("#aka", EClass.pc.Aka);
	stringBuilder.Replace("#bigdaddy", "bigdaddy".lang());
```

## GoalAutoCombat

[`@@ -120,6 +120,10 @@ public override void BuildAbilityList()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/GoalAutoCombat.cs#L120-L125)
```cs:line-numbers=120
		AddAbility(ACT.Ranged);
		AddAbility(ACT.Melee);
		AddAbility(ACT.Item);
		if (owner.HasCondition<ConBrightnessOfLife>()) // [!code ++]
		{ // [!code ++]
			TryAddAbility(6410); // [!code ++]
		} // [!code ++]
	}

	public override bool TryAbortCombat()
```

## GoalCombat

[`@@ -416,6 +416,40 @@ public void AddAbility(Act a, int mod = 0, int chance = 100, bool aiPt = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/GoalCombat.cs#L416-L421)
```cs:line-numbers=416
		});
	}

	public void TryAddAbility(int ele) // [!code ++]
	{ // [!code ++]
		if (abilities == null) // [!code ++]
		{ // [!code ++]
			BuildAbilityList(); // [!code ++]
		} // [!code ++]
		foreach (ItemAbility ability in abilities) // [!code ++]
		{ // [!code ++]
			Act obj = ability.act; // [!code ++]
			if (obj != null && obj.id == ele) // [!code ++]
			{ // [!code ++]
				return; // [!code ++]
			} // [!code ++]
		} // [!code ++]
		AddAbility(Element.Create(ele) as Act); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void TryRemoveAbility(int ele) // [!code ++]
	{ // [!code ++]
		if (abilities == null) // [!code ++]
		{ // [!code ++]
			return; // [!code ++]
		} // [!code ++]
		foreach (ItemAbility ability in abilities) // [!code ++]
		{ // [!code ++]
			Act obj = ability.act; // [!code ++]
			if (obj != null && obj.id == ele) // [!code ++]
			{ // [!code ++]
				abilities.Remove(ability); // [!code ++]
				break; // [!code ++]
			} // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public virtual bool TryUseRanged(int dist)
	{
		if (owner.TryEquipRanged())
```

[`@@ -548,9 +582,9 @@ public virtual bool TryUseAbility(int dist, bool beforeMove = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/GoalCombat.cs#L548-L556)
```cs:line-numbers=548
			break;
		case "taunt":
		{
			bool flag6 = owner.HasCondition<StanceTaunt>(); // [!code --]
			bool flag7 = tactics.source.taunt != -1 && 100 * owner.hp / owner.MaxHP >= tactics.source.taunt; // [!code --]
			num = ((flag6 && !flag7) ? 100 : ((!flag6 && flag7) ? 100 : 0)); // [!code --]
			bool flag7 = owner.HasCondition<StanceTaunt>(); // [!code ++]
			bool flag8 = tactics.source.taunt != -1 && 100 * owner.hp / owner.MaxHP >= tactics.source.taunt; // [!code ++]
			num = ((flag7 && !flag8) ? 100 : ((!flag7 && flag8) ? 100 : 0)); // [!code ++]
			break;
		}
		case "melee":
```

[`@@ -629,13 +663,13 @@ public virtual bool TryUseAbility(int dist, bool beforeMove = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/GoalCombat.cs#L629-L641)
```cs:line-numbers=629
			{
				continue;
			}
			bool flag8 = text == "dot"; // [!code --]
			if (flag8 && (owner.isRestrained || (tc != null && tc.IsRestrainedResident))) // [!code --]
			bool flag6 = text == "dot"; // [!code ++]
			if (flag6 && (owner.isRestrained || (tc != null && tc.IsRestrainedResident))) // [!code ++]
			{
				continue;
			}
			num = ((text == "attackMelee") ? tactics.P_Melee : tactics.P_Spell) + GetAttackMod(act);
			if (num > 0 && flag8) // [!code --]
			if (num > 0 && flag6) // [!code ++]
			{
				num += 10;
			}
```

[`@@ -762,7 +796,7 @@ public virtual bool TryUseAbility(int dist, bool beforeMove = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/GoalCombat.cs#L762-L768)
```cs:line-numbers=762
				break;
			}
			num = 100 - 125 * owner.hp / owner.MaxHP;
			if (EClass.rnd(200) <= num) // [!code --]
			if (EClass.rnd(200) <= num && (!owner.IsPowerful || owner.hp < owner.MaxHP / 2)) // [!code ++]
			{
				break;
			}
```

[`@@ -1067,6 +1101,10 @@ public virtual void BuildAbilityList()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/GoalCombat.cs#L1067-L1072)
```cs:line-numbers=1067
		AddAbility(ACT.Ranged);
		AddAbility(ACT.Melee);
		AddAbility(ACT.Item);
		if (owner.HasCondition<ConBrightnessOfLife>()) // [!code ++]
		{ // [!code ++]
			TryAddAbility(6410); // [!code ++]
		} // [!code ++]
	}

	public virtual bool TryAbortCombat()
```

## +LayerEditSkin

::: details File Created
```cs
using System.Collections.Generic;
using System.IO;
using System.Linq;
using UnityEngine.UI;

public class LayerEditSkin : ELayer
{
	public Image imageSkin;

	public Chara chara;

	public UIDynamicList list;

	public void Activate(Chara _chara)
	{
		chara = _chara;
		RefreshImage();
		RefreshList();
	}

	public void RefreshImage()
	{
		imageSkin.sprite = chara.GetSprite();
		imageSkin.SetNativeSize();
	}

	public void OnClickClear()
	{
		SE.Trash();
		chara.c_idSpriteReplacer = null;
		chara._CreateRenderer();
		RefreshImage();
	}

	public void RefreshList()
	{
		list.Clear();
		list.callbacks = new UIList.Callback<SpriteData, UIButton>
		{
			onClick = delegate(SpriteData a, UIButton b)
			{
				list.Select(a);
				SE.Click();
				chara.c_idSpriteReplacer = Path.GetFileName(a.path);
				chara._CreateRenderer();
				RefreshImage();
			},
			onRedraw = delegate(SpriteData a, UIButton b, int i)
			{
				b.mainText.SetText(Path.GetFileName(a.path));
				a.Init();
				b.icon.sprite = a.GetSprite();
				b.tooltip.lang = a.path;
			},
			onList = delegate
			{
				List<SpriteReplacer> obj = SpriteReplacer.ListSkins().Values.ToList();
				obj.Sort((SpriteReplacer a, SpriteReplacer b) => Lang.comparer.Compare(a.data.path, b.data.path));
				foreach (SpriteReplacer item in obj)
				{
					list.Add(item.data);
				}
			}
		};
		list.List();
	}
}
```

:::
## Party

[`@@ -41,9 +41,14 @@ public Chara leader`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Party.cs#L41-L49)
```cs:line-numbers=41
public List<Chara> SetMembers()
{
	_members = new List<Chara>();
	HashSet<int> hashSet = new HashSet<int>(); // [!code ++]
	foreach (int uidMember in uidMembers)
	{
		members.Add(RefChara.Get(uidMember)); // [!code --]
		if (!hashSet.Contains(uidMember)) // [!code ++]
		{ // [!code ++]
			hashSet.Add(uidMember); // [!code ++]
			members.Add(RefChara.Get(uidMember)); // [!code ++]
		} // [!code ++]
	}
	return _members;
}
```

## Player

[`@@ -1796,6 +1796,11 @@ public void EnterLocalZone(Point p, ZoneTransition trans = null, bool encounter`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Player.cs#L1796-L1801)
```cs:line-numbers=1796
			Msg.Say("voidClosed");
			return;
		}
		if (zone is Zone_Exile && EClass.player.CountKeyItem("key_exile") == 0) // [!code ++]
		{ // [!code ++]
			Msg.Say("exileClosed"); // [!code ++]
			return; // [!code ++]
		} // [!code ++]
		if (zone.IsClosed)
		{
			Msg.Say("zoneClosed");
```

## Region

[`@@ -69,6 +69,10 @@ public void CheckRandomSites()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Region.cs#L69-L74)
```cs:line-numbers=69
		{
			SpatialGen.Create("cave_yeek", this, register: true);
		}
		if (FindZone("village_exile") == null) // [!code ++]
		{ // [!code ++]
			SpatialGen.Create("village_exile", this, register: true); // [!code ++]
		} // [!code ++]
		elomap.objmap.UpdateMeshImmediate();
	}

```

## SKILL

[`@@ -246,12 +246,12 @@ public class SKILL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/SKILL.cs#L246-L257)
```cs:line-numbers=246

	public const int fun = 312;

	public const int eleCold = 911; // [!code ++]
 // [!code ++]
	public const int bladder = 311;

	public const int hygine = 310;

	public const int eleCold = 911; // [!code --]
 // [!code --]
	public const int faith = 306;

	public const int magicDevice = 305;
```

[`@@ -280,7 +280,7 @@ public class SKILL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/SKILL.cs#L280-L286)
```cs:line-numbers=280
		962, 963, 964, 965, 970, 971, 972, 255, 955, 914,
		920, 912, 257, 258, 259, 260, 261, 280, 281, 285,
		286, 913, 288, 289, 290, 291, 292, 287, 300, 293,
		910, 313, 312, 311, 310, 911, 306, 305, 304, 303, // [!code --]
		910, 313, 312, 911, 311, 310, 306, 305, 304, 303, // [!code ++]
		302, 301, 307
	};
}
```

## SLOT

[`@@ -1,16 +1,16 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/SLOT.cs#L1-L16)
```cs:line-numbers=1
public class SLOT
{
	public const int leg = 38; // [!code --]
	public const int waist = 37; // [!code ++]

	public const int arm = 34; // [!code --]
	public const int finger = 36; // [!code ++]

	public const int hand = 35; // [!code --]
	public const int back = 33; // [!code ++]

	public const int finger = 36; // [!code --]
	public const int arm = 34; // [!code ++]

	public const int waist = 37; // [!code --]
	public const int hand = 35; // [!code ++]

	public const int back = 33; // [!code --]
	public const int leg = 38; // [!code ++]

	public const int token = 43;

```

[`@@ -34,7 +34,7 @@ public class SLOT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/SLOT.cs#L34-L40)
```cs:line-numbers=34

	public static readonly int[] IDS = new int[16]
	{
		38, 34, 35, 36, 37, 33, 43, 45, 40, 44, // [!code --]
		37, 36, 33, 34, 35, 38, 43, 45, 40, 44, // [!code ++]
		41, 32, 39, 31, 42, 30
	};
}
```

## SPELL

[`@@ -50,11 +50,11 @@ public class SPELL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/SPELL.cs#L50-L60)
```cs:line-numbers=50

	public const int bolt_Holy = 50309;

	public const int hand_Void = 50416; // [!code --]
	public const int puddle_Nether = 50906; // [!code ++]

	public const int hand_Holy = 50409;

	public const int puddle_Nether = 50906; // [!code --]
	public const int hand_Void = 50416; // [!code ++]

	public const int miasma_Nether = 50706;

```

[`@@ -72,10 +72,10 @@ public class SPELL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/SPELL.cs#L72-L81)
```cs:line-numbers=72

	public const int sword_Mind = 51004;

	public const int ball_Poison = 50105; // [!code --]
 // [!code --]
	public const int weapon_Void = 50816;

	public const int ball_Poison = 50105; // [!code ++]
 // [!code ++]
	public const int miasma_Void = 50716;

	public const int bolt_Poison = 50305;
```

[`@@ -92,10 +92,10 @@ public class SPELL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/SPELL.cs#L92-L101)
```cs:line-numbers=92

	public const int puddle_Poison = 50905;

	public const int sword_Poison = 51005; // [!code --]
 // [!code --]
	public const int funnel_Void = 50616;

	public const int sword_Poison = 51005; // [!code ++]
 // [!code ++]
	public const int ball_Nether = 50106;

	public const int arrow_Void = 50516;
```

[`@@ -276,6 +276,8 @@ public class SPELL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/SPELL.cs#L276-L281)
```cs:line-numbers=276

	public const int SpRebirth = 8550;

	public const int SpBrightnessOfLife = 8555; // [!code ++]
 // [!code ++]
	public const int SpSilence = 8700;

	public const int SpWeakness = 8702;
```

[`@@ -286,11 +288,9 @@ public class SPELL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/SPELL.cs#L286-L296)
```cs:line-numbers=286

	public const int SpBane = 8706;

	public const int SpGravity = 8708; // [!code --]
 // [!code --]
	public const int SpHolyVeil = 8500;

	public const int SpSpeedDown = 8710; // [!code --]
	public const int SpGravity = 8708; // [!code ++]

	public const int SpMutation = 8380;

```

[`@@ -354,11 +354,11 @@ public class SPELL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/SPELL.cs#L354-L364)
```cs:line-numbers=354

	public const int SpIdentify = 8230;

	public const int ball_Mind = 50104; // [!code --]
	public const int SpSpeedDown = 8710; // [!code ++]

	public const int SpTelepathy = 8770;

	public const int SpSeeInvisible = 8776; // [!code --]
	public const int SpInvisibility = 8775; // [!code ++]

	public const int puddle_Fire = 50900;

```

[`@@ -418,12 +418,14 @@ public class SPELL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/SPELL.cs#L418-L429)
```cs:line-numbers=418

	public const int arrow_Lightning = 50502;

	public const int SpInvisibility = 8775; // [!code --]
 // [!code --]
	public const int funnel_Fire = 50600;

	public const int arrow_Fire = 50500; // [!code ++]
 // [!code ++]
	public const int hand_Fire = 50400;

	public const int SpSeeInvisible = 8776; // [!code ++]
 // [!code ++]
	public const int SpIncognito = 8780;

	public const int SpTransmuteBroom = 8790;
```

[`@@ -450,10 +452,10 @@ public class SPELL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/SPELL.cs#L450-L459)
```cs:line-numbers=450

	public const int SpSummonOrc = 9007;

	public const int arrow_Fire = 50500; // [!code --]
 // [!code --]
	public const int SpSummonFish = 9008;

	public const int SpSummonTako = 9009; // [!code ++]
 // [!code ++]
	public const int SpSummonShubKid = 9010;

	public const int SpSummonShadow = 9050;
```

[`@@ -480,17 +482,17 @@ public class SPELL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/SPELL.cs#L480-L496)
```cs:line-numbers=480

	public const int bolt_Fire = 50300;

	public const int SpSummonTako = 9009; // [!code --]
	public const int ball_Mind = 50104; // [!code ++]

	public const int sword_Void = 51016;

	public static readonly int[] IDS = new int[242] // [!code --]
	public static readonly int[] IDS = new int[243] // [!code ++]
	{
		50415, 51006, 50107, 50316, 50307, 50407, 50507, 50607, 50707, 50807,
		50907, 51007, 50108, 50116, 50308, 50408, 50508, 50608, 50708, 50808,
		50908, 51008, 50109, 51015, 50309, 50416, 50409, 50906, 50706, 50404, // [!code --]
		50504, 50604, 50704, 50804, 50904, 51004, 50105, 50816, 50716, 50305, // [!code --]
		50405, 50505, 50605, 50705, 50805, 50905, 51005, 50616, 50106, 50516, // [!code --]
		50908, 51008, 50109, 51015, 50309, 50906, 50409, 50416, 50706, 50404, // [!code ++]
		50504, 50604, 50704, 50804, 50904, 51004, 50816, 50105, 50716, 50305, // [!code ++]
		50405, 50505, 50605, 50705, 50805, 50905, 50616, 51005, 50106, 50516, // [!code ++]
		50306, 50406, 50506, 50606, 50806, 50315, 50509, 50709, 50712, 50812,
		50912, 51012, 50113, 50615, 50313, 50413, 50513, 50304, 50713, 50813,
		50913, 51013, 50114, 50515, 50314, 50414, 50514, 50614, 50714, 50814,
```

[`@@ -499,18 +501,18 @@ public class SPELL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/SPELL.cs#L499-L516)
```cs:line-numbers=499
		50111, 50815, 50311, 50411, 50511, 50611, 50711, 50811, 50911, 51011,
		50112, 50715, 50412, 50613, 50800, 51003, 8400, 8401, 8402, 8403,
		8404, 8405, 8406, 8430, 8450, 8470, 8471, 8480, 8490, 8390,
		8491, 8501, 8502, 8503, 8504, 8506, 8510, 8550, 8700, 8702, // [!code --]
		8704, 8705, 8706, 8708, 8500, 8710, 8380, 8288, 7001, 7002, // [!code --]
		8491, 8501, 8502, 8503, 8504, 8506, 8510, 8550, 8555, 8700, // [!code ++]
		8702, 8704, 8705, 8706, 8500, 8708, 8380, 8288, 7001, 7002, // [!code ++]
		7003, 7004, 7005, 7006, 7007, 7008, 7800, 8200, 8201, 8202,
		8220, 8300, 8221, 8232, 8240, 8241, 8250, 8251, 8255, 8256,
		8260, 8280, 8281, 8284, 8285, 8286, 8230, 50104, 8770, 8776, // [!code --]
		8260, 8280, 8281, 8284, 8285, 8286, 8230, 8710, 8770, 8775, // [!code ++]
		50900, 51000, 50101, 50301, 50401, 50501, 50601, 50701, 50801, 50901,
		51001, 50102, 50302, 50700, 50402, 50602, 50702, 50802, 50902, 51002,
		50103, 50303, 50403, 50503, 50603, 50703, 50803, 50903, 50502, 8775, // [!code --]
		50600, 50400, 8780, 8790, 8791, 8800, 8801, 9000, 9001, 9002, // [!code --]
		9003, 9004, 9005, 9006, 9007, 50500, 9008, 9010, 9050, 9150, // [!code --]
		9151, 9160, 9200, 9500, 9501, 9502, 9503, 50100, 50916, 50300, // [!code --]
		9009, 51016 // [!code --]
		50103, 50303, 50403, 50503, 50603, 50703, 50803, 50903, 50502, 50600, // [!code ++]
		50500, 50400, 8776, 8780, 8790, 8791, 8800, 8801, 9000, 9001, // [!code ++]
		9002, 9003, 9004, 9005, 9006, 9007, 9008, 9009, 9010, 9050, // [!code ++]
		9150, 9151, 9160, 9200, 9500, 9501, 9502, 9503, 50100, 50916, // [!code ++]
		50300, 50104, 51016 // [!code ++]
	};
}
public class Spell : Ability
```

## SourceElement

[`@@ -387,7 +387,7 @@ public override void OnAfterImportData()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/SourceElement.cs#L387-L393)
```cs:line-numbers=387

	public void AddRow(Row ele, int id, string idOrg)
	{
		if (!map.ContainsKey(id)) // [!code --]
		if (Application.isEditor || !map.ContainsKey(id)) // [!code ++]
		{
			Row row = EClass.sources.elements.alias[idOrg];
			System.Reflection.FieldInfo[] fields = row.GetType().GetFields();
```

## TaskHarvest

[`@@ -471,7 +471,21 @@ public string GetIdDismantled()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/TaskHarvest.cs#L471-L477)
```cs:line-numbers=471
	{
		return "fish_slice";
	}
	string result = target.source.components[0].Split('|')[0].Split('/')[0]; // [!code --]
	string[] array = target.source.components[0].Split('|'); // [!code ++]
	for (int i = 0; i < array.Length; i++) // [!code ++]
	{ // [!code ++]
		array[i] = array[i].Split('/')[0]; // [!code ++]
	} // [!code ++]
	string result = array[0]; // [!code ++]
	if (array.Length > 1) // [!code ++]
	{ // [!code ++]
		string category = target.material.category; // [!code ++]
		bool flag = category == "rock" || category == "ore" || category == "gem"; // [!code ++]
		if (array[0] == "ingot" && array[1] == "log" && !flag) // [!code ++]
		{ // [!code ++]
			result = array[1]; // [!code ++]
		} // [!code ++]
	} // [!code ++]
	if (target.IsEquipmentOrRangedOrAmmo)
	{
		result = target.material.thing;
```

## TileMapElona

[`@@ -461,7 +461,7 @@ public override void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/TileMapElona.cs#L461-L467)
```cs:line-numbers=461
			break;
		}
		default:
			param.tile = sourceBlock._tiles[cell.blockDir % sourceBlock._tiles.Length] + ((_lowblock && base.tileType.UseLowWallTiles) ? 3000000 : 0); // [!code --]
			param.tile = sourceBlock._tiles[cell.blockDir % sourceBlock._tiles.Length] + ((_lowblock && base.tileType.UseLowBlock) ? 3000000 : 0); // [!code ++]
			param.matColor = ((sourceBlock.colorMod == 0) ? 104025 : BaseTileMap.GetColorInt(ref matBlock.matColor, sourceBlock.colorMod));
			if (roomHeight == 0f)
			{
```

## TileType

[`@@ -44,6 +44,8 @@ public enum RampType`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/TileType.cs#L44-L49)
```cs:line-numbers=44

	public static TileTypeWallOpen WallOpen = new TileTypeWallOpen();

	public static TileTypeWallFake WallFake = new TileTypeWallFake(); // [!code ++]
 // [!code ++]
	public static TileTypeFence Fence = new TileTypeFence();

	public static TileTypeFenceClosed FenceClosed = new TileTypeFenceClosed();
```

[`@@ -204,8 +206,6 @@ public enum RampType`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/TileType.cs#L204-L211)
```cs:line-numbers=204

	public virtual bool AltitudeAsDir => false;

	public virtual bool UseLowWallTiles => false; // [!code --]
 // [!code --]
	public virtual bool UseMountHeight => false;

	public virtual bool UseHangZFix => false;
```

## TileTypePillar

[`@@ -2,8 +2,6 @@ public class TileTypePillar : TileTypeBaseBlock`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/TileTypePillar.cs#L2-L9)
```cs:line-numbers=2
{
	public override bool RepeatBlock => true;

	public override bool UseLowWallTiles => false; // [!code --]
 // [!code --]
	public override bool ForceRpeatBlock => true;

	public override int MaxAltitude => 7;
```

[`@@ -14,5 +12,7 @@ public class TileTypePillar : TileTypeBaseBlock`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/TileTypePillar.cs#L14-L18)
```cs:line-numbers=14

	public override bool IsOccupyCell => false;

	public override bool UseLowBlock => false; // [!code ++]
 // [!code ++]
	public override BlockRenderMode blockRenderMode => BlockRenderMode.Pillar;
}
```

## +TileTypeWallFake

::: details File Created
```cs
public class TileTypeWallFake : TileTypeWallOpen
{
	public override bool IsBlockPass => false;

	public override bool UseLowBlock => false;
}
```

:::
## Trait

[`@@ -1131,8 +1131,8 @@ public virtual void TryToggle()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Trait.cs#L1131-L1138)
```cs:line-numbers=1131
	}
	else if (AutoToggle)
	{
		int hour = EClass.world.date.hour; // [!code --]
		bool on = !IsNightOnlyLight || hour >= 17 || hour <= 5 || EClass._map.IsIndoor; // [!code --]
		int num = ((EClass._map.config.hour == -1) ? EClass.world.date.hour : EClass._map.config.hour); // [!code ++]
		bool on = !IsNightOnlyLight || num >= 17 || num <= 5 || EClass._map.IsIndoor; // [!code ++]
		if (ToggleType == ToggleType.Fire && EClass.world.weather.IsRaining && !EClass._map.IsIndoor && !owner.Cell.HasRoof)
		{
			on = false;
```

[`@@ -1601,7 +1601,7 @@ public void OnBarter()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Trait.cs#L1601-L1607)
```cs:line-numbers=1601
		break;
	case ShopType.RedBook:
	{
		for (int l = 0; l < 30; l++) // [!code --]
		for (int n = 0; n < 30; n++) // [!code ++]
		{
			AddThing(ThingGen.CreateFromCategory("book"));
		}
```

[`@@ -1614,11 +1614,11 @@ public void OnBarter()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Trait.cs#L1614-L1624)
```cs:line-numbers=1614
		AddThing(TraitSeed.MakeSeed("carrot")).SetNum(4 + EClass.rnd(4));
		AddThing(TraitSeed.MakeSeed("potato")).SetNum(4 + EClass.rnd(4));
		AddThing(TraitSeed.MakeSeed("corn")).SetNum(4 + EClass.rnd(4));
		for (int n = 0; n < EClass.rnd(3) + 1; n++) // [!code --]
		for (int num5 = 0; num5 < EClass.rnd(3) + 1; num5++) // [!code ++]
		{
			Add("462", 1, 0);
		}
		for (int num5 = 0; num5 < EClass.rnd(3) + 1; num5++) // [!code --]
		for (int num6 = 0; num6 < EClass.rnd(3) + 1; num6++) // [!code ++]
		{
			Add("1167", 1, 0);
		}
```

[`@@ -1705,6 +1705,17 @@ public void OnBarter()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Trait.cs#L1705-L1710)
```cs:line-numbers=1705
					thing3.DyeRandom();
					AddThing(thing3);
				}
				if (EClass._zone is Zone_Exile) // [!code ++]
				{ // [!code ++]
					for (int l = 0; l < 30; l++) // [!code ++]
					{ // [!code ++]
						Add("1235", 1, -1); // [!code ++]
						Add("1236", 1, -1); // [!code ++]
						Add("1237", 1, -1); // [!code ++]
						Add("1239", 1, -1); // [!code ++]
						Add("candle9", 1, -1); // [!code ++]
					} // [!code ++]
				} // [!code ++]
				break;
			}
			case ShopType.Casino:
```

[`@@ -1813,15 +1824,15 @@ public void OnBarter()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Trait.cs#L1813-L1827)
```cs:line-numbers=1813
			{
			case ShopType.StrangeGirl:
			{
				int num8 = (EClass.debug.enable ? 20 : (EClass._zone.development / 10)); // [!code --]
				if (num8 > 0) // [!code --]
				int num9 = (EClass.debug.enable ? 20 : (EClass._zone.development / 10)); // [!code ++]
				if (num9 > 0) // [!code ++]
				{
					Add("syringe_gene", num8, 0); // [!code --]
					Add("syringe_gene", num9, 0); // [!code ++]
					Add("diary_little", 1, 0);
				}
				if (num8 > 10) // [!code --]
				if (num9 > 10) // [!code ++]
				{
					Add("syringe_heaven", num8 / 5, 0); // [!code --]
					Add("syringe_heaven", num9 / 5, 0); // [!code ++]
				}
				break;
			}
```

[`@@ -1871,12 +1882,12 @@ public void OnBarter()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Trait.cs#L1871-L1882)
```cs:line-numbers=1871
					Add("ticket_armpillow", 1, 0);
					Add("ticket_champagne", 1, 0);
				}
				for (int num6 = 0; num6 < 3; num6++) // [!code --]
				for (int num7 = 0; num7 < 3; num7++) // [!code ++]
				{
					if (EClass.rnd(5) == 0)
					{
						TreasureType treasureType = ((EClass.rnd(10) == 0) ? TreasureType.BossNefia : ((EClass.rnd(10) == 0) ? TreasureType.Map : TreasureType.RandomChest));
						int num7 = EClass.rnd(EClass.rnd(ShopLv + (EClass.debug.enable ? 200 : 50)) + 1) + 1; // [!code --]
						int num8 = EClass.rnd(EClass.rnd(ShopLv + (EClass.debug.enable ? 200 : 50)) + 1) + 1; // [!code ++]
						Thing thing5 = ThingGen.Create(treasureType switch
						{
							TreasureType.Map => "chest_treasure", 
```

[`@@ -1884,10 +1895,10 @@ public void OnBarter()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Trait.cs#L1884-L1893)
```cs:line-numbers=1884
							_ => "chest3", 
						});
						thing5.c_lockedHard = true;
						thing5.c_lockLv = num7; // [!code --]
						thing5.c_priceAdd = 2000 + num7 * 250 * ((treasureType == TreasureType.RandomChest) ? 1 : 5); // [!code --]
						thing5.c_lockLv = num8; // [!code ++]
						thing5.c_priceAdd = 2000 + num8 * 250 * ((treasureType == TreasureType.RandomChest) ? 1 : 5); // [!code ++]
						thing5.c_revealLock = true;
						ThingGen.CreateTreasureContent(thing5, num7, treasureType, clearContent: true); // [!code --]
						ThingGen.CreateTreasureContent(thing5, num8, treasureType, clearContent: true); // [!code ++]
						AddThing(thing5);
					}
				}
```

[`@@ -1897,7 +1908,7 @@ public void OnBarter()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Trait.cs#L1897-L1903)
```cs:line-numbers=1897
			ShopType shopType = ShopType;
			if (shopType == ShopType.General || shopType == ShopType.Food)
			{
				for (int num9 = 0; num9 < (EClass.debug.enable ? 3 : 3); num9++) // [!code --]
				for (int num10 = 0; num10 < (EClass.debug.enable ? 3 : 3); num10++) // [!code ++]
				{
					if (EClass.rnd(3) == 0)
					{
```

[`@@ -1987,11 +1998,11 @@ public void OnBarter()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Trait.cs#L1987-L1997)
```cs:line-numbers=1987
			{
				return;
			}
			int num10 = t.things.width * 10; // [!code --]
			if (t.things.Count > num10) // [!code --]
			int num11 = t.things.width * 10; // [!code ++]
			if (t.things.Count > num11) // [!code ++]
			{
				int num11 = t.things.Count - num10; // [!code --]
				for (int num12 = 0; num12 < num11; num12++) // [!code --]
				int num12 = t.things.Count - num11; // [!code ++]
				for (int num13 = 0; num13 < num12; num13++) // [!code ++]
				{
					t.things.LastItem().Destroy();
				}
```

[`@@ -2001,7 +2012,7 @@ Thing Add(string id, int a, int idSkin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/Trait.cs#L2001-L2007)
```cs:line-numbers=2001
			{
				CardBlueprint.SetNormalRarity();
				Thing thing6 = ThingGen.Create(id, -1, ShopLv).SetNum(a);
				thing6.idSkin = idSkin; // [!code --]
				thing6.idSkin = ((idSkin == -1) ? EClass.rnd(thing6.source.skins.Length + 1) : idSkin); // [!code ++]
				return t.AddThing(thing6);
			}
			Thing AddThing(Thing _t)
```

## +TraitCitizenExile

::: details File Created
```cs
public class TraitCitizenExile : TraitCitizen
{
	public override bool CanGuide => true;
}
```

:::
## +TraitExileElder

::: details File Created
```cs
public class TraitExileElder : TraitUniqueChara
{
	public override int GuidePriotiy => 99;

	public override ShopType ShopType => ShopType.Influence;

	public override CurrencyType CurrencyType => CurrencyType.Influence;

	public override bool CanInvite => false;
}
```

:::
## TraitStoryBookHome

[`@@ -6,6 +6,7 @@ public class TraitStoryBookHome : TraitScroll`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/TraitStoryBookHome.cs#L6-L11)
```cs:line-numbers=6
{
	public override void OnRead(Chara c)
	{
		Dictionary<string, int> dict = new Dictionary<string, int>(); // [!code ++]
		List<SourceQuest.Row> list = EClass.sources.quests.rows.Where((SourceQuest.Row q) => IsAvailable(q)).ToList();
		EClass.ui.AddLayer<LayerList>().SetSize().SetList2(list, (SourceQuest.Row a) => GetTitle(a), delegate(SourceQuest.Row a, ItemGeneral b)
		{
```

[`@@ -28,15 +29,14 @@ static Chara GetChara(string id)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/TraitStoryBookHome.cs#L28-L42)
```cs:line-numbers=28
	{
		return EClass.game.cards.globalCharas.Find(id);
	}
	static string GetTitle(SourceQuest.Row r) // [!code --]
	string GetTitle(SourceQuest.Row r) // [!code ++]
	{
		string name = r.GetName();
		string text = Regex.Replace(r.id, "([0-9]*$)", "");
		string str = r.id.Replace(text, "");
		int num = 1; // [!code --]
		if (!str.IsEmpty())
		{
			num = 1 + str.ToInt(); // [!code --]
			str.ToInt(); // [!code ++]
		}
		if (name.IsEmpty())
		{
```

[`@@ -46,7 +46,12 @@ static string GetTitle(SourceQuest.Row r)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/TraitStoryBookHome.cs#L46-L52)
```cs:line-numbers=46
				name = r.GetName();
			}
		}
		return name + " " + num; // [!code --]
		if (!dict.ContainsKey(name)) // [!code ++]
		{ // [!code ++]
			dict.Add(name, 0); // [!code ++]
		} // [!code ++]
		dict[name]++; // [!code ++]
		return name + " " + dict[name]; // [!code ++]
	}
	static bool IsAvailable(SourceQuest.Row r)
	{
```

[`@@ -64,13 +69,13 @@ static bool IsAvailable(SourceQuest.Row r)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/TraitStoryBookHome.cs#L64-L76)
```cs:line-numbers=64
			return true;
		}
		string str2 = r.id.Replace(text2, "");
		int num2 = 0; // [!code --]
		int num = 0; // [!code ++]
		if (!str2.IsEmpty())
		{
			num2 = str2.ToInt(); // [!code --]
			num = str2.ToInt(); // [!code ++]
		}
		Quest quest = EClass.game.quests.Get(text2);
		if (quest != null && num2 <= quest.phase) // [!code --]
		if (quest != null && num <= quest.phase) // [!code ++]
		{
			return true;
		}
```

## TraitWindow

[`@@ -14,11 +14,26 @@ public override bool UseExtra`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/60c05b2ba85b8d2dc1d014678aa3261ee60c60cf/Elin/TraitWindow.cs#L14-L24)
```cs:line-numbers=14
	{
		get
		{
			if (EClass.world.date.IsNight || EClass._map.IsIndoor) // [!code --]
			bool num; // [!code ++]
			if (EClass._map.config.hour != -1) // [!code ++]
			{
				return !owner.Cell.isCurtainClosed; // [!code --]
				if (EClass._map.config.hour >= 18) // [!code ++]
				{ // [!code ++]
					goto IL_005c; // [!code ++]
				} // [!code ++]
				num = EClass._map.config.hour <= 6; // [!code ++]
			}
			return false; // [!code --]
			else // [!code ++]
			{ // [!code ++]
				num = EClass.world.date.IsNight; // [!code ++]
			} // [!code ++]
			if (!num && !EClass._map.IsIndoor) // [!code ++]
			{ // [!code ++]
				return false; // [!code ++]
			} // [!code ++]
			goto IL_005c; // [!code ++]
			IL_005c: // [!code ++]
			return !owner.Cell.isCurtainClosed; // [!code ++]
		}
	}
}
```

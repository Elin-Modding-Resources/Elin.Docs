---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 15 files modified.
version: EA 23.109 Stable Patch 2
changes: Card/Chara/CraftUtil/DOMAIN/ELEMENT/ENC/ElementContainer/FACTION/FEAT/GrowSystem/LayerLoadGame/Map/RecipeManager/SourceThingV/Thing
---

# EA 23.109 Stable Patch 2

March 20, 2025

15 files modified.

## Important Changes

Possible breaking changes. Click the filename to view the chunk.
### [LayerLoadGame (1)](#layerloadgame)
```cs:no-line-numbers
public void RefreshList() // [!code --]
public void RefreshList(string id = null) // [!code ++]
```
## Card

[`@@ -4711,9 +4711,32 @@ public void SpawnLoot(Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/Card.cs#L4711-L4719)
```cs:line-numbers=4711
		}
		if (!isBackerContent && !flag)
		{
			if (id == "isca") // [!code --]
			switch (id) // [!code ++]
			{
			case "isca": // [!code ++]
				list.Add(ThingGen.Create("blood_angel"));
				break; // [!code ++]
			case "golem_wood": // [!code ++]
				if (chance(30)) // [!code ++]
				{ // [!code ++]
					list.Add(ThingGen.Create("crystal_earth")); // [!code ++]
				} // [!code ++]
				break; // [!code ++]
			case "golem_stone": // [!code ++]
				if (chance(30)) // [!code ++]
				{ // [!code ++]
					list.Add(ThingGen.Create("crystal_sun")); // [!code ++]
				} // [!code ++]
				break; // [!code ++]
			case "golem_steel": // [!code ++]
				if (chance(30)) // [!code ++]
				{ // [!code ++]
					list.Add(ThingGen.Create("crystal_mana")); // [!code ++]
				} // [!code ++]
				break; // [!code ++]
			case "golem_gold": // [!code ++]
				list.Add(ThingGen.Create("money2")); // [!code ++]
				break; // [!code ++]
			}
			int num5 = ((EClass._zone.Boss == this) ? 2 : ((this.rarity >= Rarity.Legendary) ? 1 : 0));
			if (EClass._zone is Zone_Void)
```

[`@@ -6177,6 +6200,27 @@ public void SetRandomTone()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/Card.cs#L6177-L6182)
```cs:line-numbers=6177
		c_idTone = MOD.tones.GetToneID(text, bio?.gender ?? 0);
	}

	public bool HasCraftBonusTrait() // [!code ++]
	{ // [!code ++]
		return ListCraftBonusTraits().Count > 0; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public List<Element> ListCraftBonusTraits() // [!code ++]
	{ // [!code ++]
		List<Element> list = new List<Element>(); // [!code ++]
		string[] tag = sourceCard.tag; // [!code ++]
		for (int i = 0; i < tag.Length; i++) // [!code ++]
		{ // [!code ++]
			string[] array = tag[i].Split('/'); // [!code ++]
			if (!(array[0] != "craft_bonus")) // [!code ++]
			{ // [!code ++]
				Element item = Element.Create(array[1], array[2].ToInt()); // [!code ++]
				list.Add(item); // [!code ++]
			} // [!code ++]
		} // [!code ++]
		return list; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void TryStack(Thing t)
	{
		if (t == this)
```

[`@@ -6644,7 +6688,7 @@ public virtual int GetPrice(CurrencyType currency = CurrencyType.Money, bool sel`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/Card.cs#L6644-L6650)
```cs:line-numbers=6644
			}
			if (IsDecayed)
			{
				p *= (flag ? 1.25f : 0.5f); // [!code --]
				p *= (flag ? 0.9f : 0.5f); // [!code ++]
			}
		}
		else
```

## Chara

[`@@ -2514,7 +2514,7 @@ public override MoveResult _Move(Point newPoint, MoveType type = MoveType.Walk)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/Chara.cs#L2514-L2520)
```cs:line-numbers=2514
			}
			if (newPoint.cell.CanSuffocate())
			{
				AddCondition<ConSuffocation>((EClass.pc.Evalue(200) != 0) ? (2000 / (100 + EvalueMax(200, -5) * 10)) : 30); // [!code --]
				AddCondition<ConSuffocation>((EClass.pc.Evalue(200) != 0) ? (2000 / (100 + EvalueMax(200, -5) * 10)) : 30, force: true); // [!code ++]
				int num4 = GetCondition<ConSuffocation>()?.GetPhase() ?? 0;
				if (num4 >= 2)
				{
```

[`@@ -3804,7 +3804,7 @@ public override void Tick()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/Chara.cs#L3804-L3810)
```cs:line-numbers=3804
	}
	if (IsPC && !EClass._zone.IsRegion && cell.CanSuffocate())
	{
		AddCondition<ConSuffocation>(800 / (100 + EvalueMax(200, -5) * 10)); // [!code --]
		AddCondition<ConSuffocation>(800 / (100 + EvalueMax(200, -5) * 10), force: true); // [!code ++]
	}
	CellEffect e;
	if (cell.effect != null)
```

[`@@ -6766,7 +6766,7 @@ public void TryTakeSharedItems(IEnumerable<Thing> containers, bool msg = true, b`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/Chara.cs#L6766-L6772)
```cs:line-numbers=6766
		}
		foreach (Thing thing4 in container.things)
		{
			if (!thing4.c_isImportant) // [!code --]
			if (!thing4.c_isImportant && thing4.IsIdentified) // [!code ++]
			{
				if (num3 > 0 && thing4.id == "polish_powder")
				{
```

[`@@ -9245,9 +9245,9 @@ public void ModTempElement(int ele, int a, bool naturalDecay = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/Chara.cs#L9245-L9253)
```cs:line-numbers=9245
	{
		a = a * 100 / (200 + (tempElements.Base(ele) - a) * 10);
	}
	int num = Mathf.Abs(elements.Base(ele)) * 2 + 20; // [!code --]
	int num = Mathf.Abs(elements.ValueWithoutLink(ele)) * 2 + 20; // [!code ++]
	int num2 = tempElements.Base(ele) + a;
	if (num2 < num || num2 > num) // [!code --]
	if (num2 < -num || num2 > num) // [!code ++]
	{
		a = 0;
	}
```

## CraftUtil

[`@@ -156,14 +156,11 @@ public static Card MixIngredients(Card product, List<Thing> ings, MixType type,`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/CraftUtil.cs#L156-L169)
```cs:line-numbers=156
			product.elements.SetTo(value2.id, 0);
		}
	}
	if (product.HasTag(CTAG.dish_bonus)) // [!code --]
	if (product.HasCraftBonusTrait()) // [!code ++]
	{
		foreach (Element value3 in product.sourceCard.model.elements.dict.Values) // [!code --]
		foreach (Element item in product.ListCraftBonusTraits()) // [!code ++]
		{
			if (value3.IsTrait || value3.IsFoodTraitMain) // [!code --]
			{ // [!code --]
				product.elements.ModBase(value3.id, value3.Value); // [!code --]
			} // [!code --]
			product.elements.ModBase(item.id, item.Value); // [!code ++]
		}
	}
	if (isFood)
```

[`@@ -227,6 +224,14 @@ public static Card MixIngredients(Card product, List<Thing> ings, MixType type,`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/CraftUtil.cs#L227-L232)
```cs:line-numbers=227
	{
		product.elements.ModBase(10, 6);
	}
	if (product.HasElement(762)) // [!code ++]
	{ // [!code ++]
		product.elements.ModBase(10, product.Evalue(762) / 5); // [!code ++]
		if (product.Evalue(10) < 1) // [!code ++]
		{ // [!code ++]
			product.elements.SetTo(10, 1); // [!code ++]
		} // [!code ++]
	} // [!code ++]
	return product;
	bool IsValidTrait(Element e)
	{
```

[`@@ -259,20 +264,20 @@ void MixElements(Card t)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/CraftUtil.cs#L259-L278)
```cs:line-numbers=259
	{
		if (t != null)
		{
			foreach (Element value4 in t.elements.dict.Values) // [!code --]
			foreach (Element value3 in t.elements.dict.Values) // [!code ++]
			{
				if (IsValidTrait(value4)) // [!code --]
				if (IsValidTrait(value3)) // [!code ++]
				{
					if (isFood && value4.IsFoodTraitMain) // [!code --]
					if (isFood && value3.IsFoodTraitMain) // [!code ++]
					{
						product.elements.ModBase(value4.id, value4.Value); // [!code --]
						product.elements.ModBase(value3.id, value3.Value); // [!code ++]
					}
					else
					{
						int num4 = product.elements.Base(value4.id); // [!code --]
						if ((num4 <= 0 && value4.Value < 0 && value4.Value < num4) || (value4.Value > 0 && value4.Value > num4)) // [!code --]
						int num4 = product.elements.Base(value3.id); // [!code ++]
						if ((num4 <= 0 && value3.Value < 0 && value3.Value < num4) || (value3.Value > 0 && value3.Value > num4)) // [!code ++]
						{
							product.elements.SetTo(value4.id, value4.Value); // [!code --]
							product.elements.SetTo(value3.id, value3.Value); // [!code ++]
						}
					}
				}
```

## DOMAIN

[`@@ -8,17 +8,17 @@ public class DOMAIN`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/DOMAIN.cs#L8-L24)
```cs:line-numbers=8

	public const int domMachine = 809;

	public const int domEyth = 814; // [!code --]
	public const int domOblivion = 813; // [!code ++]

	public const int domHarmony = 815; // [!code --]
	public const int domHarvest = 808; // [!code ++]

	public const int domEarth = 812; // [!code --]
	public const int domEyth = 814; // [!code ++]

	public const int domMiracle = 803; // [!code --]
	public const int domHarmony = 815; // [!code ++]

	public const int domTest = 800; // [!code --]
	public const int domFaith = 802; // [!code ++]

	public const int domHarvest = 808; // [!code --]
	public const int domEarth = 812; // [!code ++]

	public const int domWind = 807;

```

[`@@ -28,16 +28,16 @@ public class DOMAIN`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/DOMAIN.cs#L28-L43)
```cs:line-numbers=28

	public const int domArcane = 804;

	public const int domFaith = 802; // [!code --]
	public const int domMiracle = 803; // [!code ++]

	public const int domSurvival = 801;

	public const int domOblivion = 813; // [!code --]
	public const int domTest = 800; // [!code ++]

	public static readonly int[] IDS = new int[16]
	{
		811, 810, 809, 814, 815, 812, 803, 800, 808, 807, // [!code --]
		806, 805, 804, 802, 801, 813 // [!code --]
		811, 810, 809, 813, 808, 814, 815, 802, 812, 807, // [!code ++]
		806, 805, 804, 803, 801, 800 // [!code ++]
	};
}
public class Domain : EClass
```

## ELEMENT

[`@@ -5,6 +5,10 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/ELEMENT.cs#L5-L10)
```cs:line-numbers=5

public class ELEMENT
{
	public const int purity = 759; // [!code ++]
 // [!code ++]
	public const int roasted = 762; // [!code ++]
 // [!code ++]
	public const int stimulant = 760;

	public const int comfort = 750;
```

[`@@ -19,19 +23,17 @@ public class ELEMENT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/ELEMENT.cs#L19-L37)
```cs:line-numbers=19

	public const int blood = 755;

	public const int hotspring = 756; // [!code --]
 // [!code --]
	public const int recharge = 761;

	public const int purity = 759; // [!code --]
	public const int hotspring = 756; // [!code ++]

	public const int _void = 0;

	public const int quality = 2; // [!code --]
	public const int d = 3; // [!code ++]

	public const int lv = 1;

	public const int d = 3; // [!code --]
	public const int quality = 2; // [!code ++]

	public const int socket = 5;

```

[`@@ -71,12 +73,12 @@ public class ELEMENT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/ELEMENT.cs#L71-L82)
```cs:line-numbers=71

	public const int poison = 20;

	public static readonly int[] IDS = new int[33] // [!code --]
	public static readonly int[] IDS = new int[34] // [!code ++]
	{
		760, 750, 751, 752, 753, 754, 755, 756, 761, 759, // [!code --]
		0, 2, 1, 3, 5, 10, 11, 12, 13, 14, // [!code --]
		16, 17, 18, 15, 21, 22, 23, 24, 25, 26, // [!code --]
		29, 85, 20 // [!code --]
		759, 762, 760, 750, 751, 752, 753, 754, 755, 761, // [!code ++]
		756, 0, 3, 1, 2, 5, 10, 11, 12, 13, // [!code ++]
		14, 16, 17, 18, 15, 21, 22, 23, 24, 25, // [!code ++]
		26, 29, 85, 20 // [!code ++]
	};
}
public class Element : EClass
```

[`@@ -786,6 +788,154 @@ public void _WriteNote(UINote n, ElementContainer owner, Action<UINote> onWriteN`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/ELEMENT.cs#L786-L791)
```cs:line-numbers=786
		UIText.globalSizeMod = 0;
	}

	public void AddEncNote(UINote n, Card Card, ElementContainer.NoteMode mode = ElementContainer.NoteMode.Default, Func<Element, string, string> funcText = null, Action<UINote, Element> onAddNote = null) // [!code ++]
	{ // [!code ++]
		string text = ""; // [!code ++]
		switch (mode) // [!code ++]
		{ // [!code ++]
		case ElementContainer.NoteMode.Domain: // [!code ++]
			n.AddText(Name, FontColor.Default); // [!code ++]
			return; // [!code ++]
		case ElementContainer.NoteMode.Default: // [!code ++]
		case ElementContainer.NoteMode.BonusTrait: // [!code ++]
		{ // [!code ++]
			bool flag = source.tag.Contains("common"); // [!code ++]
			string categorySub = source.categorySub; // [!code ++]
			bool flag2 = false; // [!code ++]
			bool flag3 = (source.tag.Contains("neg") ? (Value > 0) : (Value < 0)); // [!code ++]
			int num = Mathf.Abs(Value); // [!code ++]
			bool flag4 = Card?.ShowFoodEnc ?? false; // [!code ++]
			bool flag5 = Card != null && Card.IsWeapon && this is Ability; // [!code ++]
			if (IsTrait || (flag4 && IsFoodTrait)) // [!code ++]
			{ // [!code ++]
				string[] textArray = source.GetTextArray("textAlt"); // [!code ++]
				int num2 = Mathf.Clamp(Value / 10 + 1, (Value < 0 || textArray.Length <= 2) ? 1 : 2, textArray.Length - 1); // [!code ++]
				text = "altEnc".lang(textArray[0].IsEmpty(Name), textArray[num2], EClass.debug.showExtra ? (Value + " " + Name) : ""); // [!code ++]
				flag3 = num2 <= 1 || textArray.Length <= 2; // [!code ++]
				flag2 = true; // [!code ++]
			} // [!code ++]
			else if (flag5) // [!code ++]
			{ // [!code ++]
				text = "isProc".lang(Name); // [!code ++]
				flag3 = false; // [!code ++]
			} // [!code ++]
			else if (categorySub == "resist") // [!code ++]
			{ // [!code ++]
				text = ("isResist" + (flag3 ? "Neg" : "")).lang(Name); // [!code ++]
			} // [!code ++]
			else if (categorySub == "eleAttack") // [!code ++]
			{ // [!code ++]
				text = "isEleAttack".lang(Name); // [!code ++]
			} // [!code ++]
			else if (!source.textPhase.IsEmpty() && Value > 0) // [!code ++]
			{ // [!code ++]
				text = source.GetText("textPhase"); // [!code ++]
			} // [!code ++]
			else // [!code ++]
			{ // [!code ++]
				string name = Name; // [!code ++]
				bool flag6 = source.category == "skill" || (source.category == "attribute" && !source.textPhase.IsEmpty()); // [!code ++]
				bool flag7 = source.category == "enchant"; // [!code ++]
				if (source.tag.Contains("multiplier")) // [!code ++]
				{ // [!code ++]
					flag6 = (flag7 = false); // [!code ++]
					name = EClass.sources.elements.alias[source.aliasRef].GetName(); // [!code ++]
				} // [!code ++]
				flag2 = !(flag6 || flag7); // [!code ++]
				text = (flag6 ? "textEncSkill" : (flag7 ? "textEncEnc" : "textEnc")).lang(name, num + (source.tag.Contains("ratio") ? "%" : ""), ((Value > 0) ? "encIncrease" : "encDecrease").lang()); // [!code ++]
			} // [!code ++]
			int num3 = ((!(this is Resistance)) ? 1 : 0); // [!code ++]
			int num4 = 5; // [!code ++]
			if (id == 484) // [!code ++]
			{ // [!code ++]
				num3 = 0; // [!code ++]
				num4 = 1; // [!code ++]
			} // [!code ++]
			if (!flag && !flag2 && !source.tag.Contains("flag")) // [!code ++]
			{ // [!code ++]
				text = text + " [" + "*".Repeat(Mathf.Clamp(num * source.mtp / num4 + num3, 1, 5)) + ((num * source.mtp / num4 + num3 > 5) ? "+" : "") + "]"; // [!code ++]
			} // [!code ++]
			if (HasTag("hidden") && mode != ElementContainer.NoteMode.BonusTrait) // [!code ++]
			{ // [!code ++]
				text = "(debug)" + text; // [!code ++]
			} // [!code ++]
			FontColor color = (flag ? FontColor.Default : (flag3 ? FontColor.Bad : FontColor.Good)); // [!code ++]
			if (IsGlobalElement) // [!code ++]
			{ // [!code ++]
				text = text + " " + (IsFactionWideElement ? "_factionWide" : "_partyWide").lang(); // [!code ++]
				if (!IsActive(Card)) // [!code ++]
				{ // [!code ++]
					return; // [!code ++]
				} // [!code ++]
				color = FontColor.Myth; // [!code ++]
			} // [!code ++]
			if (flag4 && IsFoodTrait && !IsFoodTraitMain) // [!code ++]
			{ // [!code ++]
				color = FontColor.FoodMisc; // [!code ++]
			} // [!code ++]
			if (id == 2 && Value >= 0) // [!code ++]
			{ // [!code ++]
				color = FontColor.FoodQuality; // [!code ++]
			} // [!code ++]
			if (funcText != null) // [!code ++]
			{ // [!code ++]
				text = funcText(this, text); // [!code ++]
			} // [!code ++]
			UIItem uIItem = n.AddText("NoteText_enc", text, color); // [!code ++]
			Sprite sprite = EClass.core.refs.icons.enc.enc; // [!code ++]
			Thing thing = Card?.Thing; // [!code ++]
			if (thing != null) // [!code ++]
			{ // [!code ++]
				if (thing.material.HasEnc(id)) // [!code ++]
				{ // [!code ++]
					sprite = EClass.core.refs.icons.enc.mat; // [!code ++]
				} // [!code ++]
				foreach (int key in thing.source.elementMap.Keys) // [!code ++]
				{ // [!code ++]
					if (key == id) // [!code ++]
					{ // [!code ++]
						sprite = EClass.core.refs.icons.enc.card; // [!code ++]
					} // [!code ++]
				} // [!code ++]
				if (thing.IsFood && IsFoodTrait) // [!code ++]
				{ // [!code ++]
					sprite = EClass.core.refs.icons.enc.traitFood; // [!code ++]
				} // [!code ++]
				if (id == thing.GetInt(107)) // [!code ++]
				{ // [!code ++]
					sprite = EClass.core.refs.icons.enc.cat; // [!code ++]
				} // [!code ++]
				if (thing.GetRuneEnc(id) != null) // [!code ++]
				{ // [!code ++]
					sprite = EClass.core.refs.icons.enc.rune; // [!code ++]
				} // [!code ++]
			} // [!code ++]
			if ((bool)sprite) // [!code ++]
			{ // [!code ++]
				uIItem.image1.SetActive(enable: true); // [!code ++]
				uIItem.image1.sprite = sprite; // [!code ++]
			} // [!code ++]
			uIItem.image2.SetActive(source.IsWeaponEnc); // [!code ++]
			onAddNote?.Invoke(n, this); // [!code ++]
			return; // [!code ++]
		} // [!code ++]
		} // [!code ++]
		UIItem uIItem2 = n.AddTopic("TopicAttribute", Name, "".TagColor((ValueWithoutLink > 0) ? SkinManager.CurrentColors.textGood : SkinManager.CurrentColors.textBad, ValueWithoutLink.ToString() ?? "")); // [!code ++]
		if ((bool)uIItem2.button1) // [!code ++]
		{ // [!code ++]
			uIItem2.button1.tooltip.onShowTooltip = delegate(UITooltip t) // [!code ++]
			{ // [!code ++]
				WriteNote(t.note, EClass.pc.elements); // [!code ++]
			}; // [!code ++]
		} // [!code ++]
		SetImage(uIItem2.image1); // [!code ++]
		Image image = uIItem2.image2; // [!code ++]
		int value = (Potential - 80) / 20; // [!code ++]
		image.enabled = Potential != 80; // [!code ++]
		image.sprite = EClass.core.refs.spritesPotential[Mathf.Clamp(Mathf.Abs(value), 0, EClass.core.refs.spritesPotential.Count - 1)]; // [!code ++]
		image.color = ((Potential - 80 >= 0) ? Color.white : new Color(1f, 0.7f, 0.7f)); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public virtual void OnWriteNote(UINote n, ElementContainer owner)
	{
	}
```

## ENC

[`@@ -1,5 +1,7 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/ENC.cs#L1-L5)
```cs:line-numbers=1
public class ENC
{
	public const int living = 653; // [!code ++]
 // [!code ++]
	public const int eco = 652;

	public const int r_PV = 651;
```

[`@@ -8,26 +10,22 @@ public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/ENC.cs#L8-L33)
```cs:line-numbers=8

	public const int r_mana = 641;

	public const int r_life = 640; // [!code --]
	public const int mod_frustration = 624; // [!code ++]

	public const int mod_flurry = 621;

	public const int mod_chaser = 620; // [!code --]
	public const int mod_cleave = 622; // [!code ++]

	public const int mod_feint = 623;

	public const int mod_cleave = 622; // [!code --]
 // [!code --]
	public const int living = 653; // [!code --]
	public const int noDamage = 654; // [!code ++]

	public const int mod_frustration = 624; // [!code --]
	public const int r_life = 640; // [!code ++]

	public const int noDamage = 654; // [!code --]
	public const int onlyPet = 655; // [!code ++]

	public const int convertCold = 851;

	public const int permaCurse = 656; // [!code --]
 // [!code --]
	public const int absorbHP = 660;

	public const int absorbMP = 661;
```

[`@@ -44,19 +42,19 @@ public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/ENC.cs#L44-L62)
```cs:line-numbers=44

	public const int convertFire = 850;

	public const int mod_splash = 608; // [!code --]
	public const int mod_chaser = 620; // [!code ++]

	public const int convertImpact = 865;

	public const int convertLightning = 852;

	public const int onlyPet = 655; // [!code --]
	public const int permaCurse = 656; // [!code ++]

	public const int mod_scatter = 607; // [!code --]
	public const int mod_splash = 608; // [!code ++]

	public const int bane_animal = 463; // [!code --]
	public const int bane_man = 464; // [!code ++]

	public const int mod_precision = 605; // [!code --]
	public const int mod_drill = 606; // [!code ++]

	public const int allNeckHunt = 428;

```

[`@@ -110,7 +108,7 @@ public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/ENC.cs#L110-L116)
```cs:line-numbers=110

	public const int negateTeleport = 400;

	public const int mod_drill = 606; // [!code --]
	public const int mod_scatter = 607; // [!code ++]

	public const int breathing = 429;

```

[`@@ -118,7 +116,11 @@ public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/ENC.cs#L118-L124)
```cs:line-numbers=118

	public const int negateParalysis = 422;

	public const int slot_rune = 484; // [!code --]
	public const int sustain_DEX = 442; // [!code ++]
 // [!code ++]
	public const int mod_precision = 605; // [!code ++]
 // [!code ++]
	public const int mod_ammo_recover = 604; // [!code ++]

	public const int mod_ammo_knockback = 603;

```

[`@@ -144,10 +146,14 @@ public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/ENC.cs#L144-L153)
```cs:line-numbers=144

	public const int bane_god = 466;

	public const int bane_man = 464; // [!code --]
 // [!code --]
	public const int bane_machine = 465;

	public const int slot_rune = 484; // [!code ++]
 // [!code ++]
	public const int bane_animal = 463; // [!code ++]
 // [!code ++]
	public const int bane_fairy = 462; // [!code ++]
 // [!code ++]
	public const int bane_undead = 461;

	public const int bane_dragon = 460;
```

[`@@ -160,24 +166,18 @@ public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/ENC.cs#L160-L183)
```cs:line-numbers=160

	public const int sustain_LER = 444;

	public const int bane_fairy = 462; // [!code --]
 // [!code --]
	public const int sustain_PER = 443;

	public const int sustain_DEX = 442; // [!code --]
 // [!code --]
	public const int mod_ammo_recover = 604; // [!code --]
 // [!code --]
	public static readonly int[] IDS = new int[84]
	{
		652, 651, 650, 641, 640, 621, 620, 623, 622, 653, // [!code --]
		624, 654, 851, 656, 660, 661, 662, 663, 664, 665, // [!code --]
		666, 850, 608, 865, 852, 655, 607, 463, 605, 428, // [!code --]
		427, 426, 425, 424, 423, 421, 420, 418, 417, 416, // [!code --]
		415, 414, 412, 411, 410, 409, 408, 407, 406, 405, // [!code --]
		404, 403, 402, 401, 400, 606, 429, 440, 422, 484, // [!code --]
		603, 602, 601, 600, 441, 483, 482, 481, 480, 468, // [!code --]
		467, 466, 464, 465, 461, 460, 447, 446, 445, 444, // [!code --]
		462, 443, 442, 604 // [!code --]
		653, 652, 651, 650, 641, 624, 621, 622, 623, 654, // [!code ++]
		640, 655, 851, 660, 661, 662, 663, 664, 665, 666, // [!code ++]
		850, 620, 865, 852, 656, 608, 464, 606, 428, 427, // [!code ++]
		426, 425, 424, 423, 421, 420, 418, 417, 416, 415, // [!code ++]
		414, 412, 411, 410, 409, 408, 407, 406, 405, 404, // [!code ++]
		403, 402, 401, 400, 607, 429, 440, 422, 442, 605, // [!code ++]
		604, 603, 602, 601, 600, 441, 483, 482, 481, 480, // [!code ++]
		468, 467, 466, 465, 484, 463, 462, 461, 460, 447, // [!code ++]
		446, 445, 444, 443 // [!code ++]
	};
}
```

## ElementContainer

[`@@ -4,7 +4,6 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/ElementContainer.cs#L4-L10)
```cs:line-numbers=4
using System.Runtime.Serialization;
using Newtonsoft.Json;
using UnityEngine;
using UnityEngine.UI; // [!code --]

public class ElementContainer : EClass
{
```

[`@@ -14,7 +13,7 @@ public enum NoteMode`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/ElementContainer.cs#L14-L20)
```cs:line-numbers=14
		CharaMake,
		CharaMakeAttributes,
		Domain,
		Trait // [!code --]
		BonusTrait // [!code ++]
	}

	public Dictionary<int, Element> dict = new Dictionary<int, Element>();
```

[`@@ -675,11 +674,11 @@ public static int GetSortVal(Element a)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/ElementContainer.cs#L675-L685)
```cs:line-numbers=675
public void AddNote(UINote n, Func<Element, bool> isValid = null, Action onAdd = null, NoteMode mode = NoteMode.Default, bool addRaceFeat = false, Func<Element, string, string> funcText = null, Action<UINote, Element> onAddNote = null)
{
	List<Element> list = new List<Element>();
	foreach (Element value2 in dict.Values) // [!code --]
	foreach (Element value in dict.Values) // [!code ++]
	{
		if ((isValid == null || isValid(value2)) && (mode != NoteMode.CharaMake || value2.ValueWithoutLink != 0) && (value2.Value != 0 || mode == NoteMode.CharaMakeAttributes) && (!value2.HasTag("hidden") || EClass.debug.showExtra)) // [!code --]
		if ((isValid == null || isValid(value)) && (mode != NoteMode.CharaMake || value.ValueWithoutLink != 0) && (value.Value != 0 || mode == NoteMode.CharaMakeAttributes) && (!value.HasTag("hidden") || EClass.debug.showExtra)) // [!code ++]
		{
			list.Add(value2); // [!code --]
			list.Add(value); // [!code ++]
		}
	}
	if (addRaceFeat)
```

[`@@ -699,159 +698,16 @@ public void AddNote(UINote n, Func<Element, bool> isValid = null, Action onAdd =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/ElementContainer.cs#L699-L857)
```cs:line-numbers=699
		case NoteMode.CharaMakeAttributes:
			list.Sort((Element a, Element b) => a.GetSortVal(UIList.SortMode.ByElementParent) - b.GetSortVal(UIList.SortMode.ByElementParent));
			break;
		case NoteMode.Trait: // [!code --]
		case NoteMode.BonusTrait: // [!code ++]
			list.Sort((Element a, Element b) => GetSortVal(b) - GetSortVal(a));
			break;
		default:
			list.Sort((Element a, Element b) => a.SortVal() - b.SortVal());
			break;
		}
		string text = ""; // [!code --]
		foreach (Element e in list) // [!code --]
		foreach (Element item in list) // [!code ++]
		{
			switch (mode) // [!code --]
			{ // [!code --]
			case NoteMode.Domain: // [!code --]
				n.AddText(e.Name, FontColor.Default); // [!code --]
				continue; // [!code --]
			case NoteMode.Default: // [!code --]
			case NoteMode.Trait: // [!code --]
			{ // [!code --]
				bool flag = e.source.tag.Contains("common"); // [!code --]
				string categorySub = e.source.categorySub; // [!code --]
				bool flag2 = false; // [!code --]
				bool flag3 = (e.source.tag.Contains("neg") ? (e.Value > 0) : (e.Value < 0)); // [!code --]
				int num = Mathf.Abs(e.Value); // [!code --]
				bool flag4 = Card != null && Card.ShowFoodEnc; // [!code --]
				bool flag5 = Card != null && Card.IsWeapon && e is Ability; // [!code --]
				if (e.IsTrait || (flag4 && e.IsFoodTrait)) // [!code --]
				{ // [!code --]
					string[] textArray = e.source.GetTextArray("textAlt"); // [!code --]
					int num2 = Mathf.Clamp(e.Value / 10 + 1, (e.Value < 0 || textArray.Length <= 2) ? 1 : 2, textArray.Length - 1); // [!code --]
					text = "altEnc".lang(textArray[0].IsEmpty(e.Name), textArray[num2], EClass.debug.showExtra ? (e.Value + " " + e.Name) : ""); // [!code --]
					flag3 = num2 <= 1 || textArray.Length <= 2; // [!code --]
					flag2 = true; // [!code --]
				} // [!code --]
				else if (flag5) // [!code --]
				{ // [!code --]
					text = "isProc".lang(e.Name); // [!code --]
					flag3 = false; // [!code --]
				} // [!code --]
				else if (categorySub == "resist") // [!code --]
				{ // [!code --]
					text = ("isResist" + (flag3 ? "Neg" : "")).lang(e.Name); // [!code --]
				} // [!code --]
				else if (categorySub == "eleAttack") // [!code --]
				{ // [!code --]
					text = "isEleAttack".lang(e.Name); // [!code --]
				} // [!code --]
				else if (!e.source.textPhase.IsEmpty() && e.Value > 0) // [!code --]
				{ // [!code --]
					text = e.source.GetText("textPhase"); // [!code --]
				} // [!code --]
				else // [!code --]
				{ // [!code --]
					string name = e.Name; // [!code --]
					bool flag6 = e.source.category == "skill" || (e.source.category == "attribute" && !e.source.textPhase.IsEmpty()); // [!code --]
					bool flag7 = e.source.category == "enchant"; // [!code --]
					if (e.source.tag.Contains("multiplier")) // [!code --]
					{ // [!code --]
						flag6 = (flag7 = false); // [!code --]
						name = EClass.sources.elements.alias[e.source.aliasRef].GetName(); // [!code --]
					} // [!code --]
					flag2 = !(flag6 || flag7); // [!code --]
					text = (flag6 ? "textEncSkill" : (flag7 ? "textEncEnc" : "textEnc")).lang(name, num + (e.source.tag.Contains("ratio") ? "%" : ""), ((e.Value > 0) ? "encIncrease" : "encDecrease").lang()); // [!code --]
				} // [!code --]
				int num3 = ((!(e is Resistance)) ? 1 : 0); // [!code --]
				int num4 = 5; // [!code --]
				if (e.id == 484) // [!code --]
				{ // [!code --]
					num3 = 0; // [!code --]
					num4 = 1; // [!code --]
				} // [!code --]
				if (!flag && !flag2 && !e.source.tag.Contains("flag")) // [!code --]
				{ // [!code --]
					text = text + " [" + "*".Repeat(Mathf.Clamp(num * e.source.mtp / num4 + num3, 1, 5)) + ((num * e.source.mtp / num4 + num3 > 5) ? "+" : "") + "]"; // [!code --]
				} // [!code --]
				if (e.HasTag("hidden")) // [!code --]
				{ // [!code --]
					text = "(debug)" + text; // [!code --]
				} // [!code --]
				FontColor color = (flag ? FontColor.Default : (flag3 ? FontColor.Bad : FontColor.Good)); // [!code --]
				if (e.IsGlobalElement) // [!code --]
				{ // [!code --]
					text = text + " " + (e.IsFactionWideElement ? "_factionWide" : "_partyWide").lang(); // [!code --]
					if (!e.IsActive(Card)) // [!code --]
					{ // [!code --]
						continue; // [!code --]
					} // [!code --]
					color = FontColor.Myth; // [!code --]
				} // [!code --]
				if (flag4 && e.IsFoodTrait && !e.IsFoodTraitMain) // [!code --]
				{ // [!code --]
					color = FontColor.FoodMisc; // [!code --]
				} // [!code --]
				if (e.id == 2 && e.Value >= 0) // [!code --]
				{ // [!code --]
					color = FontColor.FoodQuality; // [!code --]
				} // [!code --]
				if (funcText != null) // [!code --]
				{ // [!code --]
					text = funcText(e, text); // [!code --]
				} // [!code --]
				UIItem uIItem = n.AddText("NoteText_enc", text, color); // [!code --]
				Sprite sprite = EClass.core.refs.icons.enc.enc; // [!code --]
				Thing thing = Card?.Thing; // [!code --]
				if (thing != null) // [!code --]
				{ // [!code --]
					if (thing.material.HasEnc(e.id)) // [!code --]
					{ // [!code --]
						sprite = EClass.core.refs.icons.enc.mat; // [!code --]
					} // [!code --]
					foreach (int key in thing.source.elementMap.Keys) // [!code --]
					{ // [!code --]
						if (key == e.id) // [!code --]
						{ // [!code --]
							sprite = EClass.core.refs.icons.enc.card; // [!code --]
						} // [!code --]
					} // [!code --]
					if (thing.IsFood && e.IsFoodTrait) // [!code --]
					{ // [!code --]
						sprite = EClass.core.refs.icons.enc.traitFood; // [!code --]
					} // [!code --]
					if (e.id == thing.GetInt(107)) // [!code --]
					{ // [!code --]
						sprite = EClass.core.refs.icons.enc.cat; // [!code --]
					} // [!code --]
					if (thing.GetRuneEnc(e.id) != null) // [!code --]
					{ // [!code --]
						sprite = EClass.core.refs.icons.enc.rune; // [!code --]
					} // [!code --]
				} // [!code --]
				if ((bool)sprite) // [!code --]
				{ // [!code --]
					uIItem.image1.SetActive(enable: true); // [!code --]
					uIItem.image1.sprite = sprite; // [!code --]
				} // [!code --]
				uIItem.image2.SetActive(e.source.IsWeaponEnc); // [!code --]
				onAddNote?.Invoke(n, e); // [!code --]
				continue; // [!code --]
			} // [!code --]
			} // [!code --]
			UIItem uIItem2 = n.AddTopic("TopicAttribute", e.Name, "".TagColor((e.ValueWithoutLink > 0) ? SkinManager.CurrentColors.textGood : SkinManager.CurrentColors.textBad, e.ValueWithoutLink.ToString() ?? "")); // [!code --]
			if ((bool)uIItem2.button1) // [!code --]
			{ // [!code --]
				uIItem2.button1.tooltip.onShowTooltip = delegate(UITooltip t) // [!code --]
				{ // [!code --]
					e.WriteNote(t.note, EClass.pc.elements); // [!code --]
				}; // [!code --]
			} // [!code --]
			e.SetImage(uIItem2.image1); // [!code --]
			Image image = uIItem2.image2; // [!code --]
			int value = (e.Potential - 80) / 20; // [!code --]
			image.enabled = e.Potential != 80; // [!code --]
			image.sprite = EClass.core.refs.spritesPotential[Mathf.Clamp(Mathf.Abs(value), 0, EClass.core.refs.spritesPotential.Count - 1)]; // [!code --]
			image.color = ((e.Potential - 80 >= 0) ? Color.white : new Color(1f, 0.7f, 0.7f)); // [!code --]
			item.AddEncNote(n, Card, mode, funcText, onAddNote); // [!code ++]
		}
	}

```

## FACTION

[`@@ -4,8 +4,6 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/FACTION.cs#L4-L11)
```cs:line-numbers=4

public class FACTION
{
	public const int bfHill = 3603; // [!code --]
 // [!code --]
	public const int bfCave = 3500;

	public const int bfPlain = 3600;
```

[`@@ -14,25 +12,29 @@ public class FACTION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/FACTION.cs#L14-L38)
```cs:line-numbers=14

	public const int bfSnow = 3602;

	public const int bfHill = 3603; // [!code ++]
 // [!code ++]
	public const int bfFertile = 3700;

	public const int bfSea = 3605;

	public const int bfBeach = 3604; // [!code --]
 // [!code --]
	public const int fRation = 2207;

	public const int fLoyal = 2117; // [!code ++]
 // [!code ++]
	public const int bfGeyser = 3701;

	public const int bfBeach = 3604; // [!code ++]
 // [!code ++]
	public const int fAttraction = 2206;

	public const int fLoyal = 2117; // [!code --]
	public const int fPromo = 2202; // [!code ++]

	public const int fFood = 2204;

	public const int fMoral = 2203;

	public const int fPromo = 2202; // [!code --]
	public const int fConstruction = 2003; // [!code ++]

	public const int fElec = 2201;

```

[`@@ -40,17 +42,15 @@ public class FACTION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/FACTION.cs#L40-L56)
```cs:line-numbers=40

	public const int fHeirloom = 2120;

	public const int fConstruction = 2003; // [!code --]
 // [!code --]
	public const int bfRuin = 3702; // [!code --]
	public const int fEducation = 2116; // [!code ++]

	public const int fTaxEvasion = 2119; // [!code --]
	public const int fAdmin = 2115; // [!code ++]

	public const int fLuck = 2118;

	public const int fAdmin = 2115; // [!code --]
	public const int fTaxEvasion = 2119; // [!code ++]

	public const int fEducation = 2116; // [!code --]
	public const int bfRuin = 3702; // [!code ++]

	public const int fSafety = 2205;

```

[`@@ -110,9 +110,9 @@ public class FACTION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/FACTION.cs#L110-L118)
```cs:line-numbers=110

	public static readonly int[] IDS = new int[52]
	{
		3603, 3500, 3600, 3601, 3602, 3700, 3605, 3604, 2207, 3701, // [!code --]
		2206, 2117, 2204, 2203, 2202, 2201, 2200, 2120, 2003, 3702, // [!code --]
		2119, 2118, 2115, 2116, 2205, 3703, 3707, 3705, 4006, 4005, // [!code --]
		3500, 3600, 3601, 3602, 3603, 3700, 3605, 2207, 2117, 3701, // [!code ++]
		3604, 2206, 2202, 2204, 2203, 2003, 2201, 2200, 2120, 2116, // [!code ++]
		2115, 2118, 2119, 3702, 2205, 3703, 3707, 3705, 4006, 4005, // [!code ++]
		4004, 4003, 4002, 4001, 3704, 3900, 3805, 3804, 3803, 4000,
		3801, 3802, 3708, 3709, 3710, 3780, 3706, 3782, 3783, 3784,
		3800, 3781
```

## FEAT

[`@@ -59,7 +59,7 @@ public class FEAT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/FEAT.cs#L59-L65)
```cs:line-numbers=59

	public const int featChef = 1658;

	public const int featScavenger = 1656; // [!code --]
	public const int featManaCost = 1657; // [!code ++]

	public const int featModelBeliever = 1655;

```

[`@@ -103,7 +103,7 @@ public class FEAT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/FEAT.cs#L103-L109)
```cs:line-numbers=103

	public const int featReboot = 1410;

	public const int featManaCost = 1657; // [!code --]
	public const int featScavenger = 1656; // [!code ++]

	public const int featPaladin2 = 1408;

```

[`@@ -233,10 +233,10 @@ public class FEAT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/FEAT.cs#L233-L242)
```cs:line-numbers=233
{
	1628, 1627, 1626, 1625, 1624, 1623, 1622, 1621, 1620, 1612,
	1412, 1610, 1421, 1420, 1419, 1418, 1417, 1416, 1415, 1414,
	1413, 1629, 1611, 1630, 1645, 1632, 1411, 1658, 1656, 1655, // [!code --]
	1413, 1629, 1611, 1630, 1645, 1632, 1411, 1658, 1657, 1655, // [!code ++]
	1654, 1653, 1652, 1651, 1650, 1649, 1631, 1648, 1646, 1644,
	1643, 1642, 1641, 1640, 1636, 1635, 1634, 1633, 1647, 1410,
	1657, 1408, 1225, 1226, 1227, 1228, 1229, 1230, 1231, 1232, // [!code --]
	1656, 1408, 1225, 1226, 1227, 1228, 1229, 1230, 1231, 1232, // [!code ++]
	1234, 1235, 1236, 1237, 1238, 1239, 1300, 1305, 1310, 1315,
	1320, 1325, 1330, 1224, 1223, 1222, 1221, 1409, 1200, 1201,
	1202, 1203, 1204, 1205, 1206, 1207, 1208, 1335, 1209, 1211,
```

## GrowSystem

[`@@ -612,7 +612,19 @@ public void PopHarvest(Chara c, Thing t = null, int num = -1)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/GrowSystem.cs#L612-L618)
```cs:line-numbers=612
{
	if (t == null)
	{
		t = ((!idHarvestThing.StartsWith('#')) ? ThingGen.Create(idHarvestThing.IsEmpty("apple")) : ThingGen.CreateFromCategory(idHarvestThing.Replace("#", ""))); // [!code --]
		if (idHarvestThing.StartsWith('#')) // [!code ++]
		{ // [!code ++]
			t = ThingGen.CreateFromCategory(idHarvestThing.Replace("#", "")); // [!code ++]
		} // [!code ++]
		else // [!code ++]
		{ // [!code ++]
			string text = idHarvestThing; // [!code ++]
			if (text == "potato" && EClass.rnd(3) == 0) // [!code ++]
			{ // [!code ++]
				text = "784"; // [!code ++]
			} // [!code ++]
			t = ThingGen.Create(text.IsEmpty("apple")); // [!code ++]
		} // [!code ++]
	}
	ApplySeed(t);
	PlantData plantData = EClass._map.TryGetPlant(cell);
```

## LayerLoadGame

[`@@ -30,6 +30,8 @@ public class LayerLoadGame : ELayer`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/LayerLoadGame.cs#L30-L35)
```cs:line-numbers=30

	public UIButton buttonMove;

	public UIButton buttonRename; // [!code ++]
 // [!code ++]
	public List<GameIndex> worlds;

	public Portrait portrait;
```

[`@@ -103,7 +105,7 @@ public void Init(bool _backup, string _pathBackup = "", string _idDest = "")`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/LayerLoadGame.cs#L103-L109)
```cs:line-numbers=103
		}
	}

	public void RefreshList() // [!code --]
	public void RefreshList(string id = null) // [!code ++]
	{
		if (!backup)
		{
```

[`@@ -142,6 +144,18 @@ public void RefreshList()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/LayerLoadGame.cs#L142-L147)
```cs:line-numbers=142
			buttonDelete.SetActive(enable: false);
			goNoInfo.SetActive(value: true);
		}
		if (id == null) // [!code ++]
		{ // [!code ++]
			return; // [!code ++]
		} // [!code ++]
		list.Select((GameIndex a) => a.id == id); // [!code ++]
		foreach (GameIndex world2 in worlds) // [!code ++]
		{ // [!code ++]
			if (world2.id == id) // [!code ++]
			{ // [!code ++]
				RefreshInfo(world2); // [!code ++]
			} // [!code ++]
		} // [!code ++]
	}

	public void RefreshInfo(GameIndex i)
```

[`@@ -187,22 +201,59 @@ public void RefreshInfo(GameIndex i)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/LayerLoadGame.cs#L187-L208)
```cs:line-numbers=187
		portrait.SetActive(enable: false);
	}
	note.Build();
	buttonListBackup.SetActive(!backup); // [!code --]
	int num = 0; // [!code ++]
	if (!backup) // [!code ++]
	{ // [!code ++]
		num = GameIO.GetGameList((cloud ? CorePath.PathBackupCloud : CorePath.PathBackup) + i.id + "/").Count; // [!code ++]
	} // [!code ++]
	buttonListBackup.mainText.SetText("listBackup".lang() + " (" + num + ")"); // [!code ++]
	buttonListBackup.SetActive(!backup && num > 0); // [!code ++]
	buttonDelete.SetActive(!backup && !ELayer.core.IsGameStarted);
	buttonBackup.SetActive(!backup && (!ELayer.core.IsGameStarted || i.id == Game.id));
	buttonOpen.SetActive(backup);
	buttonMove.SetActive(!backup && !ELayer.core.IsGameStarted);
	buttonMove.mainText.SetText((cloud ? "fromCloud" : "toCloud").lang());
	buttonRename.SetActive(!backup && !cloud && !ELayer.core.IsGameStarted); // [!code ++]
	buttonRename.SetOnClick(delegate // [!code ++]
	{ // [!code ++]
		Dialog.InputName("dialogTeleportId", i.id, delegate(bool cancel, string text) // [!code ++]
		{ // [!code ++]
			if (!cancel && !text.IsEmpty()) // [!code ++]
			{ // [!code ++]
				try // [!code ++]
				{ // [!code ++]
					if (Directory.Exists(CorePath.RootSave + text)) // [!code ++]
					{ // [!code ++]
						throw new Exception(text + " already exists."); // [!code ++]
					} // [!code ++]
					Directory.Move(CorePath.RootSave + i.id, CorePath.RootSave + text); // [!code ++]
					if (Directory.Exists(CorePath.PathBackup + i.id)) // [!code ++]
					{ // [!code ++]
						if (Directory.Exists(CorePath.PathBackup + text)) // [!code ++]
						{ // [!code ++]
							throw new Exception("Backup/" + text + " already exists."); // [!code ++]
						} // [!code ++]
						Directory.Move(CorePath.PathBackup + i.id, CorePath.PathBackup + text); // [!code ++]
					} // [!code ++]
					RefreshList(text); // [!code ++]
				} // [!code ++]
				catch (Exception ex2) // [!code ++]
				{ // [!code ++]
					ELayer.ui.Say(ex2.Message); // [!code ++]
				} // [!code ++]
			} // [!code ++]
		}); // [!code ++]
	}); // [!code ++]
	buttonMove.SetOnClick(delegate
	{
		Dialog.YesNo("dialog_switchCloud", delegate
		{
			string sourceDirName = (cloud ? CorePath.RootSaveCloud : CorePath.RootSave) + i.id;
			string text = (cloud ? CorePath.RootSave : CorePath.RootSaveCloud) + i.id; // [!code --]
			string text2 = (cloud ? CorePath.PathBackupCloud : CorePath.PathBackup) + i.id; // [!code --]
			string text3 = (cloud ? CorePath.PathBackup : CorePath.PathBackupCloud) + i.id; // [!code --]
			bool flag2 = Directory.Exists(text2); // [!code --]
			if (Directory.Exists(text) || Directory.Exists(text3)) // [!code --]
			string text2 = (cloud ? CorePath.RootSave : CorePath.RootSaveCloud) + i.id; // [!code ++]
			string text3 = (cloud ? CorePath.PathBackupCloud : CorePath.PathBackup) + i.id; // [!code ++]
			string text4 = (cloud ? CorePath.PathBackup : CorePath.PathBackupCloud) + i.id; // [!code ++]
			bool flag2 = Directory.Exists(text3); // [!code ++]
			if (Directory.Exists(text2) || Directory.Exists(text4)) // [!code ++]
			{
				SE.Beep();
				ELayer.ui.Say("cloud_conflict");
```

[`@@ -215,7 +266,7 @@ public void RefreshInfo(GameIndex i)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/LayerLoadGame.cs#L215-L221)
```cs:line-numbers=215
					if (flag2)
					{
						Debug.Log("Converting Backup files:");
						Directory.Move(text2, text3); // [!code --]
						Directory.Move(text3, text4); // [!code ++]
						foreach (GameIndex game in GameIO.GetGameList(((!cloud) ? CorePath.PathBackupCloud : CorePath.PathBackup) + i.id + "/"))
						{
							Debug.Log("Processing:" + game.id + ": " + game.path);
```

[`@@ -226,8 +277,8 @@ public void RefreshInfo(GameIndex i)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/LayerLoadGame.cs#L226-L233)
```cs:line-numbers=226
						}
					}
					Debug.Log("Converting Current World:");
					Directory.Move(sourceDirName, text); // [!code --]
					i.path = text; // [!code --]
					Directory.Move(sourceDirName, text2); // [!code ++]
					i.path = text2; // [!code ++]
					i.cloud = !cloud;
					GameIO.UpdateGameIndex(i);
					if (i.cloud)
```

[`@@ -302,6 +353,7 @@ public void RefreshInfo(GameIndex i)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/LayerLoadGame.cs#L302-L307)
```cs:line-numbers=302
		GameIO.MakeBackup(i);
		ELayer.ui.Say("backupDone");
		SE.WriteJournal();
		RefreshInfo(i); // [!code ++]
	});
	buttonOpen.SetOnClick(delegate
	{
```

## Map

[`@@ -1314,7 +1314,7 @@ public void TryShatter(Point pos, int ele, int power)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/Map.cs#L1314-L1320)
```cs:line-numbers=1314
						continue;
					}
				}
				if (row.components[0] == item3.id || row.components[0] == item3.sourceCard._origin) // [!code --]
				if (row.components[0].Split('|').Contains(item3.id) || row.components[0].Split('|').Contains(item3.sourceCard._origin)) // [!code ++]
				{
					list3.Add(row);
				}
```

## RecipeManager

[`@@ -295,7 +295,7 @@ public static RecipeSource GetUnlearnedRecipe(int lvBonus, string cat, bool only`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/RecipeManager.cs#L295-L301)
```cs:line-numbers=295
	List<RecipeSource> list = new List<RecipeSource>();
	foreach (RecipeSource item in RecipeManager.list)
	{
		if ((item.NeedFactory || item.IsQuickCraft) && (cat == null || item.row.Category.IsChildOf(cat)) && (!onlyUnlearned || !EClass.player.recipes.knownRecipes.ContainsKey(item.id)) && EClass.pc.Evalue(item.GetReqSkill().id) + 5 + lvBonus >= item.row.LV && !item.row.ContainsTag("hiddenRecipe")) // [!code --]
		if (!item.alwaysKnown && (item.NeedFactory || item.IsQuickCraft) && (cat == null || item.row.Category.IsChildOf(cat)) && (!onlyUnlearned || !EClass.player.recipes.knownRecipes.ContainsKey(item.id)) && EClass.pc.Evalue(item.GetReqSkill().id) + 5 + lvBonus >= item.row.LV && !item.row.ContainsTag("hiddenRecipe")) // [!code ++]
		{
			list.Add(item);
		}
```

## SourceThingV

[`@@ -213,6 +213,9 @@ public override void OnAfterImportData()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/SourceThingV.cs#L213-L218)
```cs:line-numbers=213
					string[] array2 = parse[i].Split('/');
					switch (array2[0])
					{
					case "elec": // [!code ++]
						row.electricity = array2[1].ToInt(); // [!code ++]
						break; // [!code ++]
					case "render":
						row._idRenderData = array2[1];
						break;
```

## Thing

[`@@ -1233,7 +1233,7 @@ public override void WriteNote(UINote n, Action<UINote> onWriteNote = null, IIns`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/Thing.cs#L1233-L1239)
```cs:line-numbers=1233
		{
			list = list2;
		}
		elements.AddNote(n, (Element e) => list.Contains(e), null, ElementContainer.NoteMode.Trait, addRaceFeat: false, delegate(Element e, string s) // [!code --]
		elements.AddNote(n, (Element e) => list.Contains(e), null, ElementContainer.NoteMode.BonusTrait, addRaceFeat: false, delegate(Element e, string s) // [!code ++]
		{
			string text12 = s;
			string text13 = e.source.GetText("textExtra");
```

[`@@ -1277,27 +1277,30 @@ public override void WriteNote(UINote n, Action<UINote> onWriteNote = null, IIns`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b2101a9e4f6833335b7bc6ce268be58000865f0c/Elin/Thing.cs#L1277-L1303)
```cs:line-numbers=1277
		{
			AddText("traitOther".lang((list2.Count - list.Count).ToString() ?? ""), FontColor.Default);
		}
		if (mode == IInspect.NoteMode.Product && HasTag(CTAG.dish_bonus)) // [!code --]
		if (mode == IInspect.NoteMode.Product && HasCraftBonusTrait()) // [!code ++]
		{
			n.AddHeader("HeaderAdditionalTrait", "additional_trait");
			source.model.elements.AddNote(n, (Element e) => e.IsTrait || e.IsFoodTraitMain, null, ElementContainer.NoteMode.Trait, addRaceFeat: false, delegate(Element e, string s) // [!code --]
			foreach (Element item in ListCraftBonusTraits()) // [!code ++]
			{
				string text9 = s; // [!code --]
				string text10 = e.source.GetText("textExtra"); // [!code --]
				if (!text10.IsEmpty()) // [!code --]
				item.AddEncNote(n, this, ElementContainer.NoteMode.BonusTrait, delegate(Element e, string s) // [!code ++]
				{
					string text11 = ""; // [!code --]
					int num = e.Value / 10; // [!code --]
					num = ((e.Value < 0) ? (num - 1) : (num + 1)); // [!code --]
					text10 = "Lv." + num + text11 + " " + text10; // [!code --]
					if (infoMode && e.IsFoodTraitMain) // [!code --]
					string text9 = s; // [!code ++]
					string text10 = e.source.GetText("textExtra"); // [!code ++]
					if (!text10.IsEmpty()) // [!code ++]
					{
						text10 += "traitAdditive".lang(); // [!code --]
						string text11 = ""; // [!code ++]
						int num = e.Value / 10; // [!code ++]
						num = ((e.Value < 0) ? (num - 1) : (num + 1)); // [!code ++]
						text10 = "Lv." + num + text11 + " " + text10; // [!code ++]
						if (infoMode && e.IsFoodTraitMain) // [!code ++]
						{ // [!code ++]
							text10 += "traitAdditive".lang(); // [!code ++]
						} // [!code ++]
						text9 += (" <size=12>" + text10 + "</size>").TagColor(FontColor.Passive); // [!code ++]
					}
					text9 += (" <size=12>" + text10 + "</size>").TagColor(FontColor.Passive); // [!code --]
				} // [!code --]
				return text9; // [!code --]
			}); // [!code --]
					return text9; // [!code ++]
				}); // [!code ++]
			} // [!code ++]
		}
	}
	if (EClass.debug.showExtra)
```

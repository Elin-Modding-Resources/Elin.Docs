---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 17 files modified. 1 new file created.
version: EA 23.188 Stable
changes: AI_Idle/AI_Mofu/BiomeProfile/Chara/SurvivalManager/ThingGen/TraitCoreDefense/TraitRod/+TraitSpotBiome/TraitVoidgate/WidgetDate/ZoneEvent/ZoneEventManager/ZoneEventRaid/ZoneEventSiege/ZoneEventSiegeGuard/ZoneEventSurvival/Zone_StartSiteSky
---

# EA 23.188 Stable

August 25, 2025

17 files modified. 1 new file created.

## Important Changes

Possible breaking changes. Click the filename to view the chunk.
### [BiomeProfile (1)](#biomeprofile)
```cs:no-line-numbers
public void Populate(Point point, bool interior = false) // [!code --]
public void Populate(Point point, bool interior = false, float mtpDensity = 1f) // [!code ++]
```
### [ThingGen (1)](#thinggen)
```cs:no-line-numbers
public static Thing CreateRod(int ele) // [!code --]
public static Thing CreateRod(int ele, int charge = -1) // [!code ++]
```
### [TraitRod (1)](#traitrod)
```cs:no-line-numbers
public static void Create(Card owner, int ele) // [!code --]
public static void Create(Card owner, int ele, int charge = -1) // [!code ++]
```
### [ZoneEvent (1)](#zoneevent)
```cs:no-line-numbers
public void OnLoad(Zone _zone) // [!code --]
public virtual void OnLoad() // [!code ++]
```
### [ZoneEventRaid (1)](#zoneeventraid)
```cs:no-line-numbers
public override void OnFirstTick() // [!code --]
public override void OnInit() // [!code ++]
```
### [ZoneEventSiege (3)](#zoneeventsiege)
```cs:no-line-numbers
public List<Chara> members = new List<Chara>(); // [!code --]

```
```cs:no-line-numbers
public virtual Chara CreateChara() // [!code --]
public virtual Chara CreateChara(Point p, bool boss = false) // [!code ++]
```
```cs:no-line-numbers
public override void OnFirstTick() // [!code --]
public override void OnInit() // [!code ++]
```
### [ZoneEventSiegeGuard (1)](#zoneeventsiegeguard)
```cs:no-line-numbers
public override Chara CreateChara() // [!code --]

```
## AI_Idle

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/AI_Idle.cs#L577-L583)
```cs:line-numbers=577
	{
		owner.AddCondition<ConSleep>(1000 + EClass.rnd(1000), force: true);
	}
	if (EClass.rnd(100) == 0 && (owner.HasHobbyOrWork("Pet") || owner.HasHobbyOrWork("Fluffy"))) // [!code --]
	if (EClass.rnd(100) == 0 && !owner.noMove && (owner.HasHobbyOrWork("Pet") || owner.HasHobbyOrWork("Fluffy"))) // [!code ++]
	{
		yield return Do(new AI_Mofu());
	}
```

## AI_Mofu

[`public class AI_Mofu : AIWork`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/AI_Mofu.cs#L9-L15)
```cs:line-numbers=9

	public Chara GetMofu()
	{
		return EClass._map.charas.Where((Chara c) => c.IsMofuable).RandomItem(); // [!code --]
		return EClass._map.charas.Where((Chara c) => c.IsMofuable && c != owner).RandomItem(); // [!code ++]
	}

	public override IEnumerable<Status> Run()
```

## BiomeProfile

[`public TileGroup interior`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/BiomeProfile.cs#L662-L668)
```cs:line-numbers=662

	public SourceMaterial.Row MatSub => _matSub ?? (_matSub = ((exterior.floor.matSub == 0) ? MatFloor : EClass.sources.materials.map[exterior.floor.matSub]));

	public void Populate(Point point, bool interior = false) // [!code --]
	public void Populate(Point point, bool interior = false, float mtpDensity = 1f) // [!code ++]
	{
		Cell cell = point.cell;
		if (cell.obj != 0 || cell.Things.Count > 0)
```

[`public void Populate(Point point, bool interior = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/BiomeProfile.cs#L677-L683)
```cs:line-numbers=677
		{
			break;
		}
		if (Rand.Range(0f, 1f) > cluster.density) // [!code --]
		if (Rand.Range(0f, 1f) > cluster.density * mtpDensity) // [!code ++]
		{
			continue;
		}
```

## Chara

[`public override void Tick()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/Chara.cs#L3950-L3957)
```cs:line-numbers=3950
			EClass.player.returnInfo.turns--;
			if (EClass.player.returnInfo.turns <= 0)
			{
				if (EClass.game.IsSurvival && EClass._zone is Zone_StartSiteSky) // [!code --]
				if (EClass.game.IsSurvival && EClass._zone.GetTopZone() is Zone_StartSiteSky) // [!code ++]
				{
					EClass.player.returnInfo = null; // [!code ++]
					Msg.SayNothingHappen();
				}
				else
```

[`public override void Die(Element e = null, Card origin = null, AttackSource atta`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/Chara.cs#L5368-L5377)
```cs:line-numbers=5368
			chara.MakeMinion((origin.IsPCParty || origin.IsPCPartyMinion) ? EClass.pc : origin.Chara, MinionType.Friend);
			Msg.Say("plant_pop", this, chara);
		}
		foreach (ZoneEvent item in EClass._zone.events.list) // [!code --]
		{ // [!code --]
			item.OnCharaDie(this); // [!code --]
		} // [!code --]
		EClass._zone.events.OnCharaDie(this); // [!code ++]
	}

	public void TryDropBossLoot()
```

[`public void ShowDialog()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/Chara.cs#L6806-L6814)
```cs:line-numbers=6806
			break;
		}
		case "farris":
			if (EClass._zone.id == "startVillage" || EClass._zone.id == "startVillage3") // [!code --]
			if (EClass._zone.id == "startVillage" || EClass._zone.id == "startVillage3" || EClass.game.IsSurvival) // [!code ++]
			{
				ShowDialog("_chara"); // [!code --]
				ShowDialog("farris"); // [!code ++]
				return;
			}
			switch (EClass.game.quests.GetPhase<QuestExploration>())
```

[`public void ShowDialog()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/Chara.cs#L6823-L6829)
```cs:line-numbers=6823
				ShowDialog("farris", "home_first");
				break;
			default:
				ShowDialog("_chara"); // [!code --]
				ShowDialog("farris"); // [!code ++]
				break;
			}
			return;
```

[`public bool RequestProtection(Chara attacker, Action<Chara> action)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/Chara.cs#L8041-L8053)
```cs:line-numbers=8041
			{
				continue;
			}
			if (Dist(chara) < 5) // [!code --]
			{ // [!code --]
				chara.GoHostile(attacker); // [!code --]
				chara.SetEnemy(attacker); // [!code --]
				attacker.SetEnemy(chara); // [!code --]
				continue; // [!code --]
			} // [!code --]
			Point nearestPoint = pos.GetNearestPoint(allowBlock: false, allowChara: false, allowInstalled: true, ignoreCenter: true);
			if (!nearestPoint.IsValid)
			{
```

## SurvivalManager

[`public int raidRound`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/SurvivalManager.cs#L74-L79)
```cs:line-numbers=74
			}
		}

		public int raidLv // [!code ++]
		{ // [!code ++]
			get // [!code ++]
			{ // [!code ++]
				return ints[8]; // [!code ++]
			} // [!code ++]
			set // [!code ++]
			{ // [!code ++]
				ints[8] = value; // [!code ++]
			} // [!code ++]
		} // [!code ++]
 // [!code ++]
		public bool raid
		{
			get
```

[`public bool raid`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/SurvivalManager.cs#L86-L91)
```cs:line-numbers=86
			}
		}

		public bool gotTaxChest // [!code ++]
		{ // [!code ++]
			get // [!code ++]
			{ // [!code ++]
				return bits[1]; // [!code ++]
			} // [!code ++]
			set // [!code ++]
			{ // [!code ++]
				bits[1] = value; // [!code ++]
			} // [!code ++]
		} // [!code ++]
 // [!code ++]
		[OnSerializing]
		private void _OnSerializing(StreamingContext context)
		{
```

[`public void Meteor(Point pos, Action action)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/SurvivalManager.cs#L117-L122)
```cs:line-numbers=117
		});
	}

	public void MeteorThing(Point pos, string id, bool install = false) // [!code ++]
	{ // [!code ++]
		Meteor(pos, delegate // [!code ++]
		{ // [!code ++]
			Card card = EClass._zone.AddCard(ThingGen.Create(id), pos); // [!code ++]
			if (install) // [!code ++]
			{ // [!code ++]
				card.Install(); // [!code ++]
			} // [!code ++]
		}); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void OnExpandFloor(Point pos)
	{
		int i = 0;
```

[`public void OnExpandFloor(Point pos)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/SurvivalManager.cs#L128-L150)
```cs:line-numbers=128
			i++;
		}
	});
	Check(9, delegate // [!code --]
	Check(6, delegate // [!code ++]
	{
		EClass._zone.ClaimZone(debug: false, pos);
	});
	Check(15, delegate // [!code --]
	Check(9, delegate // [!code ++]
	{ // [!code ++]
		EClass.pc.homeBranch.AddMemeber(EClass._zone.AddCard(CharaGen.Create("shojo"), pos.x, pos.z).Chara); // [!code ++]
	}); // [!code ++]
	Check(20, delegate // [!code ++]
	{
		EClass.pc.homeBranch.AddMemeber(EClass._zone.AddCard(CharaGen.Create("fiama"), pos.x, pos.z).Chara);
	});
	Check(25, delegate // [!code --]
	Check(40, delegate // [!code ++]
	{
		EClass.pc.homeBranch.AddMemeber(EClass._zone.AddCard(CharaGen.Create("nino"), pos.x, pos.z).Chara);
	});
	Check(40, delegate // [!code --]
	Check(60, delegate // [!code ++]
	{
		EClass.pc.homeBranch.AddMemeber(EClass._zone.AddCard(CharaGen.Create("loytel"), pos.x, pos.z).Chara);
	});
	Check(50, delegate // [!code --]
	Check(80, delegate // [!code ++]
	{
		EClass._zone.AddCard(ThingGen.Create("core_defense"), pos).Install();
	});
```

[`public bool OnMineWreck(Point point)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/SurvivalManager.cs#L172-L190)
```cs:line-numbers=172
	int num = searchWreck / 50 + 3;
	if (searchWreck == 0)
	{
		Pop(ThingGen.Create("log").SetNum(6)); // [!code --]
		Pop(ThingGen.Create("rock").SetNum(4)); // [!code --]
		Thing t2 = ThingGen.CreateParcel(null, ThingGen.Create("log").SetNum(6), ThingGen.Create("rock").SetNum(4), ThingGen.Create("resin").SetNum(2), ThingGen.Create("money2").SetNum(10), ThingGen.Create("1267"), ThingGen.CreateRod(50311, 8)); // [!code ++]
		Pop(t2); // [!code ++]
	}
	switch (sourceObj.alias)
	{
	case "nest_bird":
		chanceChange = 100; // [!code --]
		chanceChange = 65; // [!code ++]
		return Pop(ThingGen.Create((EClass.rnd(10) == 0) ? "egg_fertilized" : "_egg").TryMakeRandomItem(num));
	case "wreck_wood":
		array = new string[6] { "log", "log", "branch", "grass", "vine", "resin" }; // [!code --]
		array = new string[8] { "log", "log", "branch", "grass", "vine", "resin", "leaf", "chunk" }; // [!code ++]
		break;
	case "wreck_junk":
		chanceChange = 50; // [!code --]
		chanceChange = 100; // [!code ++]
		return Pop(ThingGen.CreateFromFilter("shop_junk", num));
	case "wreck_stone":
		chanceChange = 30;
```

[`public bool OnMineWreck(Point point)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/SurvivalManager.cs#L233-L246)
```cs:line-numbers=233
	bool Next()
	{
		EClass.game.survival.flags.searchWreck++;
		int searchWreck2 = EClass.game.survival.flags.searchWreck; // [!code ++]
		Point pos2 = point.GetNearestPoint(allowBlock: false, allowChara: false, allowInstalled: false, ignoreCenter: true) ?? point;
		if (EClass.game.survival.flags.searchWreck == 20) // [!code --]
		if (searchWreck2 == 20) // [!code ++]
		{
			Meteor(pos2, delegate
			{
				EClass._zone.AddCard(ThingGen.CreateRecipe("container_shipping"), pos2);
			});
		}
		if (searchWreck2 > (EClass.debug.enable ? 5 : 100) && !flags.gotTaxChest) // [!code ++]
		{ // [!code ++]
			MeteorThing(pos2, "chest_tax"); // [!code ++]
			flags.gotTaxChest = true; // [!code ++]
		} // [!code ++]
		NextObj();
		return true;
	}
```

[`void NextObj()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/SurvivalManager.cs#L248-L257)
```cs:line-numbers=248
	{
		if (EClass.rnd(100) < chanceChange)
		{
			string[] source = new string[11] // [!code --]
			string[] source = new string[12] // [!code ++]
			{
				"nest_bird", "wreck_wood", "wreck_wood", "wreck_wood", "wreck_wood", "wreck_stone", "wreck_stone", "wreck_scrap", "wreck_junk", "wreck_cloth", // [!code --]
				"wreck_precious" // [!code --]
				"nest_bird", "wreck_wood", "wreck_wood", "wreck_wood", "wreck_wood", "wreck_wood", "wreck_stone", "wreck_stone", "wreck_scrap", "wreck_junk", // [!code ++]
				"wreck_cloth", "wreck_precious" // [!code ++]
			};
			EClass._map.SetObj(point.x, point.z, EClass.sources.objs.alias[source.RandomItem()].id);
		}
```

[`bool Pop(Thing t)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/SurvivalManager.cs#L264-L269)
```cs:line-numbers=264
		}
	}

	public Point GetRandomPoint() // [!code ++]
	{ // [!code ++]
		TraitCoreZone traitCoreZone = EClass._map.FindThing<TraitCoreZone>(); // [!code ++]
		Point point = ((traitCoreZone != null) ? traitCoreZone.owner.pos : EClass._map.GetCenterPos()); // [!code ++]
		List<Cell> list = new List<Cell>(); // [!code ++]
		EClass._map.ForeachSphere(point.x, point.z, 50f, delegate(Point p) // [!code ++]
		{ // [!code ++]
			if (!p.IsSky && !p.IsBlocked && !p.HasObj && !p.HasThing) // [!code ++]
			{ // [!code ++]
				list.Add(p.cell); // [!code ++]
			} // [!code ++]
		}); // [!code ++]
		if (list.Count == 0) // [!code ++]
		{ // [!code ++]
			return null; // [!code ++]
		} // [!code ++]
		return list.RandomItem().GetPoint(); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public List<SourceChara.Row> ListUnrecruitedUniques()
	{
		return EClass.sources.charas.rows.Where(delegate(SourceChara.Row r)
```

## ThingGen

[`public static Thing CreateRune(int ele, int v, bool free = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/ThingGen.cs#L190-L199)
```cs:line-numbers=190
		return thing;
	}

	public static Thing CreateRod(int ele) // [!code --]
	public static Thing CreateRod(int ele, int charge = -1) // [!code ++]
	{
		Thing thing = Create("rod");
		TraitRod.Create(thing, ele); // [!code --]
		TraitRod.Create(thing, ele, charge); // [!code ++]
		return thing;
	}

```

## TraitCoreDefense

[`public class TraitCoreDefense : Trait`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/TraitCoreDefense.cs#L10-L22)
```cs:line-numbers=10

	public override void TrySetAct(ActPlan p)
	{
		if (EClass.game.IsSurvival && EClass._zone is Zone_StartSiteSky && !EClass.game.survival.flags.raid) // [!code --]
		if (EClass.game.IsSurvival && EClass._zone is Zone_StartSiteSky) // [!code ++]
		{
			p.TrySetAct("actWarhorn", delegate // [!code --]
			if (!EClass.game.survival.flags.raid) // [!code ++]
			{
				EClass.game.survival.StartRaid(); // [!code --]
				return true; // [!code --]
			}); // [!code --]
				p.TrySetAct("actWarhorn", delegate // [!code ++]
				{ // [!code ++]
					EClass.game.survival.StartRaid(); // [!code ++]
					return true; // [!code ++]
				}); // [!code ++]
			} // [!code ++]
			else if (!EClass.game.survival.IsInRaid && EClass._map.FindThing<TraitVoidgate>() != null) // [!code ++]
			{ // [!code ++]
				p.TrySetAct("actWarhornRaid", delegate // [!code ++]
				{ // [!code ++]
					EClass._zone.events.Add(new ZoneEventRaid()); // [!code ++]
					return true; // [!code ++]
				}); // [!code ++]
			} // [!code ++]
		}
		ZoneEventDefenseGame ev = EClass._zone.events.GetEvent<ZoneEventDefenseGame>();
		if (ev == null)
```

## TraitRod

[`public override void TrySetHeldAct(ActPlan p)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/TraitRod.cs#L73-L83)
```cs:line-numbers=73
		}, owner);
	}

	public static void Create(Card owner, int ele) // [!code --]
	public static void Create(Card owner, int ele, int charge = -1) // [!code ++]
	{
		owner.refVal = ele;
		SourceElement.Row row = EClass.sources.elements.map[ele];
		owner.c_charges = EClass.rnd(row.charge * 150 / 100); // [!code --]
		owner.c_charges = ((charge > 0) ? charge : EClass.rnd(row.charge * 150 / 100)); // [!code ++]
		if (row.tag.Contains("noCopy"))
		{
			owner.elements.SetBase(759, 10);
```

## +TraitSpotBiome

::: details File Created
```cs
public class TraitSpotBiome : TraitSpot
{
	public override int radius => 6;

	public override bool HaveUpdate => true;

	public override void Update()
	{
		if (EClass.rnd(5) != 0)
		{
			return;
		}
		Point randomPoint = GetRandomPoint();
		if (!randomPoint.IsSky && !randomPoint.HasObj && !randomPoint.HasBlock && !randomPoint.HasThing && randomPoint.cell.room == null)
		{
			if (EClass.rnd(5) == 0)
			{
				EClass._zone.SpawnMob(randomPoint);
			}
			else
			{
				randomPoint.cell.biome.Populate(randomPoint, interior: false, 100f);
			}
		}
	}
}
```

:::
## TraitVoidgate

[`public class TraitVoidgate : Trait`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/TraitVoidgate.cs#L1-L5)
```cs:line-numbers=1
public class TraitVoidgate : Trait
{
	public override bool CanBeHeld => !owner.isOn; // [!code ++]
 // [!code ++]
	public override bool CanBeDestroyed => false;

	public override bool CanOnlyCarry => true;
```

## WidgetDate

[`public void _Refresh()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/WidgetDate.cs#L121-L129)
```cs:line-numbers=121
	{
		text += item2.TextWidgetDate;
	}
	if (EMono.game.IsSurvival && EMono.game.survival.flags.raid) // [!code --]
	if (EMono.game.IsSurvival) // [!code ++]
	{
		text += (EMono.game.survival.IsInRaid ? "raid_ongoing".lang() : "raid_till".lang(EMono.world.date.GetRemainingHours(EMono.game.survival.flags.dateNextRaid).ToString() ?? "")); // [!code --]
		text += "raid_till".lang(EMono.game.survival.flags.raidLv.ToString() ?? ""); // [!code ++]
	}
	if (EMono.Branch != null && EMono.Branch.luckyMonth)
	{
```

## ZoneEvent

[`public virtual void OnLeaveZone()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/ZoneEvent.cs#L107-L115)
```cs:line-numbers=107
	{
	}

	public void OnLoad(Zone _zone) // [!code --]
	public virtual void OnLoad() // [!code ++]
	{
		zone = _zone; // [!code --]
	}

	public void Kill()
```

## ZoneEventManager

[`public void OnLoad(Zone _zone)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/ZoneEventManager.cs#L18-L24)
```cs:line-numbers=18
		zone = _zone;
		foreach (ZoneEvent item in list)
		{
			item.OnLoad(zone); // [!code --]
			item.zone = zone; // [!code ++]
			item.OnLoad(); // [!code ++]
		}
	}

```

[`public void OnLeaveZone()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/ZoneEventManager.cs#L118-L123)
```cs:line-numbers=118
		}
	}

	public void OnCharaDie(Chara c) // [!code ++]
	{ // [!code ++]
		list.ForeachReverse(delegate(ZoneEvent e) // [!code ++]
		{ // [!code ++]
			e.OnCharaDie(c); // [!code ++]
		}); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void OnSimulateHour()
	{
		if (list.Count == 0)
```

## ZoneEventRaid

[`using UnityEngine;`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/ZoneEventRaid.cs#L1-L10)
```cs:line-numbers=1
using UnityEngine; // [!code ++]
 // [!code ++]
public class ZoneEventRaid : ZoneEventSiege
{
	public override void OnFirstTick() // [!code --]
	public override void OnInit() // [!code ++]
	{
		lv = 5 + EClass.game.survival.flags.raidRound * 10; // [!code --]
		lv = Mathf.Max(1, EClass.game.survival.flags.raidLv); // [!code ++]
		max = 5 + lv / 5;
		base.OnFirstTick(); // [!code --]
		base.OnInit(); // [!code ++]
	}

	public override Point GetSpawnPos()
```

[`public override Point GetSpawnPos()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/ZoneEventRaid.cs#L12-L31)
```cs:line-numbers=12
		Trait trait = EClass._map.FindThing<TraitVoidgate>();
		if (trait != null)
		{
			return trait.owner.pos; // [!code --]
			trait.Toggle(on: true, silent: true); // [!code ++]
		}
		trait = EClass._map.FindThing<TraitCoreDefense>(); // [!code --]
		if (trait != null) // [!code --]
		else // [!code ++]
		{
			return trait.owner.pos; // [!code --]
			trait = EClass._map.FindThing<TraitCoreDefense>(); // [!code ++]
		}
		return EClass.pc.pos; // [!code --]
		Point point = ((trait != null) ? trait.owner.pos : EClass.pc.pos); // [!code ++]
		return point.GetNearestPoint(allowBlock: false, allowChara: false) ?? point; // [!code ++]
	}

	public override void OnKill()
	{
		base.OnKill();
		EClass.game.survival.flags.raidRound++;
		EClass.game.survival.flags.raidLv += 5; // [!code ++]
		EClass.game.survival.flags.dateNextRaid = EClass.world.date.GetRaw(168);
		Point pos = EClass.game.survival.GetRandomPoint() ?? EClass.pc.pos; // [!code ++]
		string text = ((EClass.game.survival.flags.raidLv >= 50 && EClass.rnd(3) == 0) ? "statue_god" : ((EClass.game.survival.flags.raidLv >= 25 && EClass.rnd(2) == 0) ? "statue_power" : "altar")); // [!code ++]
		EClass.game.survival.MeteorThing(pos, text, install: true); // [!code ++]
	}
}
```

## ZoneEventSiege

[`using System.Collections.Generic;`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/ZoneEventSiege.cs#L1-L60)
```cs:line-numbers=1
using System.Collections.Generic;
using Newtonsoft.Json;
using UnityEngine; // [!code ++]

public class ZoneEventSiege : ZoneEvent
{
	[JsonProperty]
	public List<int> uids = new List<int>();

	public List<Chara> members = new List<Chara>(); // [!code --]
 // [!code --]
	[JsonProperty] // [!code ++]
	public int lv = 10;

	[JsonProperty] // [!code ++]
	public int idx; // [!code ++]
 // [!code ++]
	[JsonProperty] // [!code ++]
	public int max = 10;

	public List<Chara> members = new List<Chara>(); // [!code ++]
 // [!code ++]
	public override string id => "trial_siege";

	public override float roundInterval => Mathf.Max(0.5f, 1.5f - 0.01f * (float)lv); // [!code ++]
 // [!code ++]
	public override Playlist playlist => EClass.Sound.playlistBattle;

	public virtual Chara CreateChara() // [!code --]
	public virtual Chara CreateChara(Point p, bool boss = false) // [!code ++]
	{
		return CharaGen.CreateFromFilter("c_wilds", lv); // [!code --]
		return EClass._zone.SpawnMob(p, boss ? SpawnSetting.Boss(lv) : SpawnSetting.DefenseEnemy(lv)); // [!code ++]
	}

	public override void OnFirstTick() // [!code --]
	public override void OnInit() // [!code ++]
	{
		EClass.player.stats.sieges++;
		Msg.Say("startSiege");
		EClass._zone.RefreshBGM();
		Point spawnPos = GetSpawnPos(); // [!code --]
		for (int i = 0; i < 10; i++) // [!code --]
		{ // [!code --]
			Chara chara = CreateChara(); // [!code --]
			EClass._zone.AddCard(chara, EClass._map.GetRandomSurface(spawnPos.x, spawnPos.z, 6)); // [!code --]
			chara.hostility = Hostility.Enemy; // [!code --]
			members.Add(chara); // [!code --]
			uids.Add(chara.uid); // [!code --]
			chara.PlayEffect("teleport"); // [!code --]
			chara.PlaySound("spell_funnel"); // [!code --]
		} // [!code --]
		Thing t = ThingGen.Create("torch"); // [!code --]
		EClass._zone.AddCard(t, spawnPos); // [!code --]
		if (members.Count != 0) // [!code --]
		{ // [!code --]
			return; // [!code --]
		} // [!code --]
	} // [!code ++]
 // [!code ++]
	public override void OnVisit() // [!code ++]
	{ // [!code ++]
		EClass._zone.RefreshBGM(); // [!code ++]
		members.Clear(); // [!code ++]
		foreach (int uid in uids)
		{
			foreach (Chara chara2 in EClass._map.charas) // [!code --]
			foreach (Chara chara in EClass._map.charas) // [!code ++]
			{
				if (chara2.uid == uid) // [!code --]
				if (chara.uid == uid) // [!code ++]
				{
					members.Add(chara2); // [!code --]
					members.Add(chara); // [!code ++]
				}
			}
		}
	}

	public void SpawnMob() // [!code ++]
	{ // [!code ++]
		Point spawnPos = GetSpawnPos(); // [!code ++]
		Chara chara = CreateChara(spawnPos, idx == max - 1); // [!code ++]
		chara.hostility = Hostility.Enemy; // [!code ++]
		members.Add(chara); // [!code ++]
		uids.Add(chara.uid); // [!code ++]
		chara.PlayEffect("teleport"); // [!code ++]
		chara.PlaySound("spell_funnel"); // [!code ++]
		idx++; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public virtual Point GetSpawnPos()
	{
		return EClass._map.GetRandomEdge();
```

[`public virtual Point GetSpawnPos()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/ZoneEventSiege.cs#L62-L88)
```cs:line-numbers=62

	public override void OnTickRound()
	{
		bool flag = true; // [!code --]
		if (idx < max) // [!code ++]
		{ // [!code ++]
			SpawnMob(); // [!code ++]
		} // [!code ++]
		if (ShouldEnd()) // [!code ++]
		{ // [!code ++]
			Kill(); // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public override void OnCharaDie(Chara c) // [!code ++]
	{ // [!code ++]
		if (ShouldEnd()) // [!code ++]
		{ // [!code ++]
			Kill(); // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public bool ShouldEnd() // [!code ++]
	{ // [!code ++]
		bool result = idx >= max; // [!code ++]
		foreach (Chara member in members)
		{
			if (member.IsAliveInCurrentZone) // [!code --]
			if (!member.IsPCFactionOrMinion && member.IsAliveInCurrentZone) // [!code ++]
			{
				if (member.ai is GoalIdle)
				{
					member.SetAI(new GoalSiege());
				}
				flag = false; // [!code --]
				result = false; // [!code ++]
			}
		}
		if (flag) // [!code --]
		{ // [!code --]
			Kill(); // [!code --]
		} // [!code --]
		return result; // [!code ++]
	}

	public override void OnKill()
	{
		Msg.Say("endSiege");
		SE.Play("kill_boss"); // [!code ++]
		EClass._zone.RefreshBGM();
		EClass._zone.AddCard(ThingGen.CreateTreasure("chest_boss", lv, TreasureType.BossNefia), GetSpawnPos().GetNearestPoint(allowBlock: false, allowChara: false, allowInstalled: false, ignoreCenter: true) ?? EClass.pc.pos).Install(); // [!code ++]
	}
}
```

## ZoneEventSiegeGuard

[`public class ZoneEventSiegeGuard : ZoneEventSiege`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/ZoneEventSiegeGuard.cs#L1-L7)
```cs:line-numbers=1
public class ZoneEventSiegeGuard : ZoneEventSiege
{
	public override Chara CreateChara() // [!code --]
	{ // [!code --]
		return CharaGen.Create("guard"); // [!code --]
	} // [!code --]
}
```

## ZoneEventSurvival

[`using UnityEngine;`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/ZoneEventSurvival.cs#L1-L10)
```cs:line-numbers=1
using UnityEngine; // [!code --]
 // [!code --]
public class ZoneEventSurvival : ZoneEvent
{
	public override void OnTickRound()
	{
		Debug.Log("tick:" + rounds); // [!code --]
		if (EClass._map.cells.GetLength(0) <= 100) // [!code ++]
		{ // [!code ++]
			return; // [!code ++]
		} // [!code ++]
		Cell cell = EClass._map.cells[100, 100];
		if (!cell.HasObj)
		{
```

[`public override void OnTickRound()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/ZoneEventSurvival.cs#L21-L29)
```cs:line-numbers=21
		{
			traitVoidgate.owner.isOn = EClass.game.survival.IsInRaid;
		}
		if (!EClass.game.survival.IsInRaid && EClass.world.date.GetRemainingHours(EClass.game.survival.flags.dateNextRaid) <= 0) // [!code --]
		if (!EClass.game.survival.IsInRaid) // [!code ++]
		{
			EClass._zone.events.Add(new ZoneEventRaid()); // [!code --]
			EClass.world.date.GetRemainingHours(EClass.game.survival.flags.dateNextRaid); // [!code ++]
			_ = 0; // [!code ++]
		}
	}
}
```

## Zone_StartSiteSky

[`public class Zone_StartSiteSky : Zone_StartSite`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/75120b4894b4293e3757f7f78850c766facecfc9/Elin/Zone_StartSiteSky.cs#L7-L10)
```cs:line-numbers=7
	public override string IDBaseLandFeat => "bfPlain,bfFertile,bfStart";

	public override bool BlockBorderExit => true;
 // [!code ++]
	public override string IdBiome => "Plain"; // [!code ++]
}
```

---
exclude: true
aside: false
footer: false
editLink: false
lastUpdated: false
description: 24 files modified.
version: EA 23.58 Nightly
changes: AI_UseCrafter/AM_Cinema/ActEffect/ActionMode/AttackProcess/Card/CardRenderer/Chara/CharaRenderer/CoreConfig/CoreDebug/FactionBranch/HotItemContext/LayerCraft/LayerEditPortrait/LayerUploader/Map/Net/Recipe/RecipeManager/Religion/TraitKettle/UI/VirtualDate
---

# EA 23.58 Nightly

December 16, 2024

24 files modified.

## Breaking Changes

Click file name to view the chunk.

### [Religion (1)](#religion)
```cs:no-line-numbers
public void LeaveFaith(Chara c) // [!code --]
public void LeaveFaith(Chara c, Religion newFaith) // [!code ++]
```
## AI_UseCrafter

[`@@ -213,6 +213,7 @@ public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/AI_UseCrafter.cs#L213)
```cs:line-numbers=213
					Effect.Get("mine").Play(from).SetParticleColor(recipe.GetColorMaterial().GetColor())
						.Emit(10 + EClass.rnd(10));
					owner.renderer.PlayAnime(AnimeID.JumpSmall);
					recipe.TryGetFirstTimeBonus(); // [!code ++]
				}
				else
				{
```

## AM_Cinema

[`@@ -44,7 +44,7 @@ public override void OnUpdateInput()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/AM_Cinema.cs#L44)
```cs:line-numbers=44
	if (EInput.leftMouse.clicked && !EClass.ui.isPointerOverUI)
	{
		SE.ClickGeneral();
		EClass.ui.canvas.enabled = !EClass.ui.canvas.enabled; // [!code --]
		EClass.ui.ToggleCanvas(); // [!code ++]
	}
	if (EInput.rightMouse.down || conf.speed == 0)
	{
```

## ActEffect

[`@@ -350,7 +350,7 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/ActEffect.cs#L350)
```cs:line-numbers=350
			{
				num7 = 2;
			}
			if (EClass._zone.IsPCFaction && EClass._zone.branch.lv >= 3) // [!code --]
			if (EClass._zone.IsPCFaction && EClass._zone.branch.HasItemProtection) // [!code ++]
			{
				num7 = 0;
			}
```

[`@@ -838,10 +838,10 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/ActEffect.cs#L838)
```cs:line-numbers=838
		{
			return;
		}
		Thing thing = ThingGen.Create("mine"); // [!code --]
		thing.c_idRefCard = "dog_mine"; // [!code --]
		Thing thing2 = ThingGen.Create("mine"); // [!code ++]
		thing2.c_idRefCard = "dog_mine"; // [!code ++]
		Zone.ignoreSpawnAnime = true;
		EClass._zone.AddCard(thing, CC.pos).Install(); // [!code --]
		EClass._zone.AddCard(thing2, CC.pos).Install(); // [!code ++]
		break;
	}
	case EffectId.MagicMap:
```

[`@@ -894,9 +894,9 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/ActEffect.cs#L894)
```cs:line-numbers=894
		TC.PlaySound("curse3");
		TC.PlayEffect("curse");
		TC.Say("forgetItems", TC);
		int num3 = power / 50 + 1 + EClass.rnd(3); // [!code --]
		int num4 = power / 50 + 1 + EClass.rnd(3); // [!code ++]
		List<Thing> source = TC.things.List((Thing t) => t.c_IDTState == 0);
		for (int j = 0; j < num3; j++) // [!code --]
		for (int j = 0; j < num4; j++) // [!code ++]
		{
			source.RandomItem().c_IDTState = 5;
		}
```

[`@@ -908,10 +908,10 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/ActEffect.cs#L908)
```cs:line-numbers=908
	case EffectId.EnchantArmorGreat:
	{
		bool armor = id == EffectId.EnchantArmor || id == EffectId.EnchantArmorGreat;
		bool flag3 = id == EffectId.EnchantWeaponGreat || id == EffectId.EnchantArmorGreat; // [!code --]
		bool flag4 = id == EffectId.EnchantWeaponGreat || id == EffectId.EnchantArmorGreat; // [!code ++]
		if (!tc.isThing)
		{
			LayerDragGrid.CreateEnchant(CC, armor, flag3, state); // [!code --]
			LayerDragGrid.CreateEnchant(CC, armor, flag4, state); // [!code ++]
			return;
		}
		cc.PlaySound("identify");
```

[`@@ -922,8 +922,8 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/ActEffect.cs#L922)
```cs:line-numbers=922
			tc.ModEncLv(-1);
			break;
		}
		int num4 = (flag3 ? 4 : 2) + (blessed ? 1 : 0); // [!code --]
		if (tc.encLV >= num4) // [!code --]
		int num5 = (flag4 ? 4 : 2) + (blessed ? 1 : 0); // [!code ++]
		if (tc.encLV >= num5) // [!code ++]
		{
			cc.Say("enc_resist", tc);
			break;
```

[`@@ -935,21 +935,21 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/ActEffect.cs#L935)
```cs:line-numbers=935
	case EffectId.Identify:
	case EffectId.GreaterIdentify:
	{
		bool flag4 = id == EffectId.GreaterIdentify; // [!code --]
		bool flag5 = id == EffectId.GreaterIdentify; // [!code ++]
		if (flag)
		{
			Redirect(EffectId.ForgetItems, flag4 ? BlessedState.Cursed : BlessedState.Normal, default(ActRef)); // [!code --]
			Redirect(EffectId.ForgetItems, flag5 ? BlessedState.Cursed : BlessedState.Normal, default(ActRef)); // [!code ++]
			break;
		}
		if (!tc.isThing)
		{
			int count = ((!blessed) ? 1 : (flag4 ? (2 + EClass.rnd(2)) : (3 + EClass.rnd(3)))); // [!code --]
			LayerDragGrid.CreateIdentify(CC, flag4, state, 0, count); // [!code --]
			int count = ((!blessed) ? 1 : (flag5 ? (2 + EClass.rnd(2)) : (3 + EClass.rnd(3)))); // [!code ++]
			LayerDragGrid.CreateIdentify(CC, flag5, state, 0, count); // [!code ++]
			return;
		}
		cc.PlaySound("identify");
		cc.PlayEffect("identify");
		tc.Thing.Identify(cc.IsPCParty, (!flag4) ? IDTSource.Identify : IDTSource.SuperiorIdentify); // [!code --]
		tc.Thing.Identify(cc.IsPCParty, (!flag5) ? IDTSource.Identify : IDTSource.SuperiorIdentify); // [!code ++]
		break;
	}
	case EffectId.Uncurse:
```

[`@@ -959,17 +959,17 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/ActEffect.cs#L959)
```cs:line-numbers=959
			LayerDragGrid.CreateUncurse(CC, state);
			return;
		}
		Thing thing2 = tc.Thing; // [!code --]
		if (thing2.blessedState == BlessedState.Cursed) // [!code --]
		Thing thing3 = tc.Thing; // [!code ++]
		if (thing3.blessedState == BlessedState.Cursed) // [!code ++]
		{
			thing2.SetBlessedState(BlessedState.Normal); // [!code --]
			thing3.SetBlessedState(BlessedState.Normal); // [!code ++]
		}
		else if (thing2.blessedState == BlessedState.Doomed) // [!code --]
		else if (thing3.blessedState == BlessedState.Doomed) // [!code ++]
		{
			thing2.SetBlessedState(BlessedState.Normal); // [!code --]
			thing3.SetBlessedState(BlessedState.Normal); // [!code ++]
		}
		thing2.GetRootCard()?.TryStack(thing2); // [!code --]
		LayerInventory.SetDirty(thing2); // [!code --]
		thing3.GetRootCard()?.TryStack(thing3); // [!code ++]
		LayerInventory.SetDirty(thing3); // [!code ++]
		break;
	}
	case EffectId.Lighten:
```

[`@@ -985,21 +985,21 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/ActEffect.cs#L985)
```cs:line-numbers=985
		}
		cc.PlaySound("offering");
		cc.PlayEffect("buff");
		int num5 = (tc.isWeightChanged ? tc.c_weight : tc.Thing.source.weight); // [!code --]
		int num3 = (tc.isWeightChanged ? tc.c_weight : tc.Thing.source.weight); // [!code ++]
		tc.isWeightChanged = true;
		Element orCreateElement = tc.elements.GetOrCreateElement(64);
		Element orCreateElement2 = tc.elements.GetOrCreateElement(65);
		Element orCreateElement3 = tc.elements.GetOrCreateElement(67);
		Element orCreateElement4 = tc.elements.GetOrCreateElement(66);
		bool flag5 = tc.IsEquipmentOrRanged || tc.IsThrownWeapon || tc.IsAmmo; // [!code --]
		bool flag3 = tc.IsEquipmentOrRanged || tc.IsThrownWeapon || tc.IsAmmo; // [!code ++]
		if (flag)
		{
			num5 = (int)(0.01f * (float)num5 * (float)power * 0.75f + 500f); // [!code --]
			if (num5 < 1) // [!code --]
			num3 = (int)(0.01f * (float)num3 * (float)power * 0.75f + 500f); // [!code ++]
			if (num3 < 1) // [!code ++]
			{
				num5 = 1; // [!code --]
				num3 = 1; // [!code ++]
			}
			if (flag5) // [!code --]
			if (flag3) // [!code ++]
			{
				if (tc.IsWeapon || tc.IsThrownWeapon)
				{
```

[`@@ -1016,12 +1016,12 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/ActEffect.cs#L1016)
```cs:line-numbers=1016
		}
		else
		{
			num5 = num5 * (100 - power / 10) / 100; // [!code --]
			num3 = num3 * (100 - power / 10) / 100; // [!code ++]
			if (blessed)
			{
				power /= 4;
			}
			if (flag5) // [!code --]
			if (flag3) // [!code ++]
			{
				if (tc.IsWeapon || tc.IsThrownWeapon)
				{
```

[`@@ -1036,7 +1036,7 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/ActEffect.cs#L1036)
```cs:line-numbers=1036
			}
			cc.Say("lighten", cc, tc);
		}
		tc.c_weight = num5; // [!code --]
		tc.c_weight = num3; // [!code ++]
		tc.SetDirtyWeight();
		if (tc.parent == null)
		{
```

[`@@ -1060,13 +1060,13 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/ActEffect.cs#L1060)
```cs:line-numbers=1060
		cc.PlayEffect("identify");
		cc.Say("reconstruct", cc, tc);
		EClass.game.cards.uidNext += EClass.rnd(30);
		Thing thing3 = ThingGen.Create(tc.id, -1, tc.LV * power / 100); // [!code --]
		thing3.SetBlessedState(state); // [!code --]
		Thing thing = ThingGen.Create(tc.id, -1, tc.LV * power / 100); // [!code ++]
		thing.SetBlessedState(state); // [!code ++]
		tc.Destroy();
		CC.Pick(thing3, msg: false); // [!code --]
		CC.Pick(thing, msg: false); // [!code ++]
		if (!CC.IsPC)
		{
			CC.TryEquip(thing3); // [!code --]
			CC.TryEquip(thing); // [!code ++]
		}
		break;
	}
```

[`@@ -1125,7 +1125,7 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/ActEffect.cs#L1125)
```cs:line-numbers=1125
		}
		cc.PlaySound("offering");
		cc.PlayEffect("buff");
		if (tc.id == "log" && tc.material.alias == "carbone") // [!code --]
		if ((tc.id == "log" || tc.id == "branch") && tc.material.alias == "carbone") // [!code ++]
		{
			foreach (Element item2 in tc.elements.dict.Values.ToList())
			{
```

[`@@ -2250,9 +2250,10 @@ public static bool Wish(string s, string name, int power)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/ActEffect.cs#L2250)
```cs:line-numbers=2250
				if (num == 1 && thing.trait.CanStack)
				{
					int num2 = wishValue;
					int price = thing.GetPrice(); // [!code ++]
					for (int i = 0; i < 1000; i++)
					{
						int num3 = thing.GetPrice() + 500 + i * 200; // [!code --]
						int num3 = price + 500 + i * Mathf.Max(price, 200); // [!code ++]
						if (num2 > num3)
						{
							num++;
```

## ActionMode

[`@@ -765,7 +765,7 @@ public void UpdateInput()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/ActionMode.cs#L765)
```cs:line-numbers=765
		}
		if (!EClass.ui.canvas.enabled && EInput.IsAnyKeyDown())
		{
			EClass.ui.canvas.enabled = true; // [!code --]
			EClass.ui.ToggleCanvas(); // [!code ++]
			EInput.Consume();
			return;
		}
```

## AttackProcess

[`@@ -411,10 +411,15 @@ public bool Perform(int count, bool hasHit, float dmgMulti = 1f, bool maxRoll =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/AttackProcess.cs#L411)
```cs:line-numbers=411
			dMulti *= 1.25f;
		}
	}
	if (CC.Evalue(1355) > 0) // [!code --]
	int num2 = CC.Evalue(1355); // [!code ++]
	ConStrife condition = CC.GetCondition<ConStrife>(); // [!code ++]
	if (condition != null) // [!code ++]
	{
		ConStrife condition = CC.GetCondition<ConStrife>(); // [!code --]
		num = ((condition == null) ? (num + 1) : (num + condition.GetDice().Roll())); // [!code --]
		num += condition.GetDice().Roll(); // [!code ++]
	} // [!code ++]
	else if (num2 > 0) // [!code ++]
	{ // [!code ++]
		num++; // [!code ++]
	}
	num = Mathf.Clamp(num, 0, 9999999);
	num = (int)(dMulti * (float)num * dmgMulti);
```

[`@@ -428,8 +433,8 @@ public bool Perform(int count, bool hasHit, float dmgMulti = 1f, bool maxRoll =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/AttackProcess.cs#L428)
```cs:line-numbers=428
		num /= 2;
	}
	List<Element> list2 = new List<Element>();
	int num2 = CC.Evalue(91); // [!code --]
	int num3 = 0; // [!code --]
	int num3 = CC.Evalue(91); // [!code ++]
	int num4 = 0; // [!code ++]
	if (weapon != null)
	{
		list2 = weapon.elements.dict.Values.ToList();
```

[`@@ -439,9 +444,9 @@ public bool Perform(int count, bool hasHit, float dmgMulti = 1f, bool maxRoll =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/AttackProcess.cs#L439)
```cs:line-numbers=439
		}
		if (IsRanged || isThrow)
		{
			num2 += weapon.Evalue(91); // [!code --]
			num3 += weapon.Evalue(91); // [!code ++]
		}
		num3 += weapon.Evalue(603); // [!code --]
		num4 += weapon.Evalue(603); // [!code ++]
	}
	else if (CC.id == "rabbit_vopal")
	{
```

[`@@ -472,7 +477,7 @@ public bool Perform(int count, bool hasHit, float dmgMulti = 1f, bool maxRoll =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/AttackProcess.cs#L472)
```cs:line-numbers=472
			list2.Add(value);
		}
	}
	if (hit && num2 > EClass.rnd(100)) // [!code --]
	if (hit && num3 > EClass.rnd(100)) // [!code ++]
	{
		CC.Say("vopal");
		penetration = 100;
```

[`@@ -526,9 +531,9 @@ public bool Perform(int count, bool hasHit, float dmgMulti = 1f, bool maxRoll =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/AttackProcess.cs#L526)
```cs:line-numbers=526
		CC.Say("attackMelee", CC, TC, GetAttackText(attackType, 0));
	}
	bool showEffect = true;
	int num4 = 0; // [!code --]
	int num5 = 0;
	int num6 = 0;
	int num7 = 0; // [!code ++]
	ConWeapon conWeapon = null;
	if (weapon != null)
	{
```

[`@@ -536,40 +541,40 @@ public bool Perform(int count, bool hasHit, float dmgMulti = 1f, bool maxRoll =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/AttackProcess.cs#L536)
```cs:line-numbers=536
		{
			if (value2.source.categorySub == "eleConvert")
			{
				num4 = EClass.sources.elements.alias[value2.source.aliasRef].id; // [!code --]
				num5 = 50 + value2.Value * 2; // [!code --]
				num6 = Mathf.Min(value2.Value, 100); // [!code --]
				num5 = EClass.sources.elements.alias[value2.source.aliasRef].id; // [!code ++]
				num6 = 50 + value2.Value * 2; // [!code ++]
				num7 = Mathf.Min(value2.Value, 100); // [!code ++]
				break;
			}
		}
	}
	if (num4 == 0) // [!code --]
	if (num5 == 0) // [!code ++]
	{
		if (CC.HasCondition<ConWeapon>())
		{
			conWeapon = CC.GetCondition<ConWeapon>();
			num4 = conWeapon.sourceElement.id; // [!code --]
			num5 = conWeapon.power / 2; // [!code --]
			num6 = 40 + (int)Mathf.Min(MathF.Sqrt(conWeapon.power), 80f); // [!code --]
			num5 = conWeapon.sourceElement.id; // [!code ++]
			num6 = conWeapon.power / 2; // [!code ++]
			num7 = 40 + (int)Mathf.Min(MathF.Sqrt(conWeapon.power), 80f); // [!code ++]
		}
		if (conWeapon == null && weapon == null && (CC.MainElement != Element.Void || CC.HasElement(1565)))
		{
			num4 = (CC.HasElement(1565) ? 915 : CC.MainElement.id); // [!code --]
			num5 = CC.Power / 3 + EClass.rnd(CC.Power / 2); // [!code --]
			num5 = (CC.HasElement(1565) ? 915 : CC.MainElement.id); // [!code ++]
			num6 = CC.Power / 3 + EClass.rnd(CC.Power / 2); // [!code ++]
			if (CC.MainElement != Element.Void)
			{
				num5 += CC.MainElement.Value; // [!code --]
				num6 += CC.MainElement.Value; // [!code ++]
			}
			showEffect = false;
			num6 = 50; // [!code --]
			num7 = 50; // [!code ++]
		}
		if (conWeapon == null && weapon != null && weapon.trait is TraitToolRangeCane)
		{
			IEnumerable<Element> enumerable = weapon.elements.dict.Values.Where((Element e) => e.source.categorySub == "eleAttack");
			if (enumerable.Count() > 0)
			{
				num4 = enumerable.RandomItem().id; // [!code --]
				num5 = num4 switch // [!code --]
				num5 = enumerable.RandomItem().id; // [!code ++]
				num6 = num5 switch // [!code ++]
				{
					920 => 30, 
					914 => 50, 
```

[`@@ -577,16 +582,16 @@ public bool Perform(int count, bool hasHit, float dmgMulti = 1f, bool maxRoll =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/AttackProcess.cs#L577)
```cs:line-numbers=577
					_ => 100, 
				};
			}
			num6 = 50; // [!code --]
			num7 = 50; // [!code ++]
		}
	}
	int num7 = num; // [!code --]
	int num8 = num * num6 / 100; // [!code --]
	num -= num8; // [!code --]
	int num9 = num * penetration / 100; // [!code --]
	int num8 = num; // [!code ++]
	int num9 = num * num7 / 100; // [!code ++]
	num -= num9;
	num = TC.ApplyProtection(num) + num9 + num8; // [!code --]
	TC.DamageHP(num, num4, num5, (!IsRanged && !isThrow) ? AttackSource.Melee : AttackSource.Range, CC, showEffect); // [!code --]
	int num10 = num * penetration / 100; // [!code ++]
	num -= num10; // [!code ++]
	num = TC.ApplyProtection(num) + num10 + num9; // [!code ++]
	TC.DamageHP(num, num5, num6, (!IsRanged && !isThrow) ? AttackSource.Melee : AttackSource.Range, CC, showEffect); // [!code ++]
	conWeapon?.Mod(-1);
	bool flag2 = IsCane || (weapon != null && weapon.Evalue(482) > 0);
	int attackStyleElement = CC.body.GetAttackStyleElement(attackStyle);
```

[`@@ -624,13 +629,13 @@ public bool Perform(int count, bool hasHit, float dmgMulti = 1f, bool maxRoll =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/AttackProcess.cs#L624)
```cs:line-numbers=624
			}
			if (item.source.categorySub == "eleAttack")
			{
				int num10 = 25; // [!code --]
				int num11 = 25; // [!code ++]
				int dmg = EClass.rnd(num * (100 + item.Value * 10) / 500 + 5);
				if (conWeapon == null && weapon != null && weapon.trait is TraitToolRangeCane)
				{
					num10 = 0; // [!code --]
					num11 = 0; // [!code ++]
				}
				if (num10 >= EClass.rnd(100)) // [!code --]
				if (num11 >= EClass.rnd(100)) // [!code ++]
				{
					TC.DamageHP(dmg, item.id, isThrow ? (100 + item.Value * 5) : (30 + item.Value), AttackSource.WeaponEnchant, CC);
				}
```

[`@@ -644,12 +649,12 @@ public bool Perform(int count, bool hasHit, float dmgMulti = 1f, bool maxRoll =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/AttackProcess.cs#L644)
```cs:line-numbers=644
	}
	if (!IsRanged && attackStyle == AttackStyle.Shield)
	{
		int num11 = CC.Evalue(123); // [!code --]
		if (CC.elements.ValueWithoutLink(123) >= 10 && Mathf.Clamp(Mathf.Sqrt(num11) - 2f, 8f, 12f) > (float)EClass.rnd(100)) // [!code --]
		int num12 = CC.Evalue(123); // [!code ++]
		if (CC.elements.ValueWithoutLink(123) >= 10 && Mathf.Clamp(Mathf.Sqrt(num12) - 2f, 8f, 12f) > (float)EClass.rnd(100)) // [!code ++]
		{
			num = num7 * Mathf.Min(50 + num11, 200) / 100; // [!code --]
			num = num8 * Mathf.Min(50 + num12, 200) / 100; // [!code ++]
			num = TC.ApplyProtection(num);
			Debug.Log("Bash:" + num + "/" + num7); // [!code --]
			Debug.Log("Bash:" + num + "/" + num8); // [!code ++]
			CC.PlaySound("shield_bash");
			CC.Say("shield_bash", CC, TC);
			TC.DamageHP(num, AttackSource.None, CC);
```

[`@@ -657,7 +662,7 @@ public bool Perform(int count, bool hasHit, float dmgMulti = 1f, bool maxRoll =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/AttackProcess.cs#L657)
```cs:line-numbers=657
			{
				if (EClass.rnd(2) == 0)
				{
					TC.Chara.AddCondition<ConDim>(50 + (int)Mathf.Sqrt(num11) * 10); // [!code --]
					TC.Chara.AddCondition<ConDim>(50 + (int)Mathf.Sqrt(num12) * 10); // [!code ++]
				}
				TC.Chara.AddCondition<ConParalyze>(EClass.rnd(2), force: true);
			}
```

[`@@ -667,7 +672,7 @@ public bool Perform(int count, bool hasHit, float dmgMulti = 1f, bool maxRoll =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/AttackProcess.cs#L667)
```cs:line-numbers=667
	{
		return true;
	}
	if (TC.isChara && num3 > 0 && num3 * 2 + 15 > EClass.rnd(100) && !TC.isRestrained && TC.Chara.TryMoveFrom(CC.pos) == Card.MoveResult.Success) // [!code --]
	if (TC.isChara && num4 > 0 && num4 * 2 + 15 > EClass.rnd(100) && !TC.isRestrained && TC.Chara.TryMoveFrom(CC.pos) == Card.MoveResult.Success) // [!code ++]
	{
		TC.pos.PlayEffect("vanish");
		TC.PlaySound("push", 1.5f);
```

[`@@ -769,9 +774,9 @@ void Proc(List<Element> list)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/AttackProcess.cs#L769)
```cs:line-numbers=769
		{
			if (item2 is Ability)
			{
				int num12 = 10 + item2.Value / 5; // [!code --]
				int num13 = 10 + item2.Value / 5; // [!code ++]
				int power = EClass.curve((100 + item2.Value * 10) * (100 + weaponSkill.Value) / 100, 400, 100);
				if (num12 >= EClass.rnd(100)) // [!code --]
				if (num13 >= EClass.rnd(100)) // [!code ++]
				{
					Act obj = item2 as Act;
					Card card = (obj.TargetType.CanSelectSelf ? CC : TC);
```

## Card

[`@@ -6238,8 +6238,14 @@ public virtual int GetPrice(CurrencyType currency = CurrencyType.Money, bool sel`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/Card.cs#L6238)
```cs:line-numbers=6238
		p = Guild.Mage.BuySpellbookPrice((int)p);
	}
	int num = ((priceType != PriceType.CopyShop) ? 1 : 5);
	float num2 = 1f + Mathf.Min(0.01f * (float)Evalue(752), 1f) + Mathf.Min(0.01f * (float)Evalue(751), 1f) * (float)num; // [!code --]
	p *= num2; // [!code --]
	float num2 = Mathf.Min(0.01f * (float)Evalue(752), 1f); // [!code ++]
	float num3 = Mathf.Min(0.01f * (float)Evalue(751), 1f); // [!code ++]
	if (num3 > 0f) // [!code ++]
	{ // [!code ++]
		num3 *= (float)num; // [!code ++]
	} // [!code ++]
	float num4 = Mathf.Clamp(1f + num2 + num3, 0.5f, 5f); // [!code ++]
	p *= num4; // [!code ++]
	p *= 0.20000000298023224;
	if (sell)
	{
```

[`@@ -6322,11 +6328,11 @@ public virtual int GetPrice(CurrencyType currency = CurrencyType.Money, bool sel`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/Card.cs#L6322)
```cs:line-numbers=6322
		}
		break;
	}
	float num3 = Math.Clamp(Mathf.Sqrt(c.Evalue(291) + ((!sell && EClass._zone.IsPCFaction) ? (EClass.Branch.Evalue(2800) * 2) : 0)), 0f, 25f); // [!code --]
	float num5 = Math.Clamp(Mathf.Sqrt(c.Evalue(291) + ((!sell && EClass._zone.IsPCFaction) ? (EClass.Branch.Evalue(2800) * 2) : 0)), 0f, 25f); // [!code ++]
	switch (priceType)
	{
	case PriceType.Tourism:
		num3 = 0f; // [!code --]
		num5 = 0f; // [!code ++]
		break;
	case PriceType.Shipping:
		if (sell)
```

[`@@ -6340,52 +6346,52 @@ public virtual int GetPrice(CurrencyType currency = CurrencyType.Money, bool sel`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/Card.cs#L6340)
```cs:line-numbers=6340
		{
			break;
		}
		float num4 = 1.25f; // [!code --]
		float num6 = 1.25f; // [!code ++]
		if (EClass.Branch != null)
		{
			if (EClass.Branch.policies.IsActive(2817))
			{
				num4 += 0.1f + 0.01f * Mathf.Sqrt(EClass.Branch.Evalue(2817)); // [!code --]
				num6 += 0.1f + 0.01f * Mathf.Sqrt(EClass.Branch.Evalue(2817)); // [!code ++]
			}
			if (EClass.Branch.policies.IsActive(2816))
			{
				num4 += 0.2f + 0.02f * Mathf.Sqrt(EClass.Branch.Evalue(2816)); // [!code --]
				num6 += 0.2f + 0.02f * Mathf.Sqrt(EClass.Branch.Evalue(2816)); // [!code ++]
			}
			if (isChara)
			{
				if (EClass.Branch.policies.IsActive(2828))
				{
					num4 += 0.1f + 0.01f * Mathf.Sqrt(EClass.Branch.Evalue(2828)); // [!code --]
					num6 += 0.1f + 0.01f * Mathf.Sqrt(EClass.Branch.Evalue(2828)); // [!code ++]
				}
			}
			else if (category.IsChildOf("food") || category.IsChildOf("drink"))
			{
				if (EClass.Branch.policies.IsActive(2818))
				{
					num4 += 0.05f + 0.005f * Mathf.Sqrt(EClass.Branch.Evalue(2818)); // [!code --]
					num6 += 0.05f + 0.005f * Mathf.Sqrt(EClass.Branch.Evalue(2818)); // [!code ++]
				}
			}
			else if (category.IsChildOf("furniture"))
			{
				if (EClass.Branch.policies.IsActive(2819))
				{
					num4 += 0.05f + 0.005f * Mathf.Sqrt(EClass.Branch.Evalue(2819)); // [!code --]
					num6 += 0.05f + 0.005f * Mathf.Sqrt(EClass.Branch.Evalue(2819)); // [!code ++]
				}
			}
			else if (EClass.Branch.policies.IsActive(2820))
			{
				num4 += 0.05f + 0.005f * Mathf.Sqrt(EClass.Branch.Evalue(2820)); // [!code --]
				num6 += 0.05f + 0.005f * Mathf.Sqrt(EClass.Branch.Evalue(2820)); // [!code ++]
			}
		}
		p *= num4; // [!code --]
		p *= num6; // [!code ++]
		break;
	}
	}
	if ((uint)currency > 1u)
	{
		num3 = 0f; // [!code --]
		num5 = 0f; // [!code ++]
	}
	p *= (sell ? (1f + num3 * 0.02f) : (1f - num3 * 0.02f)); // [!code --]
	p *= (sell ? (1f + num5 * 0.02f) : (1f - num5 * 0.02f)); // [!code ++]
	if (sell)
	{
		p = EClass.curve((int)p, 10000, 10000, 80);
```

## CardRenderer

[`@@ -216,6 +216,11 @@ public override void Draw(RenderParam p, ref Vector3 v, bool drawShadow)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/CardRenderer.cs#L216)
```cs:line-numbers=216
					drawShadow = traitFigure.ShowShadow;
					pref = row.pref;
				}
				if (renderData.pass != null && renderData.pass.name == "pass charaL" && EClass.pc.held == owner) // [!code ++]
				{ // [!code ++]
					int num = (int)renderData.pass.pmesh.tiling.x; // [!code ++]
					p.tile = (int)p.tile / num * num * 2 + (int)p.tile % num; // [!code ++]
				} // [!code ++]
			}
			else
			{
```

[`@@ -309,9 +314,9 @@ public override void Draw(RenderParam p, ref Vector3 v, bool drawShadow)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/CardRenderer.cs#L309)
```cs:line-numbers=309
	{
		RenderObject.tempV = position;
		RenderObject.tempV.y += data.offset.y + data.size.y;
		for (int num = listTC.Count - 1; num >= 0; num--) // [!code --]
		for (int num2 = listTC.Count - 1; num2 >= 0; num2--) // [!code ++]
		{
			listTC[num].OnDraw(ref RenderObject.tempV); // [!code --]
			listTC[num2].OnDraw(ref RenderObject.tempV); // [!code ++]
		}
	}
	if (owner.trait.RenderExtra)
```

## Chara

[`@@ -6413,6 +6413,11 @@ public void TryTakeSharedItems(IEnumerable<Thing> containers, bool msg = true, b`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/Chara.cs#L6413)
```cs:line-numbers=6413
	int num3 = 2;
	int num4 = 2;
	int num5 = 2;
	if (homeBranch != null && homeBranch.HasItemProtection && !IsPCParty) // [!code ++]
	{ // [!code ++]
		num4 = 0; // [!code ++]
		num5 = 0; // [!code ++]
	} // [!code ++]
	foreach (Thing thing3 in things)
	{
		if (CanEat(thing3, shouldEat))
```

## CharaRenderer

[`@@ -320,11 +320,12 @@ public void DrawHat()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/CharaRenderer.cs#L320)
```cs:line-numbers=320

	public override void DrawHeld()
	{
		Card held = owner.held; // [!code ++]
		int num = currentDir;
		RenderData renderData = owner.held.renderer.data; // [!code --]
		SourcePref pref = owner.held.Pref; // [!code --]
		RenderData renderData = held.renderer.data; // [!code ++]
		SourcePref pref = held.Pref; // [!code ++]
		bool flag = num == 1 || num == 3;
		if (owner.held.isChara) // [!code --]
		if (held.isChara) // [!code ++]
		{
			Vector3[] array = (EClass.player.altHeldPos ? RenderObject.renderSetting.heldPosChara2 : RenderObject.renderSetting.heldPosChara);
			RenderObject.currentParam.x += array[num].x;
```

[`@@ -332,11 +333,11 @@ public override void DrawHeld()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/CharaRenderer.cs#L332)
```cs:line-numbers=332
		RenderObject.currentParam.z += array[num].z + data.offset.z - renderData.offset.z;
		if (EClass.player.altHeldPos)
		{
			owner.held.SetDir((owner.dir == 0) ? 2 : ((owner.dir == 1) ? 1 : ((owner.dir != 2) ? 3 : 0))); // [!code --]
			held.SetDir((owner.dir == 0) ? 2 : ((owner.dir == 1) ? 1 : ((owner.dir != 2) ? 3 : 0))); // [!code ++]
		}
		else
		{
			owner.held.SetDir((owner.dir == 0) ? 2 : owner.dir); // [!code --]
			held.SetDir((owner.dir == 0) ? 2 : owner.dir); // [!code ++]
		}
	}
	else
```

[`@@ -354,26 +355,26 @@ public override void DrawHeld()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/CharaRenderer.cs#L354)
```cs:line-numbers=354
			RenderObject.currentParam.y += heldPos[4].y;
			RenderObject.currentParam.z += heldPos[4].z + data.offset.z - renderData.offset.z;
		}
		if (owner.held.trait.NoHeldDir || !owner.held.sourceCard.ContainsTag("noHeldDir")) // [!code --]
		if (held.trait.NoHeldDir || !held.sourceCard.ContainsTag("noHeldDir")) // [!code ++]
		{
			owner.held.dir = (owner.flipX ? 1 : 0); // [!code --]
			held.dir = (owner.flipX ? 1 : 0); // [!code ++]
		}
	}
	if (!owner.Cell.sourceSurface.tileType.IsDeepWater)
	{
		int liquidLv = RenderObject.currentParam.liquidLv;
		if (owner.held.isChara) // [!code --]
		if (held.isChara) // [!code ++]
		{
			RenderObject.currentParam.liquidLv = 0;
		}
		owner.held.SetRenderParam(RenderObject.currentParam); // [!code --]
		held.SetRenderParam(RenderObject.currentParam); // [!code ++]
		RenderObject.currentParam.x += renderData.heldPos.x - renderData.offset.x + (flag ? 0.01f : (-0.01f)) * (float)pref.equipX;
		RenderObject.currentParam.y += renderData.heldPos.y - renderData.offset.y + 0.01f * (float)pref.equipY;
		RenderObject.currentParam.z += renderData.heldPos.z;
		RenderObject.tempV.x = RenderObject.currentParam.x;
		RenderObject.tempV.y = RenderObject.currentParam.y;
		RenderObject.tempV.z = RenderObject.currentParam.z;
		owner.held.renderer.Draw(RenderObject.currentParam, ref RenderObject.tempV, drawShadow: false); // [!code --]
		held.renderer.Draw(RenderObject.currentParam, ref RenderObject.tempV, drawShadow: false); // [!code ++]
		RenderObject.currentParam.liquidLv = liquidLv;
	}
}
```

## CoreConfig

[`@@ -699,10 +699,6 @@ public void OnInit()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/CoreConfig.cs#L699)
```cs:line-numbers=699
	{
		EClass.core.ui.skins.SetMainSkin(test.idSkin);
		Apply();
		if (EClass.debug.enable) // [!code --]
		{ // [!code --]
			net.enable = false; // [!code --]
		} // [!code --]
	}

	public bool HasBackerRewardCode()
```

## CoreDebug

[`@@ -930,6 +930,7 @@ public void UpdateInput()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/CoreDebug.cs#L930)
```cs:line-numbers=930
	}
	if (Input.GetKeyDown(KeyCode.F3))
	{
		(EClass.pc.AddCondition<ConStrife>() as ConStrife).lv = 6; // [!code ++]
		for (int i = 0; i < 10; i++)
		{
			Thing thing = ThingGen.Create("egg_fertilized");
```

## FactionBranch

[`@@ -131,6 +131,8 @@ public class Statistics : EClass`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/FactionBranch.cs#L131)
```cs:line-numbers=131

	public int DangerLV => Mathf.Max(1, ContentLV - (int)Mathf.Sqrt(Evalue(2704)) * 2 + (int)Mathf.Sqrt(Evalue(2706)) * 4);

	public bool HasItemProtection => lv >= 3; // [!code ++]
 // [!code ++]
	public bool HasNetwork => lv >= 5;

	public bool IsTaxFree => policies.IsActive(2514);
```

## HotItemContext

[`@@ -99,7 +99,7 @@ public static void Show(string id, Vector3 pos)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/HotItemContext.cs#L99)
```cs:line-numbers=99
			uIContextMenu.AddButton("hideUI", delegate
			{
				SE.ClickGeneral();
				EClass.ui.canvas.enabled = !EClass.ui.canvas.enabled; // [!code --]
				EClass.ui.ToggleCanvas(); // [!code ++]
			});
			UIContextMenu uIContextMenu2 = m.AddChild("tool");
			uIContextMenu2.AddButton("LayerMod", delegate
```

## LayerCraft

[`@@ -303,6 +303,10 @@ public void RefreshCategory(string cat, bool first = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/LayerCraft.cs#L303)
```cs:line-numbers=303
			{
				b.Attach("recipe_new", rightAttach: false);
			}
			if (a.HasFirstTimeBonus()) // [!code ++]
			{ // [!code ++]
				b.Attach("recipe_firstTime", rightAttach: false); // [!code ++]
			} // [!code ++]
		},
		onList = delegate
		{
```

## LayerEditPortrait

[`@@ -129,6 +129,7 @@ public void RefreshList()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/LayerEditPortrait.cs#L129)
```cs:line-numbers=129
		{
			b.mainText.SetText(a.id);
			b.SetPortrait(a.id, hairColor);
			b.tooltip.lang = a.id; // [!code ++]
		},
		onList = delegate
		{
```

## LayerUploader

[`@@ -102,8 +102,7 @@ public void ExportMap()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/LayerUploader.cs#L102)
```cs:line-numbers=102

	public void Upload()
	{
		Debug.Log("aaaa"); // [!code --]
		if (ini.Global["agreed"].IsEmpty()) // [!code --]
		if (ini.Global["agreed"].IsEmpty() || ELayer.debug.enable) // [!code ++]
		{
			string[] items = new string[3] { "readTerms", "agree", "disagree" };
			Dialog.List("dialogTermsOfUse".lang(), items, (string j) => j, delegate(int c, string d)
```

## Map

[`@@ -1191,7 +1191,7 @@ public void TryShatter(Point pos, int ele, int power)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/Map.cs#L1191)
```cs:line-numbers=1191
		{
			continue;
		}
		if (EClass._zone.IsPCFaction && EClass.Branch.lv >= 3) // [!code --]
		if (EClass._zone.IsPCFaction && EClass.Branch.HasItemProtection) // [!code ++]
		{
			Card rootCard = item.GetRootCard();
			if (!rootCard.isChara || rootCard.Chara.IsPCFaction)
```

## Net

[`@@ -311,6 +311,10 @@ public static async UniTask<bool> SendChat(string name, string msg, ChatCategory`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/Net.cs#L311)
```cs:line-numbers=311
	}
	try
	{
		if (EClass.debug.enable) // [!code ++]
		{ // [!code ++]
			idLang = "DEBUG"; // [!code ++]
		} // [!code ++]
		Debug.Log("Start Sending Text:");
		WWWForm wWWForm = new WWWForm();
		wWWForm.AddField("submit", "Send");
```

[`@@ -348,6 +352,10 @@ public static async UniTask<List<ChatLog>> GetChat(ChatCategory cat, string idLa`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/Net.cs#L348)
```cs:line-numbers=348
	List<ChatLog> list = new List<ChatLog>();
	try
	{
		if (EClass.debug.enable) // [!code ++]
		{ // [!code ++]
			idLang = "DEBUG"; // [!code ++]
		} // [!code ++]
		string uri = $"http://ylva.php.xdomain.jp/script/chat/logs/all_{idLang}.json";
		using UnityWebRequest www = UnityWebRequest.Get(uri);
		await www.SendWebRequest();
```

## Recipe

[`@@ -901,4 +901,25 @@ public int GetSortVal()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/Recipe.cs#L901)
```cs:line-numbers=901
		Element reqSkill = source.GetReqSkill();
		return reqSkill.source.id * 10000 - reqSkill.Value;
	}
 // [!code ++]
	public bool HasFirstTimeBonus() // [!code ++]
	{ // [!code ++]
		if (EClass.player.recipes.craftedRecipes.Contains(id)) // [!code ++]
		{ // [!code ++]
			return false; // [!code ++]
		} // [!code ++]
		return true; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void TryGetFirstTimeBonus() // [!code ++]
	{ // [!code ++]
		if (HasFirstTimeBonus()) // [!code ++]
		{ // [!code ++]
			EClass.player.recipes.craftedRecipes.Add(id); // [!code ++]
			Element reqSkill = source.GetReqSkill(); // [!code ++]
			int num = 1 + ((!IsStaticLV()) ? (reqSkill.Value / 20) : 0); // [!code ++]
			Msg.Say("firstTimeCraft", Name); // [!code ++]
			EClass.pc.Pick(ThingGen.Create("ticket_fortune").SetNum(num)); // [!code ++]
		} // [!code ++]
	} // [!code ++]
}
```

## RecipeManager

[`@@ -13,6 +13,9 @@ public class RecipeManager : EClass`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/RecipeManager.cs#L13)
```cs:line-numbers=13
	[JsonProperty]
	public HashSet<string> knownIngredients = new HashSet<string>();

	[JsonProperty] // [!code ++]
	public HashSet<string> craftedRecipes = new HashSet<string>(); // [!code ++]
 // [!code ++]
	[JsonProperty]
	public Dictionary<string, int> knownRecipes = new Dictionary<string, int>();

```

## Religion

[`@@ -373,7 +373,7 @@ public void JoinFaith(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/Religion.cs#L373)
```cs:line-numbers=373
	}
	if (c.faith != this)
	{
		c.faith.LeaveFaith(c); // [!code --]
		c.faith.LeaveFaith(c, this); // [!code ++]
	}
	EClass.pc.c_daysWithGod = 0;
	Msg.Say("worship", Name);
```

[`@@ -381,7 +381,6 @@ public void JoinFaith(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/Religion.cs#L381)
```cs:line-numbers=381
	EClass.Sound.Play("worship");
	c.PlayEffect("aura_heaven");
	c.faith = this;
	c.elements.SetBase(85, 0); // [!code --]
	OnJoinFaith();
	if (IsEyth)
	{
```

[`@@ -402,22 +401,36 @@ public void JoinFaith(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/Religion.cs#L402)
```cs:line-numbers=402
		}
	}

	public void LeaveFaith(Chara c) // [!code --]
	public void LeaveFaith(Chara c, Religion newFaith) // [!code ++]
	{
		if (!IsEyth) // [!code --]
		if (IsEyth) // [!code ++]
		{
			if (c.IsPC) // [!code --]
			return; // [!code ++]
		} // [!code ++]
		bool flag = (newFaith == EClass.game.religions.Trickery && this == EClass.game.religions.MoonShadow) || (newFaith == EClass.game.religions.MoonShadow && this == EClass.game.religions.Trickery); // [!code ++]
		if (c.IsPC) // [!code ++]
		{ // [!code ++]
			Msg.Say("worship2"); // [!code ++]
			if (!flag) // [!code ++]
			{
				Msg.Say("worship2"); // [!code --]
				Punish(c);
			}
			if (c.IsPC) // [!code --]
			{ // [!code --]
				EClass.pc.faction.charaElements.OnLeaveFaith(); // [!code --]
			} // [!code --]
			OnLeaveFaith(); // [!code --]
			c.RefreshFaithElement(); // [!code --]
		}
		if (flag) // [!code ++]
		{ // [!code ++]
			Talk("regards"); // [!code ++]
			c.elements.SetBase(85, c.Evalue(85) / 2); // [!code ++]
		} // [!code ++]
		else // [!code ++]
		{ // [!code ++]
			c.elements.SetBase(85, 0); // [!code ++]
		} // [!code ++]
		if (c.IsPC) // [!code ++]
		{ // [!code ++]
			EClass.pc.faction.charaElements.OnLeaveFaith(); // [!code ++]
		} // [!code ++]
		OnLeaveFaith(); // [!code ++]
		c.RefreshFaithElement(); // [!code ++]
	}

	public void Punish(Chara c)
```

## TraitKettle

[`@@ -44,7 +44,7 @@ public override bool CanJoinParty`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/TraitKettle.cs#L44)
```cs:line-numbers=44

	public override bool CanBeBanished => false;

	public override int RestockDay => 30; // [!code --]
	public override int RestockDay => 28; // [!code ++]

	public override bool CanCopy(Thing t)
	{
```

## UI

[`@@ -333,6 +333,15 @@ public void Hide(float duration = 1f)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/UI.cs#L333)
```cs:line-numbers=333
		}
	}

	public void ToggleCanvas() // [!code ++]
	{ // [!code ++]
		canvas.enabled = !canvas.enabled; // [!code ++]
		if ((bool)WidgetSideScreen.Instance) // [!code ++]
		{ // [!code ++]
			WidgetSideScreen.Instance.SetActive(canvas.enabled); // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void OnUpdate()
	{
		if (hud.imageDrag.gameObject.activeSelf)
```

[`@@ -742,7 +751,6 @@ public void ToggleFeedback()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/UI.cs#L742)
```cs:line-numbers=742

	public void StartDrag(DragItem item)
	{
		Debug.Log(EInput.leftMouse.down); // [!code --]
		dragDuration = 0f;
		if (currentDrag != null)
		{
```

## VirtualDate

[`@@ -1,5 +1,4 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/VirtualDate.cs#L1)
```cs:line-numbers=1
using System.Collections.Generic;
using UnityEngine; // [!code --]

public class VirtualDate : Date
{
```

[`@@ -54,7 +53,6 @@ public BranchMap GetBranchMap()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/479295bc9156f6706a1a48e2fdb1fbe6427ff3d8/Elin/VirtualDate.cs#L54)
```cs:line-numbers=54

	public void BuildSunMap()
	{
		Debug.Log("Building Sunmap"); // [!code --]
		sunMap = new HashSet<int>();
		foreach (Trait value in EClass._map.props.installed.traits.suns.Values)
		{
```

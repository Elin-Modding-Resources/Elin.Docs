---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 28 files modified. 2 new files created.
version: EA 23.69 Nightly
changes: AI_Fuck/AI_Slaughter/ActionMode/Affinity/BaseListPeople/BaseTileMap/ButtonAbility/Card/Chara/CoreDebug/CoreRef/DNA/Hobby/InvOwnerMod/LayerInventory/RecipeCard/Religion/ReligionMoonShadow/ReligionTrickery/Resistance/TaskClean/Thing/TileType/TraitGodStatue/TraitMod/TraitModRanged/+TraitRune/+TraitToolBrush/Zone/Zone_VernisMine
---

# EA 23.69 Nightly

December 30, 2024

28 files modified. 2 new files created.

## Important Changes

Possible breaking changes. Click the filename to view the chunk.
### [Chara (1)](#chara)
```cs:no-line-numbers
public void ModAffinity(Chara c, int a, bool show = true) // [!code --]
public void ModAffinity(Chara c, int a, bool show = true, bool showOnlyEmo = false) // [!code ++]
```
### [InvOwnerMod (1)](#invownermod)
```cs:no-line-numbers
public static bool IsValidMod(Thing t, SourceElement.Row row) // [!code --]

```
### [LayerInventory (1)](#layerinventory)
```cs:no-line-numbers
public static LayerInventory GetPCLayer() // [!code --]

```
### [TraitGodStatue (1)](#traitgodstatue)
```cs:no-line-numbers
public Thing GetManiGene() // [!code --]

```
## AI_Fuck

[`@@ -23,6 +23,8 @@ public enum FuckType`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/AI_Fuck.cs#L23-L28)
```cs:line-numbers=23

	public int progress;

	public int totalAffinity; // [!code ++]
 // [!code ++]
	public virtual FuckType Type => FuckType.fuck;

	public override bool PushChara => false;
```

[`@@ -111,11 +113,21 @@ public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/AI_Fuck.cs#L111-L121)
```cs:line-numbers=111
			{
				tc.AddCondition<ConFear>(50);
			}
			if (i % 5 == 0) // [!code ++]
			{ // [!code ++]
				tc.PlaySound("brushing"); // [!code ++]
				int num = cc.CHA + cc.Evalue(237) - tc.CHA * 2; // [!code ++]
				int num2 = ((EClass.rnd(cc.CHA + cc.Evalue(237)) <= EClass.rnd(tc.CHA)) ? (-5 + Mathf.Clamp(num / 10, -30, 0)) : (5 + Mathf.Clamp(num / 10, 0, 20))); // [!code ++]
				totalAffinity += num2; // [!code ++]
				tc.ModAffinity(EClass.pc, num2, show: true, showOnlyEmo: true); // [!code ++]
				Debug.Log(num2 + "/" + tc._affinity); // [!code ++]
			} // [!code ++]
			tc.interest -= (tc.IsPCFaction ? 20 : (tc.IsHuman ? 6 : 2)); // [!code ++]
			if (i == 0 || i == 10)
			{
				cc.Talk("goodBoy");
			}
			cc.elements.ModExp(237, 10); // [!code --]
			cc.elements.ModExp(237, 15); // [!code ++]
			break;
		}
	}
```

[`@@ -131,6 +143,10 @@ public void Finish()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/AI_Fuck.cs#L131-L136)
```cs:line-numbers=131
		return;
	}
	bool flag = EClass.rnd(2) == 0;
	int num; // [!code ++]
	int num2; // [!code ++]
	int num3; // [!code ++]
	bool flag3; // [!code ++]
	switch (Type)
	{
	case FuckType.fuck:
```

[`@@ -158,7 +174,7 @@ public void Finish()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/AI_Fuck.cs#L158-L164)
```cs:line-numbers=158
				chara2.AddCondition<ConInsane>(100 + EClass.rnd(100));
			}
		}
		int num = CalcMoney.Whore(chara2, chara); // [!code --]
		int num4 = CalcMoney.Whore(chara2, chara); // [!code ++]
		chara.Talk("tail_after");
		bool flag2 = false;
		if (succubus)
```

[`@@ -177,24 +193,24 @@ public void Finish()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/AI_Fuck.cs#L177-L200)
```cs:line-numbers=177
				chara = chara5;
				chara2 = chara4;
			}
			Debug.Log("buyer:" + chara.Name + " seller:" + chara2.Name + " money:" + num); // [!code --]
			Debug.Log("buyer:" + chara.Name + " seller:" + chara2.Name + " money:" + num4); // [!code ++]
			if (!chara.IsPC)
			{
				chara.ModCurrency(EClass.rndHalf(num)); // [!code --]
				chara.ModCurrency(EClass.rndHalf(num4)); // [!code ++]
			}
			if (!chara2.IsPC && chara.GetCurrency() < num && EClass.rnd(2) == 0) // [!code --]
			if (!chara2.IsPC && chara.GetCurrency() < num4 && EClass.rnd(2) == 0) // [!code ++]
			{
				num = chara.GetCurrency(); // [!code --]
				num4 = chara.GetCurrency(); // [!code ++]
			}
			Debug.Log("money:" + num + " buyer:" + chara.GetCurrency()); // [!code --]
			if (chara.GetCurrency() >= num) // [!code --]
			Debug.Log("money:" + num4 + " buyer:" + chara.GetCurrency()); // [!code ++]
			if (chara.GetCurrency() >= num4) // [!code ++]
			{
				chara.Talk("tail_pay");
			}
			else
			{
				chara.Talk("tail_nomoney");
				num = chara.GetCurrency(); // [!code --]
				num4 = chara.GetCurrency(); // [!code ++]
				chara2.Say("angry", chara2);
				chara2.Talk("angry");
				flag = (sell ? true : false);
```

[`@@ -203,25 +219,25 @@ public void Finish()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/AI_Fuck.cs#L203-L227)
```cs:line-numbers=203
					flag2 = true;
				}
			}
			chara.ModCurrency(-num); // [!code --]
			chara.ModCurrency(-num4); // [!code ++]
			if (chara2 == EClass.pc)
			{
				if (num > 0) // [!code --]
				if (num4 > 0) // [!code ++]
				{
					EClass.player.DropReward(ThingGen.Create("money").SetNum(num)); // [!code --]
					EClass.player.DropReward(ThingGen.Create("money").SetNum(num4)); // [!code ++]
					EClass.player.ModKarma(-1);
				}
			}
			else
			{
				int num2 = (chara2.CHA * 10 + 100) / ((chara2.IsPCFaction && chara2.memberType == FactionMemberType.Default) ? 1 : 10); // [!code --]
				if (chara2.GetCurrency() - num2 > 0) // [!code --]
				int num5 = (chara2.CHA * 10 + 100) / ((chara2.IsPCFaction && chara2.memberType == FactionMemberType.Default) ? 1 : 10); // [!code ++]
				if (chara2.GetCurrency() - num5 > 0) // [!code ++]
				{
					chara2.c_allowance += num; // [!code --]
					chara2.c_allowance += num4; // [!code ++]
				}
				else
				{
					chara2.ModCurrency(num); // [!code --]
					chara2.ModCurrency(num4); // [!code ++]
				}
			}
			chara = chara4;
```

[`@@ -238,29 +254,58 @@ public void Finish()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/AI_Fuck.cs#L238-L266)
```cs:line-numbers=238
		}
		SuccubusExp(chara, chara2);
		SuccubusExp(chara2, chara);
		chara2.ModAffinity(chara, flag ? 10 : (-5)); // [!code ++]
		break;
	}
	case FuckType.tame:
		if (CanTame()) // [!code --]
		{
			if (flag) // [!code --]
			num = ((!chara2.IsPCFaction) ? (chara2.IsHuman ? 10 : 5) : (chara2.IsHuman ? 5 : 0)); // [!code ++]
			if (totalAffinity > 0) // [!code ++]
			{ // [!code ++]
				chara.Say("brush_success", target, owner); // [!code ++]
			} // [!code ++]
			else // [!code ++]
			{ // [!code ++]
				chara.Say("brush_fail", target, owner); // [!code ++]
				num *= 5; // [!code ++]
			} // [!code ++]
			if (CanTame() && !EClass._zone.IsInstance && chara2.c_bossType == BossType.none) // [!code ++]
			{ // [!code ++]
				num2 = (chara2.trait.CanInvite ? 1 : 0); // [!code ++]
				if (num2 != 0 && chara2.affinity.CanInvite()) // [!code ++]
				{ // [!code ++]
					num3 = ((EClass.pc.GetBestAttribute() > chara2.CHA) ? 1 : 0); // [!code ++]
					goto IL_04ad; // [!code ++]
				} // [!code ++]
			} // [!code ++]
			else // [!code ++]
			{ // [!code ++]
				num2 = 0; // [!code ++]
			} // [!code ++]
			num3 = 0; // [!code ++]
			goto IL_04ad; // [!code ++]
		} // [!code ++]
		IL_04ad: // [!code ++]
		flag3 = (byte)num3 != 0; // [!code ++]
		if (num2 != 0) // [!code ++]
		{ // [!code ++]
			if (flag3) // [!code ++]
			{
				chara.Say("tame_success", owner, target);
				chara2.MakeAlly();
				chara.elements.ModExp(237, 200); // [!code --]
			}
			else
			{
				chara.Say("tame_fail", chara, chara2);
			}
		}
		else // [!code --]
		if (num > EClass.rnd(100)) // [!code ++]
		{
			chara.Say("tame_invalid", chara2); // [!code --]
			chara2.DoHostileAction(chara); // [!code ++]
			chara2.calmCheckTurn *= 3; // [!code ++]
		}
		break;
	}
	chara2.ModAffinity(chara, flag ? 10 : (-5)); // [!code --]
	static int StaminaCost(Chara c1, Chara c2)
	{
		return (int)Mathf.Max(10f * (float)c1.END / (float)Mathf.Max(c2.END, 1), 0f);
```

## AI_Slaughter

[`@@ -14,7 +14,7 @@ public override string GetText(string str = "")`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/AI_Slaughter.cs#L14-L20)
```cs:line-numbers=14
	{
		string[] list = Lang.GetList("fur");
		string text = list[Mathf.Clamp(target.c_fur / 10, 0, list.Length - 1)];
		return "AI_Shear".lang() + "(" + text + ")"; // [!code --]
		return "AI_Slaughter".lang() + "(" + text + ")"; // [!code ++]
	}

	public override bool IsValidTC(Card c)
```

[`@@ -39,7 +39,7 @@ public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/AI_Slaughter.cs#L39-L45)
```cs:line-numbers=39
		{
			target.PlaySound("slaughter");
			target.SetCensored(enable: true);
			owner.Say("disassemble_start", owner, target); // [!code --]
			owner.Say("disassemble_start", owner, owner.Tool, target.Name); // [!code ++]
		},
		onProgress = delegate(Progress_Custom p)
		{
```

[`@@ -62,7 +62,10 @@ public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/AI_Slaughter.cs#L62-L68)
```cs:line-numbers=62
		},
		onProgressComplete = delegate
		{
			target.Chara.ModAffinity(owner, 1); // [!code --]
			bool num = target.HasElement(1237) || target.HasElement(701); // [!code ++]
			target.pos.PlayEffect("revive"); // [!code ++]
			target.Chara.ModAffinity(owner, -50); // [!code ++]
			owner.ShowEmo(Emo.love); // [!code ++]
			target.SetCensored(enable: false);
			if (target.HaveFur())
			{
```

[`@@ -71,6 +74,7 @@ public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/AI_Slaughter.cs#L71-L76)
```cs:line-numbers=71
			}
			slaughtering = true;
			target.Die();
			Msg.Say("goto_heaven", target); // [!code ++]
			slaughtering = false;
			if (target.Chara.trait.IsUnique)
			{
```

[`@@ -81,10 +85,15 @@ public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/AI_Slaughter.cs#L81-L90)
```cs:line-numbers=81
					target.Chara.homeBranch.BanishMember(target.Chara, skipMsg: true);
				}
				owner.elements.ModExp(237, 250);
				owner.elements.ModExp(290, 100); // [!code --]
				owner.elements.ModExp(290, 250); // [!code ++]
				EClass.pc.stamina.Mod(-3);
				if (num) // [!code ++]
				{ // [!code ++]
					Msg.Say("killcat"); // [!code ++]
					EClass.player.ModKarma(-3); // [!code ++]
				} // [!code ++]
			}
		}.SetDuration(5000 / (100 + owner.Tool.material.hardness * 2), 3); // [!code --]
		}.SetDuration(6000 / (100 + owner.Tool.material.hardness * 2), 3); // [!code ++]
		yield return Do(seq);
	}

```

## ActionMode

[`@@ -625,29 +625,30 @@ public void UpdateInput()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/ActionMode.cs#L625-L653)
```cs:line-numbers=625
		hotElementTimer = 0f;
	}
	focusTimer += Core.delta;
	if (EClass.ui.isPointerOverUI && (EInput.leftMouse.down || EInput.rightMouse.down || (EClass.core.config.ui.autoFocusWindow && !Input.GetMouseButton(0) && focusTimer > 0.2f))) // [!code --]
	if (EClass.ui.isPointerOverUI && (EInput.leftMouse.down || EInput.rightMouse.down || (EClass.core.config.ui.autoFocusWindow && !Input.GetMouseButton(0)))) // [!code ++]
	{
		LayerInventory componentOf2 = InputModuleEX.GetComponentOf<LayerInventory>();
		if (componentOf2 != null && EClass.ui.layerFloat.layers.Contains(componentOf2)) // [!code --]
		if (componentOf2 != null) // [!code ++]
		{
			if (EInput.rightMouse.down) // [!code --]
			LayerInventory layerInventory = LayerInventory.GetLayer(InputModuleEX.GetComponentOf<ButtonGrid>()?.card); // [!code ++]
			if ((bool)layerInventory) // [!code ++]
			{
				if (!componentOf2.mainInv && !InputModuleEX.GetComponentOf<UIButton>() && !componentOf2.windows[0].saveData.noRightClickClose) // [!code --]
				{ // [!code --]
					componentOf2.Close(); // [!code --]
				} // [!code --]
				LayerInventory.highlightInv = layerInventory.invs[0].owner; // [!code ++]
			}
			else // [!code --]
			if (focusTimer > 0.1f) // [!code ++]
			{
				componentOf2.transform.SetAsLastSibling(); // [!code --]
				if (EClass.ui.layerFloat.layers.Contains(componentOf2) && !layerInventory) // [!code ++]
				{ // [!code ++]
					componentOf2.transform.SetAsLastSibling(); // [!code ++]
				} // [!code ++]
				LayerAbility componentOf3 = InputModuleEX.GetComponentOf<LayerAbility>(); // [!code ++]
				if (componentOf3 != null && EClass.ui.layerFloat.layers.Contains(componentOf3)) // [!code ++]
				{ // [!code ++]
					componentOf3.transform.SetAsLastSibling(); // [!code ++]
				} // [!code ++]
				focusTimer = 0f; // [!code ++]
			}
		}
		LayerAbility componentOf3 = InputModuleEX.GetComponentOf<LayerAbility>(); // [!code --]
		if (componentOf3 != null && EClass.ui.layerFloat.layers.Contains(componentOf3)) // [!code --]
		{ // [!code --]
			componentOf3.transform.SetAsLastSibling(); // [!code --]
		} // [!code --]
		focusTimer = 0f; // [!code --]
	}
	if ((EInput.isShiftDown && Input.GetMouseButton(0)) || (EInput.rightMouse.dragging2 && !Input.GetMouseButtonDown(1) && Input.GetMouseButton(1)))
	{
```

[`@@ -660,6 +661,11 @@ public void UpdateInput()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/ActionMode.cs#L660-L665)
```cs:line-numbers=660
	}
	if (EInput.rightMouse.down)
	{
		LayerInventory componentOf5 = InputModuleEX.GetComponentOf<LayerInventory>(); // [!code ++]
		if (componentOf5 != null && EClass.ui.layerFloat.layers.Contains(componentOf5) && EInput.rightMouse.down && !componentOf5.mainInv && !InputModuleEX.GetComponentOf<UIButton>() && !componentOf5.windows[0].saveData.noRightClickClose) // [!code ++]
		{ // [!code ++]
			componentOf5.Close(); // [!code ++]
		} // [!code ++]
		if (EClass.ui.contextMenu.isActive)
		{
			EClass.ui.contextMenu.currentMenu.Hide();
```

[`@@ -681,10 +687,10 @@ public void UpdateInput()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/ActionMode.cs#L681-L690)
```cs:line-numbers=681
	bool flag = (EInput.mouse3.clicked && input.mouse3Click == CoreConfig.GameFunc.AllAction) || (EInput.mouse4.clicked && input.mouse4Click == CoreConfig.GameFunc.AllAction) || (EInput.mouse3.pressedLong && input.mouse3PressLong == CoreConfig.GameFunc.AllAction) || (EInput.mouse4.pressedLong && input.mouse4PressLong == CoreConfig.GameFunc.AllAction);
	if (flag || EInput.middleMouse.down || EInput.middleMouse.clicked || EInput.middleMouse.pressedLong)
	{
		UIButton componentOf5 = InputModuleEX.GetComponentOf<UIButton>(); // [!code --]
		if ((bool)componentOf5 && componentOf5.CanMiddleClick() && (flag || EInput.middleMouse.clicked || EInput.middleMouse.pressedLong)) // [!code --]
		UIButton componentOf6 = InputModuleEX.GetComponentOf<UIButton>(); // [!code ++]
		if ((bool)componentOf6 && componentOf6.CanMiddleClick() && (flag || EInput.middleMouse.clicked || EInput.middleMouse.pressedLong)) // [!code ++]
		{
			componentOf5.OnMiddleClick(flag); // [!code --]
			componentOf6.OnMiddleClick(flag); // [!code ++]
		}
	}
	if ((bool)EClass.ui.contextMenu.currentMenu)
```

[`@@ -772,18 +778,18 @@ public void UpdateInput()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/ActionMode.cs#L772-L789)
```cs:line-numbers=772
	}
	if (EInput.action == EAction.Examine && !IsBuildMode)
	{
		ButtonGrid componentOf6 = InputModuleEX.GetComponentOf<ButtonGrid>(); // [!code --]
		ButtonGrid componentOf7 = InputModuleEX.GetComponentOf<ButtonGrid>(); // [!code ++]
		Card card = null;
		if ((bool)componentOf6 && componentOf6.card != null) // [!code --]
		if ((bool)componentOf7 && componentOf7.card != null) // [!code ++]
		{
			card = componentOf6.card; // [!code --]
			card = componentOf7.card; // [!code ++]
		}
		if (card == null)
		{
			UIItem componentOf7 = InputModuleEX.GetComponentOf<UIItem>(); // [!code --]
			if ((bool)componentOf7 && componentOf7.refObj is Thing) // [!code --]
			UIItem componentOf8 = InputModuleEX.GetComponentOf<UIItem>(); // [!code ++]
			if ((bool)componentOf8 && componentOf8.refObj is Thing) // [!code ++]
			{
				card = (Thing)componentOf7.refObj; // [!code --]
				card = (Thing)componentOf8.refObj; // [!code ++]
			}
		}
		if (card == null)
```

## Affinity

[`@@ -60,6 +60,28 @@ public bool CanSleepBeside()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/Affinity.cs#L60-L65)
```cs:line-numbers=60
		return true;
	}

	public Sprite GetIcon() // [!code ++]
	{ // [!code ++]
		int affinity = CC._affinity; // [!code ++]
		if (affinity <= -100) // [!code ++]
		{ // [!code ++]
			return EClass.core.refs.icons.affnity.hate; // [!code ++]
		} // [!code ++]
		if (affinity <= -10) // [!code ++]
		{ // [!code ++]
			return EClass.core.refs.icons.affnity.dontLike; // [!code ++]
		} // [!code ++]
		if (affinity >= 100) // [!code ++]
		{ // [!code ++]
			return EClass.core.refs.icons.affnity.love; // [!code ++]
		} // [!code ++]
		if (affinity >= 10) // [!code ++]
		{ // [!code ++]
			return EClass.core.refs.icons.affnity.like; // [!code ++]
		} // [!code ++]
		return null; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public Thing OnGift(Thing t)
	{
		t.CheckJustCooked();
```

## BaseListPeople

[`@@ -84,6 +84,14 @@ public override void OnInstantiate(Chara a, ItemGeneral b)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/BaseListPeople.cs#L84-L89)
```cs:line-numbers=84
				break;
			}
		}
		if (a.IsPCFaction) // [!code ++]
		{ // [!code ++]
			Sprite icon = a.affinity.GetIcon(); // [!code ++]
			if ((bool)icon) // [!code ++]
			{ // [!code ++]
				Util.Instantiate<UIItem>("UI/Element/Grid/Attach/affinity", b).image1.sprite = icon; // [!code ++]
			} // [!code ++]
		} // [!code ++]
		b.AddSubButton(EClass.core.refs.icons.work, delegate
		{
			if (roomWork == null)
```

## BaseTileMap

[`@@ -2570,6 +2570,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/BaseTileMap.cs#L2570-L2575)
```cs:line-numbers=2570
						if (thing != null)
						{
							_actorPos.z -= 0.2f;
							thingPos.z -= 0.2f; // [!code ++]
						}
						_actorPos.y -= num20;
					}
```

## ButtonAbility

[`@@ -26,6 +26,8 @@ public class ButtonAbility : UIButton, IMouseHint`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/ButtonAbility.cs#L26-L31)
```cs:line-numbers=26
	[NonSerialized]
	public bool dragged;

	public static Act hotkeyAct; // [!code ++]
 // [!code ++]
	public static float hotkeyTimer;

	public void SetAct(Chara _chara, Element e)
```

[`@@ -131,13 +133,17 @@ public static bool TryUse(Act act, Card tg = null, Point pos = null, Card cataly`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/ButtonAbility.cs#L131-L143)
```cs:line-numbers=131
	{
		pos = EClass.pc.pos.Copy();
	}
	if (first) // [!code ++]
	{ // [!code ++]
		hotkeyAct = act; // [!code ++]
	} // [!code ++]
	if (first && EInput.GetHotkey() != -1)
	{
		mouse = false;
		hotkeyTimer = 0f;
		Debug.Log(EInput.GetHotkey());
	}
	if (act.HaveLongPressAction) // [!code --]
	if (act.HaveLongPressAction && act == hotkeyAct) // [!code ++]
	{
		if ((mouse && EInput.rightMouse.pressedLong) || (!mouse && hotkeyTimer >= 0.45f))
		{
```

## Card

[`@@ -4408,9 +4408,9 @@ public void SpawnLoot(Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/Card.cs#L4408-L4416)
```cs:line-numbers=4408
	if (AI_Slaughter.slaughtering)
	{
		flag2 = true;
		num = EClass.rndHalf(4 + 5 * Chara.race.food[0].ToInt() / 100); // [!code --]
		num = EClass.rndHalf(4 + 10 * (50 + Mathf.Max(0, (int)MathF.Sqrt(EClass.pc.Evalue(290) * 10))) / 100); // [!code ++]
	}
	if (origin != null && origin.HasElement(290)) // [!code --]
	else if (origin != null && origin.HasElement(290)) // [!code ++]
	{
		if (!flag2 && Chara.race.corpse[1].ToInt() > EClass.rnd(150000 / (100 + (int)Mathf.Sqrt(origin.Evalue(290)) * 5)))
		{
```

[`@@ -4641,6 +4641,9 @@ public Thing TryMakeRandomItem(int lv = -1)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/Card.cs#L4641-L4646)
```cs:line-numbers=4641
	}
	switch (id)
	{
	case "gene": // [!code ++]
		DNA.CopyDNA(DNA.GenerateRandomGene(lv), Thing); // [!code ++]
		break; // [!code ++]
	case "log":
		ChangeMaterial(EClass.sources.materials.rows.Where((SourceMaterial.Row m) => m.category == "wood").RandomItem());
		break;
```

[`@@ -5457,9 +5460,9 @@ public int GetLightRadius()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/Card.cs#L5457-L5465)
```cs:line-numbers=5457
	if (IsPCFaction)
	{
		Thing equippedThing = Chara.body.GetEquippedThing(45);
		if (equippedThing != null) // [!code --]
		if (equippedThing != null && equippedThing.trait is TraitLightSource traitLightSource) // [!code ++]
		{
			num2 = (equippedThing.trait as TraitLightSource).LightRadius; // [!code --]
			num2 = traitLightSource.LightRadius; // [!code ++]
		}
		if (Chara.held != null && IsPC)
		{
```

## Chara

[`@@ -6892,7 +6892,7 @@ public Room FindRoom()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/Chara.cs#L6892-L6898)
```cs:line-numbers=6892
		return FindBed()?.owner.pos.cell.room;
	}

	public void ModAffinity(Chara c, int a, bool show = true) // [!code --]
	public void ModAffinity(Chara c, int a, bool show = true, bool showOnlyEmo = false) // [!code ++]
	{
		if (c == this)
		{
```

[`@@ -6908,15 +6908,22 @@ public void ModAffinity(Chara c, int a, bool show = true)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/Chara.cs#L6908-L6922)
```cs:line-numbers=6908
		a = affinity.Mod(a);
	}
	bool flag = a > 0;
	if (show) // [!code --]
	if (!show) // [!code ++]
	{ // [!code ++]
		return; // [!code ++]
	} // [!code ++]
	if (a == 0) // [!code ++]
	{
		if (a == 0) // [!code --]
		if (!showOnlyEmo) // [!code ++]
		{
			Say("affinityNone", this, c);
			return; // [!code --]
		}
		ShowEmo((!flag) ? Emo.angry : Emo.love); // [!code --]
		c.ShowEmo(flag ? Emo.love : Emo.sad); // [!code --]
		return; // [!code ++]
	} // [!code ++]
	ShowEmo((!flag) ? Emo.angry : Emo.love); // [!code ++]
	c.ShowEmo(flag ? Emo.love : Emo.sad); // [!code ++]
	if (!showOnlyEmo) // [!code ++]
	{ // [!code ++]
		Say(flag ? "affinityPlus" : "affinityMinus", this, c);
	}
}
```

## CoreDebug

[`@@ -905,16 +905,10 @@ public void UpdateInput()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/CoreDebug.cs#L905-L920)
```cs:line-numbers=905
	}
	if (Input.GetKeyDown(KeyCode.F2))
	{
		EClass.pc.Pick(EClass.pc.MakeMilk(effect: true, 10)); // [!code --]
		EClass.pc.Pick(EClass.pc.MakeEgg(effect: true, 10)); // [!code --]
		Chara targetChara = EClass.scene.mouseTarget.TargetChara; // [!code --]
		if (targetChara != null) // [!code --]
		{ // [!code --]
			EClass.pc.Pick(targetChara.MakeMilk()); // [!code --]
			EClass.pc.Pick(targetChara.MakeGene()); // [!code --]
			EClass.pc.Pick(targetChara.MakeBraineCell()); // [!code --]
			EClass.pc.Pick(targetChara.MakeEgg(effect: true, 10)); // [!code --]
		} // [!code --]
		Thing to = ThingGen.Create("gene"); // [!code ++]
		to = DNA.CopyDNA(DNA.GenerateRandomGene(), to); // [!code ++]
		EClass.pc.Pick(to); // [!code ++]
		EClass.pc.Pick(ThingGen.Create("rune")); // [!code ++]
		return;
	}
	if (Input.GetKeyDown(KeyCode.F3))
```

## CoreRef

[`@@ -41,6 +41,18 @@ public class InventoryStyle`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/CoreRef.cs#L41-L46)
```cs:line-numbers=41
	[Serializable]
	public class Icons
	{
		[Serializable] // [!code ++]
		public class Affinity // [!code ++]
		{ // [!code ++]
			public Sprite hate; // [!code ++]
 // [!code ++]
			public Sprite dontLike; // [!code ++]
 // [!code ++]
			public Sprite like; // [!code ++]
 // [!code ++]
			public Sprite love; // [!code ++]
		} // [!code ++]
 // [!code ++]
		public Sprite suspend;

		public Sprite resume;
```

[`@@ -91,6 +103,8 @@ public class Icons`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/CoreRef.cs#L91-L96)
```cs:line-numbers=91

		public Sprite personal;

		public Affinity affnity; // [!code ++]
 // [!code ++]
		public UDInvTab invTab;

		public UDIconWeather weather;
```

## DNA

[`@@ -127,6 +127,41 @@ public static Thing GenerateGene(CardRow r, Type? type = null, int lv = -1, int`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/DNA.cs#L127-L132)
```cs:line-numbers=127
		return thing;
	}

	public static Thing CopyDNA(Thing from, Thing to) // [!code ++]
	{ // [!code ++]
		to.c_DNA = from.c_DNA; // [!code ++]
		to.c_idRefCard = from.c_idRefCard; // [!code ++]
		to.ChangeMaterial(from.material); // [!code ++]
		return to; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public static Thing GenerateRandomGene(int lv = -1, int seed = -1) // [!code ++]
	{ // [!code ++]
		if (lv == -1) // [!code ++]
		{ // [!code ++]
			lv = EClass._zone.ContentLv; // [!code ++]
		} // [!code ++]
		Rand.SetSeed(seed); // [!code ++]
		CardRow r = SpawnList.Get("chara").Select(100); // [!code ++]
		Rand.SetSeed(); // [!code ++]
		return GenerateGene(r, Type.Superior, lv, seed); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public static Thing GenerateManiGene(Card owner) // [!code ++]
	{ // [!code ++]
		owner.things.DestroyAll(); // [!code ++]
		Debug.Log("Mani:" + owner.c_seed); // [!code ++]
		Rand.SetSeed(owner.c_seed); // [!code ++]
		CardRow r = SpawnList.Get("chara").Select(100); // [!code ++]
		Rand.SetSeed(owner.c_seed); // [!code ++]
		Thing thing = GenerateGene(r, Type.Superior, owner.LV, owner.c_seed); // [!code ++]
		thing.c_DNA.cost = thing.c_DNA.cost / 2; // [!code ++]
		thing.MakeRefFrom("mani"); // [!code ++]
		Rand.SetSeed(); // [!code ++]
		owner.c_seed++; // [!code ++]
		return thing; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void Apply(Chara c)
	{
		if (c.c_genes == null)
```

## Hobby

[`@@ -58,6 +58,15 @@ public int GetEfficiency(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/Hobby.cs#L58-L63)
```cs:line-numbers=58
			num = num * c.race.breeder / 100;
		}
		num += GetLv(c);
		return num * (100 + c.homeBranch.Evalue(3708) * 10) / 100; // [!code --]
		if (c.affinity.value < 0) // [!code ++]
		{ // [!code ++]
			num += c.affinity.value; // [!code ++]
		} // [!code ++]
		num = num * (100 + c.homeBranch.Evalue(3708) * 10) / 100; // [!code ++]
		if (num >= 0) // [!code ++]
		{ // [!code ++]
			return num; // [!code ++]
		} // [!code ++]
		return 0; // [!code ++]
	}
}
```

## InvOwnerMod

[`@@ -4,9 +4,18 @@ public class InvOwnerMod : InvOwnerDraglet`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/InvOwnerMod.cs#L4-L12)
```cs:line-numbers=4

	public override string langTransfer => "invMod";

	public static bool IsValidMod(Thing t, SourceElement.Row row) // [!code --]
	public static bool IsValidRuneMod(Thing t, SourceElement.Row row, string idMat) // [!code ++]
	{
		if (t.trait is TraitToolRangeCane && !row.tag.Contains("cane")) // [!code --]
		if (idMat == "adamantite") // [!code ++]
		{ // [!code ++]
			return t.category.slot == 35; // [!code ++]
		} // [!code ++]
		return false; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public static bool IsValidRangedMod(Thing t, SourceElement.Row row) // [!code ++]
	{ // [!code ++]
		if (t.trait is TraitToolRangeCane && !row.tag.Contains("modCane")) // [!code ++]
		{
			return false;
		}
```

[`@@ -26,7 +35,14 @@ public InvOwnerMod(Card owner = null, Card container = null, CurrencyType _curre`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/InvOwnerMod.cs#L26-L32)
```cs:line-numbers=26
public override bool ShouldShowGuide(Thing t)
{
	TraitMod traitMod = owner.trait as TraitMod;
	if (!IsValidMod(t, traitMod.source)) // [!code --]
	if (traitMod is TraitRune) // [!code ++]
	{ // [!code ++]
		if (!IsValidRuneMod(t, traitMod.source, owner.material.alias)) // [!code ++]
		{ // [!code ++]
			return false; // [!code ++]
		} // [!code ++]
	} // [!code ++]
	else if (!IsValidRangedMod(t, traitMod.source)) // [!code ++]
	{
		return false;
	}
```

## LayerInventory

[`@@ -42,12 +42,12 @@ public static LayerInventory GetTopLayer(Thing t, bool includePlayer = false, In`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/LayerInventory.cs#L42-L53)
```cs:line-numbers=42
		return result;
	}

	public static LayerInventory GetPCLayer() // [!code --]
	public static LayerInventory GetLayer(Card t) // [!code ++]
	{
		LayerInventory result = null;
		foreach (LayerInventory item in listInv)
		{
			if (item.Inv.Container.IsPC) // [!code --]
			if (item.Inv.Container == t) // [!code ++]
			{
				return item;
			}
```

[`@@ -55,6 +55,11 @@ public static LayerInventory GetPCLayer()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/LayerInventory.cs#L55-L60)
```cs:line-numbers=55
		return result;
	}

	public static LayerInventory GetPCLayer() // [!code ++]
	{ // [!code ++]
		return GetLayer(ELayer.pc); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public static void Close(Thing t)
	{
		foreach (LayerInventory item in listInv)
```

## RecipeCard

[`@@ -86,6 +86,7 @@ public override void BuildIngredientList()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/RecipeCard.cs#L86-L91)
```cs:line-numbers=86
		ingredients.Add(new Ingredient
		{
			id = "seasoning",
			useCat = true, // [!code ++]
			optional = true,
			req = 1
		});
```

## Religion

[`@@ -164,6 +164,11 @@ public string GetGodTalk(string suffix)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/Religion.cs#L164-L169)
```cs:line-numbers=164
		return EClass.sources.dataGodTalk.GetText(id, suffix).Split(Environment.NewLine.ToCharArray()).RandomItem();
	}

	public virtual int GetOfferingMtp(Thing t) // [!code ++]
	{ // [!code ++]
		return 0; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public int GetOfferingValue(Thing t, int num = -1)
	{
		t.CheckJustCooked();
```

[`@@ -171,15 +176,19 @@ public int GetOfferingValue(Thing t, int num = -1)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/Religion.cs#L171-L185)
```cs:line-numbers=171
	{
		num = t.Num;
	}
	int num2 = 0; // [!code --]
	int v = 0; // [!code ++]
	if (t.source._origin == "meat")
	{
		num2 = Mathf.Clamp(t.SelfWeight / 10, 1, 1000); // [!code --]
		v = Mathf.Clamp(t.SelfWeight / 10, 1, 1000); // [!code ++]
		if (t.refCard == null)
		{
			num2 /= 10; // [!code --]
			v /= 10; // [!code ++]
		}
	}
	else if (GetOfferingMtp(t) > 0) // [!code ++]
	{ // [!code ++]
		SetValue(t.category, GetOfferingMtp(t)); // [!code ++]
	} // [!code ++]
	else
	{
		string[] cat_offer = source.cat_offer;
```

[`@@ -187,22 +196,27 @@ public int GetOfferingValue(Thing t, int num = -1)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/Religion.cs#L187-L208)
```cs:line-numbers=187
			{
				if (t.category.IsChildOf(key))
				{
					num2 = Mathf.Clamp(t.SelfWeight / 10, 50, 1000); // [!code --]
					num2 *= EClass.sources.categories.map[key].offer / 100; // [!code --]
					SetValue(EClass.sources.categories.map[key], 1); // [!code ++]
					break;
				}
			}
		}
		if (num2 == 0) // [!code --]
		if (v == 0) // [!code ++]
		{
			return 0;
		}
		if (t.IsDecayed)
		{
			num2 /= 10; // [!code --]
			v /= 10; // [!code ++]
		} // [!code ++]
		v = v * (100 + Mathf.Min(t.LV * 2, 100) + (t.HasElement(757) ? 50 : 0)) / 100; // [!code ++]
		v = Mathf.Max(v, 1) * num; // [!code ++]
		return v; // [!code ++]
		void SetValue(SourceCategory.Row cat, int mtp) // [!code ++]
		{ // [!code ++]
			v = Mathf.Clamp(t.SelfWeight / 10, 50, 1000); // [!code ++]
			v *= cat.offer * mtp / 100; // [!code ++]
		}
		num2 = num2 * (100 + Mathf.Min(t.LV * 2, 100) + (t.HasElement(757) ? 50 : 0)) / 100; // [!code --]
		return Mathf.Max(num2, 1) * num; // [!code --]
	}

	public bool TryGetGift()
```

## ReligionMoonShadow

[`@@ -1,4 +1,18 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/ReligionMoonShadow.cs#L1-L4)
```cs:line-numbers=1
public class ReligionMoonShadow : ReligionMinor
{
	public override string id => "moonshadow";
 // [!code ++]
	public override int GetOfferingMtp(Thing t) // [!code ++]
	{ // [!code ++]
		switch (t.id) // [!code ++]
		{ // [!code ++]
		case "1134": // [!code ++]
		case "1218": // [!code ++]
		case "mochi": // [!code ++]
		case "kagamimochi": // [!code ++]
			return 2; // [!code ++]
		default: // [!code ++]
			return 0; // [!code ++]
		} // [!code ++]
	} // [!code ++]
}
```

## ReligionTrickery

[`@@ -1,4 +1,18 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/ReligionTrickery.cs#L1-L4)
```cs:line-numbers=1
public class ReligionTrickery : ReligionMinor
{
	public override string id => "trickery";
 // [!code ++]
	public override int GetOfferingMtp(Thing t) // [!code ++]
	{ // [!code ++]
		switch (t.id) // [!code ++]
		{ // [!code ++]
		case "1134": // [!code ++]
		case "1218": // [!code ++]
		case "mochi": // [!code ++]
		case "kagamimochi": // [!code ++]
			return 2; // [!code ++]
		default: // [!code ++]
			return 0; // [!code ++]
		} // [!code ++]
	} // [!code ++]
}
```

## Resistance

[`@@ -6,7 +6,7 @@ public class Resistance : Element`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/Resistance.cs#L6-L12)
```cs:line-numbers=6

	public override bool ShowXP => false;

	public override string ShortName => EClass.sources.elements.alias[base.source.aliasParent].GetName(); // [!code --]
	public override string ShortName => EClass.sources.elements.alias.TryGetValue(base.source.aliasParent)?.GetName() ?? base.source.aliasParent; // [!code ++]

	public override bool CanLink(ElementContainer owner)
	{
```

## TaskClean

[`@@ -12,24 +12,16 @@ public override string GetText(string str = "")`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/TaskClean.cs#L12-L35)
```cs:line-numbers=12

	public static bool CanClean(Point p)
	{
		if (!p.IsBlocked) // [!code --]
		if (!p.HasDirt) // [!code ++]
		{
			if (!p.HasDirt) // [!code --]
			{ // [!code --]
				return p.cell.HasLiquid; // [!code --]
			} // [!code --]
			return true; // [!code --]
			return p.cell.HasLiquid; // [!code ++]
		}
		return false; // [!code --]
		return true; // [!code ++]
	}

	public override bool CanPerform()
	{
		if (CanProgress()) // [!code --]
		{ // [!code --]
			return CanClean(dest); // [!code --]
		} // [!code --]
		return false; // [!code --]
		return CanClean(dest); // [!code ++]
	}

	public override bool CanManualCancel()
```

[`@@ -71,7 +63,7 @@ public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/TaskClean.cs#L71-L77)
```cs:line-numbers=71
public static Point GetTarget(Point dest)
{
	List<Point> list = new List<Point>();
	foreach (Point item in EClass._map.ListPointsInCircle(dest, 3f)) // [!code --]
	foreach (Point item in EClass._map.ListPointsInCircle(dest, 3f, mustBeWalkable: false)) // [!code ++]
	{
		if (CanClean(item))
		{
```

## Thing

[`@@ -252,7 +252,7 @@ public override void OnCreate(int genLv)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/Thing.cs#L252-L258)
```cs:line-numbers=252
				for (int k = 0; k < EClass.rnd(num2 + 1); k++)
				{
					Tuple<SourceElement.Row, int> enchant = GetEnchant(genLv, (SourceElement.Row r) => r.tag.Contains("modRanged"), neg: false);
					if (enchant != null && InvOwnerMod.IsValidMod(this, enchant.Item1)) // [!code --]
					if (enchant != null && InvOwnerMod.IsValidRangedMod(this, enchant.Item1)) // [!code ++]
					{
						ApplySocket(enchant.Item1.id, enchant.Item2);
					}
```

[`@@ -570,7 +570,7 @@ public override string GetName(NameStyle style, int _num = -1)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/Thing.cs#L570-L576)
```cs:line-numbers=570
		}
		if (!(text7 == "*r"))
		{
			text = ((!source.name2.IsEmpty()) ? source.GetTextArray("name2")[0].Replace("#1b", base.c_extraNameRef.IsEmpty((base.refCard != null) ? base.refCard.GetName() : text7)).Replace("#1", base.c_extraNameRef.IsEmpty(text7)) : (source.naming.Contains("last") ? (text + Lang.space + text7) : (source.naming.Contains("first") ? (text7 + Lang.space + text) : ((!source.naming.Contains("of")) ? (text6.IsEmpty() ? "_of3" : "_of2").lang(text7, text) : "_of".lang(text7, text))))); // [!code --]
			text = ((!source.name2.IsEmpty()) ? source.GetTextArray("name2")[0].Replace("#1b", base.c_extraNameRef.IsEmpty((base.refCard == null) ? text7 : (base.refCard.isChara ? base.refCard.GetName() : base.refCard.GetText()))).Replace("#1", base.c_extraNameRef.IsEmpty(text7)) : (source.naming.Contains("last") ? (text + Lang.space + text7) : (source.naming.Contains("first") ? (text7 + Lang.space + text) : ((!source.naming.Contains("of")) ? (text6.IsEmpty() ? "_of3" : "_of2").lang(text7, text) : "_of".lang(text7, text))))); // [!code ++]
		}
		else
		{
```

## TileType

[`@@ -330,7 +330,7 @@ public HitResult _HitTest(Point pos, Card target, bool canIgnore = true)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/TileType.cs#L330-L336)
```cs:line-numbers=330
	}
	if (pos.HasBlock)
	{
		if (!CanBuiltOnBlock && pos.sourceBlock.tileType.IsOccupyCell) // [!code --]
		if (!CanBuiltOnBlock && pos.sourceBlock.tileType.IsOccupyCell && !EClass.core.config.test.allowBlockOnItem) // [!code ++]
		{
			return HitResult.Invalid;
		}
```

## TraitGodStatue

[`@@ -1,5 +1,3 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/TraitGodStatue.cs#L1-L5)
```cs:line-numbers=1
using UnityEngine; // [!code --]
 // [!code --]
public class TraitGodStatue : TraitPowerStatue
{
	public Religion Religion => EClass.game.religions.dictAll[GetParam(1)];
```

[`@@ -21,7 +19,7 @@ public void OnChangeMaterial()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/TraitGodStatue.cs#L21-L27)
```cs:line-numbers=21
	owner.rarity = (owner.isOn ? Rarity.Artifact : Rarity.Normal);
	if (Religion.id == "machine")
	{
		owner.AddCard(GetManiGene()); // [!code --]
		owner.AddCard(DNA.GenerateManiGene(owner)); // [!code ++]
	}
	if (owner.placeState == PlaceState.installed)
	{
```

[`@@ -29,21 +27,6 @@ public void OnChangeMaterial()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/TraitGodStatue.cs#L29-L49)
```cs:line-numbers=29
		}
	}

	public Thing GetManiGene() // [!code --]
	{ // [!code --]
		owner.things.DestroyAll(); // [!code --]
		Debug.Log("Mani:" + owner.c_seed); // [!code --]
		Rand.SetSeed(owner.c_seed); // [!code --]
		CardRow r = SpawnList.Get("chara").Select(100); // [!code --]
		Rand.SetSeed(owner.c_seed); // [!code --]
		Thing thing = DNA.GenerateGene(r, DNA.Type.Superior, owner.LV, owner.c_seed); // [!code --]
		thing.c_DNA.cost = thing.c_DNA.cost / 2; // [!code --]
		thing.MakeRefFrom("mani"); // [!code --]
		Rand.SetSeed(); // [!code --]
		owner.c_seed++; // [!code --]
		return thing; // [!code --]
	} // [!code --]
 // [!code --]
	public override void _OnUse(Chara c)
	{
		Religion.Talk("shrine");
```

[`@@ -57,7 +40,7 @@ public override void _OnUse(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/TraitGodStatue.cs#L57-L63)
```cs:line-numbers=57
	}
	case "machine":
	{
		Thing t = owner.things.Find("gene") ?? GetManiGene(); // [!code --]
		Thing t = owner.things.Find("gene") ?? DNA.GenerateManiGene(owner); // [!code ++]
		EClass.pc.Pick(t);
		break;
	}
```

## TraitMod

[`@@ -2,13 +2,15 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/TraitMod.cs#L2-L14)
```cs:line-numbers=2

public class TraitMod : TraitItem
{
	public virtual string Tag => "mod"; // [!code ++]
 // [!code ++]
	public override bool CanStack => false;

	public SourceElement.Row source => EClass.sources.elements.map[owner.refVal];

	public override void OnCreate(int lv)
	{
		Tuple<SourceElement.Row, int> tuple = Thing.GetEnchant(lv, (SourceElement.Row r) => r.tag.Contains("modRanged"), neg: false); // [!code --]
		Tuple<SourceElement.Row, int> tuple = Thing.GetEnchant(lv, (SourceElement.Row r) => r.tag.Contains(Tag), neg: false); // [!code ++]
		if (tuple == null)
		{
			tuple = new Tuple<SourceElement.Row, int>(EClass.sources.elements.map[600], EClass.rnd(10) + 1);
```

## TraitModRanged

[`@@ -1,3 +1,4 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/TraitModRanged.cs#L1-L3)
```cs:line-numbers=1
public class TraitModRanged : TraitMod
{
	public override string Tag => "modRanged"; // [!code ++]
}
```

## +TraitRune

::: details File Created
```cs
public class TraitRune : TraitMod
{
	public override string Tag => "modMelee";
}
```

:::
## +TraitToolBrush

::: details File Created
```cs
public class TraitToolBrush : TraitTool
{
	public override bool DisableAutoCombat => true;

	public override void TrySetHeldAct(ActPlan p)
	{
		foreach (Chara chara in p.pos.Charas)
		{
			if (chara.interest > 0)
			{
				p.TrySetAct(new AI_TendAnimal
				{
					target = chara
				}, chara);
			}
		}
	}
}
```

:::
## Zone

[`@@ -1456,7 +1456,6 @@ public void AddGlobalCharasOnActivate()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/Zone.cs#L1456-L1462)
```cs:line-numbers=1456
		spawnPosPC = spawnPosPC.GetNearestPoint();
	}
	spawnPosPC = spawnPosPC.Clamp(useBounds: true).GetNearestPoint();
	Debug.Log(spawnPosPC); // [!code --]
	foreach (Chara c in EClass.game.cards.globalCharas.Values)
	{
		if (c.currentZone != this)
```

## Zone_VernisMine

[`@@ -1,3 +1,5 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/Zone_VernisMine.cs#L1-L3)
```cs:line-numbers=1
using UnityEngine; // [!code ++]
 // [!code ++]
public class Zone_VernisMine : Zone_Dungeon
{
	public const int LvBoss = -8;
```

[`@@ -30,6 +32,10 @@ public override string idExport`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/68f5c39752433a78f9311d90400f281ee50a8550/Elin/Zone_VernisMine.cs#L30-L35)
```cs:line-numbers=30
		}
	}

	public override int ContentLv => DangerLv; // [!code ++]
 // [!code ++]
	public override int DangerLv => 5 + Mathf.Abs(base.lv); // [!code ++]
 // [!code ++]
	public override string GetDungenID()
	{
		return "DungeonMine";
```

---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 21 files modified. 4 new files created.
version: EA 23.187 Stable
changes: AIWork/AI_Idle/+AI_Mofu/ActPlan/Chara/DramaManager/ElementContainer/FactionBranch/Game/LayerQuestBoard/Map/SurvivalManager/TCOrbitChara/TaskBuild/TaskDig/TaskHarvest/TraitCoreDefense/TraitGuildDoorman/+TraitVoidgate/WidgetDate/+ZoneEventRaid/ZoneEventSiege/+ZoneEventSurvival/Zone_StartSite/Zone_User
---

# EA 23.187 Stable

August 24, 2025

21 files modified. 4 new files created.

## Important Changes

Possible breaking changes. Click the filename to view the chunk.
### [Map (1)](#map)
```cs:no-line-numbers
public bool TrySpawnSurvivalItem(Point point) // [!code --]

```
## AIWork

[`using System;`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/AIWork.cs#L1-L5)
```cs:line-numbers=1
using System;
using System.Collections.Generic;
using UnityEngine; // [!code ++]

public class AIWork : AIAct
{
```

[`public bool SetDestination()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/AIWork.cs#L79-L84)
```cs:line-numbers=79
	}
	if (!sourceWork.destTrait.IsEmpty())
	{
		if (Application.isEditor && Type.GetType("Trait" + sourceWork.destTrait + ", Elin") == null) // [!code ++]
		{ // [!code ++]
			Debug.Log(sourceWork.destTrait + "/" + sourceWork.alias); // [!code ++]
		} // [!code ++]
		if (destArea != null)
		{
			destThing = EClass._map.FindThing(Type.GetType("Trait" + sourceWork.destTrait + ", Elin"), destArea);
```

## AI_Idle

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/AI_Idle.cs#L577-L582)
```cs:line-numbers=577
	{
		owner.AddCondition<ConSleep>(1000 + EClass.rnd(1000), force: true);
	}
	if (EClass.rnd(100) == 0 && (owner.HasHobbyOrWork("Pet") || owner.HasHobbyOrWork("Fluffy"))) // [!code ++]
	{ // [!code ++]
		yield return Do(new AI_Mofu()); // [!code ++]
	} // [!code ++]
	if (EClass.rnd((owner.host != null && owner.GetInt(106) != 0) ? 1000 : 40) == 0 && owner.IsHuman)
	{
		DoSomethingToNearChara((Chara c) => (!c.IsPCParty || EClass.rnd(5) == 0) && c.IsMofuable && !owner.IsHostile(c) && !c.IsInCombat, delegate(Chara c)
```

## +AI_Mofu

::: details File Created
```cs
using System.Collections.Generic;
using System.Linq;

public class AI_Mofu : AIWork
{
	public Chara mofu;

	public override int MaxRestart => 100;

	public Chara GetMofu()
	{
		return EClass._map.charas.Where((Chara c) => c.IsMofuable).RandomItem();
	}

	public override IEnumerable<Status> Run()
	{
		yield return DoWait(3 + EClass.rnd(10));
		if (mofu == null)
		{
			mofu = GetMofu();
		}
		if (mofu == null || !mofu.ExistsOnMap)
		{
			yield return Success();
		}
		if (owner.Dist(mofu) > 1)
		{
			yield return DoGoto(mofu);
		}
		if (mofu == null || !mofu.ExistsOnMap)
		{
			yield return Success();
		}
		owner.Cuddle(mofu);
		if (EClass.rnd(222) != 0)
		{
			yield return Restart();
		}
	}
}
```

:::
## ActPlan

[`void func()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/ActPlan.cs#L859-L865)
```cs:line-numbers=859
					}, null, CursorSystem.Hand, 1, isHostileAct: false, localAct: false);
				}
			}
			if (input == ActInput.AllAction && pos.IsSky) // [!code --]
			if (input == ActInput.AllAction && pos.IsSky && !EClass.game.IsSurvival) // [!code ++]
			{
				TrySetAct("actSkyJump", delegate
				{
```

## Chara

[`public override void Tick()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/Chara.cs#L3950-L3956)
```cs:line-numbers=3950
			EClass.player.returnInfo.turns--;
			if (EClass.player.returnInfo.turns <= 0)
			{
				if (EClass.game.Prologue.type == GameType.Survival && EClass._zone is Zone_StartSiteSky) // [!code --]
				if (EClass.game.IsSurvival && EClass._zone is Zone_StartSiteSky) // [!code ++]
				{
					Msg.SayNothingHappen();
				}
```

[`public Goal GetGoalHobby()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/Chara.cs#L8416-L8421)
```cs:line-numbers=8416
		return new GoalHobby();
	}

	public bool HasHobbyOrWork(string alias) // [!code ++]
	{ // [!code ++]
		int num = EClass.sources.hobbies.alias.TryGetValue(alias)?.id ?? 0; // [!code ++]
		listHobby.Clear(); // [!code ++]
		if (_works == null || _hobbies == null) // [!code ++]
		{ // [!code ++]
			RerollHobby(); // [!code ++]
		} // [!code ++]
		foreach (int work in _works) // [!code ++]
		{ // [!code ++]
			if (work == num) // [!code ++]
			{ // [!code ++]
				return true; // [!code ++]
			} // [!code ++]
		} // [!code ++]
		foreach (int hobby in _hobbies) // [!code ++]
		{ // [!code ++]
			if (hobby == num) // [!code ++]
			{ // [!code ++]
				return true; // [!code ++]
			} // [!code ++]
		} // [!code ++]
		return false; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void SetAIIdle()
	{
	}
```

## DramaManager

[`public bool CheckIF(string IF)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/DramaManager.cs#L1047-L1053)
```cs:line-numbers=1047
	switch (array[0])
	{
	case "survival":
		return EMono.game.Prologue.type == GameType.Survival; // [!code --]
		return EMono.game.IsSurvival; // [!code ++]
	case "fromBook":
		return LayerDrama.fromBook;
	case "!fromBook":
```

## ElementContainer

[`public List<Element> ListBestSkills()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/ElementContainer.cs#L627-L633)
```cs:line-numbers=627

	public List<Element> ListGeneFeats()
	{
		return ListElements((Element a) => a.Value > 0 && a.source.category == "feat" && a.source.cost.Length != 0 && a.source.cost[0] > 0 && a.source.geneSlot >= 0); // [!code --]
		return ListElements((Element a) => a.ValueWithoutLink > 0 && a.source.category == "feat" && a.source.cost.Length != 0 && a.source.cost[0] > 0 && a.source.geneSlot >= 0); // [!code ++]
	}

	public List<Element> ListLearnable(Chara c)
```

## FactionBranch

[`public void UpdateReqruits(bool clear = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/FactionBranch.cs#L1681-L1686)
```cs:line-numbers=1681
				AddRecruit(chara);
			}
		}
		if (EClass.game.IsSurvival) // [!code ++]
		{ // [!code ++]
			EClass.game.survival.OnUpdateRecruit(this); // [!code ++]
		} // [!code ++]
	}

	public void AddRecruit(Chara c)
```

## Game

[`private void _OnDeserialized(StreamingContext context)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/Game.cs#L269-L274)
```cs:line-numbers=269

	public bool altAbility => EClass.core.config.game.altAbility;

	public bool IsSurvival => Prologue.type == GameType.Survival; // [!code ++]
 // [!code ++]
	public Zone StartZone => spatials.Find(EClass.game.Prologue.idStartZone);

	public new static void Wait(float a, Point p)
```

## LayerQuestBoard

[`public override void OnSwitchContent(Window window)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/LayerQuestBoard.cs#L47-L52)
```cs:line-numbers=47
		RefreshQuest();
		break;
	case 1:
		if (ELayer.debug.enable) // [!code ++]
		{ // [!code ++]
			ELayer.Branch.UpdateReqruits(clear: true); // [!code ++]
		} // [!code ++]
		RefreshHire();
		break;
	case 2:
```

## Map

[`public void Reload()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/Map.cs#L314-L320)
```cs:line-numbers=314
	string id = Game.id;
	EClass.game.Save();
	EClass.scene.Init(Scene.Mode.None);
	Game.Load(id, EClass.game.isCloud); // [!code --]
	Game.Load(id, cloud: false); // [!code ++]
	RevealAll();
	TweenUtil.Tween(0.1f, null, delegate
	{
```

[`public void MineObj(Point point, Task task = null, Chara c = null)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/Map.cs#L1888-L1896)
```cs:line-numbers=1888
			{
				MineBlock(point, recoverBlock: false, c, mineObj: false);
			}
			if (EClass.game.Prologue.type == GameType.Survival && EClass._zone is Zone_StartSiteSky && !EClass.scene.actionMode.IsBuildMode) // [!code --]
			if (EClass.game.IsSurvival && EClass._zone is Zone_StartSiteSky && !EClass.scene.actionMode.IsBuildMode) // [!code ++]
			{
				if (TrySpawnSurvivalItem(point)) // [!code --]
				if (EClass.game.survival.OnMineWreck(point)) // [!code ++]
				{
					Rand.SetSeed();
					return;
```

[`public void MineObjSound(Point point)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/Map.cs#L1939-L2039)
```cs:line-numbers=1939
		point.PlaySound(point.cell.matObj.GetSoundDead(point.cell.sourceObj));
	}

	public bool TrySpawnSurvivalItem(Point point) // [!code --]
	{ // [!code --]
		SourceObj.Row sourceObj = point.cell.sourceObj; // [!code --]
		int searchWreck = EClass.game.survival.flags.searchWreck; // [!code --]
		string[] array = new string[6] { "log", "rock", "branch", "bone", "grass", "vine" }; // [!code --]
		int chanceChange = 25; // [!code --]
		int num = searchWreck / 50 + 3; // [!code --]
		switch (sourceObj.alias) // [!code --]
		{ // [!code --]
		case "nest_bird": // [!code --]
			chanceChange = 100; // [!code --]
			return Pop(ThingGen.Create((EClass.rnd(10) == 0) ? "egg_fertilized" : "_egg").TryMakeRandomItem(num)); // [!code --]
		case "wreck_wood": // [!code --]
			array = new string[5] { "log", "log", "branch", "grass", "vine" }; // [!code --]
			break; // [!code --]
		case "wreck_junk": // [!code --]
			chanceChange = 50; // [!code --]
			return Pop(ThingGen.CreateFromFilter("shop_junk", num)); // [!code --]
		case "wreck_stone": // [!code --]
			array = new string[4] { "rock", "rock", "stone", "bone" }; // [!code --]
			break; // [!code --]
		case "wreck_scrap": // [!code --]
			chanceChange = 75; // [!code --]
			array = new string[1] { "scrap" }; // [!code --]
			break; // [!code --]
		case "wreck_cloth": // [!code --]
			chanceChange = 75; // [!code --]
			array = new string[1] { "fiber" }; // [!code --]
			break; // [!code --]
		case "wreck_precious": // [!code --]
			chanceChange = 100; // [!code --]
			return Pop(ThingGen.CreateFromFilter("shop_magic", num)); // [!code --]
		default: // [!code --]
			return false; // [!code --]
		} // [!code --]
		if (EClass.rnd(3) == 0 && EClass.game.survival.flags.spawnedFloor < 4) // [!code --]
		{ // [!code --]
			EClass.game.survival.flags.spawnedFloor++; // [!code --]
			return Pop(ThingGen.CreateFloor(40, 45).SetNum(3)); // [!code --]
		} // [!code --]
		if (EClass.rnd(20) == 0) // [!code --]
		{ // [!code --]
			return Pop(TraitSeed.MakeRandomSeed()); // [!code --]
		} // [!code --]
		if (EClass.rnd(12) == 0) // [!code --]
		{ // [!code --]
			return Pop(ThingGen.Create("money2")); // [!code --]
		} // [!code --]
		if (EClass.rnd(12) == 0) // [!code --]
		{ // [!code --]
			Point pos = point.GetNearestPoint(allowBlock: false, allowChara: false, allowInstalled: false, ignoreCenter: true) ?? point; // [!code --]
			if (searchWreck < 50 || EClass.rnd(3) != 0) // [!code --]
			{ // [!code --]
				EClass._zone.SpawnMob(pos, SpawnSetting.HomeWild(num)); // [!code --]
			} // [!code --]
			else // [!code --]
			{ // [!code --]
				EClass._zone.SpawnMob(pos, SpawnSetting.HomeEnemy(Mathf.Max(num - 5, 1))); // [!code --]
			} // [!code --]
		} // [!code --]
		return Pop(ThingGen.Create(array.RandomItem()).SetNum(1 + EClass.rnd(3))); // [!code --]
		bool Next() // [!code --]
		{ // [!code --]
			EClass.game.survival.flags.searchWreck++; // [!code --]
			Point pos2 = point.GetNearestPoint(allowBlock: false, allowChara: false, allowInstalled: false, ignoreCenter: true) ?? point; // [!code --]
			if (EClass.game.survival.flags.searchWreck == 20) // [!code --]
			{ // [!code --]
				EffectMeteor.Create(pos2, 0, 1, delegate // [!code --]
				{ // [!code --]
					EClass._zone.AddCard(ThingGen.CreateRecipe("container_shipping"), pos2); // [!code --]
				}); // [!code --]
			} // [!code --]
			NextObj(); // [!code --]
			return true; // [!code --]
		} // [!code --]
		void NextObj() // [!code --]
		{ // [!code --]
			if (EClass.rnd(100) < chanceChange) // [!code --]
			{ // [!code --]
				string[] source = new string[11] // [!code --]
				{ // [!code --]
					"nest_bird", "wreck_wood", "wreck_wood", "wreck_wood", "wreck_wood", "wreck_stone", "wreck_stone", "wreck_scrap", "wreck_junk", "wreck_cloth", // [!code --]
					"wreck_precious" // [!code --]
				}; // [!code --]
				SetObj(point.x, point.z, EClass.sources.objs.alias[source.RandomItem()].id); // [!code --]
			} // [!code --]
		} // [!code --]
		bool Pop(Thing t) // [!code --]
		{ // [!code --]
			TrySmoothPick(point, t, EClass.pc); // [!code --]
			Next(); // [!code --]
			return true; // [!code --]
		} // [!code --]
	} // [!code --]
 // [!code --]
	public PlantData TryGetPlant(Point p)
	{
		return plants.TryGetValue(p.index);
```

## SurvivalManager

[`using System;`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/SurvivalManager.cs#L1-L5)
```cs:line-numbers=1
using System; // [!code ++]
using System.Collections.Generic; // [!code ++]
using System.Linq; // [!code ++]
using System.Runtime.Serialization;
using Newtonsoft.Json;
using UnityEngine; // [!code ++]

public class SurvivalManager : EClass
{
```

[`public int searchWreck`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/SurvivalManager.cs#L46-L51)
```cs:line-numbers=46
			}
		}

		public int dateNextRaid // [!code ++]
		{ // [!code ++]
			get // [!code ++]
			{ // [!code ++]
				return ints[6]; // [!code ++]
			} // [!code ++]
			set // [!code ++]
			{ // [!code ++]
				ints[6] = value; // [!code ++]
			} // [!code ++]
		} // [!code ++]
 // [!code ++]
		public int raidRound // [!code ++]
		{ // [!code ++]
			get // [!code ++]
			{ // [!code ++]
				return ints[7]; // [!code ++]
			} // [!code ++]
			set // [!code ++]
			{ // [!code ++]
				ints[7] = value; // [!code ++]
			} // [!code ++]
		} // [!code ++]
 // [!code ++]
		public bool raid // [!code ++]
		{ // [!code ++]
			get // [!code ++]
			{ // [!code ++]
				return bits[0]; // [!code ++]
			} // [!code ++]
			set // [!code ++]
			{ // [!code ++]
				bits[0] = value; // [!code ++]
			} // [!code ++]
		} // [!code ++]
 // [!code ++]
		[OnSerializing]
		private void _OnSerializing(StreamingContext context)
		{
```

[`private void _OnDeserialized(StreamingContext context)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/SurvivalManager.cs#L61-L64)
```cs:line-numbers=61

	[JsonProperty]
	public Flags flags = new Flags();
 // [!code ++]
	public bool IsInRaid => GetRaidEvent() != null; // [!code ++]
 // [!code ++]
	public ZoneEventRaid GetRaidEvent() // [!code ++]
	{ // [!code ++]
		return EClass._zone.events.GetEvent<ZoneEventRaid>(); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void Meteor(Point pos, Action action) // [!code ++]
	{ // [!code ++]
		EffectMeteor.Create(pos, 0, 1, delegate // [!code ++]
		{ // [!code ++]
			action(); // [!code ++]
		}); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void OnExpandFloor(Point pos) // [!code ++]
	{ // [!code ++]
		int i = 0; // [!code ++]
		bool done = false; // [!code ++]
		EClass._map.ForeachCell(delegate(Cell c) // [!code ++]
		{ // [!code ++]
			if (!c.sourceFloor.tileType.IsSkipFloor) // [!code ++]
			{ // [!code ++]
				i++; // [!code ++]
			} // [!code ++]
		}); // [!code ++]
		Check(9, delegate // [!code ++]
		{ // [!code ++]
			EClass._zone.ClaimZone(debug: false, pos); // [!code ++]
		}); // [!code ++]
		Check(15, delegate // [!code ++]
		{ // [!code ++]
			EClass.pc.homeBranch.AddMemeber(EClass._zone.AddCard(CharaGen.Create("fiama"), pos.x, pos.z).Chara); // [!code ++]
		}); // [!code ++]
		Check(25, delegate // [!code ++]
		{ // [!code ++]
			EClass.pc.homeBranch.AddMemeber(EClass._zone.AddCard(CharaGen.Create("nino"), pos.x, pos.z).Chara); // [!code ++]
		}); // [!code ++]
		Check(40, delegate // [!code ++]
		{ // [!code ++]
			EClass.pc.homeBranch.AddMemeber(EClass._zone.AddCard(CharaGen.Create("loytel"), pos.x, pos.z).Chara); // [!code ++]
		}); // [!code ++]
		Check(50, delegate // [!code ++]
		{ // [!code ++]
			EClass._zone.AddCard(ThingGen.Create("core_defense"), pos).Install(); // [!code ++]
		}); // [!code ++]
		void Check(int a, Action action) // [!code ++]
		{ // [!code ++]
			if (!done && flags.floors < a && i >= a) // [!code ++]
			{ // [!code ++]
				Meteor(pos, action); // [!code ++]
				EClass.game.survival.flags.floors = a; // [!code ++]
				done = true; // [!code ++]
			} // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public bool OnMineWreck(Point point) // [!code ++]
	{ // [!code ++]
		if (EClass._zone.events.GetEvent<ZoneEventSurvival>() == null) // [!code ++]
		{ // [!code ++]
			EClass._zone.events.Add(new ZoneEventSurvival()); // [!code ++]
		} // [!code ++]
		SourceObj.Row sourceObj = point.cell.sourceObj; // [!code ++]
		int searchWreck = EClass.game.survival.flags.searchWreck; // [!code ++]
		string[] array = new string[6] { "log", "rock", "branch", "bone", "grass", "vine" }; // [!code ++]
		int chanceChange = 25; // [!code ++]
		int num = searchWreck / 50 + 3; // [!code ++]
		if (searchWreck == 0) // [!code ++]
		{ // [!code ++]
			Pop(ThingGen.Create("log").SetNum(6)); // [!code ++]
			Pop(ThingGen.Create("rock").SetNum(4)); // [!code ++]
		} // [!code ++]
		switch (sourceObj.alias) // [!code ++]
		{ // [!code ++]
		case "nest_bird": // [!code ++]
			chanceChange = 100; // [!code ++]
			return Pop(ThingGen.Create((EClass.rnd(10) == 0) ? "egg_fertilized" : "_egg").TryMakeRandomItem(num)); // [!code ++]
		case "wreck_wood": // [!code ++]
			array = new string[6] { "log", "log", "branch", "grass", "vine", "resin" }; // [!code ++]
			break; // [!code ++]
		case "wreck_junk": // [!code ++]
			chanceChange = 50; // [!code ++]
			return Pop(ThingGen.CreateFromFilter("shop_junk", num)); // [!code ++]
		case "wreck_stone": // [!code ++]
			chanceChange = 30; // [!code ++]
			array = new string[4] { "rock", "rock", "stone", "bone" }; // [!code ++]
			break; // [!code ++]
		case "wreck_scrap": // [!code ++]
			chanceChange = 75; // [!code ++]
			array = new string[1] { "scrap" }; // [!code ++]
			break; // [!code ++]
		case "wreck_cloth": // [!code ++]
			chanceChange = 75; // [!code ++]
			array = new string[1] { "fiber" }; // [!code ++]
			break; // [!code ++]
		case "wreck_precious": // [!code ++]
			chanceChange = 100; // [!code ++]
			return Pop(ThingGen.CreateFromFilter("shop_magic", num)); // [!code ++]
		default: // [!code ++]
			return false; // [!code ++]
		} // [!code ++]
		if (EClass.rnd(3) == 0 && EClass.game.survival.flags.spawnedFloor < 4) // [!code ++]
		{ // [!code ++]
			EClass.game.survival.flags.spawnedFloor++; // [!code ++]
			return Pop(ThingGen.CreateFloor(40, 45).SetNum(3)); // [!code ++]
		} // [!code ++]
		if (EClass.rnd(20) == 0) // [!code ++]
		{ // [!code ++]
			return Pop(TraitSeed.MakeRandomSeed()); // [!code ++]
		} // [!code ++]
		if (EClass.rnd(12) == 0) // [!code ++]
		{ // [!code ++]
			return Pop(ThingGen.Create("money2")); // [!code ++]
		} // [!code ++]
		if (EClass.rnd(12) == 0) // [!code ++]
		{ // [!code ++]
			Point pos = point.GetNearestPoint(allowBlock: false, allowChara: false, allowInstalled: false, ignoreCenter: true) ?? point; // [!code ++]
			if (searchWreck < 50 || EClass.rnd(3) != 0) // [!code ++]
			{ // [!code ++]
				EClass._zone.SpawnMob(pos, SpawnSetting.HomeWild(num)); // [!code ++]
			} // [!code ++]
			else // [!code ++]
			{ // [!code ++]
				EClass._zone.SpawnMob(pos, SpawnSetting.HomeEnemy(Mathf.Max(num - 5, 1))); // [!code ++]
			} // [!code ++]
		} // [!code ++]
		return Pop(ThingGen.Create(array.RandomItem()).SetNum(1 + EClass.rnd(3))); // [!code ++]
		bool Next() // [!code ++]
		{ // [!code ++]
			EClass.game.survival.flags.searchWreck++; // [!code ++]
			Point pos2 = point.GetNearestPoint(allowBlock: false, allowChara: false, allowInstalled: false, ignoreCenter: true) ?? point; // [!code ++]
			if (EClass.game.survival.flags.searchWreck == 20) // [!code ++]
			{ // [!code ++]
				Meteor(pos2, delegate // [!code ++]
				{ // [!code ++]
					EClass._zone.AddCard(ThingGen.CreateRecipe("container_shipping"), pos2); // [!code ++]
				}); // [!code ++]
			} // [!code ++]
			NextObj(); // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
		void NextObj() // [!code ++]
		{ // [!code ++]
			if (EClass.rnd(100) < chanceChange) // [!code ++]
			{ // [!code ++]
				string[] source = new string[11] // [!code ++]
				{ // [!code ++]
					"nest_bird", "wreck_wood", "wreck_wood", "wreck_wood", "wreck_wood", "wreck_stone", "wreck_stone", "wreck_scrap", "wreck_junk", "wreck_cloth", // [!code ++]
					"wreck_precious" // [!code ++]
				}; // [!code ++]
				EClass._map.SetObj(point.x, point.z, EClass.sources.objs.alias[source.RandomItem()].id); // [!code ++]
			} // [!code ++]
		} // [!code ++]
		bool Pop(Thing t) // [!code ++]
		{ // [!code ++]
			EClass._map.TrySmoothPick(point, t, EClass.pc); // [!code ++]
			Next(); // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public List<SourceChara.Row> ListUnrecruitedUniques() // [!code ++]
	{ // [!code ++]
		return EClass.sources.charas.rows.Where(delegate(SourceChara.Row r) // [!code ++]
		{ // [!code ++]
			if (r.quality != 4 || r.race == "god" || r.size.Length != 0) // [!code ++]
			{ // [!code ++]
				return false; // [!code ++]
			} // [!code ++]
			switch (r.id) // [!code ++]
			{ // [!code ++]
			case "fiama": // [!code ++]
			case "loytel": // [!code ++]
			case "nino": // [!code ++]
			case "big_daddy": // [!code ++]
			case "littleOne": // [!code ++]
				return false; // [!code ++]
			default: // [!code ++]
				return EClass.game.cards.globalCharas.Find(r.id) == null; // [!code ++]
			} // [!code ++]
		}).ToList(); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void OnUpdateRecruit(FactionBranch branch) // [!code ++]
	{ // [!code ++]
		List<SourceChara.Row> list = ListUnrecruitedUniques(); // [!code ++]
		for (int i = 0; i < (EClass.debug.enable ? 10 : 2); i++) // [!code ++]
		{ // [!code ++]
			SourceChara.Row row = list.RandomItem(); // [!code ++]
			if (row != null) // [!code ++]
			{ // [!code ++]
				Chara chara = CharaGen.Create(row.id); // [!code ++]
				chara.RemoveEditorTag(EditorTag.AINoMove); // [!code ++]
				branch.AddRecruit(chara); // [!code ++]
				list.Remove(row); // [!code ++]
			} // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void StartRaid() // [!code ++]
	{ // [!code ++]
		SE.Play("warhorn"); // [!code ++]
		Msg.Say("warhorn"); // [!code ++]
		flags.raid = true; // [!code ++]
		Point pos = EClass.pc.pos.GetNearestPoint(allowBlock: false, allowChara: false, allowInstalled: false, ignoreCenter: true) ?? EClass.pc.pos; // [!code ++]
		Meteor(pos, delegate // [!code ++]
		{ // [!code ++]
			EClass._zone.AddCard(ThingGen.Create("teleporter_demon"), pos).Install(); // [!code ++]
		}); // [!code ++]
		flags.dateNextRaid = EClass.world.date.GetRaw(72); // [!code ++]
	} // [!code ++]
}
```

## TCOrbitChara

[`public void RefreshAll()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/TCOrbitChara.cs#L83-L89)
```cs:line-numbers=83
			{
				flag = true;
			}
			else if (owner.IsUnique) // [!code --]
			else if (owner.IsUnique && !EMono.game.IsSurvival) // [!code ++]
			{
				string id = owner.id;
				if (!(id == "ashland"))
```

## TaskBuild

[`public override void OnProgressComplete()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/TaskBuild.cs#L381-L437)
```cs:line-numbers=381
				}
			});
		}
		if (EClass.game.Prologue.type != GameType.Survival || !(EClass._zone is Zone_StartSiteSky)) // [!code --]
		if (EClass.game.IsSurvival && EClass._zone is Zone_StartSiteSky) // [!code ++]
		{
			return; // [!code --]
		} // [!code --]
		int i = 0; // [!code --]
		EClass._map.ForeachCell(delegate(Cell c) // [!code --]
		{ // [!code --]
			if (!c.sourceFloor.tileType.IsSkipFloor) // [!code --]
			{ // [!code --]
				i++; // [!code --]
			} // [!code --]
		}); // [!code --]
		if (EClass.game.survival.flags.floors < 9 && i >= 9) // [!code --]
		{ // [!code --]
			EffectMeteor.Create(pos, 0, 1, delegate // [!code --]
			{ // [!code --]
				EClass._zone.ClaimZone(debug: false, pos); // [!code --]
			}); // [!code --]
			EClass.game.survival.flags.floors = 9; // [!code --]
		} // [!code --]
		else if (EClass.game.survival.flags.floors < 15 && i >= 15) // [!code --]
		{ // [!code --]
			EffectMeteor.Create(pos, 0, 1, delegate // [!code --]
			{ // [!code --]
				EClass.pc.homeBranch.AddMemeber(EClass._zone.AddCard(CharaGen.Create("fiama"), pos.x, pos.z).Chara); // [!code --]
			}); // [!code --]
			EClass.game.survival.flags.floors = 15; // [!code --]
		} // [!code --]
		else if (EClass.game.survival.flags.floors < 25 && i >= 25) // [!code --]
		{ // [!code --]
			EffectMeteor.Create(pos, 0, 1, delegate // [!code --]
			{ // [!code --]
				EClass.pc.homeBranch.AddMemeber(EClass._zone.AddCard(CharaGen.Create("nino"), pos.x, pos.z).Chara); // [!code --]
			}); // [!code --]
			EClass.game.survival.flags.floors = 25; // [!code --]
		} // [!code --]
		else if (EClass.game.survival.flags.floors < 40 && i >= 40) // [!code --]
		{ // [!code --]
			EffectMeteor.Create(pos, 0, 1, delegate // [!code --]
			{ // [!code --]
				EClass.pc.homeBranch.AddMemeber(EClass._zone.AddCard(CharaGen.Create("loytel"), pos.x, pos.z).Chara); // [!code --]
			}); // [!code --]
			EClass.game.survival.flags.floors = 40; // [!code --]
		} // [!code --]
		else if (EClass.game.survival.flags.floors < 50 && i >= 50) // [!code --]
		{ // [!code --]
			EffectMeteor.Create(pos, 0, 1, delegate // [!code --]
			{ // [!code --]
				EClass._zone.AddCard(ThingGen.Create("core_defense"), pos).Install(); // [!code --]
			}); // [!code --]
			EClass.game.survival.flags.floors = 50; // [!code --]
			EClass.game.survival.OnExpandFloor(pos); // [!code ++]
		}
	}

```

## TaskDig

[`public override HitResult GetHitResult()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/TaskDig.cs#L96-L102)
```cs:line-numbers=96
			}
			return HitResult.Default;
		}
		if (EClass._zone.IsSkyLevel && (pos.Installed != null || pos.Charas.Count >= 2 || (pos.HasChara && pos.FirstChara != EClass.pc))) // [!code --]
		if (EClass._zone.IsSkyLevel && (pos.IsSky || pos.Installed != null || pos.Charas.Count >= 2 || (pos.HasChara && (pos.FirstChara != EClass.pc || EClass.game.IsSurvival)))) // [!code ++]
		{
			return HitResult.Invalid;
		}
```

[`public override HitResult GetHitResult()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/TaskDig.cs#L104-L110)
```cs:line-numbers=104
		{
			return HitResult.Invalid;
		}
		if (!pos.HasBridge && pos.sourceFloor.id == 40) // [!code --]
		if (!pos.HasBridge && !EClass._zone.IsSkyLevel && pos.sourceFloor.id == 40) // [!code ++]
		{
			return HitResult.Invalid;
		}
```

[`public override void OnProgressComplete()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/TaskDig.cs#L191-L197)
```cs:line-numbers=191
		{
			EClass.player.recipes.ComeUpWithRecipe(idRecipe, 30);
		}
		if (owner.IsPC && owner.IsAliveInCurrentZone && EClass._zone.IsSkyLevel && owner.pos.IsSky) // [!code --]
		if (owner.IsPC && owner.IsAliveInCurrentZone && EClass._zone.IsSkyLevel && !EClass.game.IsSurvival && owner.pos.IsSky) // [!code ++]
		{
			EClass.pc.FallFromZone();
		}
```

## TaskHarvest

[`public override bool Loop`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/TaskHarvest.cs#L74-L80)
```cs:line-numbers=74
{
	get
	{
		if (EClass.game.Prologue.type == GameType.Survival && EClass._zone is Zone_StartSite) // [!code --]
		if (EClass.game.IsSurvival && EClass._zone is Zone_StartSite) // [!code ++]
		{
			return CanProgress();
		}
```

## TraitCoreDefense

[`public class TraitCoreDefense : Trait`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/TraitCoreDefense.cs#L10-L15)
```cs:line-numbers=10

	public override void TrySetAct(ActPlan p)
	{
		if (EClass.game.IsSurvival && EClass._zone is Zone_StartSiteSky && !EClass.game.survival.flags.raid) // [!code ++]
		{ // [!code ++]
			p.TrySetAct("actWarhorn", delegate // [!code ++]
			{ // [!code ++]
				EClass.game.survival.StartRaid(); // [!code ++]
				return true; // [!code ++]
			}); // [!code ++]
		} // [!code ++]
		ZoneEventDefenseGame ev = EClass._zone.events.GetEvent<ZoneEventDefenseGame>();
		if (ev == null)
		{
```

## TraitGuildDoorman

[`public class TraitGuildDoorman : TraitUniqueGuildPersonnel`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/TraitGuildDoorman.cs#L4-L10)
```cs:line-numbers=4

	public virtual bool IsGuildMember => false;

	public override bool CanBePushed => IsGuildMember; // [!code --]
	public override bool CanBePushed // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			if (!IsGuildMember) // [!code ++]
			{ // [!code ++]
				return base.owner.IsPCFaction; // [!code ++]
			} // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
	} // [!code ++]

	public virtual void GiveTrial()
	{
```

## +TraitVoidgate

::: details File Created
```cs
public class TraitVoidgate : Trait
{
	public override bool CanBeDestroyed => false;

	public override bool CanOnlyCarry => true;

	public override bool CanPutAway => false;

	public override bool IsAnimeOn => owner.isOn;
}
```

:::
## WidgetDate

[`public void _Refresh()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/WidgetDate.cs#L121-L126)
```cs:line-numbers=121
	{
		text += item2.TextWidgetDate;
	}
	if (EMono.game.IsSurvival && EMono.game.survival.flags.raid) // [!code ++]
	{ // [!code ++]
		text += (EMono.game.survival.IsInRaid ? "raid_ongoing".lang() : "raid_till".lang(EMono.world.date.GetRemainingHours(EMono.game.survival.flags.dateNextRaid).ToString() ?? "")); // [!code ++]
	} // [!code ++]
	if (EMono.Branch != null && EMono.Branch.luckyMonth)
	{
		text = text + " " + "lucky_month".lang().TagColor(Msg.colors.colors["save"]);
```

## +ZoneEventRaid

::: details File Created
```cs
public class ZoneEventRaid : ZoneEventSiege
{
	public override void OnFirstTick()
	{
		lv = 5 + EClass.game.survival.flags.raidRound * 10;
		max = 5 + lv / 5;
		base.OnFirstTick();
	}

	public override Point GetSpawnPos()
	{
		Trait trait = EClass._map.FindThing<TraitVoidgate>();
		if (trait != null)
		{
			return trait.owner.pos;
		}
		trait = EClass._map.FindThing<TraitCoreDefense>();
		if (trait != null)
		{
			return trait.owner.pos;
		}
		return EClass.pc.pos;
	}

	public override void OnKill()
	{
		base.OnKill();
		EClass.game.survival.flags.raidRound++;
		EClass.game.survival.flags.dateNextRaid = EClass.world.date.GetRaw(168);
	}
}
```

:::
## ZoneEventSiege

[`public class ZoneEventSiege : ZoneEvent`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/ZoneEventSiege.cs#L8-L20)
```cs:line-numbers=8

	public List<Chara> members = new List<Chara>();

	public int lv = 10; // [!code ++]
 // [!code ++]
	public int max = 10; // [!code ++]
 // [!code ++]
	public override string id => "trial_siege";

	public override Playlist playlist => EClass.Sound.playlistBattle;

	public virtual Chara CreateChara()
	{
		return CharaGen.CreateFromFilter("c_wilds"); // [!code --]
		return CharaGen.CreateFromFilter("c_wilds", lv); // [!code ++]
	}

	public override void OnFirstTick()
```

[`public override void OnFirstTick()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/ZoneEventSiege.cs#L22-L38)
```cs:line-numbers=22
	EClass.player.stats.sieges++;
	Msg.Say("startSiege");
	EClass._zone.RefreshBGM();
	Point randomEdge = EClass._map.GetRandomEdge(); // [!code --]
	Point spawnPos = GetSpawnPos(); // [!code ++]
	for (int i = 0; i < 10; i++)
	{
		Chara chara = CreateChara();
		EClass._zone.AddCard(chara, EClass._map.GetRandomSurface(randomEdge.x, randomEdge.z, 6)); // [!code --]
		EClass._zone.AddCard(chara, EClass._map.GetRandomSurface(spawnPos.x, spawnPos.z, 6)); // [!code ++]
		chara.hostility = Hostility.Enemy;
		members.Add(chara);
		uids.Add(chara.uid);
		chara.PlayEffect("teleport"); // [!code ++]
		chara.PlaySound("spell_funnel"); // [!code ++]
	}
	Thing t = ThingGen.Create("torch");
	EClass._zone.AddCard(t, randomEdge); // [!code --]
	EClass._zone.AddCard(t, spawnPos); // [!code ++]
	if (members.Count != 0)
	{
		return;
```

[`public override void OnFirstTick()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/ZoneEventSiege.cs#L49-L54)
```cs:line-numbers=49
		}
	}

	public virtual Point GetSpawnPos() // [!code ++]
	{ // [!code ++]
		return EClass._map.GetRandomEdge(); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public override void OnTickRound()
	{
		bool flag = true;
```

[`public override void OnTickRound()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/ZoneEventSiege.cs#L63-L69)
```cs:line-numbers=63
			flag = false;
		}
	}
	if (flag || EClass.Branch.IsAllDead()) // [!code --]
	if (flag) // [!code ++]
	{
		Kill();
	}
```

## +ZoneEventSurvival

::: details File Created
```cs
using UnityEngine;

public class ZoneEventSurvival : ZoneEvent
{
	public override void OnTickRound()
	{
		Debug.Log("tick:" + rounds);
		Cell cell = EClass._map.cells[100, 100];
		if (!cell.HasObj)
		{
			EClass._map.SetObj(cell.x, cell.z, 46);
		}
		if (EClass.player.stats.days >= 10 && !EClass.game.survival.flags.raid)
		{
			EClass.game.survival.StartRaid();
		}
		if (EClass.game.survival.flags.raid)
		{
			TraitVoidgate traitVoidgate = EClass._map.FindThing<TraitVoidgate>();
			if (traitVoidgate != null)
			{
				traitVoidgate.owner.isOn = EClass.game.survival.IsInRaid;
			}
			if (!EClass.game.survival.IsInRaid && EClass.world.date.GetRemainingHours(EClass.game.survival.flags.dateNextRaid) <= 0)
			{
				EClass._zone.events.Add(new ZoneEventRaid());
			}
		}
	}
}
```

:::
## Zone_StartSite

[`public class Zone_StartSite : Zone`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/Zone_StartSite.cs#L5-L8)
```cs:line-numbers=5
	public override bool isClaimable => true;

	public override string IDBaseLandFeat => "bfPlain,bfFertile,bfStart";
 // [!code ++]
	public override void OnGenerateMap() // [!code ++]
	{ // [!code ++]
	} // [!code ++]
}
```

## Zone_User

[`public class Zone_User : Zone`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/253305202041a272665b98c5047f2b142df372c4/Elin/Zone_User.cs#L21-L26)
```cs:line-numbers=21

	public override bool RevealRoom => true;

	public override float OreChance => 0f; // [!code ++]
 // [!code ++]
	public override bool IsUnderwater => elements.Has(3606);

	public override void OnActivate()
```

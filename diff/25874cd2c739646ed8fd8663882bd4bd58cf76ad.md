---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 15 files modified. 1 new file created.
version: EA 23.194 Nightly
changes: AI_Sleep/ActWait/BuildMenu/Card/Chara/DramaManager/HotItemHeld/Recipe/SerializedCards/Trait/TraitBed/TraitDetector/TraitGeneMachine/TraitViewMap/WindowCharaMini/+Zone_EternalGarden
---

# EA 23.194 Nightly

September 5, 2025

15 files modified. 1 new file created.

## Important Changes

Possible breaking changes. Click the filename to view the chunk.
### [Card (1)](#card)
```cs:no-line-numbers
public void MakeRefFrom(string id) // [!code --]
public Card MakeRefFrom(string id) // [!code ++]
```
## AI_Sleep

[`public class AI_Sleep : AI_TargetThing`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/AI_Sleep.cs#L1-L6)
```cs:line-numbers=1
public class AI_Sleep : AI_TargetThing
{
	public override bool GotoTarget => true; // [!code --]
	public Chara lover; // [!code ++]
 // [!code ++]
	public override bool GotoTarget => lover == null; // [!code ++]

	public override void OnProgressComplete()
	{
```

[`public override void OnProgressComplete()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/AI_Sleep.cs#L9-L15)
```cs:line-numbers=9
		Msg.Say((EClass._zone.events.GetEvent<ZoneEventQuest>() != null) ? "badidea" : "notSleepy");
		return;
	}
	if (base.target != null && !owner.pos.Equals(base.target.pos)) // [!code --]
	if (lover != null && lover.ExistsOnMap && lover.Dist(owner) <= 1) // [!code ++]
	{ // [!code ++]
		owner.Say("sleep_beside", owner, lover); // [!code ++]
		owner.MoveImmediate(lover.pos, focus: false, cancelAI: false); // [!code ++]
	} // [!code ++]
	else if (base.target != null && !owner.pos.Equals(base.target.pos)) // [!code ++]
	{
		owner._Move(base.target.pos);
	}
```

## ActWait

[`public static bool SearchMedal(Chara c, Point p)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/ActWait.cs#L32-L37)
```cs:line-numbers=32
		if (thing.isHidden && thing.id == "medal" && !EClass._zone.IsUserZone)
		{
			thing.SetHidden(hide: false);
			thing.PlayAnime(AnimeID.Hop); // [!code ++]
			c.PlaySound("medal");
			Msg.Say("spotMedal", c, thing);
			return true;
```

[`public static void Search(Chara c, bool manual = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/ActWait.cs#L82-L87)
```cs:line-numbers=82
				thing.SetHidden(hide: false);
				if (thing.id == "medal")
				{
					thing.PlayAnime(AnimeID.Hop); // [!code ++]
					c.PlaySound("medal");
					Msg.Say("spotMedal", c, thing);
				}
```

## BuildMenu

[`private void _Search()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/BuildMenu.cs#L281-L287)
```cs:line-numbers=281
		}
		EMono.pc.things.Foreach(delegate(Thing t)
		{
			if (t.trait.CanBeDropped && !t.trait.CanOnlyCarry && (t.source.name.Contains(s) || t.source.name_JP.Contains(s) || t.NameOne.Contains(s))) // [!code --]
			if (t.trait.CanBeDropped && !t.trait.CanOnlyCarry && !t.isEquipped && (t.source.name.Contains(s) || t.source.name_JP.Contains(s) || t.NameOne.Contains(s))) // [!code ++]
			{
				Recipe recipe3 = Recipe.Create(t);
				if (recipe3 == null)
```

[`public void RefreshCategory(string cat)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/BuildMenu.cs#L603-L609)
```cs:line-numbers=603
				}
				EMono.pc.things.Foreach(delegate(Thing t)
				{
					if (!t.trait.CanOnlyCarry && t.trait.CanBeDropped && !t.c_isImportant) // [!code --]
					if (!t.trait.CanOnlyCarry && t.trait.CanBeDropped && !t.c_isImportant && !t.isEquipped) // [!code ++]
					{
						counts[t.trait.RecipeCat]++;
						if (t.trait.RecipeCat == cat && t.invY != 1)
```

## Card

[`public void DamageHP(int dmg, int ele, int eleP = 100, AttackSource attackSource`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/Card.cs#L4250-L4256)
```cs:line-numbers=4250
						flag3 = true;
						Chara.AddCondition<ConFractured>((int)Mathf.Max(10f, 30f - Mathf.Sqrt(Evalue(436))));
						hp = Mathf.Min(num13 * (int)Mathf.Sqrt(Evalue(436) * 2) / 100, MaxHP / 3);
						goto IL_0e7f; // [!code --]
						goto IL_0ed7; // [!code ++]
					}
				}
				if (zoneInstanceBout != null && (bool)LayerDrama.Instance)
```

[`public void DamageHP(int dmg, int ele, int eleP = 100, AttackSource attackSource`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/Card.cs#L4278-L4288)
```cs:line-numbers=4278
						if (EClass.player.invlunerable)
						{
							EvadeDeath();
							goto IL_0e7f; // [!code --]
							goto IL_0ed7; // [!code ++]
						}
					}
					if (IsPC && Evalue(1220) > 0 && Chara.stamina.value >= Chara.stamina.max / 2) // [!code --]
					if (Evalue(1220) > 0 && Chara.stamina.value >= (IsPC ? (Chara.stamina.max / 2) : (Chara.stamina.max / 3 * 2))) // [!code ++]
					{
						Say("fate", this); // [!code ++]
						PlaySound("revive"); // [!code ++]
						PlayEffect("aura_heaven"); // [!code ++]
						Chara.stamina.Mod(-Chara.stamina.max / 2);
						Chara.AddCondition<ConInvulnerable>();
						EvadeDeath();
```

[`public void DamageHP(int dmg, int ele, int eleP = 100, AttackSource attackSource`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/Card.cs#L4291-L4298)
```cs:line-numbers=4291
			}
		}
	}
	goto IL_0e7f; // [!code --]
	IL_0e7f: // [!code --]
	goto IL_0ed7; // [!code ++]
	IL_0ed7: // [!code ++]
	if (trait.CanBeAttacked)
	{
		renderer.PlayAnime(AnimeID.HitObj);
```

[`public void MakeFigureFrom(string id)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/Card.cs#L5500-L5508)
```cs:line-numbers=5500
		MakeRefFrom(id);
	}

	public void MakeRefFrom(string id) // [!code --]
	public Card MakeRefFrom(string id) // [!code ++]
	{
		c_idRefCard = id;
		return this; // [!code ++]
	}

	public void MakeRefFrom(Card c1, Card c2 = null)
```

## Chara

[`public void RestockInventory(bool onCreate)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/Chara.cs#L4810-L4815)
```cs:line-numbers=4810
{
	switch (id)
	{
	case "lomias": // [!code ++]
		if (ShouldRestock("_meat")) // [!code ++]
		{ // [!code ++]
			AddCard(ThingGen.Create("_meat").MakeRefFrom("begger")); // [!code ++]
		} // [!code ++]
		break; // [!code ++]
	case "fiama":
		Restock("book_story", 1);
		break;
```

[`public void RestockInventory(bool onCreate)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/Chara.cs#L4828-L4838)
```cs:line-numbers=4828
		}
		void Restock(string id, int num)
		{
			if (things.Find(id) == null) // [!code --]
			if (ShouldRestock(id)) // [!code ++]
			{
				AddCard(ThingGen.Create(id).SetNum(num));
			}
		}
		bool ShouldRestock(string id) // [!code ++]
		{ // [!code ++]
			return things.Find(id) == null; // [!code ++]
		} // [!code ++]
	}

	private void SetEQQuality()
```

[`public bool UseAbility(Act a, Card tc = null, Point pos = null, bool pt = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/Chara.cs#L5680-L5685)
```cs:line-numbers=5680
	{
		num3 = 1 + Evalue(1648);
	}
	Debug.Log(cost.cost + "/" + a.Value); // [!code ++]
	if (IsPC && cost.cost > 0 && a.Value == 0)
	{
		Msg.SayNothingHappen();
```

[`public override SubPassData GetSubPassData()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/Chara.cs#L6442-L6448)
```cs:line-numbers=6442
			return EClass.setting.pass.subDeadPCC;
		}
	}
	else if (conSleep != null && host == null && pos.Equals(EClass.pc.pos) && IsHuman && GetBool(123)) // [!code --]
	else if (conSleep != null && host == null && pos.Equals(EClass.pc.pos) && IsHuman && (GetBool(123) || affinity.CanSleepBeside())) // [!code ++]
	{
		return EClass.setting.pass.subDead;
	}
```

[`public void Cure(CureType type, int p = 100, BlessedState state = BlessedState.N`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/Chara.cs#L9152-L9158)
```cs:line-numbers=9152
			Condition condition = conditions[num];
			if (!(condition is ConAnorexia) || type == CureType.Death)
			{
				if (condition.Type == ConditionType.Bad || condition.Type == ConditionType.Debuff || condition.Type == ConditionType.Disease) // [!code --]
				ConditionType type2 = condition.Type; // [!code ++]
				if ((uint)(type2 - 2) <= 2u || type2 == ConditionType.Stance) // [!code ++]
				{
					condition.Kill();
				}
```

[`public void Cure(CureType type, int p = 100, BlessedState state = BlessedState.N`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/Chara.cs#L9182-L9187)
```cs:line-numbers=9182
		}
	}

	public void RemoveAllStances() // [!code ++]
	{ // [!code ++]
		for (int num = conditions.Count - 1; num >= 0; num--) // [!code ++]
		{ // [!code ++]
			Condition condition = conditions[num]; // [!code ++]
			if (condition.Type == ConditionType.Stance) // [!code ++]
			{ // [!code ++]
				condition.Kill(); // [!code ++]
			} // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public bool TryNeckHunt(Chara TC, int power, bool harvest = false)
	{
		if (TC == null || TC.HasCondition<ConInvulnerable>() || TC.Evalue(1421) > 0 || !TC.ExistsOnMap)
```

## DramaManager

[`public bool CheckIF(string IF)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/DramaManager.cs#L1048-L1053)
```cs:line-numbers=1048
	{
	case "survival":
		return EMono.game.IsSurvival;
	case "!survival": // [!code ++]
		return !EMono.game.IsSurvival; // [!code ++]
	case "fromBook":
		return LayerDrama.fromBook;
	case "!fromBook":
```

## HotItemHeld

[`public override bool TrySetAct(ActPlan p)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/HotItemHeld.cs#L181-L187)
```cs:line-numbers=181
	{
		if (p.IsSelf && thing.trait.CanUse(EClass.pc))
		{
			return p.TrySetAct(thing.trait.LangUse, () => thing.trait.OnUse(p.cc), thing, null, -1); // [!code --]
			return p.TrySetAct(thing.trait.LangUse, () => thing.trait.OnUse(p.cc), thing, null, -1, isHostileAct: false, thing.trait.IsLocalAct); // [!code ++]
		}
		if (EClass.scene.mouseTarget.target is Card && thing.trait.CanUse(EClass.pc, EClass.scene.mouseTarget.target as Card))
		{
```

## Recipe

[`public bool HasSameTile(Point point, int dir, int altitude, int bridgeHeight)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/Recipe.cs#L609-L615)
```cs:line-numbers=609
			return true;
		}
	}
	else if (IsBlock && point.matBlock == GetColorMaterial() && (point.sourceBlock == tileRow || (tileRow.tileType == point.sourceBlock.tileType && tileRow.tileType == TileType.Slope))) // [!code --]
	else if (IsBlock && point.matBlock == GetColorMaterial() && (point.sourceBlock == tileRow || (tileRow != null && tileRow.tileType == point.sourceBlock.tileType && tileRow.tileType == TileType.Slope))) // [!code ++]
	{
		if (point.sourceBlock.tileType.AltitudeAsDir && dir != point.cell.objDir)
		{
```

## SerializedCards

[`public int element`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/SerializedCards.cs#L261-L266)
```cs:line-numbers=261
			}
		}

		public int encLv // [!code ++]
		{ // [!code ++]
			get // [!code ++]
			{ // [!code ++]
				return ints[22]; // [!code ++]
			} // [!code ++]
			set // [!code ++]
			{ // [!code ++]
				ints[22] = value; // [!code ++]
			} // [!code ++]
		} // [!code ++]
 // [!code ++]
		public string id
		{
			get
```

[`public void Add(Card c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/SerializedCards.cs#L417-L423)
```cs:line-numbers=417
		refVal = c.refVal,
		idSkin = c.idSkin,
		idDeity = c.c_idDeity,
		isEmpty = (c.things.Count == 0 && c.c_lockLv == 0) // [!code --]
		isEmpty = (c.things.Count == 0 && c.c_lockLv == 0), // [!code ++]
		encLv = c.encLV // [!code ++]
	};
	if (c.c_idBacker != 0)
	{
```

[`public void Restore(Map map, Map orgMap, bool addToZone, PartialMap partial = nu`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/SerializedCards.cs#L759-L764)
```cs:line-numbers=759
					card2.c_lockLv = 1;
				}
			}
			if (card4.encLv != 0) // [!code ++]
			{ // [!code ++]
				card2.SetEncLv(card4.encLv); // [!code ++]
			} // [!code ++]
		}
		if (card2.isChara)
		{
```

## Trait

[`public virtual bool CanOpenContainer`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/Trait.cs#L257-L262)
```cs:line-numbers=257

	public virtual bool CanBeMasked => false;

	public virtual bool IsLocalAct => true; // [!code ++]
 // [!code ++]
	public virtual bool IsBlendBase => false;

	public virtual bool CanBeOnlyBuiltInHome => false;
```

## TraitBed

[`public int MaxHolders`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/TraitBed.cs#L21-L29)
```cs:line-numbers=21
public override void TrySetAct(ActPlan p)
{
	ValidateOwners();
	Chara chara = owner.pos.FirstChara; // [!code ++]
	if (chara != null && !chara.affinity.CanSleepBeside()) // [!code ++]
	{ // [!code ++]
		chara = null; // [!code ++]
	} // [!code ++]
	p.TrySetAct(new AI_Sleep
	{
		target = owner.Thing // [!code --]
		target = owner.Thing, // [!code ++]
		lover = chara // [!code ++]
	}, owner);
	p.TrySetAct(new AI_PassTime
	{
```

## TraitDetector

[`public void Search()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/TraitDetector.cs#L53-L63)
```cs:line-numbers=53
	int num = 999;
	foreach (Thing thing in EClass._map.things)
	{
		int num2 = EClass.pc.Dist(thing); // [!code --]
		if ((thing.id.ToLower().Contains(term.ToLower()) || thing.Name.ToLower().Contains(term.ToLower())) && num2 < num) // [!code --]
		if (!thing.isMasked) // [!code ++]
		{
			num = num2; // [!code --]
			card = thing; // [!code --]
			int num2 = EClass.pc.Dist(thing); // [!code ++]
			if ((thing.id.ToLower().Contains(term.ToLower()) || thing.Name.ToLower().Contains(term.ToLower())) && num2 < num) // [!code ++]
			{ // [!code ++]
				num = num2; // [!code ++]
				card = thing; // [!code ++]
			} // [!code ++]
		}
	}
	interval = 10;
```

[`public void Search()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/TraitDetector.cs#L74-L80)
```cs:line-numbers=74
			Msg.Say((LangGame.Has(text) ? text : "beep").lang());
			WidgetMainText.ignoreStack = false;
		}
		owner.PlayAnime(AnimeID.HitObj); // [!code --]
		owner.PlayAnime(AnimeID.Hop); // [!code ++]
	}

	public override void SetName(ref string s)
```

## TraitGeneMachine

[`public override bool OnUse(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/TraitGeneMachine.cs#L129-L134)
```cs:line-numbers=129
			condition.gene = null;
		}
		target.RemoveCondition<ConSuspend>();
		target.Cure(CureType.Death); // [!code ++]
		target.MoveNeighborDefinitely();
		target.PlaySound("ding_potential");
		target.pos.PlayEffect("mutation");
```

## TraitViewMap

[`using UnityEngine;`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/TraitViewMap.cs#L1-L9)
```cs:line-numbers=1
using UnityEngine; // [!code ++]
 // [!code ++]
public class TraitViewMap : TraitItem
{
	public override bool IsLocalAct => false; // [!code ++]
 // [!code ++]
	public override bool CanUseInUserZone => true;

	public override bool OnUse(Chara c)
	{
		Debug.Log("a"); // [!code ++]
		ActionMode.ViewMap.Activate();
		return false;
	}
```

## WindowCharaMini

[`public void Refresh(int idTab)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/25874cd2c739646ed8fd8663882bd4bd58cf76ad/Elin/WindowCharaMini.cs#L230-L235)
```cs:line-numbers=230
							SE.Trash();
							genes.Remove(chara, g);
							Refresh(idTab);
							chara.RemoveAllStances(); // [!code ++]
						});
					}
				});
```

## +Zone_EternalGarden

::: details File Created
```cs
public class Zone_EternalGarden : Zone_Civilized
{
}
```

:::
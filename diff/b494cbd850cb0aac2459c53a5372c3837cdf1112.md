---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 29 files modified. 4 new files created.
version: EA 23.68 Nightly
changes: AI_Shear/AI_Shopping/+AI_Slaughter/ActEffect/ActPlan/CINT/Card/CellDetail/Chara/CoreConfig/Dialog/DramaManager/DropdownGrid/FactionBranch/Game/GameDifficulty/+GameDifficultySetting/GameSetting/GoalCombat/ListPeopleRevive/Map/Props/Recipe/Scene/TaskClean/Trait/TraitBed/TraitSeed/+TraitToolButcher/+TraitWoodMill/UICharaMaker/WidgetStatsBar/Zone
---

# EA 23.68 Nightly

December 29, 2024

29 files modified. 4 new files created.

## Important Changes

Possible breaking changes. Click the filename to view the chunk.
### [FactionBranch (1)](#factionbranch)
```cs:no-line-numbers
public void BanishMember(Chara c, bool sell = false) // [!code --]
public void BanishMember(Chara c, bool skipMsg = false) // [!code ++]
```
## AI_Shear

[`@@ -24,7 +24,7 @@ public override bool Perform()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/AI_Shear.cs#L24-L30)
```cs:line-numbers=24
public override IEnumerable<Status> Run()
{
	yield return DoGoto(target);
	int furLv = Mathf.Clamp(target.c_fur / 10 + 1, 1, 5); // [!code --]
	int furLv = GetFurLv(target.Chara); // [!code ++]
	Progress_Custom seq = new Progress_Custom
	{
		canProgress = () => IsValidTC(target),
```

[`@@ -43,61 +43,73 @@ public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/AI_Shear.cs#L43-L103)
```cs:line-numbers=43
				target.renderer.PlayAnime(AnimeID.Shiver);
				if (owner.Dist(target) > 1)
				{
					EClass.pc.TryMoveTowards(target.pos); // [!code --]
					owner.TryMoveTowards(target.pos); // [!code ++]
					if (owner == null)
					{
						p.Cancel();
					}
					else if (owner.Dist(target) > 1)
					{
						EClass.pc.Say("targetTooFar"); // [!code --]
						owner.Say("targetTooFar"); // [!code ++]
						p.Cancel();
					}
				}
			},
			onProgressComplete = delegate
			{
				string text = "fiber"; // [!code --]
				string idMat = "wool"; // [!code --]
				string text2 = target.id; // [!code --]
				if (!(text2 == "putty_snow")) // [!code --]
				{ // [!code --]
					if (text2 == "putty_snow_gold") // [!code --]
					{ // [!code --]
						idMat = "gold"; // [!code --]
					} // [!code --]
					else if (!target.Chara.race.fur.IsEmpty()) // [!code --]
					{ // [!code --]
						string[] array = target.Chara.race.fur.Split('/'); // [!code --]
						text = array[0]; // [!code --]
						idMat = array[1]; // [!code --]
					} // [!code --]
				} // [!code --]
				else // [!code --]
				{ // [!code --]
					idMat = "cashmere"; // [!code --]
				} // [!code --]
				Thing thing = ThingGen.Create(text, idMat); // [!code --]
				int num = 100 * furLv + furLv * furLv * 10; // [!code --]
				int num2 = target.LV; // [!code --]
				if (target.Chara.IsInCombat || target.Chara.IsMinion) // [!code --]
				{ // [!code --]
					owner.Say("shear_penalty"); // [!code --]
					num /= 2; // [!code --]
					num2 /= 2; // [!code --]
				} // [!code --]
				int num3 = 20 + thing.material.tier * 20; // [!code --]
				thing.SetNum(Mathf.Max(num / num3, 1) + EClass.rnd(furLv + 1)); // [!code --]
				thing.SetEncLv(EClass.curve(num2, 30, 10) / 10); // [!code --]
				thing.elements.ModBase(2, EClass.curve(num2 / 10 * 10, 30, 10)); // [!code --]
				target.c_fur = -5; // [!code --]
				owner.Say("shear_end", owner, target, thing.Name); // [!code --]
				owner.Pick(thing, msg: false); // [!code --]
				Thing fur = GetFur(target.Chara); // [!code ++]
				owner.Say("shear_end", owner, target, fur.Name); // [!code ++]
				owner.Pick(fur, msg: false); // [!code ++]
				owner.elements.ModExp(237, 50 * furLv);
				EClass.pc.stamina.Mod(-1); // [!code --]
				owner.stamina.Mod(-1); // [!code ++]
				target.Chara.ModAffinity(owner, 1);
			}
		}.SetDuration((6 + furLv * 6) * 100 / (100 + owner.Tool.material.hardness * 2), 3);
		yield return Do(seq);
	}
 // [!code ++]
	public static int GetFurLv(Chara c) // [!code ++]
	{ // [!code ++]
		return Mathf.Clamp(c.c_fur / 10 + 1, 1, 5); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public static Thing GetFur(Chara c, int mod = 100) // [!code ++]
	{ // [!code ++]
		int furLv = GetFurLv(c); // [!code ++]
		string text = "fiber"; // [!code ++]
		string idMat = "wool"; // [!code ++]
		string text2 = c.id; // [!code ++]
		if (!(text2 == "putty_snow")) // [!code ++]
		{ // [!code ++]
			if (text2 == "putty_snow_gold") // [!code ++]
			{ // [!code ++]
				idMat = "gold"; // [!code ++]
			} // [!code ++]
			else if (!c.Chara.race.fur.IsEmpty()) // [!code ++]
			{ // [!code ++]
				string[] array = c.Chara.race.fur.Split('/'); // [!code ++]
				text = array[0]; // [!code ++]
				idMat = array[1]; // [!code ++]
			} // [!code ++]
		} // [!code ++]
		else // [!code ++]
		{ // [!code ++]
			idMat = "cashmere"; // [!code ++]
		} // [!code ++]
		Thing thing = ThingGen.Create(text, idMat); // [!code ++]
		int num = mod * furLv + furLv * furLv * 10; // [!code ++]
		int num2 = c.LV; // [!code ++]
		if (c.IsInCombat || c.IsMinion) // [!code ++]
		{ // [!code ++]
			Msg.Say("shear_penalty"); // [!code ++]
			num /= 2; // [!code ++]
			num2 /= 2; // [!code ++]
		} // [!code ++]
		int num3 = 20 + thing.material.tier * 20; // [!code ++]
		thing.SetNum(Mathf.Max(num / num3, 1) + EClass.rnd(furLv + 1)); // [!code ++]
		thing.SetEncLv(EClass.curve(num2, 30, 10) / 10); // [!code ++]
		thing.elements.ModBase(2, EClass.curve(num2 / 10 * 10, 30, 10)); // [!code ++]
		c.c_fur = -5; // [!code ++]
		return thing; // [!code ++]
	} // [!code ++]
}
```

## AI_Shopping

[`@@ -142,7 +142,7 @@ public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/AI_Shopping.cs#L142-L148)
```cs:line-numbers=142
	public static void SellChara(Chara c)
	{
		Msg.Say("sell_resident", c);
		c.homeBranch.BanishMember(c, sell: true); // [!code --]
		c.homeBranch.BanishMember(c, skipMsg: true); // [!code ++]
		EClass.player.ModKarma(-1);
	}

```

## +AI_Slaughter

::: details File Created
```cs
using System.Collections.Generic;
using UnityEngine;

public class AI_Slaughter : AI_TargetCard
{
	public static bool slaughtering;

	public override bool CanManualCancel()
	{
		return true;
	}

	public override string GetText(string str = "")
	{
		string[] list = Lang.GetList("fur");
		string text = list[Mathf.Clamp(target.c_fur / 10, 0, list.Length - 1)];
		return "AI_Shear".lang() + "(" + text + ")";
	}

	public override bool IsValidTC(Card c)
	{
		return c?.ExistsOnMap ?? false;
	}

	public override bool Perform()
	{
		target = Act.TC;
		return base.Perform();
	}

	public override IEnumerable<Status> Run()
	{
		yield return DoGoto(target);
		target.Chara.AddCondition<ConWait>(1000, force: true);
		Progress_Custom seq = new Progress_Custom
		{
			canProgress = () => IsValidTC(target),
			onProgressBegin = delegate
			{
				target.PlaySound("slaughter");
				target.SetCensored(enable: true);
				owner.Say("disassemble_start", owner, target);
			},
			onProgress = delegate(Progress_Custom p)
			{
				owner.LookAt(target);
				target.renderer.PlayAnime(AnimeID.Shiver);
				target.Chara.AddCondition<ConWait>(1000, force: true);
				if (owner.Dist(target) > 1)
				{
					owner.TryMoveTowards(target.pos);
					if (owner == null)
					{
						p.Cancel();
					}
					else if (owner.Dist(target) > 1)
					{
						owner.Say("targetTooFar");
						p.Cancel();
					}
				}
			},
			onProgressComplete = delegate
			{
				target.Chara.ModAffinity(owner, 1);
				target.SetCensored(enable: false);
				if (target.HaveFur())
				{
					Thing fur = AI_Shear.GetFur(target.Chara, 500);
					EClass._zone.AddCard(fur, target.pos);
				}
				slaughtering = true;
				target.Die();
				slaughtering = false;
				if (target.Chara.trait.IsUnique)
				{
					target.c_dateDeathLock = EClass.world.date.GetRaw() + 86400;
				}
				else
				{
					target.Chara.homeBranch.BanishMember(target.Chara, skipMsg: true);
				}
				owner.elements.ModExp(237, 250);
				owner.elements.ModExp(290, 100);
				EClass.pc.stamina.Mod(-3);
			}
		}.SetDuration(5000 / (100 + owner.Tool.material.hardness * 2), 3);
		yield return Do(seq);
	}

	public override void OnCancelOrSuccess()
	{
		if (target.ExistsOnMap)
		{
			target.Chara.RemoveCondition<ConWait>();
			target.SetCensored(enable: false);
		}
	}
}
```

:::
## ActEffect

[`@@ -1679,7 +1679,7 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/ActEffect.cs#L1679-L1685)
```cs:line-numbers=1679
		{
			if (TC.IsPC && list3.Count == 0)
			{
				list3 = EClass.game.cards.globalCharas.Where((KeyValuePair<int, Chara> a) => a.Value.isDead && a.Value.faction == EClass.pc.faction && !a.Value.isSummon).ToList(); // [!code --]
				list3 = EClass.game.cards.globalCharas.Where((KeyValuePair<int, Chara> a) => a.Value.CanRevive() && a.Value.isDead && a.Value.faction == EClass.pc.faction && !a.Value.isSummon).ToList(); // [!code ++]
			}
			if (list3.Count > 0)
			{
```

## ActPlan

[`@@ -515,7 +515,7 @@ public void _Update(PointTarget target)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/ActPlan.cs#L515-L521)
```cs:line-numbers=515
						}
						if (flag5 || altAction)
						{
							if (EClass.pc.HasElement(1216) && (c2.HasCondition<ConSleep>() || EClass.debug.enable)) // [!code --]
							if (EClass.pc.HasElement(1216) && c2.HasCondition<ConSleep>()) // [!code ++]
							{
								TrySetAct(new AI_Fuck
								{
```

## CINT

[`@@ -145,4 +145,6 @@ public class CINT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/CINT.cs#L145-L148)
```cs:line-numbers=145
	public const int isDisableStockUse = 122;

	public const int isSleepBeside = 123;
 // [!code ++]
	public const int dateDeathLock = 130; // [!code ++]
}
```

## Card

[`@@ -1153,6 +1153,18 @@ public int c_dateStockExpire`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Card.cs#L1153-L1158)
```cs:line-numbers=1153
		}
	}

	public int c_dateDeathLock // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			return GetInt(130); // [!code ++]
		} // [!code ++]
		set // [!code ++]
		{ // [!code ++]
			SetInt(130, value); // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public int c_IDTState
	{
		get
```

[`@@ -2693,7 +2705,7 @@ public void AddExp(int a)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Card.cs#L2693-L2699)
```cs:line-numbers=2693
		a *= 2;
		if (IsPCFaction)
		{
			a = a * Mathf.Clamp(100 + Chara.affinity.value / 10, 50, 100) / 100; // [!code --]
			a = a * Mathf.Clamp(100 + Chara.affinity.value / 10, 50, 200) / 100; // [!code ++]
		}
	}
	a = a * (100 + Evalue(1237) * 30) / 100;
```

[`@@ -3314,7 +3326,14 @@ public void SetPlaceState(PlaceState newState, bool byPlayer = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Card.cs#L3314-L3320)
```cs:line-numbers=3314
		{
			if (isThing)
			{
				pos.detail.MoveThingToTop(Thing); // [!code --]
				if (trait.InstallBottomPriority != -1) // [!code ++]
				{ // [!code ++]
					pos.detail.MoveThingToBottom(Thing); // [!code ++]
				} // [!code ++]
				else // [!code ++]
				{ // [!code ++]
					pos.detail.MoveThingToTop(Thing); // [!code ++]
				} // [!code ++]
			}
			area?.OnInstallCard(this);
			isRoofItem = false;
```

[`@@ -4381,10 +4400,16 @@ public void SpawnLoot(Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Card.cs#L4381-L4390)
```cs:line-numbers=4381
		}
	}
	bool flag2 = Chara.race.corpse[1].ToInt() > EClass.rnd(1500) || (Chara.IsPowerful && !IsPCFaction) || EClass.debug.godFood;
	int num = 1; // [!code ++]
	if (Chara.race.IsAnimal && EClass.rnd(EClass._zone.IsPCFaction ? 3 : 5) == 0)
	{
		flag2 = true;
	}
	if (AI_Slaughter.slaughtering) // [!code ++]
	{ // [!code ++]
		flag2 = true; // [!code ++]
		num = EClass.rndHalf(4 + 5 * Chara.race.food[0].ToInt() / 100); // [!code ++]
	} // [!code ++]
	if (origin != null && origin.HasElement(290))
	{
		if (!flag2 && Chara.race.corpse[1].ToInt() > EClass.rnd(150000 / (100 + (int)Mathf.Sqrt(origin.Evalue(290)) * 5)))
```

[`@@ -4404,7 +4429,7 @@ public void SpawnLoot(Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Card.cs#L4404-L4410)
```cs:line-numbers=4404
		{
			text = "meat_marble";
		}
		Thing thing3 = ThingGen.Create(text); // [!code --]
		Thing thing3 = ThingGen.Create(text).SetNum(num); // [!code ++]
		if (thing3.source._origin == "meat")
		{
			thing3.MakeFoodFrom(this);
```

[`@@ -4424,10 +4449,10 @@ public void SpawnLoot(Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Card.cs#L4424-L4433)
```cs:line-numbers=4424
		foreach (string item2 in sourceCard.loot.Concat(Chara.race.loot).ToList())
		{
			string[] array = item2.Split('/');
			int num = array[1].ToInt(); // [!code --]
			if (num >= 1000 || num > EClass.rnd(1000) || EClass.debug.godMode) // [!code --]
			int num2 = array[1].ToInt(); // [!code ++]
			if (num2 >= 1000 || num2 > EClass.rnd(1000) || EClass.debug.godMode) // [!code ++]
			{
				list.Add(ThingGen.Create(array[0]).SetNum((num < 1000) ? 1 : (num / 1000 + ((EClass.rnd(1000) > num % 1000) ? 1 : 0)))); // [!code --]
				list.Add(ThingGen.Create(array[0]).SetNum((num2 < 1000) ? 1 : (num2 / 1000 + ((EClass.rnd(1000) > num2 % 1000) ? 1 : 0)))); // [!code ++]
			}
		}
		if (race.IsMachine)
```

[`@@ -4465,19 +4490,19 @@ public void SpawnLoot(Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Card.cs#L4465-L4483)
```cs:line-numbers=4465
		}
		if (!isBackerContent && !flag)
		{
			int num2 = ((EClass._zone.Boss == this) ? 2 : ((this.rarity >= Rarity.Legendary) ? 1 : 0)); // [!code --]
			int num3 = ((EClass._zone.Boss == this) ? 2 : ((this.rarity >= Rarity.Legendary) ? 1 : 0)); // [!code ++]
			if (EClass._zone is Zone_Void)
			{
				num2++; // [!code --]
				num3++; // [!code ++]
			}
			if (EClass.rnd(5) == 0)
			{
				num2++; // [!code --]
				num3++; // [!code ++]
			}
			string text2 = id;
			if (text2 == "big_daddy" || text2 == "santa")
			{
				num2 += 2; // [!code --]
				num3 += 2; // [!code ++]
			}
			List<Thing> list2 = new List<Thing>();
			foreach (Thing thing4 in things)
```

[`@@ -4506,33 +4531,33 @@ public void SpawnLoot(Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Card.cs#L4506-L4538)
```cs:line-numbers=4506
					list.Add(thing4);
				}
			}
			if (num2 > 0 && list2.Count > 0) // [!code --]
			if (num3 > 0 && list2.Count > 0) // [!code ++]
			{
				list2.Shuffle();
				for (int j = 0; j < list2.Count && j < num2; j++) // [!code --]
				for (int j = 0; j < list2.Count && j < num3; j++) // [!code ++]
				{
					list.Add(list2[j]);
					num2--; // [!code --]
					num3--; // [!code ++]
				}
			}
			if (this.rarity >= Rarity.Legendary && !IsUnique && c_bossType != BossType.Evolved)
			{
				int num3 = 0; // [!code --]
				int num4 = 0; // [!code ++]
				foreach (Card item3 in list)
				{
					if (item3.rarity >= Rarity.Legendary || item3.IsContainer)
					{
						num3++; // [!code --]
						num4++; // [!code ++]
					}
				}
				if (num3 == 0) // [!code --]
				if (num4 == 0) // [!code ++]
				{
					int num4 = ((!(EClass._zone is Zone_Void)) ? 1 : 2); // [!code --]
					if (num2 < num4) // [!code --]
					int num5 = ((!(EClass._zone is Zone_Void)) ? 1 : 2); // [!code ++]
					if (num3 < num5) // [!code ++]
					{
						num2 = num4; // [!code --]
						num3 = num5; // [!code ++]
					}
					for (int k = 0; k < num2; k++) // [!code --]
					for (int k = 0; k < num3; k++) // [!code ++]
					{
						Rand.SetSeed(uid + k);
						if (EClass.rnd((EClass._zone.events.GetEvent<ZoneEventDefenseGame>() != null) ? 3 : 2) == 0)
```

## CellDetail

[`@@ -1,4 +1,5 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/CellDetail.cs#L1-L4)
```cs:line-numbers=1
using System.Collections.Generic;
using UnityEngine; // [!code ++]

public class CellDetail
{
```

[`@@ -48,9 +49,10 @@ public void MoveThingToBottom(Thing t)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/CellDetail.cs#L48-L56)
```cs:line-numbers=48
	{
		things.Remove(t);
		things.Insert(0, t);
		for (int i = 0; i < things.Count - 1 && things[i].IsInstalled; i++) // [!code --]
		for (int i = 0; i < things.Count && things[i].IsInstalled; i++) // [!code ++]
		{
			t.stackOrder = i; // [!code --]
			things[i].stackOrder = i; // [!code ++]
			Debug.Log(things[i].Name + "/" + things[i].stackOrder); // [!code ++]
		}
	}
}
```

[`@@ -60,7 +62,7 @@ public void MoveThingToTop(Thing t)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/CellDetail.cs#L60-L66)
```cs:line-numbers=60
	if (things.Count != 1)
	{
		int num = 0;
		for (int i = 0; i < things.Count - 1 && things[i].IsInstalled; i++) // [!code --]
		for (int i = 0; i < things.Count && things[i].IsInstalled; i++) // [!code ++]
		{
			num = i + 1;
		}
```

## Chara

[`@@ -864,7 +864,7 @@ public bool IsWealthy`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Chara.cs#L864-L870)
```cs:line-numbers=864

	public FactionBranch homeBranch => homeZone?.branch;

	public int MaxGeneSlot => race.geneCap; // [!code --]
	public int MaxGeneSlot => race.geneCap - (HasElement(1237) ? 2 : 0); // [!code ++]

	public int CurrentGeneSlot
	{
```

[`@@ -4467,6 +4467,11 @@ public void Drink(Card t)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Chara.cs#L4467-L4472)
```cs:line-numbers=4467
		_ = IsPC;
	}

	public bool CanRevive() // [!code ++]
	{ // [!code ++]
		return EClass.world.date.IsExpired(base.c_dateDeathLock); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void GetRevived()
	{
		Revive(EClass.pc.pos.GetNearestPoint(allowBlock: false, allowChara: false), msg: true);
```

[`@@ -4673,7 +4678,7 @@ public override void Die(Element e = null, Card origin = null, AttackSource atta`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Chara.cs#L4673-L4679)
```cs:line-numbers=4673
		{
			Effect.Get("blood").Play((parent is Chara) ? (parent as Chara).pos : pos).SetParticleColor(EClass.Colors.matColors[base.material.alias].main)
				.Emit(50);
			AddBlood(2 + EClass.rnd(2)); // [!code --]
			AddBlood(AI_Slaughter.slaughtering ? 12 : (2 + EClass.rnd(2))); // [!code ++]
			PlaySound(base.material.GetSoundDead(source));
		}
		renderer.RefreshSprite();
```

## CoreConfig

[`@@ -205,6 +205,10 @@ public class GameConfig`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/CoreConfig.cs#L205-L210)
```cs:line-numbers=205
		[NonSerialized]
		[JsonIgnore]
		public bool ignoreWarnDisassemble;
 // [!code ++]
		[NonSerialized] // [!code ++]
		[JsonIgnore] // [!code ++]
		public bool ignoreWarnSlaughter; // [!code ++]
	}

	[Serializable]
```

## Dialog

[`@@ -318,6 +318,9 @@ public static void TryWarn(string lang, Action action, bool yes = true)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Dialog.cs#L318-L323)
```cs:line-numbers=318
			case "warn_disassemble":
				ELayer.core.config.game.ignoreWarnDisassemble = true;
				break;
			case "warn_slaughter": // [!code ++]
				ELayer.core.config.game.ignoreWarnSlaughter = true; // [!code ++]
				break; // [!code ++]
			}
			d.Close();
			Commit();
```

[`@@ -355,6 +358,21 @@ void Commit()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Dialog.cs#L355-L360)
```cs:line-numbers=355
		}
	}

	public static void TryWarnSlaughter(Action action) // [!code ++]
	{ // [!code ++]
		if (ELayer.core.config.game.ignoreWarnSlaughter) // [!code ++]
		{ // [!code ++]
			warned = true; // [!code ++]
			action(); // [!code ++]
			warned = false; // [!code ++]
			ActPlan.warning = false; // [!code ++]
		} // [!code ++]
		else // [!code ++]
		{ // [!code ++]
			TryWarn("warn_slaughter", action); // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public static void TryWarnCrime(Action action)
	{
		if (!ELayer.core.config.game.warnCrime || ELayer.core.config.game.ignoreWarnCrime)
```

## DramaManager

[`@@ -1024,7 +1024,7 @@ public bool CheckIF(string IF)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/DramaManager.cs#L1024-L1030)
```cs:line-numbers=1024
		{
			foreach (Chara member in EMono.pc.homeBranch.members)
			{
				if (member.isDead && member.GetInt(100) != 0) // [!code --]
				if (member.isDead && member.CanRevive() && member.GetInt(100) != 0) // [!code ++]
				{
					return true;
				}
```

## DropdownGrid

[`@@ -115,7 +115,7 @@ public void BuildIngredients(Recipe _recipe, Image _icon, Action _onValueChange,`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/DropdownGrid.cs#L115-L121)
```cs:line-numbers=115
					if (uid != 0)
					{
						Thing thing = EMono.pc.things.Find((Thing t) => t.uid == uid) ?? EMono._map.Stocked.Find(uid);
						if (thing != null) // [!code --]
						if (thing != null && (!(thing.parent is Card card) || card.GetWindowSaveData() == null || !card.GetWindowSaveData().excludeCraft)) // [!code ++]
						{
							ingredient.SetThing(thing);
							flag = true;
```

## FactionBranch

[`@@ -406,15 +406,20 @@ public void OnSimulateHour(VirtualDate date)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/FactionBranch.cs#L406-L420)
```cs:line-numbers=406
	}
	foreach (Chara chara3 in EClass._map.charas)
	{
		if (chara3.memberType == FactionMemberType.Guest && ((chara3.c_allowance <= 0 && EClass.rnd(2) == 0) || chara3.GetInt(34) + 10080 < EClass.world.date.GetRaw())) // [!code --]
		if (chara3.memberType != FactionMemberType.Guest || ((chara3.c_allowance > 0 || EClass.rnd(2) != 0) && chara3.GetInt(34) + 10080 >= EClass.world.date.GetRaw())) // [!code ++]
		{
			if (!chara3.IsGlobal) // [!code --]
			{ // [!code --]
				chara3.Destroy(); // [!code --]
			} // [!code --]
			chara3.ClearBed(); // [!code --]
			break; // [!code --]
			continue; // [!code ++]
		} // [!code ++]
		foreach (Chara item in EClass._zone.ListMinions(chara3)) // [!code ++]
		{ // [!code ++]
			item.Destroy(); // [!code ++]
		} // [!code ++]
		if (!chara3.IsGlobal) // [!code ++]
		{ // [!code ++]
			chara3.Destroy(); // [!code ++]
		}
		chara3.ClearBed(); // [!code ++]
		break; // [!code ++]
	}
	if (date.hour == 5)
	{
```

[`@@ -437,11 +442,11 @@ public void OnSimulateHour(VirtualDate date)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/FactionBranch.cs#L437-L447)
```cs:line-numbers=437
	}
	if (!date.IsRealTime && date.hour % 8 == 0)
	{
		foreach (Chara item in EClass._map.charas.Where((Chara c) => c.memberType == FactionMemberType.Guest).ToList()) // [!code --]
		foreach (Chara item2 in EClass._map.charas.Where((Chara c) => c.memberType == FactionMemberType.Guest).ToList()) // [!code ++]
		{
			for (int j = 0; j < 3; j++)
			{
				AI_Shopping.TryShop(item, realtime: false); // [!code --]
				AI_Shopping.TryShop(item2, realtime: false); // [!code ++]
			}
		}
		AI_Shopping.TryRestock(EClass.pc, realtime: false);
```

[`@@ -823,7 +828,7 @@ void GetOutcome(Hobby h)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/FactionBranch.cs#L823-L829)
```cs:line-numbers=823
				{
					if (!member2.IsPCParty)
					{
						if (member2.isDead && EClass.rnd(num3) > EClass.rnd(100)) // [!code --]
						if (member2.isDead && member2.CanRevive() && EClass.rnd(num3) > EClass.rnd(100)) // [!code ++]
						{
							Log("bNurse", i, member2);
							member2.Revive(member2.pos, msg: true);
```

[`@@ -1366,10 +1371,10 @@ public void ChangeMemberType(Chara c, FactionMemberType type)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/FactionBranch.cs#L1366-L1375)
```cs:line-numbers=1366
		policies.Validate();
	}

	public void BanishMember(Chara c, bool sell = false) // [!code --]
	public void BanishMember(Chara c, bool skipMsg = false) // [!code ++]
	{
		RemoveMemeber(c);
		if (!sell) // [!code --]
		if (!skipMsg) // [!code ++]
		{
			Msg.Say("banish", c, EClass._zone.Name);
		}
```

## Game

[`@@ -253,7 +253,7 @@ private void _OnDeserialized(StreamingContext context)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Game.cs#L253-L259)
```cs:line-numbers=253

	public Prologue Prologue => EClass.setting.start.prologues[idPrologue];

	public GameDifficulty Difficulty => EClass.setting.start.difficulties[idDifficulty]; // [!code --]
	public GameDifficultySetting Difficulty => EClass.setting.start.difficulties[idDifficulty]; // [!code ++]

	public bool UseGrid => EClass.core.config.game.useGrid;

```

## GameDifficulty

[`@@ -1,17 +1,41 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/GameDifficulty.cs#L1-L17)
```cs:line-numbers=1
using System; // [!code --]
using Newtonsoft.Json; // [!code ++]

[Serializable] // [!code --]
public class GameDifficulty : EClass
{
	public int tier; // [!code --]
	[JsonProperty] // [!code ++]
	public int socre; // [!code ++]

	public bool allowManualSave; // [!code --]
	[JsonProperty] // [!code ++]
	public int minScore; // [!code ++]

	public bool allowRevive; // [!code --]
	[JsonProperty] // [!code ++]
	public int bonusLoot; // [!code ++]

	public bool deleteGameOnDeath; // [!code --]
	[JsonProperty] // [!code ++]
	public bool deathPenalty; // [!code ++]

	public int ID => EClass.setting.start.difficulties.IndexOf(this); // [!code --]
	[JsonProperty] // [!code ++]
	public bool economy; // [!code ++]

	public string Name => Lang.GetList("difficulties")[ID]; // [!code --]
	[JsonProperty] // [!code ++]
	public bool manualSave; // [!code ++]
 // [!code ++]
	[JsonProperty] // [!code ++]
	public bool ironMode; // [!code ++]
 // [!code ++]
	[JsonProperty] // [!code ++]
	public bool moreFood; // [!code ++]
 // [!code ++]
	[JsonProperty] // [!code ++]
	public bool moreReward; // [!code ++]
 // [!code ++]
	public int GetGrade(int v) // [!code ++]
	{ // [!code ++]
		return 0; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public int CalculateScore() // [!code ++]
	{ // [!code ++]
		return 0; // [!code ++]
	} // [!code ++]
}
```

## +GameDifficultySetting

::: details File Created
```cs
using System;

[Serializable]
public class GameDifficultySetting : EClass
{
	public int tier;

	public bool allowManualSave;

	public bool allowRevive;

	public bool deleteGameOnDeath;

	public int ID => EClass.setting.start.difficulties.IndexOf(this);

	public string Name => Lang.GetList("difficulties")[ID];
}
```

:::
## GameSetting

[`@@ -239,7 +239,7 @@ public class StartSetting`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/GameSetting.cs#L239-L245)
```cs:line-numbers=239
	{
		public List<Prologue> prologues;

		public List<GameDifficulty> difficulties; // [!code --]
		public List<GameDifficultySetting> difficulties; // [!code ++]
	}

	[Serializable]
```

## GoalCombat

[`@@ -834,7 +834,6 @@ int HealFactor(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/GoalCombat.cs#L834-L840)
```cs:line-numbers=834
			continue;
		}
		Chara chara = owner;
		Debug.Log(ability2.act.Name + ":" + ability2.act.CanPerform(owner, ability2.tg ?? tc)); // [!code --]
		if (ability2.act.CanPerform(owner, ability2.tg ?? tc) && owner.UseAbility(ability2.act, ability2.tg ?? tc, null, (ability2.act.HaveLongPressAction && ability2.pt) || ability2.aiPt))
		{
			if (EClass.debug.logCombat)
```

## ListPeopleRevive

[`@@ -26,7 +26,7 @@ public override void OnClick(Chara c, ItemGeneral i)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/ListPeopleRevive.cs#L26-L32)
```cs:line-numbers=26

	public override void OnList()
	{
		foreach (KeyValuePair<int, Chara> item in EClass.game.cards.globalCharas.Where((KeyValuePair<int, Chara> a) => a.Value.isDead && a.Value.faction == EClass.pc.faction && !a.Value.isSummon)) // [!code --]
		foreach (KeyValuePair<int, Chara> item in EClass.game.cards.globalCharas.Where((KeyValuePair<int, Chara> a) => a.Value.CanRevive() && a.Value.isDead && a.Value.faction == EClass.pc.faction && !a.Value.isSummon)) // [!code ++]
		{
			list.Add(item.Value);
		}
```

## Map

[`@@ -2002,7 +2002,7 @@ public void AddDecal(int x, int z, int id, int amount = 1, bool refresh = true)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Map.cs#L2002-L2008)
```cs:line-numbers=2002

	public void SetDecal(int x, int z, int id = 0, int amount = 1, bool refresh = true)
	{
		cells[x, z].decal = (byte)(id * 8 + ((id != 0) ? amount : 0)); // [!code --]
		cells[x, z].decal = (byte)((id != 0 && amount != 0) ? ((uint)(id * 8 + amount)) : 0u); // [!code ++]
		if (refresh)
		{
			RefreshNeighborTiles(x, z);
```

## Props

[`@@ -214,6 +214,7 @@ public ThingStack ListThingStack(Recipe.Ingredient ing, StockSearchMode searchMo`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Props.cs#L214-L219)
```cs:line-numbers=214
		{
			FindCat(item);
		}
		stack.list.Sort((Thing a, Thing b) => b.Num - a.Num); // [!code ++]
		return stack;
	}
	Find(id2);
```

[`@@ -221,6 +222,7 @@ public ThingStack ListThingStack(Recipe.Ingredient ing, StockSearchMode searchMo`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Props.cs#L221-L226)
```cs:line-numbers=221
	{
		Find(item2);
	}
	stack.list.Sort((Thing a, Thing b) => b.Num - a.Num); // [!code ++]
	return stack;
	void Find(string id)
	{
```

## Recipe

[`@@ -857,9 +857,13 @@ public bool IsCraftable()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Recipe.cs#L857-L865)
```cs:line-numbers=857
{
	foreach (Ingredient ingredient in ingredients)
	{
		if (!ingredient.optional && EClass._map.Stocked.ListThingStack(ingredient, StockSearchMode.AroundPC).max < ingredient.req) // [!code --]
		if (!ingredient.optional) // [!code ++]
		{
			return false; // [!code --]
			ThingStack thingStack = EClass._map.Stocked.ListThingStack(ingredient, StockSearchMode.AroundPC); // [!code ++]
			if (thingStack.list.Count == 0 || thingStack.list[0].Num < ingredient.req) // [!code ++]
			{ // [!code ++]
				return false; // [!code ++]
			} // [!code ++]
		}
	}
	return true;
```

## Scene

[`@@ -217,7 +217,7 @@ public void Init(Mode newMode)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Scene.cs#L217-L223)
```cs:line-numbers=217
			Zone zone = (EMono.pc.currentZone = EMono.pc.homeZone);
			obj.zone = zone;
		}
		EMono.core.config.game.ignoreWarnCrime = (EMono.core.config.game.ignoreWarnMana = (EMono.core.config.game.ignoreWarnDisassemble = false)); // [!code --]
		EMono.core.config.game.ignoreWarnCrime = (EMono.core.config.game.ignoreWarnMana = (EMono.core.config.game.ignoreWarnDisassemble = (EMono.core.config.game.ignoreWarnSlaughter = false))); // [!code ++]
		EMono.game.updater.Reset();
		CellDetail.count = 0;
		skipAnime = true;
```

## TaskClean

[`@@ -46,29 +46,25 @@ public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/TaskClean.cs#L46-L74)
```cs:line-numbers=46
			{
				yield return Success();
			}
			bool fail = false; // [!code --]
			yield return DoGoto(dest, 0, ignoreConnection: false, delegate // [!code --]
			yield return DoGoto(dest, 1); // [!code ++]
			for (int i = 0; i < ((!dest.cell.HasLiquid) ? 1 : 5); i++) // [!code ++]
			{
				fail = true; // [!code --]
				return Status.Running; // [!code --]
			}); // [!code --]
			yield return KeepRunning(); // [!code --]
			if (!fail && CanClean(dest)) // [!code --]
			{ // [!code --]
				if (owner.Dist(dest) > 1) // [!code --]
				{ // [!code --]
					yield return Cancel(); // [!code --]
				} // [!code --]
				Point point = dest; // [!code --]
				EClass._map.SetDecal(point.x, point.z); // [!code --]
				EClass._map.SetLiquid(point.x, point.z, 0, 0); // [!code --]
				point.PlayEffect("vanish"); // [!code --]
				EClass.pc.Say("clean", owner); // [!code --]
				EClass.pc.PlaySound("clean_floor"); // [!code --]
				EClass.pc.stamina.Mod(-1); // [!code --]
				EClass.pc.ModExp(293, 30); // [!code --]
				owner.LookAt(dest); // [!code ++]
				owner.renderer.NextFrame(); // [!code ++]
				yield return KeepRunning();
			}
			if (!CanClean(dest) || owner.Dist(dest) > 1) // [!code ++]
			{ // [!code ++]
				yield return Cancel(); // [!code ++]
			} // [!code ++]
			EClass._map.SetDecal(dest.x, dest.z); // [!code ++]
			EClass._map.SetLiquid(dest.x, dest.z, 0, 0); // [!code ++]
			dest.PlayEffect("vanish"); // [!code ++]
			EClass.pc.Say("clean", owner); // [!code ++]
			EClass.pc.PlaySound("clean_floor"); // [!code ++]
			EClass.pc.stamina.Mod(-1); // [!code ++]
			EClass.pc.ModExp(293, 30); // [!code ++]
			yield return KeepRunning(); // [!code ++]
		}
	}

```

## Trait

[`@@ -81,6 +81,8 @@ public virtual bool ShouldRefreshTile`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Trait.cs#L81-L86)
```cs:line-numbers=81

	public virtual bool ShouldTryRefreshRoom => IsDoor;

	public virtual int InstallBottomPriority => -1; // [!code ++]
 // [!code ++]
	public virtual bool CanHarvest => true;

	public virtual int radius => 0;
```

[`@@ -1115,7 +1117,14 @@ public virtual void Toggle(bool on, bool silent = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Trait.cs#L1115-L1121)
```cs:line-numbers=1115
			}
		}
		owner.isOn = on;
		PlayToggleEffect(silent); // [!code ++]
		OnToggle(); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public virtual void PlayToggleEffect(bool silent) // [!code ++]
	{ // [!code ++]
		bool flag = ToggleType == ToggleType.Fire;
		bool isOn = owner.isOn; // [!code ++]
		switch (ToggleType)
		{
		case ToggleType.Lever:
```

[`@@ -1124,49 +1133,46 @@ public virtual void Toggle(bool on, bool silent = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Trait.cs#L1124-L1172)
```cs:line-numbers=1124
				owner.Say("lever", EClass.pc, owner);
				owner.PlaySound("switch_lever");
			}
			break; // [!code --]
			return; // [!code ++]
		case ToggleType.Curtain:
			if (!silent)
			{
				owner.Say(on ? "close" : "open", EClass.pc, owner); // [!code --]
				owner.Say(isOn ? "close" : "open", EClass.pc, owner); // [!code ++]
				owner.PlaySound("Material/leather_drop");
			}
			owner.pos.RefreshNeighborTiles();
			EClass.pc.RecalculateFOV();
			break; // [!code --]
		default: // [!code --]
			if (on) // [!code --]
			{ // [!code --]
				if (!silent) // [!code --]
				{ // [!code --]
					owner.Say(flag ? "toggle_fire" : "toggle_ele", EClass.pc, owner); // [!code --]
					string id = ((Electricity < 0) ? "switch_on_electricity" : (flag ? "torch_lit" : "switch_on")); // [!code --]
					if (this is TraitMusicBox) // [!code --]
					{ // [!code --]
						id = "switch_on_musicbox"; // [!code --]
					} // [!code --]
					owner.PlaySound(id); // [!code --]
				} // [!code --]
				RefreshRenderer(); // [!code --]
				owner.RecalculateFOV(); // [!code --]
				break; // [!code --]
			} // [!code --]
			return; // [!code ++]
		case ToggleType.None: // [!code ++]
			return; // [!code ++]
		} // [!code ++]
		if (isOn) // [!code ++]
		{ // [!code ++]
			if (!silent)
			{
				string id2 = ((Electricity < 0) ? "switch_off_electricity" : (flag ? "torch_unlit" : "switch_off")); // [!code --]
				owner.Say(flag ? "toggle_fire" : "toggle_ele", EClass.pc, owner); // [!code ++]
				string id = ((Electricity < 0) ? "switch_on_electricity" : (flag ? "torch_lit" : "switch_on")); // [!code ++]
				if (this is TraitMusicBox)
				{
					id2 = "switch_off_musicbox"; // [!code --]
					id = "switch_on_musicbox"; // [!code ++]
				}
				owner.PlaySound(id2); // [!code --]
				owner.PlaySound(id); // [!code ++]
			}
			RefreshRenderer();
			owner.RecalculateFOV();
			break; // [!code --]
		case ToggleType.None: // [!code --]
			break; // [!code --]
			return; // [!code ++]
		}
		OnToggle(); // [!code --]
		if (!silent) // [!code ++]
		{ // [!code ++]
			string id2 = ((Electricity < 0) ? "switch_off_electricity" : (flag ? "torch_unlit" : "switch_off")); // [!code ++]
			if (this is TraitMusicBox) // [!code ++]
			{ // [!code ++]
				id2 = "switch_off_musicbox"; // [!code ++]
			} // [!code ++]
			owner.PlaySound(id2); // [!code ++]
		} // [!code ++]
		RefreshRenderer(); // [!code ++]
		owner.RecalculateFOV(); // [!code ++]
	}

	public virtual void OnToggle()
```

[`@@ -1907,7 +1913,7 @@ public void OnBarter()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Trait.cs#L1907-L1913)
```cs:line-numbers=1907
				{
					thing9.isStolen = true;
				}
				if (CurrencyType == CurrencyType.Money || !thing9.IsUnique) // [!code --]
				if (!(thing9.trait is TraitErohon)) // [!code ++]
				{
					thing9.c_IDTState = 0;
				}
```

## TraitBed

[`@@ -91,7 +91,7 @@ public void ValidateOwners()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/TraitBed.cs#L91-L97)
```cs:line-numbers=91
	data.list.ForeachReverse(delegate(int i)
	{
		Chara chara = EClass._map.FindChara(i) ?? EClass.game.cards.globalCharas.Find(i);
		if (chara == null || (chara.IsPCFaction && chara.homeBranch != EClass._zone.branch)) // [!code --]
		if (chara == null || (chara.IsPCFaction && !chara.IsPCParty && chara.homeBranch != EClass._zone.branch)) // [!code ++]
		{
			data.list.Remove(i);
		}
```

## TraitSeed

[`@@ -8,6 +8,8 @@ public class TraitSeed : Trait`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/TraitSeed.cs#L8-L13)
```cs:line-numbers=8

	public SourceObj.Row row => EClass.sources.objs.map[owner.refVal];

	public override int InstallBottomPriority => 10000; // [!code ++]
 // [!code ++]
	public override bool CanExtendBuild => true;

	public override bool CanChangeHeight => false;
```

## +TraitToolButcher

::: details File Created
```cs
public class TraitToolButcher : TraitTool
{
	public override bool DisableAutoCombat => true;

	public override void TrySetHeldAct(ActPlan p)
	{
		foreach (Chara chara in p.pos.Charas)
		{
			if (chara.IsPCParty || !chara.IsPCFaction)
			{
				continue;
			}
			Chara _c = chara;
			p.TrySetAct("AI_Slaughter", delegate
			{
				Dialog.TryWarnSlaughter(delegate
				{
					EClass.pc.SetAIImmediate(new AI_Slaughter
					{
						target = _c
					});
				});
				return false;
			}, chara);
		}
	}
}
```

:::
## +TraitWoodMill

::: details File Created
```cs
public class TraitWoodMill : TraitCrafter
{
	public override string IdSource => "WoodMill";

	public override int numIng => 2;

	public override string CrafterTitle => "invWoodMill";

	public override AnimeID IdAnimeProgress => AnimeID.Shiver;

	public override string idSoundProgress => "cook_pound";

	public override ToggleType ToggleType => ToggleType.Custom;

	public override AnimeType animeType => AnimeType.Microwave;

	public override bool AutoTurnOff => true;

	public override bool AutoToggle => false;

	public override void PlayToggleEffect(bool silent)
	{
	}
}
```

:::
## UICharaMaker

[`@@ -215,12 +215,12 @@ public void ListDifficulties()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/UICharaMaker.cs#L215-L226)
```cs:line-numbers=215
	TooltipManager.Instance.disableHide = "note";
	bool first = true;
	EMono.ui.AddLayer<LayerList>().SetPivot(0.5f, 0.2f).SetSize(260f)
		.SetList2(EMono.setting.start.difficulties, (GameDifficulty a) => a.Name, delegate(GameDifficulty a, ItemGeneral b) // [!code --]
		.SetList2(EMono.setting.start.difficulties, (GameDifficultySetting a) => a.Name, delegate(GameDifficultySetting a, ItemGeneral b) // [!code ++]
		{
			EMono.game.idDifficulty = a.ID;
			textDifficulty.SetText(listDifficulties[EMono.game.idDifficulty]);
			Refresh();
		}, delegate(GameDifficulty a, ItemGeneral item) // [!code --]
		}, delegate(GameDifficultySetting a, ItemGeneral item) // [!code ++]
		{
			UIButton b2 = item.button1;
			b2.SetTooltip(delegate(UITooltip t)
```

## WidgetStatsBar

[`@@ -273,17 +273,14 @@ public void Refresh()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/WidgetStatsBar.cs#L273-L289)
```cs:line-numbers=273
			{
				text2 = text2 + " (" + ele.ValueWithoutLink + ")";
			}
			if (ele.DisplayValue < ele.ValueWithoutLink) // [!code --]
			int num = ((EMono.pc.tempElements != null) ? EMono.pc.tempElements.Value(ele.id) : 0); // [!code ++]
			if (ele.DisplayValue < ele.ValueWithoutLink || num < 0) // [!code ++]
			{
				fontColor = FontColor.Bad;
			}
			else if (EMono.pc.tempElements != null) // [!code --]
			else if (num > 0) // [!code ++]
			{
				Element element = EMono.pc.tempElements.GetElement(ele.id); // [!code --]
				if (element != null && element.vBase > 0) // [!code --]
				{ // [!code --]
					fontColor = FontColor.Good; // [!code --]
				} // [!code --]
				fontColor = FontColor.Good; // [!code ++]
			}
		}
		if (text2 != text || item.lastColor != fontColor)
```

## Zone

[`@@ -111,7 +111,7 @@ public override int DangerLv`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Zone.cs#L111-L117)
```cs:line-numbers=111
			{
				return GetTopZone().DangerLv + Mathf.Abs(base.lv) - 1;
			}
			return (int)Mathf.Max(1f, (float)base._dangerLv + MathF.Abs(base.lv) + (float)DangerLvFix); // [!code --]
			return (int)Mathf.Max(1f, (branch != null) ? ((float)branch.DangerLV) : ((float)base._dangerLv + MathF.Abs(base.lv) + (float)DangerLvFix)); // [!code ++]
		}
	}

```

[`@@ -1024,7 +1024,7 @@ public void Revive()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Zone.cs#L1024-L1030)
```cs:line-numbers=1024
	{
		foreach (Chara deadChara in map.deadCharas)
		{
			if (deadChara.trait.CanAutoRevive) // [!code --]
			if (deadChara.trait.CanAutoRevive && deadChara.CanRevive()) // [!code ++]
			{
				deadChara.Revive();
				if (deadChara.isBackerContent && EClass.player.doneBackers.Contains(deadChara.c_idBacker) && !EClass.core.config.test.ignoreBackerDestoryFlag)
```

[`@@ -1037,7 +1037,7 @@ public void Revive()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Zone.cs#L1037-L1043)
```cs:line-numbers=1037
	}
	foreach (Chara value in EClass.game.cards.globalCharas.Values)
	{
		if (value.isDead && value.homeZone == this) // [!code --]
		if (value.isDead && value.CanRevive() && value.homeZone == this) // [!code ++]
		{
			value.Revive();
			Point point = GetSpawnPos(value);
```

[`@@ -2021,7 +2021,7 @@ Thing SearchDest()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Zone.cs#L2021-L2027)
```cs:line-numbers=2021
			{
				thing = EClass.game.cards.container_shipping;
			}
			if (!sharedOnly || thing.IsSharedContainer) // [!code --]
			if ((!sharedOnly || thing.IsSharedContainer) && thing.c_lockLv <= 0) // [!code ++]
			{
				if (add)
				{
```

[`@@ -3348,6 +3348,19 @@ public void UpdateQuests(bool force = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/b494cbd850cb0aac2459c53a5372c3837cdf1112/Elin/Zone.cs#L3348-L3353)
```cs:line-numbers=3348
		}
	}

	public List<Chara> ListMinions(Chara c) // [!code ++]
	{ // [!code ++]
		List<Chara> list = new List<Chara>(); // [!code ++]
		foreach (Chara chara in EClass._map.charas) // [!code ++]
		{ // [!code ++]
			if (chara.c_uidMaster == c.uid && chara.c_minionType == MinionType.Default) // [!code ++]
			{ // [!code ++]
				list.Add(chara); // [!code ++]
			} // [!code ++]
		} // [!code ++]
		return list; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public int CountMinions(Chara c)
	{
		int num = 0;
```

---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 37 files modified. 4 new files created.
version: EA 23.76 Nightly
changes: AI_Clean/ActPlan/BaseTileSelector/CardActor/CardRenderer/CellDetail/Chara/ConInvisibility/CoreDebug/Game/+GameContractResolver/GameDate/GameIO/GameIndex/GameSerializationBinder/GameUpdater/GoalCombat/GuildFighter/InvOwner/LayerHome/LayerShippingResult/Map/ModManager/ModUtil/Player/PropSet/Props/Scene/ShippingResult/Thing/ThingContainer/TileType/TraitDrinkMilkMother/TraitFoodEggFertilized/+TraitLightAlwaysAnime/+TraitMannequin/TraitRadio/WidgetMemo/WidgetSearch/ZoneEvent/+Zone_Exile
---

# EA 23.76 Nightly

January 14, 2025

37 files modified. 4 new files created.

## Important Changes

Possible breaking changes. Click the filename to view the chunk.
### [Player (1)](#player)
```cs:no-line-numbers
public int GetShippingBonus(int _a) // [!code --]
public int GetShippingBonus(long _a) // [!code ++]
```
### [PropSet (3)](#propset)
```cs:no-line-numbers
public void Add(Card c) // [!code --]
public new void Add(Card c) // [!code ++]
```
```cs:no-line-numbers
public void Remove(Card c) // [!code --]
public new void Remove(Card c) // [!code ++]
```
```cs:no-line-numbers
public bool Contains(Card c) // [!code --]

```
## AI_Clean

[`@@ -25,7 +25,7 @@ public static Point GetCleanPoint(Chara c, int r = -1, int tries = 10)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/AI_Clean.cs#L25-L31)
```cs:line-numbers=25
			{
				continue;
			}
			if (point.HasDirt || point.cell.HasLiquid) // [!code --]
			if ((point.HasDirt && !EClass._map.config.retainDecal) || point.cell.HasLiquid) // [!code ++]
			{
				return point;
			}
```

## ActPlan

[`@@ -740,6 +740,20 @@ public void _Update(PointTarget target)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/ActPlan.cs#L740-L745)
```cs:line-numbers=740
									return true;
								}, t);
							}
							if (t.trait.CanName) // [!code ++]
							{ // [!code ++]
								TrySetAct("changeName", delegate // [!code ++]
								{ // [!code ++]
									Dialog.InputName("dialogChangeName", t.c_refText.IsEmpty(""), delegate(bool cancel, string text) // [!code ++]
									{ // [!code ++]
										if (!cancel) // [!code ++]
										{ // [!code ++]
											t.c_refText = text; // [!code ++]
										} // [!code ++]
									}); // [!code ++]
									return false; // [!code ++]
								}, t); // [!code ++]
							} // [!code ++]
						}
					}
					if (isKey)
```

## BaseTileSelector

[`@@ -168,7 +168,7 @@ public void OnUpdate()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/BaseTileSelector.cs#L168-L174)
```cs:line-numbers=168
		}
		EMono.ui.hud.hint.UpdateText();
	}
	if (!hitPoint.IsValid || EMono.ui.isPointerOverUI || EMono.ui.wasActive || mode.selectType == SelectType.None || !EMono.pc.ai.ShowCursor) // [!code --]
	if (!hitPoint.IsValid || EMono.ui.isPointerOverUI || EMono.ui.wasActive || mode.selectType == SelectType.None || !EMono.pc.ai.ShowCursor || (UIDragPanel.dragging && Input.GetMouseButton(0))) // [!code ++]
	{
		return;
	}
```

## CardActor

[`@@ -226,7 +226,11 @@ public virtual void RefreshSprite()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/CardActor.cs#L226-L232)
```cs:line-numbers=226
	switch (type)
	{
	case Type.Canvas:
		if (owner != null && owner.c_textureData != null && (bool)sr2) // [!code --]
		if (owner == null || !sr2) // [!code ++]
		{ // [!code ++]
			break; // [!code ++]
		} // [!code ++]
		if (owner.c_textureData != null) // [!code ++]
		{
			sr2.sprite = owner.GetPaintSprite();
			if (owner.trait is TraitCanvas traitCanvas)
```

[`@@ -234,6 +238,10 @@ public virtual void RefreshSprite()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/CardActor.cs#L234-L239)
```cs:line-numbers=234
				sr2.transform.SetLocalScale(traitCanvas.Scale, traitCanvas.Scale, 1f);
			}
		}
		else // [!code ++]
		{ // [!code ++]
			sr2.sprite = null; // [!code ++]
		} // [!code ++]
		break;
	case Type.Boat:
		sr2.SetActive(owner.Cell.IsFloorWater);
```

## CardRenderer

[`@@ -359,8 +359,16 @@ public SourcePref GetPref()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/CardRenderer.cs#L359-L366)
```cs:line-numbers=359
		switch (owner.sourceCard.tiles.TryGet(owner.idSkin))
		{
		case 2319:
		case 2619: // [!code ++]
		case 2621: // [!code ++]
		case 2623: // [!code ++]
		case 2625: // [!code ++]
			return EClass.core.refs.prefs.sonwputit1;
		case 2320:
		case 2620: // [!code ++]
		case 2622: // [!code ++]
		case 2624: // [!code ++]
		case 2626: // [!code ++]
			return EClass.core.refs.prefs.snowputit2;
		}
	}
```

[`@@ -455,10 +463,6 @@ public void RemoveExtra(string id)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/CardRenderer.cs#L455-L464)
```cs:line-numbers=455

	public override void OnLeaveScreen()
	{
		if (!isSynced) // [!code --]
		{ // [!code --]
			Debug.LogWarning("renderer alraedy not synced:" + owner); // [!code --]
		} // [!code --]
		isSynced = false;
		if (hasActor && (!owner.ExistsOnMap || !data.persistActor))
		{
```

## CellDetail

[`@@ -1,5 +1,4 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/CellDetail.cs#L1-L5)
```cs:line-numbers=1
using System.Collections.Generic;
using UnityEngine; // [!code --]

public class CellDetail
{
```

[`@@ -52,7 +51,6 @@ public void MoveThingToBottom(Thing t)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/CellDetail.cs#L52-L58)
```cs:line-numbers=52
		for (int i = 0; i < things.Count && things[i].IsInstalled; i++)
		{
			things[i].stackOrder = i;
			Debug.Log(things[i].Name + "/" + things[i].stackOrder); // [!code --]
		}
	}
}
```

## Chara

[`@@ -3407,7 +3407,7 @@ public void TickConditions()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Chara.cs#L3407-L3413)
```cs:line-numbers=3407
					AddCondition<ConBlind>(200);
				}
			}
			if (turn % (2000 * (100 + Evalue(412) * 2) / Mathf.Max(100 + Evalue(409) * 10, 100)) == 0) // [!code --]
			if (turn % (200000 / Mathf.Max(100 + Evalue(409) * 10, 50)) == 0) // [!code ++]
			{
				ModCorruption(1);
			}
```

[`@@ -3416,7 +3416,7 @@ public void TickConditions()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Chara.cs#L3416-L3422)
```cs:line-numbers=3416
	if (!IsPC)
	{
		int num2 = Evalue(409);
		if (num2 > 0 && turn % 2000 * (100 + Evalue(412) * 2) / (100 + num2 * 10) == 0) // [!code --]
		if (num2 > 0 && turn % (200000 / Mathf.Max(100 + num2 * 10, 50)) == 0) // [!code ++]
		{
			ModCorruption(1);
		}
```

[`@@ -4029,7 +4029,7 @@ public void HoldCard(Card t, int num = -1)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Chara.cs#L4029-L4035)
```cs:line-numbers=4029
	}
	if (t.GetRootCard() != this)
	{
		t = Pick(t.Thing, msg: false); // [!code --]
		t = Pick(t.Thing, msg: false, tryStack: false); // [!code ++]
		if (t.GetRootCard() != this)
		{
			return;
```

[`@@ -5527,7 +5527,14 @@ public void Cuddle(Chara c, bool headpat = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Chara.cs#L5527-L5533)
```cs:line-numbers=5527
public Chara SetEnemy(Chara c = null)
{
	enemy = c;
	if (c != null) // [!code --]
	if (c == null) // [!code ++]
	{ // [!code ++]
		if (ai is GoalCombat) // [!code ++]
		{ // [!code ++]
			ai.Cancel(); // [!code ++]
		} // [!code ++]
	} // [!code ++]
	else // [!code ++]
	{
		calmCheckTurn = 10 + EClass.rnd(30);
	}
```

[`@@ -5638,7 +5645,7 @@ public void DoHostileAction(Card _tg, bool immediate = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Chara.cs#L5638-L5644)
```cs:line-numbers=5638
		{
			GoHostile(chara);
			chara.GoHostile(this);
			if (base.isHidden && !chara.CanSee(this) && !chara.IsDisabled && !chara.IsPCParty && !chara.IsPCPartyMinion && EClass.rnd(6) == 0) // [!code --]
			if (base.isHidden && !chara.CanSee(this) && !chara.IsDisabled && !chara.IsPCParty && !chara.IsPCPartyMinion && EClass.rnd(10 + Dist(chara) * 10) == 0) // [!code ++]
			{
				Thing t = ThingGen.Create("49");
				ActThrow.Throw(chara, pos, t);
```

[`@@ -5673,6 +5680,10 @@ public bool FindNewEnemy()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Chara.cs#L5673-L5678)
```cs:line-numbers=5673
	{
		return false;
	}
	if (IsPCParty && EClass.pc.isHidden && base.isHidden) // [!code ++]
	{ // [!code ++]
		return false; // [!code ++]
	} // [!code ++]
	bool flag = enemy != null || ai is GoalCombat;
	int num = (base.PER + Evalue(210) * 2) * ((!flag) ? 1 : 2);
	bool flag2 = IsPCParty && !IsPC && EClass.game.config.tactics.dontWander;
```

[`@@ -6191,6 +6202,10 @@ public void ChangeMemberType(FactionMemberType type)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Chara.cs#L6191-L6196)
```cs:line-numbers=6191
public void ShowDialog()
{
	Zone_Nymelle zone_Nymelle = EClass._zone as Zone_Nymelle;
	if (conSuspend != null && IsPCParty) // [!code ++]
	{ // [!code ++]
		RemoveCondition<ConSuspend>(); // [!code ++]
	} // [!code ++]
	if (IsDeadOrSleeping)
	{
		ShowDialog("_chara", "sleep");
```

[`@@ -6436,9 +6451,9 @@ public void ClearBed(Map map = null)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Chara.cs#L6436-L6444)
```cs:line-numbers=6436
	{
		map = EClass._map;
	}
	foreach (Card value in map.props.installed.all.Values) // [!code --]
	foreach (Card item in map.props.installed.all) // [!code ++]
	{
		if (value.trait is TraitBed traitBed && traitBed.IsHolder(this)) // [!code --]
		if (item.trait is TraitBed traitBed && traitBed.IsHolder(this)) // [!code ++]
		{
			traitBed.RemoveHolder(this);
		}
```

[`@@ -6447,9 +6462,9 @@ public void ClearBed(Map map = null)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Chara.cs#L6447-L6455)
```cs:line-numbers=6447

	public TraitBed FindBed()
	{
		foreach (Card value in EClass._map.props.installed.all.Values) // [!code --]
		foreach (Card item in EClass._map.props.installed.all) // [!code ++]
		{
			if (value.trait is TraitBed traitBed && traitBed.IsHolder(this)) // [!code --]
			if (item.trait is TraitBed traitBed && traitBed.IsHolder(this)) // [!code ++]
			{
				return traitBed;
			}
```

[`@@ -6463,9 +6478,9 @@ public TraitBed TryAssignBed()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Chara.cs#L6463-L6471)
```cs:line-numbers=6463
	{
		return null;
	}
	foreach (Card value in EClass._map.props.installed.all.Values) // [!code --]
	foreach (Card item in EClass._map.props.installed.all) // [!code ++]
	{
		if (value.trait is TraitBed traitBed && traitBed.CanAssign(this)) // [!code --]
		if (item.trait is TraitBed traitBed && traitBed.CanAssign(this)) // [!code ++]
		{
			traitBed.AddHolder(this);
			Msg.Say("claimBed", this);
```

[`@@ -8688,32 +8703,45 @@ public void ModWeight(int a, bool ignoreLimit = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Chara.cs#L8688-L8719)
```cs:line-numbers=8688

	public void ModCorruption(int a)
	{
		if (a > 0 && ResistLv(962) > 0 && EClass.rnd(ResistLv(962) + 1) != 0) // [!code --]
		if (a > 0) // [!code ++]
		{ // [!code ++]
			if (ResistLv(962) > 0 && EClass.rnd(ResistLv(962) + 1) != 0) // [!code ++]
			{ // [!code ++]
				return; // [!code ++]
			} // [!code ++]
			int num = Evalue(412); // [!code ++]
			if (num != 0) // [!code ++]
			{ // [!code ++]
				float num2 = (float)a * 100f / (float)Mathf.Max(100 + num * 2, 10); // [!code ++]
				a = (int)num2 + ((EClass.rndf(1f) > num2 % 1f) ? 1 : 0); // [!code ++]
			} // [!code ++]
		} // [!code ++]
		if (a == 0) // [!code ++]
		{
			return;
		}
		int num = (corruption + a) / 100 - corruption / 100; // [!code --]
		for (int i = 0; i < Mathf.Abs(num); i++) // [!code --]
		int num3 = (corruption + a) / 100 - corruption / 100; // [!code ++]
		for (int i = 0; i < Mathf.Abs(num3); i++) // [!code ++]
		{
			if (!MutateRandom((num > 0) ? 1 : (-1), 100, ether: true)) // [!code --]
			if (!MutateRandom((num3 > 0) ? 1 : (-1), 100, ether: true)) // [!code ++]
			{
				break;
			}
		}
		corruption += a;
		int num2 = 0; // [!code --]
		int num4 = 0; // [!code ++]
		foreach (Element value in elements.dict.Values)
		{
			if (value.source.category == "ether")
			{
				num2 += value.Value; // [!code --]
				num4 += value.Value; // [!code ++]
			}
		}
		if (num2 > 0 && IsPC) // [!code --]
		if (num4 > 0 && IsPC) // [!code ++]
		{
			Tutorial.Reserve("ether");
		}
		corruption = num2 * 100 + corruption % 100; // [!code --]
		corruption = num4 * 100 + corruption % 100; // [!code ++]
	}

	public List<Element> ListAvailabeFeats(bool pet = false, bool showAll = false)
```

## ConInvisibility

[`@@ -4,6 +4,18 @@ public class ConInvisibility : BaseBuff`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/ConInvisibility.cs#L4-L9)
```cs:line-numbers=4

	public override bool ShouldRefresh => true;

	public override void OnStart() // [!code ++]
	{ // [!code ++]
		owner.isHidden = true; // [!code ++]
		foreach (Chara chara in EClass._map.charas) // [!code ++]
		{ // [!code ++]
			if (chara.enemy == owner && !chara.CanSeeLos(owner)) // [!code ++]
			{ // [!code ++]
				chara.SetEnemy(); // [!code ++]
			} // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public override void OnRefresh()
	{
		owner.isHidden = true;
```

## CoreDebug

[`@@ -905,14 +905,7 @@ public void UpdateInput()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/CoreDebug.cs#L905-L918)
```cs:line-numbers=905
	}
	if (Input.GetKeyDown(KeyCode.F2))
	{
		Chara targetChara = EClass.scene.mouseTarget.TargetChara; // [!code --]
		if (targetChara != null) // [!code --]
		{ // [!code --]
			EClass.pc.Pick(targetChara.MakeMilk()); // [!code --]
			EClass.pc.Pick(targetChara.MakeGene()); // [!code --]
			EClass.pc.Pick(targetChara.MakeBraineCell()); // [!code --]
			EClass.pc.Pick(targetChara.MakeEgg(effect: true, 10)); // [!code --]
		} // [!code --]
		EClass.pc.ModCorruption(1); // [!code ++]
		return;
	}
	if (Input.GetKeyDown(KeyCode.F3))
```

[`@@ -1136,7 +1129,7 @@ public void UpdateInput()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/CoreDebug.cs#L1136-L1142)
```cs:line-numbers=1136
		}
		if (key)
		{
			foreach (Card item2 in EClass._map.Roaming.all.GetList<Card>()) // [!code --]
			foreach (Card item2 in EClass._map.Roaming.all) // [!code ++]
			{
				EClass._zone.RemoveCard(item2);
			}
```

## Game

[`@@ -440,6 +440,17 @@ public void OnLoad()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Game.cs#L440-L445)
```cs:line-numbers=440
			}
		}
	});
	if (version.IsBelow(0, 23, 76)) // [!code ++]
	{ // [!code ++]
		QuestDebt questDebt = EClass.game.quests.Get<QuestDebt>(); // [!code ++]
		if (questDebt != null && questDebt.stage == 6 && player.debt == 19530000) // [!code ++]
		{ // [!code ++]
			EClass.pc.AddCard(ThingGen.Create("loytel_mart")); // [!code ++]
			EClass.pc.AddCard(ThingGen.Create("ticket_massage")); // [!code ++]
			player.debt = 19500000; // [!code ++]
			questDebt.stage = 5; // [!code ++]
		} // [!code ++]
	} // [!code ++]
	if (version.IsBelow(0, 23, 72))
	{
		foreach (Chara value2 in EClass.game.cards.globalCharas.Values)
```

## +GameContractResolver

::: details File Created
```cs
using Newtonsoft.Json.Serialization;

public class GameContractResolver : DefaultContractResolver
{
	public static readonly GameContractResolver Instance = new GameContractResolver();
}
```

:::
## GameDate

[`@@ -252,7 +252,11 @@ public void ShipGoods()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/GameDate.cs#L252-L258)
```cs:line-numbers=252
	ShippingResult shippingResult = new ShippingResult();
	shippingResult.rawDate = EClass.world.date.GetRaw();
	shippingResult.uidZone = zone.uid;
	shippingResult.total = EClass.player.stats.shipMoney; // [!code --]
	if (EClass.player.stats.shipMoney < 0) // [!code ++]
	{ // [!code ++]
		EClass.player.stats.shipMoney = 2147483647L; // [!code ++]
	} // [!code ++]
	shippingResult.total = (int)EClass.player.stats.shipMoney; // [!code ++]
	shippingResult.hearthLv = zone.branch.lv;
	shippingResult.hearthExp = zone.branch.exp;
	shippingResult.debt = EClass.player.debt;
```

## GameIO

[`@@ -152,6 +152,10 @@ public static Game LoadGame(string id, string root, bool cloud)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/GameIO.cs#L152-L157)
```cs:line-numbers=152
	Game.id = id;
	GameIndex gameIndex = IO.LoadFile<GameIndex>(root + "/index.txt");
	string path = root + "/game.txt";
	foreach (KeyValuePair<string, string> fallbackType in gameIndex.fallbackTypes) // [!code ++]
	{ // [!code ++]
		ModUtil.fallbackTypes[fallbackType.Key] = fallbackType.Value; // [!code ++]
	} // [!code ++]
	if (cloud)
	{
		gameIndex.cloud = true;
```

## GameIndex

[`@@ -1,4 +1,5 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/GameIndex.cs#L1-L4)
```cs:line-numbers=1
using System;
using System.Collections.Generic; // [!code ++]
using Newtonsoft.Json;
using UnityEngine;

```

[`@@ -41,6 +42,8 @@ public class GameIndex : EClass`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/GameIndex.cs#L41-L46)
```cs:line-numbers=41

	public bool cloud;

	public Dictionary<string, string> fallbackTypes = new Dictionary<string, string>(); // [!code ++]
 // [!code ++]
	[JsonIgnore]
	public string path;

```

[`@@ -67,6 +70,7 @@ public GameIndex Create(Game game)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/GameIndex.cs#L67-L72)
```cs:line-numbers=67
		idJob = EClass.pc.job.id;
		days = EClass.player.stats.days;
		deepest = EClass.player.stats.deepest;
		fallbackTypes = ModUtil.fallbackTypes; // [!code ++]
		Color color = EClass.pc.pccData?.GetHairColor(applyMod: true) ?? Color.white;
		this.color = ColorUtility.ToHtmlStringRGBA(color);
	}
```

## GameSerializationBinder

[`@@ -16,6 +16,11 @@ public override Type BindToType(string assemblyName, string typeName)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/GameSerializationBinder.cs#L16-L21)
```cs:line-numbers=16
	{
		Debug.LogError(ex.Message);
		Debug.LogError(assemblyName + "/" + typeName);
		if (ModUtil.fallbackTypes.ContainsKey(typeName)) // [!code ++]
		{ // [!code ++]
			Debug.Log(typeName + "/" + Type.GetType(ModUtil.fallbackTypes[typeName])); // [!code ++]
			return Type.GetType(ModUtil.fallbackTypes[typeName]); // [!code ++]
		} // [!code ++]
		if (typeName.Contains("Quest"))
		{
			return typeof(QuestDummy);
```

## GameUpdater

[`@@ -121,6 +121,10 @@ public override void FixedUpdate()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/GameUpdater.cs#L121-L126)
```cs:line-numbers=121
					cell.decal = 0;
				}
			}
			if (EClass.rnd(30) == 0 && cell.decal != 0 && !pos.IsInBounds) // [!code ++]
			{ // [!code ++]
				cell.decal = 0; // [!code ++]
			} // [!code ++]
			x++;
			if (x >= Size)
			{
```

## GoalCombat

[`@@ -58,6 +58,7 @@ public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/GoalCombat.cs#L58-L63)
```cs:line-numbers=58
	bool dontWander = owner.IsPCParty && !owner.IsPC && EClass.game.config.tactics.dontWander;
	while (true)
	{
		bool canSeeLos = false; // [!code ++]
		if (EClass.debug.logCombat)
		{
			Debug.Log("■" + owner.Name + "/" + count + "/" + lostCount);
```

[`@@ -78,15 +79,19 @@ public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/GoalCombat.cs#L78-L92)
```cs:line-numbers=78
			}
		}
		tc = owner.enemy;
		if (tc != null && owner.IsPCFaction && !EClass.pc.ai.ShouldAllyAttack(tc)) // [!code --]
		if (tc != null && owner.IsPCFaction) // [!code ++]
		{
			tc = (owner.enemy = null); // [!code --]
		} // [!code --]
		if (tc != null && !tc.isDead && tc.ExistsOnMap && tc.pos.IsInBounds && lostCount < (owner.IsPowerful ? 50 : 5)) // [!code --]
		{ // [!code --]
			lostCount = ((!owner.CanSeeLos(tc)) ? (lostCount + 1) : 0); // [!code --]
			if (EClass.pc.isHidden && owner.isHidden) // [!code ++]
			{ // [!code ++]
				owner.enemy = null; // [!code ++]
				yield return Success(); // [!code ++]
			} // [!code ++]
			if (!EClass.pc.ai.ShouldAllyAttack(tc)) // [!code ++]
			{ // [!code ++]
				tc = (owner.enemy = null); // [!code ++]
			} // [!code ++]
		}
		else // [!code --]
		if (tc == null || tc.isDead || !tc.ExistsOnMap || !tc.pos.IsInBounds || lostCount >= (owner.IsPowerful ? 50 : 5)) // [!code ++]
		{
			tc = (owner.enemy = null);
			if (owner.IsPC && EClass.game.config.autoCombat.abortOnKill)
```

[`@@ -101,6 +106,11 @@ public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/GoalCombat.cs#L101-L106)
```cs:line-numbers=101
			}
			tc = owner.enemy;
		}
		else // [!code ++]
		{ // [!code ++]
			canSeeLos = owner.CanSeeLos(tc); // [!code ++]
			lostCount = ((!canSeeLos) ? (lostCount + 1) : 0); // [!code ++]
		} // [!code ++]
		if (owner.IsPC && tc.HasEditorTag(EditorTag.Invulnerable))
		{
			Msg.Say("abort_idle");
```

[`@@ -231,7 +241,7 @@ public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/GoalCombat.cs#L231-L237)
```cs:line-numbers=231
				}
			}
		}
		if (owner.IsPC && EClass.game.config.autoCombat.bDontChase) // [!code --]
		if ((owner.IsPC && EClass.game.config.autoCombat.bDontChase) || (!canSeeLos && tc.isHidden)) // [!code ++]
		{
			move = false;
			haltSecondMove = true;
```

## GuildFighter

[`@@ -38,7 +38,7 @@ public bool CanGiveContribution(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/GuildFighter.cs#L38-L44)
```cs:line-numbers=38

	public bool ShowBounty(Chara c)
	{
		return false; // [!code --]
		return true; // [!code ++]
	}

	public bool HasBounty(Chara c)
```

## InvOwner

[`@@ -231,7 +231,14 @@ public bool Process(bool startTransaction = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/InvOwner.cs#L231-L237)
```cs:line-numbers=231
				{
					EClass.pc.ModCurrency(-price, IDCurrency);
				}
				ShopTransaction.current.Process(thing2, thing2.Num, sell); // [!code --]
				if (sell && !thing2.IsIdentified) // [!code ++]
				{ // [!code ++]
					thing2.Identify(show: true, IDTSource.SuperiorIdentify); // [!code ++]
				} // [!code ++]
				else // [!code ++]
				{ // [!code ++]
					ShopTransaction.current.Process(thing2, thing2.Num, sell); // [!code ++]
				} // [!code ++]
				Msg.Say(sell ? "sold" : "bought", thing2, Lang._currency(Mathf.Abs(price), IDCurrency));
				if (thing2.id == "statue_weird" && sell)
				{
```

## LayerHome

[`@@ -251,11 +251,11 @@ public void RefreshSpots()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/LayerHome.cs#L251-L261)
```cs:line-numbers=251
		},
		onList = delegate
		{
			foreach (Card value in ELayer._map.Installed.all.Values) // [!code --]
			foreach (Card item in ELayer._map.Installed.all) // [!code ++]
			{
				if (value.trait.IsSpot) // [!code --]
				if (item.trait.IsSpot) // [!code ++]
				{
					listArea.Add(value.trait); // [!code --]
					listArea.Add(item.trait); // [!code ++]
				}
			}
		},
```

## LayerShippingResult

[`@@ -107,26 +107,26 @@ public void Refresh()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/LayerShippingResult.cs#L107-L132)
```cs:line-numbers=107
	float num = (float)update / (float)maxUpdate;
	int income = result.GetIncome();
	income = (int)((float)income * num);
	int a = result.total + income; // [!code --]
	long num2 = result.total + income; // [!code ++]
	textIncome.text = Lang._currency(income, showUnit: true);
	textIncomeTotal.text = Lang._currency(a, showUnit: true); // [!code --]
	textIncomeTotal.text = Lang._currency(num2, showUnit: true); // [!code ++]
	int shippingBonus = ELayer.player.stats.GetShippingBonus(result.total);
	int shippingBonus2 = ELayer.player.stats.GetShippingBonus(a); // [!code --]
	int shippingBonus2 = ELayer.player.stats.GetShippingBonus(num2); // [!code ++]
	int lastShippingExp = ELayer.player.stats.lastShippingExp;
	int lastShippingExpMax = ELayer.player.stats.lastShippingExpMax;
	int hearthLv = result.hearthLv;
	int num2 = (int)((float)result.hearthExpGained * num); // [!code --]
	int num3 = (int)((float)result.hearthExpGained * num); // [!code ++]
	int nextExp = branch.GetNextExp(hearthLv);
	int num3 = result.hearthExp + num2; // [!code --]
	int num4 = result.hearthExp + num3; // [!code ++]
	gaugeGold.rectTransform.sizeDelta = new Vector2(Mathf.Min(300, 300 * lastShippingExp / lastShippingExpMax), 50f);
	gaugeHearth.rectTransform.sizeDelta = new Vector2(Mathf.Min(300, 300 * num3 / nextExp), 50f); // [!code --]
	gaugeHearth.rectTransform.sizeDelta = new Vector2(Mathf.Min(300, 300 * num4 / nextExp), 50f); // [!code ++]
	gaugeDebt.rectTransform.sizeDelta = new Vector2(Mathf.Min(300f, 300f * ((float)result.debt / 20000000f)), 50f);
	textGold.text = "shipping_nextGold".lang(lastShippingExp.ToFormat(), lastShippingExpMax.ToFormat());
	int num4 = shippingBonus2 - shippingBonus; // [!code --]
	textGold2.text = ((num4 == 0) ? "" : ("+" + num4)); // [!code --]
	textHearth.text = "shipping_hearth".lang(hearthLv.ToString() ?? "", (100f * (float)num3 / (float)nextExp).ToString("F1")); // [!code --]
	float num5 = 100f * (float)num2 / (float)nextExp; // [!code --]
	textHearth2.text = ((num5 == 0f) ? "" : ("+" + num5.ToString("F1") + "%")); // [!code --]
	int num5 = shippingBonus2 - shippingBonus; // [!code ++]
	textGold2.text = ((num5 == 0) ? "" : ("+" + num5)); // [!code ++]
	textHearth.text = "shipping_hearth".lang(hearthLv.ToString() ?? "", (100f * (float)num4 / (float)nextExp).ToString("F1")); // [!code ++]
	float num6 = 100f * (float)num3 / (float)nextExp; // [!code ++]
	textHearth2.text = ((num6 == 0f) ? "" : ("+" + num6.ToString("F1") + "%")); // [!code ++]
	textDebt.text = (ELayer.game.quests.IsStarted<QuestDebt>() ? (Lang._currency(result.debt, showUnit: true) ?? "") : "???");
	gaugeDebt.SetActive(ELayer.game.quests.IsStarted<QuestDebt>());
	if (shippingBonus2 - shippingBonus != lastBonus)
```

## Map

[`@@ -2631,7 +2631,7 @@ public Thing FindThing(string workTag, BaseArea area1 = null, BaseArea area2 = n`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Map.cs#L2631-L2637)
```cs:line-numbers=2631
	PropSet orCreate = EClass._map.Installed.workMap.GetOrCreate(workTag);
	if (area1 != null)
	{
		IEnumerable<Card> enumerable = orCreate.Values.Where((Card a) => a.pos.HasRoomOrArea(area1)); // [!code --]
		IEnumerable<Card> enumerable = orCreate.Where((Card a) => a.pos.HasRoomOrArea(area1)); // [!code ++]
		if (enumerable.Count() > 0)
		{
			thing = enumerable.RandomItem() as Thing;
```

[`@@ -2639,7 +2639,7 @@ public Thing FindThing(string workTag, BaseArea area1 = null, BaseArea area2 = n`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Map.cs#L2639-L2645)
```cs:line-numbers=2639
	}
	if (thing == null && area2 != null)
	{
		IEnumerable<Card> enumerable2 = orCreate.Values.Where((Card a) => a.pos.HasRoomOrArea(area2)); // [!code --]
		IEnumerable<Card> enumerable2 = orCreate.Where((Card a) => a.pos.HasRoomOrArea(area2)); // [!code ++]
		if (enumerable2.Count() > 0)
		{
			thing = enumerable2.RandomItem() as Thing;
```

[`@@ -2651,7 +2651,9 @@ public Thing FindThing(string workTag, BaseArea area1 = null, BaseArea area2 = n`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Map.cs#L2651-L2657)
```cs:line-numbers=2651
public Thing FindThing(string workTag, Chara c)
{
	Thing result = null;
	IEnumerable<Card> enumerable = EClass._map.Installed.workMap.GetOrCreate(workTag).Values.Where((Card a) => a.pos.IsPublicSpace()); // [!code --]
	IEnumerable<Card> enumerable = from a in EClass._map.Installed.workMap.GetOrCreate(workTag) // [!code ++]
		where a.pos.IsPublicSpace() // [!code ++]
		select a; // [!code ++]
	if (enumerable.Count() > 0)
	{
		result = enumerable.RandomItem() as Thing;
```

## ModManager

[`@@ -203,6 +203,7 @@ public IEnumerator RefreshMods(Action onComplete, bool syncMods)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/ModManager.cs#L203-L208)
```cs:line-numbers=203
			}
		}
	}
	ModUtil.OnModsActivated(); // [!code ++]
	BaseModManager.isInitialized = true;
	yield return new WaitForEndOfFrame();
	onComplete?.Invoke();
```

[`@@ -215,6 +216,10 @@ public IEnumerator RefreshMods(Action onComplete, bool syncMods)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/ModManager.cs#L215-L220)
```cs:line-numbers=215

	public void SaveLoadOrder()
	{
		if (disableMod) // [!code ++]
		{ // [!code ++]
			return; // [!code ++]
		} // [!code ++]
		List<string> list = new List<string>();
		foreach (BaseModPackage package in packages)
		{
```

## ModUtil

[`@@ -1,4 +1,5 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/ModUtil.cs#L1-L4)
```cs:line-numbers=1
using System;
using System.Collections.Generic; // [!code ++]
using System.IO;
using NPOI.SS.UserModel;
using NPOI.XSSF.UserModel;
```

[`@@ -6,11 +7,23 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/ModUtil.cs#L6-L16)
```cs:line-numbers=6

public class ModUtil : EClass
{
	public static Dictionary<string, string> fallbackTypes = new Dictionary<string, string>(); // [!code ++]
 // [!code ++]
	public static void Test()
	{
		ImportExcel("", "", EClass.sources.charas);
	}

	public static void OnModsActivated() // [!code ++]
	{ // [!code ++]
		RegisterSerializedTypeFallback("TrueArena", "ArenaWaveEvent", "ZoneEvent"); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public static void RegisterSerializedTypeFallback(string nameAssembly, string nameType, string nameFallbackType) // [!code ++]
	{ // [!code ++]
		fallbackTypes[nameType] = nameFallbackType; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public static void ImportExcel(string pathToExcelFile, string sheetName, SourceData source)
	{
		Debug.Log("ImportExcel source:" + source?.ToString() + " Path:" + pathToExcelFile);
```

## Player

[`@@ -83,8 +83,6 @@ public class Stats`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Player.cs#L83-L90)
```cs:line-numbers=83

		public int shipNum;

		public int shipMoney; // [!code --]
 // [!code --]
		public int slept;

		public int death;
```

[`@@ -97,16 +95,21 @@ public class Stats`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Player.cs#L97-L112)
```cs:line-numbers=97

		public int gambleChestOpen;

		public long shipMoney; // [!code ++]
 // [!code ++]
		[JsonIgnore]
		public int lastShippingExp;

		[JsonIgnore]
		public int lastShippingExpMax;

		public int GetShippingBonus(int _a) // [!code --]
		public int GetShippingBonus(long _a) // [!code ++]
		{
			int p = 0; // [!code --]
			long p = 0L; // [!code ++]
			bool first = true;
			SetBonus(1000000000, 50000); // [!code ++]
			SetBonus(100000000, 20000); // [!code ++]
			SetBonus(10000000, 10000); // [!code ++]
			SetBonus(500000, 5000);
			SetBonus(250000, 3000);
			SetBonus(100000, 2000);
```

[`@@ -114,7 +117,7 @@ public int GetShippingBonus(int _a)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Player.cs#L114-L120)
```cs:line-numbers=114
		SetBonus(6000, 500);
		SetBonus(2000, 200);
		SetBonus(0, 100);
		return p; // [!code --]
		return (int)p; // [!code ++]
		void SetBonus(int threshold, int div)
		{
			if (_a >= threshold)
```

[`@@ -122,7 +125,7 @@ void SetBonus(int threshold, int div)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Player.cs#L122-L128)
```cs:line-numbers=122
				p += (_a - threshold) / div;
				if (first)
				{
					lastShippingExp = (_a - threshold) % div; // [!code --]
					lastShippingExp = (int)((_a - threshold) % div); // [!code ++]
					lastShippingExpMax = div;
					first = false;
				}
```

[`@@ -794,6 +797,9 @@ public void OnLeaveZone()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Player.cs#L794-L799)
```cs:line-numbers=794
	[JsonProperty]
	public string memo = "";

	[JsonProperty] // [!code ++]
	public string memo2 = ""; // [!code ++]
 // [!code ++]
	[JsonProperty]
	public Pref pref = new Pref();

```

[`@@ -1155,7 +1161,7 @@ public void OnCreateGame()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Player.cs#L1155-L1161)
```cs:line-numbers=1155
		flags.toggleHotbarHighlightDisabled = true;
		layerAbilityConfig.hideDepletedSpell = true;
		layerAbilityConfig.bgAlpha = 70;
		memo = "memo_blank".lang(); // [!code --]
		memo = (memo2 = "memo_blank".lang()); // [!code ++]
	}

	public void OnStartNewGame()
```

## PropSet

[`@@ -1,24 +1,19 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/PropSet.cs#L1-L24)
```cs:line-numbers=1
using System.Collections.Generic;

public class PropSet : Dictionary<int, Card> // [!code --]
public class PropSet : HashSet<Card> // [!code ++]
{
	public int num;

	public void Add(Card c) // [!code --]
	public new void Add(Card c) // [!code ++]
	{
		ModNum(c.Num);
		Add(c.uid, c); // [!code --]
		base.Add(c); // [!code ++]
	}

	public void Remove(Card c) // [!code --]
	public new void Remove(Card c) // [!code ++]
	{
		ModNum(-c.Num);
		Remove(c.uid); // [!code --]
	} // [!code --]
 // [!code --]
	public bool Contains(Card c) // [!code --]
	{ // [!code --]
		return ContainsKey(c.uid); // [!code --]
		base.Remove(c); // [!code ++]
	}

	public virtual void ModNum(int a)
```

## Props

[`@@ -1,4 +1,5 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Props.cs#L1-L4)
```cs:line-numbers=1
using System.Collections.Generic;
using System.Linq; // [!code ++]
using Newtonsoft.Json;
using UnityEngine;

```

[`@@ -61,6 +62,14 @@ public void Init()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Props.cs#L61-L66)
```cs:line-numbers=61

	public void Add(Card t)
	{
		if (all.Contains(t)) // [!code ++]
		{ // [!code ++]
			Debug.Log(t.props); // [!code ++]
			Debug.Log(t.parent); // [!code ++]
			Debug.Log(things.Contains(t) + "/" + cardMap.ContainsKey(t.id)); // [!code ++]
			Debug.LogError(t?.ToString() + " alreadin in " + this); // [!code ++]
			return; // [!code ++]
		} // [!code ++]
		if (t.props != null)
		{
			t.props.Remove(t);
```

[`@@ -79,11 +88,6 @@ public void Add(Card t)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Props.cs#L79-L89)
```cs:line-numbers=79
			EClass._map.Stocked.Add(thing);
		}
	}
	if (all.Contains(t)) // [!code --]
	{ // [!code --]
		Debug.LogError(t?.ToString() + " alreadin in " + this); // [!code --]
		return; // [!code --]
	} // [!code --]
	weight += t.Num;
	all.Add(t);
	things.Add(t.Thing);
```

[`@@ -187,11 +191,11 @@ public Thing GetAvailableThing(string id, int idMat)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Props.cs#L187-L197)
```cs:line-numbers=187
	{
		return null;
	}
	foreach (Card value in propSet.Values) // [!code --]
	foreach (Card item in propSet) // [!code ++]
	{
		if (value.idMaterial == idMat) // [!code --]
		if (item.idMaterial == idMat) // [!code ++]
		{
			return value as Thing; // [!code --]
			return item as Thing; // [!code ++]
		}
	}
	return null;
```

[`@@ -236,12 +240,12 @@ void Find(string id)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Props.cs#L236-L247)
```cs:line-numbers=236
		});
		if (EClass._zone.IsPCFaction || EClass._zone is Zone_Tent || EClass.debug.enable)
		{
			foreach (Card value in cardMap.GetOrCreate(id).Values) // [!code --]
			foreach (Card item3 in cardMap.GetOrCreate(id)) // [!code ++]
			{
				Card obj = value.parent as Card; // [!code --]
				Card obj = item3.parent as Card; // [!code ++]
				if (obj != null && obj.c_lockLv == 0)
				{
					TryAdd(value.Thing); // [!code --]
					TryAdd(item3.Thing); // [!code ++]
				}
			}
		}
```

[`@@ -375,10 +379,10 @@ public Thing Find(string id, string idMat)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Props.cs#L375-L384)
```cs:line-numbers=375

	public Thing Find(string id, int idMat = -1, int refVal = -1, bool shared = false)
	{
		Dictionary<int, Card>.ValueCollection valueCollection = cardMap.TryGetValue(id)?.Values; // [!code --]
		if (valueCollection != null) // [!code --]
		PropSet propSet = cardMap.TryGetValue(id); // [!code ++]
		if (propSet != null) // [!code ++]
		{
			foreach (Card item in valueCollection) // [!code --]
			foreach (Card item in propSet) // [!code ++]
			{
				if ((!shared || item.parent is Thing { IsSharedContainer: not false }) && (idMat == -1 || item.material.id == idMat) && (refVal == -1 || item.refVal == refVal))
				{
```

[`@@ -392,11 +396,11 @@ public Thing Find(string id, int idMat = -1, int refVal = -1, bool shared = fals`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Props.cs#L392-L402)
```cs:line-numbers=392
public int GetNum(string id, bool onlyShared = false)
{
	int num = 0;
	foreach (Card value in cardMap.GetOrCreate(id).Values) // [!code --]
	foreach (Card item in cardMap.GetOrCreate(id)) // [!code ++]
	{
		if (!onlyShared || (value.parentThing != null && value.parentThing.IsSharedContainer)) // [!code --]
		if (!onlyShared || (item.parentThing != null && item.parentThing.IsSharedContainer)) // [!code ++]
		{
			num += value.Num; // [!code --]
			num += item.Num; // [!code ++]
		}
	}
	return num;
```

[`@@ -412,9 +416,9 @@ public void Validate()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Props.cs#L412-L420)
```cs:line-numbers=412
	foreach (KeyValuePair<string, PropSet> item in cardMap)
	{
		int num = 0;
		foreach (Card value in item.Value.Values) // [!code --]
		foreach (Card item2 in item.Value) // [!code ++]
		{
			num += value.Num; // [!code --]
			num += item2.Num; // [!code ++]
		}
		if (num != item.Value.num)
		{
```

## Scene

[`@@ -316,7 +316,7 @@ public void Init(Mode newMode)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Scene.cs#L316-L322)
```cs:line-numbers=316
		{
			EMono.ui.widgets.Activate("QuestTracker");
		}
		if (EMono._zone is Zone_Town && !EMono._zone.isMapSaved && !EMono.debug.enable) // [!code --]
		if ((EMono._zone is Zone_Town || EMono._zone is Zone_Tent) && !EMono._zone.isMapSaved && !EMono.debug.ignoreAutoSave) // [!code ++]
		{
			EMono.game.Save();
		}
```

## ShippingResult

[`@@ -34,12 +34,12 @@ public int income`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/ShippingResult.cs#L34-L45)
```cs:line-numbers=34
	}

	[JsonProperty]
	public int[] ints = new int[10]; // [!code --]
	public long[] ints = new long[10]; // [!code ++]

	[JsonProperty]
	public List<Item> items = new List<Item>();

	public int total // [!code --]
	public long total // [!code ++]
	{
		get
		{
```

[`@@ -55,7 +55,7 @@ public int rawDate`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/ShippingResult.cs#L55-L61)
```cs:line-numbers=55
{
	get
	{
		return ints[1]; // [!code --]
		return (int)ints[1]; // [!code ++]
	}
	set
	{
```

[`@@ -67,7 +67,7 @@ public int uidZone`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/ShippingResult.cs#L67-L73)
```cs:line-numbers=67
{
	get
	{
		return ints[2]; // [!code --]
		return (int)ints[2]; // [!code ++]
	}
	set
	{
```

[`@@ -79,7 +79,7 @@ public int hearthLv`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/ShippingResult.cs#L79-L85)
```cs:line-numbers=79
{
	get
	{
		return ints[3]; // [!code --]
		return (int)ints[3]; // [!code ++]
	}
	set
	{
```

[`@@ -91,7 +91,7 @@ public int hearthExp`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/ShippingResult.cs#L91-L97)
```cs:line-numbers=91
{
	get
	{
		return ints[4]; // [!code --]
		return (int)ints[4]; // [!code ++]
	}
	set
	{
```

[`@@ -103,7 +103,7 @@ public int hearthExpGained`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/ShippingResult.cs#L103-L109)
```cs:line-numbers=103
{
	get
	{
		return ints[5]; // [!code --]
		return (int)ints[5]; // [!code ++]
	}
	set
	{
```

[`@@ -115,7 +115,7 @@ public int debt`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/ShippingResult.cs#L115-L121)
```cs:line-numbers=115
{
	get
	{
		return ints[6]; // [!code --]
		return (int)ints[6]; // [!code ++]
	}
	set
	{
```

## Thing

[`@@ -1503,10 +1503,10 @@ public override void SetRenderParam(RenderParam p)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/Thing.cs#L1503-L1512)
```cs:line-numbers=1503
	}
	if (trait.IdSkin != 0)
	{
		int num6 = trait.IdSkin - 1; // [!code --]
		int index = trait.IdSkin - 1; // [!code ++]
		if (sourceCard.skins.Length != 0)
		{
			p.tile += ((p.tile < 0f) ? (-sourceCard.skins[num6]) : sourceCard.skins[num6]); // [!code --]
			p.tile += ((p.tile < 0f) ? (-sourceCard.skins.TryGet(index)) : sourceCard.skins.TryGet(index)); // [!code ++]
		}
	}
}
```

## ThingContainer

[`@@ -428,12 +428,15 @@ public DestData GetDest(Thing t, bool tryStack = true)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/ThingContainer.cs#L428-L439)
```cs:line-numbers=428
	_listContainers.Add(this);
	TrySearchContainer(owner);
	_listContainers.Sort((ThingContainer a, ThingContainer b) => (b.owner.GetWindowSaveData()?.priority ?? 0) * 10 + (b.owner.IsPC ? 1 : 0) - ((a.owner.GetWindowSaveData()?.priority ?? 0) * 10 + (a.owner.IsPC ? 1 : 0)));
	foreach (ThingContainer listContainer in _listContainers) // [!code --]
	if (tryStack) // [!code ++]
	{
		SearchDest(listContainer, searchEmpty: false, searchStack: true); // [!code --]
		if (d.IsValid) // [!code --]
		foreach (ThingContainer listContainer in _listContainers) // [!code ++]
		{
			return d; // [!code --]
			SearchDest(listContainer, searchEmpty: false, searchStack: true); // [!code ++]
			if (d.IsValid) // [!code ++]
			{ // [!code ++]
				return d; // [!code ++]
			} // [!code ++]
		}
	}
	foreach (ThingContainer listContainer2 in _listContainers)
```

## TileType

[`@@ -336,9 +336,8 @@ public HitResult _HitTest(Point pos, Card target, bool canIgnore = true)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/TileType.cs#L336-L344)
```cs:line-numbers=336
		{
			return HitResult.Invalid;
		}
		if (IsDoor && pos.HasWallOrFence && pos.cell.blockDir == 2) // [!code --]
		if (IsDoor && !pos.HasWallOrFence) // [!code ++]
		{
			return HitResult.Invalid; // [!code --]
		}
	}
	else if (IsDoor)
```

## TraitDrinkMilkMother

[`@@ -64,15 +64,23 @@ public override void OnDrink(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/TraitDrinkMilkMother.cs#L64-L78)
```cs:line-numbers=64
			c.Say("grow_adult", c);
			c.PlaySound("mutation");
			c.PlayEffect("mutation");
			string id = c.id; // [!code ++]
			if (!(id == "putty_snow")) // [!code ++]
			{ // [!code ++]
				if (id == "putty_snow_gold" && c.idSkin >= 1) // [!code ++]
				{ // [!code ++]
					c.idSkin = 0; // [!code ++]
				} // [!code ++]
			} // [!code ++]
			else if (c.idSkin >= 4) // [!code ++]
			{ // [!code ++]
				c.idSkin = (c.idSkin - 4) / 2; // [!code ++]
			} // [!code ++]
		}
		else
		{
			c.Say("grow_baby", c);
			c.PlaySound("ding_potential");
			if (c.id == "putty_snow" && c.idSkin >= 4) // [!code --]
			{ // [!code --]
				c.idSkin = 0; // [!code --]
			} // [!code --]
		}
		c.PlayEffect("buff");
		EClass.pc.ModExp(237, 100);
```

## TraitFoodEggFertilized

[`@@ -64,9 +64,17 @@ public static Chara Incubate(Thing egg, Point pos, Card incubator = null)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/TraitFoodEggFertilized.cs#L64-L72)
```cs:line-numbers=64
	public static void MakeBaby(Chara c, int baby)
	{
		c.SetFeat(1232, baby, msg: true);
		if (c.id == "putty_snow" && c.idSkin == 0) // [!code --]
		string id = c.id; // [!code ++]
		if (!(id == "putty_snow")) // [!code ++]
		{
			c.idSkin = 4 + EClass.rnd(2); // [!code --]
			if (id == "putty_snow_gold" && c.idSkin == 0) // [!code ++]
			{ // [!code ++]
				c.idSkin = 1 + EClass.rnd(2); // [!code ++]
			} // [!code ++]
		} // [!code ++]
		else if (c.idSkin <= 3) // [!code ++]
		{ // [!code ++]
			c.idSkin = 4 + c.idSkin * 2 + EClass.rnd(2); // [!code ++]
		}
	}

```

## +TraitLightAlwaysAnime

::: details File Created
```cs
public class TraitLightAlwaysAnime : TraitLight
{
	public override bool IsAnimeOn => true;

	public override bool UseExtra => true;
}
```

:::
## +TraitMannequin

::: details File Created
```cs
using System.Collections.Generic;

public class TraitMannequin : TraitItem
{
	public override bool UseAltTiles => owner.things.Count > 0;

	public override bool CanUseFromInventory => false;

	public override bool CanName => true;

	public override bool CanUse(Chara c)
	{
		if (base.CanUse(c))
		{
			if (!EClass._zone.IsPCFaction)
			{
				return EClass._zone is Zone_Tent;
			}
			return true;
		}
		return false;
	}

	public override bool OnUse(Chara c)
	{
		List<Thing> list = new List<Thing>();
		foreach (BodySlot slot in EClass.pc.body.slots)
		{
			if (slot.elementId != 44 && slot.elementId != 45 && slot.thing != null && slot.thing.blessedState >= BlessedState.Normal)
			{
				list.Add(slot.thing);
			}
		}
		if (owner.things.Count == 0)
		{
			foreach (Thing item in list)
			{
				owner.AddCard(item);
			}
		}
		else
		{
			List<Thing> list2 = new List<Thing>();
			foreach (Thing thing in owner.things)
			{
				list2.Add(thing);
			}
			foreach (Thing item2 in list)
			{
				owner.AddCard(item2);
			}
			foreach (Thing item3 in list2)
			{
				EClass.pc.PickOrDrop(EClass.pc.pos, item3, msg: false);
				if (item3.GetRootCard().IsPC)
				{
					EClass.pc.body.Equip(item3, null, msg: false);
				}
			}
		}
		SE.Equip();
		return true;
	}
}
```

:::
## TraitRadio

[`@@ -5,7 +5,7 @@ public class TraitRadio : TraitItem`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/TraitRadio.cs#L5-L11)
```cs:line-numbers=5
	public List<string> ids = new List<string>
	{
		"none", "amb_fire", "amb_bbq", "amb_crowd", "amb_seagull", "amb_horror", "amb_pub", "amb_smelter", "amb_clockwork", "amb_dead",
		"amb_magic", "amb_fountain", "amb_clock", "amb_boat", "amb_waterfall" // [!code --]
		"amb_magic", "amb_fountain", "amb_clock", "amb_boat", "amb_waterfall", "amb_rag1", "amb_squeak1" // [!code ++]
	};

	public override string IDActorEx => owner.GetStr(52);
```

## WidgetMemo

[`@@ -5,6 +5,8 @@ public class WidgetMemo : Widget`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/WidgetMemo.cs#L5-L10)
```cs:line-numbers=5
{
	public static WidgetMemo Instance;

	public int id; // [!code ++]
 // [!code ++]
	public InputField input;

	public Window window;
```

[`@@ -23,7 +25,7 @@ public class WidgetMemo : Widget`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/WidgetMemo.cs#L23-L29)
```cs:line-numbers=23

	public override void OnActivate()
	{
		input.text = EMono.player.memo; // [!code --]
		input.text = ((id == 0) ? EMono.player.memo : EMono.player.memo2); // [!code ++]
		buttonEdit.SetOnClick(delegate
		{
			ToggleInput(!input.isFocused);
```

[`@@ -33,7 +35,7 @@ public override void OnActivate()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/WidgetMemo.cs#L33-L39)
```cs:line-numbers=33

	public override void OnDeactivate()
	{
		EMono.player.memo = input.text; // [!code --]
		SaveText(); // [!code ++]
	}

	public void ToggleInput(bool enable)
```

[`@@ -50,7 +52,19 @@ public void ToggleInput(bool enable)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/WidgetMemo.cs#L50-L56)
```cs:line-numbers=50

	public override void OnUpdateConfig()
	{
		EMono.player.memo = input.text; // [!code --]
		SaveText(); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void SaveText() // [!code ++]
	{ // [!code ++]
		if (id == 0) // [!code ++]
		{ // [!code ++]
			EMono.player.memo = input.text; // [!code ++]
		} // [!code ++]
		else // [!code ++]
		{ // [!code ++]
			EMono.player.memo2 = input.text; // [!code ++]
		} // [!code ++]
	}

	private void Update()
```

## WidgetSearch

[`@@ -134,22 +134,22 @@ public override void Search(string s)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/WidgetSearch.cs#L134-L155)
```cs:line-numbers=134
					newCards.Add(thing2);
				}
			}
			foreach (Card value in EMono._map.props.stocked.all.Values) // [!code --]
			foreach (Card item in EMono._map.props.stocked.all) // [!code ++]
			{
				if (!(value.parent is Thing { c_lockLv: <=0, IsContainer: not false })) // [!code --]
				if (!(item.parent is Thing { c_lockLv: <=0, IsContainer: not false })) // [!code ++]
				{
					continue;
				}
				if (encSearch)
				{
					if (value.MatchEncSearch(s)) // [!code --]
					if (item.MatchEncSearch(s)) // [!code ++]
					{
						newCards.Add(value); // [!code --]
						newCards.Add(item); // [!code ++]
					}
				}
				else if (value.Name.ToLower().Contains(s) || value.sourceCard.GetSearchName(jp: false).Contains(s)) // [!code --]
				else if (item.Name.ToLower().Contains(s) || item.sourceCard.GetSearchName(jp: false).Contains(s)) // [!code ++]
				{
					newCards.Add(value); // [!code --]
					newCards.Add(item); // [!code ++]
				}
			}
		}
```

## ZoneEvent

[`@@ -114,6 +114,10 @@ public void OnLoad(Zone _zone)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/159f709647b860115e5f642b13ffc6d1db511a95/Elin/ZoneEvent.cs#L114-L119)
```cs:line-numbers=114

	public void Kill()
	{
		if (zone == null) // [!code ++]
		{ // [!code ++]
			zone = EClass._zone; // [!code ++]
		} // [!code ++]
		zone.events.list.Remove(this);
		OnKill();
	}
```

## +Zone_Exile

::: details File Created
```cs
public class Zone_Exile : Zone_SubTown
{
}
```

:::
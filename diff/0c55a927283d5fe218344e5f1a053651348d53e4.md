---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 15 files modified.
version: EA 23.221 Nightly
changes: ActEffect/ActMissileBarrage/ActThrow/BaseSong/Card/Chara/Game/QuestCurry/QuestDebt/SerializedCards/StanceSongSleep/StanceSongValor/Stats/TraitSeed/Zone
---

# EA 23.221 Nightly

October 17, 2025

15 files modified.

## Important Changes

Possible breaking changes. Click the filename to view the chunk.
### [StanceSongSleep (2)](#stancesongsleep)
```cs:no-line-numbers
public override void OnStart() // [!code --]
public override void TickSong() // [!code ++]
```
```cs:no-line-numbers
public override void Tick() // [!code --]

```
### [StanceSongValor (2)](#stancesongvalor)
```cs:no-line-numbers
public override void OnStart() // [!code --]
public override void TickSong() // [!code ++]
```
```cs:no-line-numbers
public override void Tick() // [!code --]

```
### [Zone (2)](#zone)
```cs:no-line-numbers
public void SetBGM(List<int> ids, bool refresh = true) // [!code --]
public void SetBGM(List<int> ids, bool refresh = true, float fadeDuration = 0f) // [!code ++]
```
```cs:no-line-numbers
public void SetBGM(int id = -1, bool refresh = true) // [!code --]
public void SetBGM(int id = -1, bool refresh = true, float fadeDuration = 0f) // [!code ++]
```
## ActEffect

[`public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/ActEffect.cs#L783-L789)
```cs:line-numbers=783
	case EffectId.Rocket:
	case EffectId.Flare:
	{
		float radius = ((id == EffectId.Rocket) ? 3f : ((id == EffectId.Suicide) ? 3.5f : ((id == EffectId.Flare) ? 2.1f : ((float)((id == EffectId.BallBubble) ? 2 : 5))))); // [!code --]
		float radius = ((id == EffectId.Rocket) ? 2.8f : ((id == EffectId.Suicide) ? 3.5f : ((id == EffectId.Flare) ? 2.1f : ((float)((id == EffectId.BallBubble) ? 2 : 5))))); // [!code ++]
		if ((id == EffectId.Explosive || id == EffectId.Rocket) && actRef.refThing != null)
		{
			radius = 2 + actRef.refThing.Evalue(666);
```

## ActMissileBarrage

[`public override bool Perform()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/ActMissileBarrage.cs#L18-L37)
```cs:line-numbers=18
			}
		}
	}
	Act.CC.Say("abMissileBarrage", Act.CC); // [!code --]
	if (list.Count > 0)
	{
		Act.CC.Say("abMissileBarrage", Act.CC); // [!code ++]
		Act.CC.PlaySound("missile"); // [!code ++]
		Chara cC = Act.CC;
		foreach (Point item in list)
		{
			Act.CC = cC;
			Act.TP.Set(item);
			ActEffect.ProcAt(EffectId.Rocket, GetPower(Act.CC) / 2, BlessedState.Normal, Act.CC, null, Act.TP, isNeg: true, new ActRef // [!code --]
			ActEffect.ProcAt(EffectId.Rocket, GetPower(Act.CC), BlessedState.Normal, Act.CC, null, Act.TP, isNeg: true, new ActRef // [!code ++]
			{
				origin = Act.CC.Chara,
				aliasEle = "eleImpact"
			});
			ActEffect.RapidDelay = 0.05f; // [!code --]
			ActEffect.RapidDelay = 0.075f; // [!code ++]
			ActEffect.RapidCount++;
		}
	}
```

## ActThrow

[`public static EffectIRenderer Throw(Card c, Point p, Card target, Thing t, Throw`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/ActThrow.cs#L345-L352)
```cs:line-numbers=345
			c.ModExp(108, 100);
			if (traitMonsterBall.IsDuponneBall && EClass.game.quests.GetPhase<QuestNegotiationDarkness>() == 3)
			{
				EClass.Sound.StopBGM(3f); // [!code --]
				EClass._zone.SetBGM(1, refresh: false); // [!code --]
				EClass._zone.SetBGM(120, refresh: true, 3f); // [!code ++]
				EClass.game.quests.Get<QuestNegotiationDarkness>().NextPhase();
			}
		}
```

## BaseSong

[`public class BaseSong : BaseStance`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/BaseSong.cs#L1-L3)
```cs:line-numbers=1
public class BaseSong : BaseStance
{
	public override void OnStart() // [!code ++]
	{ // [!code ++]
		owner.ShowEmo(Emo.happy); // [!code ++]
		owner.mana.Validate(); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public override void Tick() // [!code ++]
	{ // [!code ++]
		if (!EClass._zone.IsRegion) // [!code ++]
		{ // [!code ++]
			if (owner.HasCondition<ConSilence>()) // [!code ++]
			{ // [!code ++]
				Kill(); // [!code ++]
			} // [!code ++]
			else // [!code ++]
			{ // [!code ++]
				TickSong(); // [!code ++]
			} // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public virtual void TickSong() // [!code ++]
	{ // [!code ++]
	} // [!code ++]
}
```

## Card

[`public virtual int GetPrice(CurrencyType currency = CurrencyType.Money, bool sel`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/Card.cs#L7293-L7298)
```cs:line-numbers=7293
		{
			p *= 0.20000000298023224;
		}
		if (isReplica) // [!code ++]
		{ // [!code ++]
			p *= 0.20000000298023224; // [!code ++]
		} // [!code ++]
		if (currency == CurrencyType.Money && (category.IsChildOf("meal") || category.IsChildOf("preserved")))
		{
			p *= 0.5;
```

## Chara

[`public void Refresh(bool calledRecursive = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/Chara.cs#L1738-L1744)
```cs:line-numbers=1738
	{
		base.isHidden = false;
	}
	visibleWithTelepathy = !IsUndead && !IsMachine && !IsHorror; // [!code --]
	visibleWithTelepathy = !IsUndead && !IsMachine && !IsHorror && !IsMultisize; // [!code ++]
	SetDirtySpeed();
	if (host != null && !calledRecursive && host.source != null)
	{
```

[`public void TryDropBossLoot()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/Chara.cs#L5514-L5522)
```cs:line-numbers=5514
		{
			EClass.player.stats.nefiaBeaten++;
			EClass._zone.GetTopZone().isConquered = true;
			EClass.Sound.StopBGM(2f); // [!code --]
			SE.Play("Jingle/fanfare2");
			EClass._zone.SetBGM(114); // [!code --]
			EClass._zone.SetBGM(114, refresh: true, 3f); // [!code ++]
		}
		EClass.player.ModFame(EClass.rndHalf(30 + EClass._zone.DangerLv * 2));
		EClass.player.ModKarma(5);
```

[`public void TryDropBossLoot()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/Chara.cs#L5538-L5545)
```cs:line-numbers=5538
		{
			num = 5;
			flag = (flag2 = true);
			EClass.Sound.StopBGM(3f); // [!code --]
			EClass._zone.SetBGM(1, refresh: false); // [!code --]
			EClass._zone.SetBGM(120, refresh: true, 3f); // [!code ++]
			if (EClass.game.quests.IsStarted<QuestNegotiationDarkness>() && EClass.game.quests.GetPhase<QuestNegotiationDarkness>() <= 3)
			{
				EClass.game.quests.Get<QuestNegotiationDarkness>().ChangePhase(4);
```

[`public void TryDropBossLoot()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/Chara.cs#L5552-L5559)
```cs:line-numbers=5552
		flag = (flag2 = true);
		if (EClass._zone is Zone_DungeonMino)
		{
			EClass.Sound.StopBGM(3f); // [!code --]
			EClass._zone.SetBGM(46, refresh: false); // [!code --]
			EClass._zone.SetBGM(46, refresh: true, 3f); // [!code ++]
		}
		break;
	case "melilith_boss":
```

## Game

[`public void OnLoad()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/Game.cs#L455-L460)
```cs:line-numbers=455
		}
	});
	TryAddQuest("into_darkness", "exile_kettle");
	if (version.IsBelow(0, 23, 221) && EClass.game.quests.IsCompleted("curry")) // [!code ++]
	{ // [!code ++]
		world.SendPackage(ThingGen.CreateParcel(null, ThingGen.CreateCassette(110))); // [!code ++]
	} // [!code ++]
	if (version.IsBelow(0, 23, 185))
	{
		player.resetPrincipal = true;
```

## QuestCurry

[`public class QuestCurry : QuestSequence`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/QuestCurry.cs#L2-L7)
```cs:line-numbers=2
{
	public override void OnComplete()
	{
		EClass.player.DropReward(ThingGen.CreateCassette(110), silent: true); // [!code ++]
		DropReward(TraitSeed.MakeSeed("redpepper").SetNum(3));
	}
}
```

## QuestDebt

[`public override void OnStart()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/QuestDebt.cs#L24-L32)
```cs:line-numbers=24
		chara.homeZone = EClass.pc.homeBranch.owner;
		chara.noMove = false;
		chara.RemoveEditorTag(EditorTag.Invulnerable);
		Thing thing = ThingGen.Create("856"); // [!code --]
		thing.refVal = 109; // [!code --]
		EClass.pc.Pick(thing); // [!code --]
		Thing t = ThingGen.CreateCassette(109); // [!code ++]
		EClass.pc.Pick(t); // [!code ++]
	}

	public override bool CanUpdateOnTalk(Chara c)
```

## SerializedCards

[`public string cText`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/SerializedCards.cs#L381-L386)
```cs:line-numbers=381
			}
		}

		public string cNote // [!code ++]
		{ // [!code ++]
			get // [!code ++]
			{ // [!code ++]
				return strs[9]; // [!code ++]
			} // [!code ++]
			set // [!code ++]
			{ // [!code ++]
				strs[9] = value; // [!code ++]
			} // [!code ++]
		} // [!code ++]
 // [!code ++]
		public bool isDead
		{
			get
```

[`public void Add(Card c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/SerializedCards.cs#L443-L449)
```cs:line-numbers=443
		idDeity = c.c_idDeity,
		isEmpty = (c.things.Count == 0 && c.c_lockLv == 0),
		encLv = c.encLV,
		cText = c.c_refText // [!code --]
		cText = c.c_refText, // [!code ++]
		cNote = c.c_note // [!code ++]
	};
	if (c.c_idBacker != 0)
	{
```

[`public void Restore(Map map, Map orgMap, bool addToZone, PartialMap partial = nu`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/SerializedCards.cs#L717-L722)
```cs:line-numbers=717
		card2.idSkin = card4.idSkin;
		card2.c_idDeity = card4.idDeity;
		card2.c_refText = card4.cText;
		card2.c_note = card4.cNote; // [!code ++]
		if (card4.idBacker != 0)
		{
			Debug.Log(card4.idBacker);
```

## StanceSongSleep

[``](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/StanceSongSleep.cs#L2-L30)
```cs:line-numbers=2

public class StanceSongSleep : BaseSong
{
	public override void OnStart() // [!code --]
	public override void TickSong() // [!code ++]
	{
		owner.ShowEmo(Emo.happy); // [!code --]
	} // [!code --]
 // [!code --]
	public override void Tick() // [!code --]
	{ // [!code --]
		if (owner.HasCondition<ConSilence>() || EClass._zone.IsRegion) // [!code --]
		{ // [!code --]
			return; // [!code --]
		} // [!code --]
		int num = 0; // [!code --]
		foreach (Chara item in owner.pos.ListCharasInRadius(owner, 4, (Chara c) => !c.IsDeadOrSleeping && c.IsHostile(owner)))
		{
			if ((item.IsPowerful ? 10 : 30) * Mathf.Min(base.power / 4, 100) / 100 > EClass.rnd(100))
			{
				item.AddCondition<ConSleep>(50 + base.power / 2);
			}
			num++; // [!code --]
		} // [!code --]
		if (num > 0) // [!code --]
		{ // [!code --]
			owner.mana.Mod(-(1 + owner.mana.max / 200)); // [!code --]
		}
	}
}
```

## StanceSongValor

[`public class StanceSongValor : BaseSong`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/StanceSongValor.cs#L1-L17)
```cs:line-numbers=1
public class StanceSongValor : BaseSong
{
	public override void OnStart() // [!code --]
	public override void TickSong() // [!code ++]
	{
		owner.ShowEmo(Emo.happy); // [!code --]
	} // [!code --]
 // [!code --]
	public override void Tick() // [!code --]
	{ // [!code --]
		if (owner.HasCondition<ConSilence>() || EClass._zone.IsRegion) // [!code --]
		{ // [!code --]
			return; // [!code --]
		} // [!code --]
		int num = 0; // [!code --]
		foreach (Chara item in owner.pos.ListCharasInRadius(owner, 4, (Chara c) => (c.IsDeadOrSleeping || !owner.IsPCFactionOrMinion) ? (!c.IsHostile(owner)) : c.IsPCFactionOrMinion))
		{
			if (!item.HasCondition<ConEuphoric>())
```

[`public override void Tick()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/StanceSongValor.cs#L22-L32)
```cs:line-numbers=22
			{
				item.AddCondition<ConHero>(base.power);
			}
			num++; // [!code --]
		} // [!code --]
		if (num > 0) // [!code --]
		{ // [!code --]
			owner.mana.Mod(-(1 + owner.mana.max / 200)); // [!code --]
		}
	}
}
```

## Stats

[`public virtual void Mod(int a)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/Stats.cs#L170-L175)
```cs:line-numbers=170
		}
	}

	public virtual void Validate() // [!code ++]
	{ // [!code ++]
		value = Mathf.Clamp(value, min, max); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public virtual void OnChangePhase(int phase, int lastPhase)
	{
		bool flag = phase > lastPhase;
```

## TraitSeed

[`public static SourceObj.Row GetRandomSeedObj()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/TraitSeed.cs#L201-L207)
```cs:line-numbers=201
{
	if (listSeeds == null)
	{
		listSeeds = EClass.sources.objs.rows.Where((SourceObj.Row s) => s.HasTag(CTAG.seed) && !s.HasTag(CTAG.rareSeed)).ToList(); // [!code --]
		listSeeds = EClass.sources.objs.rows.Where((SourceObj.Row s) => s.HasTag(CTAG.seed) && !s.HasTag(CTAG.rareSeed) && s.alias != "redpepper").ToList(); // [!code ++]
	}
	return listSeeds.RandomItemWeighted((SourceObj.Row a) => a.chance);
}
```

## Zone

[`public int GetElectricity(bool cost = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/Zone.cs#L2906-L2912)
```cs:line-numbers=2906
		return sum;
	}

	public void SetBGM(List<int> ids, bool refresh = true) // [!code --]
	public void SetBGM(List<int> ids, bool refresh = true, float fadeDuration = 0f) // [!code ++]
	{
		map._plDay.Clear();
		if (ids.Count > 0)
```

[`public void SetBGM(List<int> ids, bool refresh = true)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/0c55a927283d5fe218344e5f1a053651348d53e4/Elin/Zone.cs#L2922-L2937)
```cs:line-numbers=2922
		UnityEngine.Object.DestroyImmediate(map.plDay);
		map.plDay = null;
		RefreshPlaylist();
		if (refresh) // [!code --]
		if (!refresh) // [!code ++]
		{ // [!code ++]
			return; // [!code ++]
		} // [!code ++]
		if (fadeDuration > 0f) // [!code ++]
		{ // [!code ++]
			EClass.Sound.StopBGM(fadeDuration, playLastBGM: false, delegate // [!code ++]
			{ // [!code ++]
				if (EClass.core.IsGameStarted && EClass.game.activeZone == this) // [!code ++]
				{ // [!code ++]
					RefreshBGM(); // [!code ++]
				} // [!code ++]
			}); // [!code ++]
		} // [!code ++]
		else // [!code ++]
		{
			EClass.Sound.StopBGM();
			RefreshBGM();
		}
	}

	public void SetBGM(int id = -1, bool refresh = true) // [!code --]
	public void SetBGM(int id = -1, bool refresh = true, float fadeDuration = 0f) // [!code ++]
	{
		SetBGM(new List<int> { id }, refresh); // [!code --]
		SetBGM(new List<int> { id }, refresh, fadeDuration); // [!code ++]
	}

	public void RefreshPlaylist()
```

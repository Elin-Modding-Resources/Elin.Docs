---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 23 files modified.
version: EA 23.278 Nightly
changes: AI_Fish/AI_Fuck/AI_Idle/ActEffect/ActZap/Affinity/BaseSong/Chara/FactionBranch/FoodEffect/GoalCombat/ID_Achievement/LoveData/Player/SerializedCards/StanceSongEnd/StanceSongSleep/StanceSongValor/TraitAltar/TraitFloorSwitch/TraitMannequin/TraitSwitch/TraitWell
---

# EA 23.278 Nightly

February 27, 2026

23 files modified.

## Important Changes

**None.**
## AI_Fish

[`public override void OnProgressComplete()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/AI_Fish.cs#L113-L119)
```cs:line-numbers=113
		{
			thing.isHidden = false;
		}
		if (owner.IsPC) // [!code --]
		if (EClass.rnd(EClass.debug.enable ? 2 : 100) == 0 && thing.category.IsChildOf("fish")) // [!code ++]
		{ // [!code ++]
			owner.Say("fish_ehe"); // [!code ++]
			owner.Say("fish_ehe2"); // [!code ++]
			owner.PlaySound("escape"); // [!code ++]
			owner.PlayEffect("fizzle"); // [!code ++]
			thing.Destroy(); // [!code ++]
			if (owner.IsPC) // [!code ++]
			{ // [!code ++]
				EClass.player.flags.fishStolen++; // [!code ++]
				Steam.GetAchievement(ID_Achievement.EHE_FISH); // [!code ++]
			} // [!code ++]
		} // [!code ++]
		else if (owner.IsPC) // [!code ++]
		{
			if (EClass.game.config.preference.pickFish)
			{
```

## AI_Fuck

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/AI_Fuck.cs#L160-L165)
```cs:line-numbers=160
				}
				break;
			}
			if (((cc.HasElement(1216) || tc.HasElement(1216)) ? 100 : 20) > EClass.rnd(100)) // [!code ++]
			{ // [!code ++]
				((EClass.rnd(2) == 0) ? cc : tc).PlayEffect("love2"); // [!code ++]
			} // [!code ++]
			if (variation == Variation.Slime)
			{
				owner.DoHostileAction(target);
```

## AI_Idle

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/AI_Idle.cs#L586-L592)
```cs:line-numbers=586
				num = EClass.rnd(EClass.rnd(EClass.rnd(EClass.rnd(500)))) + 1;
				string[] strs = new string[4] { "1294", "1294", "1130", "1131" };
				ThrowMethod throwMethod = ThrowMethod.Reward;
				if (owner.affinity.CurrentStage <= Affinity.Stage.Hate || owner.IsMarried || (EClass.debug.enable && EClass.rnd(10) == 0)) // [!code --]
				if (owner.affinity.IsWeddingHater || owner.IsMarried || (EClass.debug.enable && EClass.rnd(10) == 0)) // [!code ++]
				{
					owner.Talk("curse_wed");
					throwMethod = ThrowMethod.Punish;
```

## ActEffect

[`void AddCon<T>(int rate, int power) where T : Condition`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/ActEffect.cs#L2313-L2318)
```cs:line-numbers=2313
		TC.Say("heal_jure", TC);
		break;
	case EffectId.Headpat:
		CC.PlaySound("headpat"); // [!code ++]
		CC.Cuddle(TC, headpat: true);
		break;
	case EffectId.RemoveHex:
```

## ActZap

[`public override bool Perform()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/ActZap.cs#L23-L30)
```cs:line-numbers=23
		Act.CC.RemoveCondition<ConInvisibility>();
		Act.TC = Act.CC;
		EffectId idEffect = trait.IdEffect;
		int power = trait.Power * (100 + Act.CC.Evalue(305) * 10 + Act.CC.MAG / 2 + Act.CC.PER / 2) / 100; // [!code --]
		ActEffect.ProcAt(idEffect, power, trait.owner.blessedState, Act.CC, null, Act.TP, trait.IsNegative, new ActRef // [!code --]
		long a = trait.Power * (100 + (long)Act.CC.Evalue(305) * 10L + Act.CC.MAG / 2 + Act.CC.PER / 2) / 100; // [!code ++]
		ActEffect.ProcAt(idEffect, MathEx.Min(a), trait.owner.blessedState, Act.CC, null, Act.TP, trait.IsNegative, new ActRef // [!code ++]
		{
			refThing = trait.owner.Thing,
			aliasEle = trait.aliasEle,
```

## Affinity

[`public enum Stage`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/Affinity.cs#L33-L38)
```cs:line-numbers=33

	public string Name => Lang.GetList("affinity").TryGet(list.IndexOf(this), list.Count - 1);

	public bool IsWeddingHater => CurrentStage <= Stage.Hate; // [!code ++]
 // [!code ++]
	public static Affinity Get(Chara c)
	{
		CC = c;
```

## BaseSong

[`public class BaseSong : BaseStance`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/BaseSong.cs#L1-L5)
```cs:line-numbers=1
public class BaseSong : BaseStance
{
	public virtual int IdAbility => -1; // [!code ++]
 // [!code ++]
	public override void OnStart()
	{
		owner.ShowEmo(Emo.happy);
```

[`public override void OnStart()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/BaseSong.cs#L8-L24)
```cs:line-numbers=8

	public override void Tick()
	{
		if (!EClass._zone.IsRegion) // [!code --]
		if (EClass._zone.IsRegion) // [!code ++]
		{ // [!code ++]
			return; // [!code ++]
		} // [!code ++]
		if (owner.HasCondition<ConSilence>()) // [!code ++]
		{ // [!code ++]
			Kill(); // [!code ++]
			return; // [!code ++]
		} // [!code ++]
		Element element = owner.elements.GetElement(IdAbility); // [!code ++]
		if (element != null) // [!code ++]
		{
			if (owner.HasCondition<ConSilence>()) // [!code --]
			{ // [!code --]
				Kill(); // [!code --]
			} // [!code --]
			else // [!code --]
			{ // [!code --]
				TickSong(); // [!code --]
			} // [!code --]
			owner.elements.ModExp(element.id, 20f); // [!code ++]
		}
		TickSong(); // [!code ++]
	}

	public virtual void TickSong()
```

## Chara

[`public void ShowDialog()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/Chara.cs#L7209-L7215)
```cs:line-numbers=7209
		}
		if (EClass._zone is Zone_Music || EClass._zone is Zone_Wedding)
		{
			ShowDialog("_chara", (!(EClass._zone is Zone_Wedding)) ? "party" : (IsPCParty ? "wedding_love" : "wedding")); // [!code --]
			string step = ((!(EClass._zone is Zone_Wedding)) ? "party" : (IsPCParty ? "wedding_love" : ((IsMarried || affinity.IsWeddingHater) ? "wedding_hater" : "wedding"))); // [!code ++]
			if (EClass._zone is Zone_Wedding && IsPCParty && base.c_love != null && !base.c_love.gaveCutter) // [!code ++]
			{ // [!code ++]
				step = "wedding_cutter"; // [!code ++]
				EClass.player.DropReward(ThingGen.Create("dagger_cakecutter")); // [!code ++]
				base.c_love.gaveCutter = true; // [!code ++]
			} // [!code ++]
			ShowDialog("_chara", step); // [!code ++]
			return;
		}
		if (EClass.game.quests.OnShowDialog(this))
```

## FactionBranch

[`public void AddMemeber(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/FactionBranch.cs#L1480-L1488)
```cs:line-numbers=1480
		{
			uidMaid = c.uid;
		}
		if (c.id == "lomias") // [!code --]
		switch (c.id) // [!code ++]
		{
		case "lomias": // [!code ++]
			Steam.GetAchievement(ID_Achievement.LOMIAS2);
			break; // [!code ++]
		case "larnneire": // [!code ++]
			Steam.GetAchievement(ID_Achievement.LARNNEIRE2); // [!code ++]
			break; // [!code ++]
		case "melilith": // [!code ++]
			Steam.GetAchievement(ID_Achievement.MELILITH); // [!code ++]
			break; // [!code ++]
		}
	}

```

## FoodEffect

[`public static void Proc(Chara c, Thing food, bool consume = true)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/FoodEffect.cs#L403-L408)
```cs:line-numbers=403
	}
	if (!c2.IsCat && food.trait is TraitFoodChuryu)
	{
		int num10 = 0; // [!code ++]
		foreach (Chara item in c2.pos.ListCharasInRadius(c2, 5, (Chara c) => c.IsCat))
		{
			item.Say("angry", item);
```

[`public static void Proc(Chara c, Thing food, bool consume = true)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/FoodEffect.cs#L412-L417)
```cs:line-numbers=412
			{
				EClass.player.ModKarma(-3);
			}
			num10++; // [!code ++]
		} // [!code ++]
		EClass.player.stats.angryCats += num10; // [!code ++]
		Debug.Log(num10 + "/" + EClass.player.stats.angryCats); // [!code ++]
		if (num10 >= 10) // [!code ++]
		{ // [!code ++]
			Steam.GetAchievement(ID_Achievement.CHURYU); // [!code ++]
		}
	}
	if (c2.IsPC && EClass._zone is Zone_Lothria)
```

## GoalCombat

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/GoalCombat.cs#L176-L182)
```cs:line-numbers=176
			owner.PlaySound("boost");
			owner.ShowEmo(Emo.love);
			owner.lastEmo = Emo.angry;
			owner.MakeMinion(tc.IsPCParty ? EClass.pc : tc); // [!code --]
			owner.MakeMinion(tc); // [!code ++]
			yield return Success();
		}
		if (EClass.rnd(5) == 0 && tc.HasElement(1325) && owner.IsPlant && owner.CanBeTempAlly(tc))
```

## ID_Achievement

[`public enum ID_Achievement`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/ID_Achievement.cs#L8-L12)
```cs:line-numbers=8
	PUTIT,
	ASHLAND_PIE,
	JURE_WATER,
	WINDOW_CHARM // [!code --]
	WINDOW_CHARM, // [!code ++]
	EHE_FISH, // [!code ++]
	CHURYU, // [!code ++]
	MELILITH, // [!code ++]
	LARNNEIRE, // [!code ++]
	LARNNEIRE2 // [!code ++]
}
```

## LoveData

[`public class LoveData : EClass`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/LoveData.cs#L14-L18)
```cs:line-numbers=14
	[JsonProperty]
	public string nameZoneMarriage;

	[JsonProperty] // [!code ++]
	public bool gaveCutter; // [!code ++]
 // [!code ++]
	public bool IsWed => dateWedding != 0;
}
```

## Player

[`public class Stats : EClass`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/Player.cs#L131-L136)
```cs:line-numbers=131
		[JsonProperty]
		public int divorced;

		[JsonProperty] // [!code ++]
		public int angryCats; // [!code ++]
 // [!code ++]
		[JsonProperty]
		public long shipMoney;

```

[`public int reward_killkill`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/Player.cs#L709-L714)
```cs:line-numbers=709
			}
		}

		public int fishStolen // [!code ++]
		{ // [!code ++]
			get // [!code ++]
			{ // [!code ++]
				return ints[21]; // [!code ++]
			} // [!code ++]
			set // [!code ++]
			{ // [!code ++]
				ints[21] = value; // [!code ++]
			} // [!code ++]
		} // [!code ++]
 // [!code ++]
		[OnSerializing]
		private void _OnSerializing(StreamingContext context)
		{
```

## SerializedCards

[`public void Restore(Map map, Map orgMap, bool addToZone, PartialMap partial = nu`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/SerializedCards.cs#L859-L864)
```cs:line-numbers=859
			}
			card2.c_IDTState = card4.idtState;
		}
		else if (card2.trait is TraitMannequin) // [!code ++]
		{ // [!code ++]
			card2.c_lockLv = 1; // [!code ++]
		} // [!code ++]
		if (card2.isChara)
		{
			card2.Chara.homeZone = EClass._zone;
```

## StanceSongEnd

[``](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/StanceSongEnd.cs#L2-L7)
```cs:line-numbers=2

public class StanceSongEnd : BaseSong
{
	public override int IdAbility => 6753; // [!code ++]
 // [!code ++]
	public override void TickSong()
	{
		foreach (Chara item in owner.pos.ListCharasInRadius(owner, 4, (Chara c) => !c.IsDeadOrSleeping && c.IsHostile(owner)))
```

## StanceSongSleep

[``](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/StanceSongSleep.cs#L2-L7)
```cs:line-numbers=2

public class StanceSongSleep : BaseSong
{
	public override int IdAbility => 6750; // [!code ++]
 // [!code ++]
	public override void TickSong()
	{
		foreach (Chara item in owner.pos.ListCharasInRadius(owner, 4, (Chara c) => !c.IsDeadOrSleeping && c.IsHostile(owner)))
```

## StanceSongValor

[`public class StanceSongValor : BaseSong`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/StanceSongValor.cs#L1-L5)
```cs:line-numbers=1
public class StanceSongValor : BaseSong
{
	public override int IdAbility => 6752; // [!code ++]
 // [!code ++]
	public override void TickSong()
	{
		foreach (Chara item in owner.pos.ListCharasInRadius(owner, 4, (Chara c) => (c.IsDeadOrSleeping || !owner.IsPCFactionOrMinion) ? (!c.IsHostile(owner)) : c.IsPCFactionOrMinion))
```

## TraitAltar

[`public void _OnOffer(Chara c, Thing t, int takeoverMod = 0)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/TraitAltar.cs#L251-L261)
```cs:line-numbers=251
	int value = orCreateElement.Value;
	c.elements.ModExp(orCreateElement.id, offeringValue * 2 / 3);
	int num2 = 4;
	if (orCreateElement.vBase >= num) // [!code --]
	{ // [!code --]
		c.elements.SetBase(orCreateElement.id, num); // [!code --]
	} // [!code --]
	else // [!code --]
	if (orCreateElement.vBase < num) // [!code ++]
	{
		num2 = Mathf.Clamp(orCreateElement.vBase * 100 / num / 25, 0, 3);
	}
```

## TraitFloorSwitch

[`public override void OnStepped(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/TraitFloorSwitch.cs#L9-L15)
```cs:line-numbers=9
		{
			owner.Say("levitating");
		}
		else if (!CanDisarmTrap || (!TryDisarmTrap(c) && EClass.pc.Evalue(1656) < 3)) // [!code --]
		else if (!CanDisarmTrap || (!TryDisarmTrap(c) && (!c.IsPCFactionOrMinion || EClass.pc.Evalue(1656) < 3))) // [!code ++]
		{
			ActivateTrap(c);
		}
```

## TraitMannequin

[`public class TraitMannequin : TraitItem`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/TraitMannequin.cs#L8-L14)
```cs:line-numbers=8

	public override bool CanUseContent => false;

	public override bool UseAltTiles => owner.things.Count > 0; // [!code --]
	public override bool UseAltTiles // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			if (owner.things.Count <= 0) // [!code ++]
			{ // [!code ++]
				return owner.c_lockLv != 0; // [!code ++]
			} // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
	} // [!code ++]

	public override bool CanUseFromInventory => false;

```

## TraitSwitch

[`public bool TryDisarmTrap(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/TraitSwitch.cs#L59-L69)
```cs:line-numbers=59
		c.Say("disarm_success", c, owner);
		owner.PlaySound("disarm");
		c.ModExp(293, 50 + TrapLv);
		int num = (EClass.debug.enable ? 10 : EClass.pc.Evalue(1656)); // [!code --]
		if (!c.IsPCParty) // [!code --]
		{ // [!code --]
			num = 0; // [!code --]
		} // [!code --]
		int num = (EClass.debug.enable ? 10 : (c.IsPCFactionOrMinion ? EClass.pc.Evalue(1656) : 0)); // [!code ++]
		if (!IsLaidByDog && num > 0 && num + 2 > EClass.rnd(10))
		{
			string id = "scrap";
```

[`public bool TryDisarmTrap(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/TraitSwitch.cs#L106-L112)
```cs:line-numbers=106
	c.Say("disarm_fail", c, owner);
	c.PlaySound("disarm_fail");
	c.ModExp(293, 20 + TrapLv / 3);
	if (c.IsPCFaction) // [!code --]
	if (c.IsPCParty) // [!code ++]
	{
		int @int = owner.GetInt(60);
		owner.SetInt(60, @int + 1);
```

## TraitWell

[`public override void TrySetAct(ActPlan p)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/a2b913dc2a96530a79ef9e153eec9cd205de7acf/Elin/TraitWell.cs#L109-L115)
```cs:line-numbers=109
			if (EClass.player.CountKeyItem("well_wish") > 0)
			{
				EClass.player.ModKeyItem("well_wish", -1);
				ActEffect.Proc(EffectId.Wish, EClass.pc, null, 50 + EClass.player.CountKeyItem("well_enhance") * 50); // [!code --]
				ActEffect.Proc(EffectId.Wish, EClass.pc, null, 50 + EClass.player.CountKeyItem("well_enhance") * 50 + EClass.player.flags.fishStolen * 20); // [!code ++]
				EClass.player.wellWished = true;
			}
			else
```

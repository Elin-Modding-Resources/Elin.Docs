---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 5 files modified.
version: EA 23.254 Nightly Patch 1
changes: Chara/RecipeManager/RecipeSource/Thing/TraitGiftNewYear
---

# EA 23.254 Nightly Patch 1

January 2, 2026

5 files modified.

## Important Changes

**None.**
## Chara

[`public bool UseAbility(Act a, Card tc = null, Point pos = null, bool pt = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65fd64d58368177c4e3f66202a8d8e69b0ae8824/Elin/Chara.cs#L6007-L6013)
```cs:line-numbers=6007
	switch (cost.type)
	{
	case Act.CostType.MP:
		if (Evalue(1421) >= 2 && base.hp <= MaxHP / (9 - Evalue(1421) * 2)) // [!code --]
		if (Evalue(1421) >= 2 && base.hp <= MaxHP / Mathf.Max(1, 9 - Evalue(1421) * 2)) // [!code ++]
		{
			num6 /= 2;
		}
```

## RecipeManager

[`public static RecipeSource GetUnlearnedRecipe(int lvBonus, string cat, bool only`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65fd64d58368177c4e3f66202a8d8e69b0ae8824/Elin/RecipeManager.cs#L308-L314)
```cs:line-numbers=308
	List<RecipeSource> list = new List<RecipeSource>();
	foreach (RecipeSource item in RecipeManager.list)
	{
		if (!item.alwaysKnown && (item.NeedFactory || item.IsQuickCraft) && (cat == null || item.row.Category.IsChildOf(cat)) && (!onlyUnlearned || !EClass.player.recipes.knownRecipes.ContainsKey(item.id)) && EClass.pc.Evalue(item.GetReqSkill().id) + 5 + lvBonus >= item.row.LV && !item.row.ContainsTag("hiddenRecipe")) // [!code --]
		if (!item.alwaysKnown && !item.noRandomRecipe && (item.NeedFactory || item.IsQuickCraft) && (cat == null || item.row.Category.IsChildOf(cat)) && (!onlyUnlearned || !EClass.player.recipes.knownRecipes.ContainsKey(item.id)) && EClass.pc.Evalue(item.GetReqSkill().id) + 5 + lvBonus >= item.row.LV && !item.row.ContainsTag("hiddenRecipe")) // [!code ++]
		{
			list.Add(item);
		}
```

[`public static RecipeSource GetLearnedRecipe(string cat = null)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65fd64d58368177c4e3f66202a8d8e69b0ae8824/Elin/RecipeManager.cs#L322-L328)
```cs:line-numbers=322
	foreach (string key in EClass.player.recipes.knownRecipes.Keys)
	{
		RecipeSource recipeSource = Get(key);
		if (recipeSource != null && recipeSource.row is SourceThing.Row && (recipeSource.NeedFactory || recipeSource.IsQuickCraft) && (cat == null || recipeSource.row.Category.IsChildOf(cat))) // [!code --]
		if (recipeSource != null && recipeSource.row is SourceThing.Row && !recipeSource.noRandomRecipe && (recipeSource.NeedFactory || recipeSource.IsQuickCraft) && (cat == null || recipeSource.row.Category.IsChildOf(cat))) // [!code ++]
		{
			list.Add(recipeSource);
		}
```

## RecipeSource

[`public class RecipeSource : EClass`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65fd64d58368177c4e3f66202a8d8e69b0ae8824/Elin/RecipeSource.cs#L22-L27)
```cs:line-numbers=22

	public bool alwaysKnown;

	public bool noRandomRecipe; // [!code ++]
 // [!code ++]
	public static List<Recipe.Ingredient> DefaultIngredients = new List<Recipe.Ingredient>
	{
		new Recipe.Ingredient
```

[`public Element GetReqSkill()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65fd64d58368177c4e3f66202a8d8e69b0ae8824/Elin/RecipeSource.cs#L134-L142)
```cs:line-numbers=134
	{
		return DefaultIngredients;
	}
	if (row.recipeKey.Length != 0 && row.recipeKey[0] == "*") // [!code --]
	if (row.recipeKey.Length != 0) // [!code ++]
	{
		alwaysKnown = true; // [!code --]
		if (row.recipeKey[0] == "*") // [!code ++]
		{ // [!code ++]
			alwaysKnown = true; // [!code ++]
		} // [!code ++]
		else if (row.recipeKey[0] == "-") // [!code ++]
		{ // [!code ++]
			noRandomRecipe = true; // [!code ++]
		} // [!code ++]
	}
	string[] components = row.components;
	List<Recipe.Ingredient> list = new List<Recipe.Ingredient>();
```

[`public Element GetReqSkill()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65fd64d58368177c4e3f66202a8d8e69b0ae8824/Elin/RecipeSource.cs#L162-L171)
```cs:line-numbers=162
					array3[0] = array3[0].Remove(0, 1);
					break;
				case '+':
					goto IL_0142; // [!code --]
					goto IL_0164; // [!code ++]
				}
				break;
				IL_0142: // [!code --]
				IL_0164: // [!code ++]
				optional = true;
				array3[0] = array3[0].Remove(0, 1);
			}
```

## Thing

[`public override void OnCreate(int genLv)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65fd64d58368177c4e3f66202a8d8e69b0ae8824/Elin/Thing.cs#L277-L288)
```cs:line-numbers=277
				{
					AddSocket();
				}
				for (int k = 0; k < EClass.rnd(num2 + 1); k++) // [!code --]
				if (!bp.isCraft) // [!code ++]
				{
					Tuple<SourceElement.Row, int> enchant = GetEnchant(genLv, (SourceElement.Row r) => r.tag.Contains("modRanged"), neg: false); // [!code --]
					if (enchant != null && InvOwnerMod.IsValidRangedMod(this, enchant.Item1)) // [!code --]
					for (int k = 0; k < EClass.rnd(num2 + 1); k++) // [!code ++]
					{
						ApplySocket(enchant.Item1.id, enchant.Item2); // [!code --]
						Tuple<SourceElement.Row, int> enchant = GetEnchant(genLv, (SourceElement.Row r) => r.tag.Contains("modRanged"), neg: false); // [!code ++]
						if (enchant != null && InvOwnerMod.IsValidRangedMod(this, enchant.Item1)) // [!code ++]
						{ // [!code ++]
							ApplySocket(enchant.Item1.id, enchant.Item2); // [!code ++]
						} // [!code ++]
					}
				}
			}
```

## TraitGiftNewYear

[`public override bool OnUse(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65fd64d58368177c4e3f66202a8d8e69b0ae8824/Elin/TraitGiftNewYear.cs#L11-L16)
```cs:line-numbers=11
	SE.Play("dropReward");
	EClass.pc.Pick(ThingGen.Create("kagamimochi"));
	EClass.pc.Pick(ThingGen.Create("1134"));
	EClass.pc.Pick(ThingGen.CreateRecipe("1310")); // [!code ++]
	Chara chara = CharaGen.Create("putty_snow");
	EClass._zone.AddCard(chara, (owner.ExistsOnMap ? owner.pos : EClass.pc.pos).GetNearestPoint(allowBlock: false, allowChara: false));
	Msg.Say("package_chara", chara, owner);
```

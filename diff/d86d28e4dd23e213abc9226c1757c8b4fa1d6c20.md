---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 31 files modified. 1 new file created.
version: EA 23.75
changes: AI_PlayMusic/ActEffect/ActMelee/BackerContent/BaseListPeople/Card/CardRenderer/Chara/CharaRenderer/CoreRef/DramaActor/DropdownGrid/FactionBranch/LayerInventory/POLICY/Recipe/RecipeManager/SKILL/SerializedCards/SourceThingV/StatsHygiene/StatsMana/Trait/TraitBaseSpellbook/TraitCanvas/TraitDrawingPaper/TraitFoodEggFertilized/+TraitFoodPreparedPackage/TraitWrench/WindowChara/ZonePreEnterEncounter/Zone_Tent
---

# EA 23.75

January 11, 2025

31 files modified. 1 new file created.

## Important Changes

**None.**
## AI_PlayMusic

[`@@ -65,7 +65,7 @@ public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/AI_PlayMusic.cs#L65-L71)
```cs:line-numbers=65
	{
		yield return DoGoto(tool.pos, tool.pos.IsBlocked ? 1 : 0);
	}
	if (owner.IsPCC && EClass.game.config.preference.keepPlayingMusic) // [!code --]
	if (owner.IsPC && EClass.game.config.preference.keepPlayingMusic) // [!code ++]
	{
		keepPlaying = true;
		playingTool = tool;
```

## ActEffect

[`@@ -534,7 +534,8 @@ public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/ActEffect.cs#L534-L540)
```cs:line-numbers=534
			}
			chara2 = actRef.n1 switch
			{
				"yeek" => CharaGen.CreateFromFilter(SpawnListChara.Get("yeek", (SourceChara.Row r) => r.race == "yeek"), power / 10),  // [!code --]
				"yeek" => CharaGen.CreateFromFilter(SpawnListChara.Get("summon_yeek", (SourceChara.Row r) => r.race == "yeek"), power / 10),  // [!code ++]
				"orc" => CharaGen.CreateFromFilter(SpawnListChara.Get("summon_orc", (SourceChara.Row r) => r.race == "orc"), power / 10),  // [!code ++]
				"pawn" => CharaGen.CreateFromFilter("c_pawn", power / 10), 
				"monster" => CharaGen.CreateFromFilter("c_dungeon", power / 10), 
				"animal" => CharaGen.CreateFromFilter("c_animal", power / 15), 
```

## ActMelee

[`@@ -153,7 +153,11 @@ public bool Attack(float dmgMulti = 1f, bool maxRoll = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/ActMelee.cs#L153-L159)
```cs:line-numbers=153
			{
				if (!item.Equals(obj))
				{
					item.FirstChara?.IsHostile(Act.CC); // [!code --]
					Chara firstChara = item.FirstChara; // [!code ++]
					if (firstChara != null && firstChara.IsHostile(Act.CC)) // [!code ++]
					{ // [!code ++]
						Attack(firstChara, item); // [!code ++]
					} // [!code ++]
				}
			}
		}
```

## BackerContent

[`@@ -25,7 +25,7 @@ public static void GakiConvert(ref string text, string idLang = "zako")`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/BackerContent.cs#L25-L31)
```cs:line-numbers=25
		{
			text = idLang.lang().Split(',').RandomItem() + " (" + text + ")";
		}
		else if (idLang == "mokyu") // [!code --]
		else if (idLang == "mokyu" || idLang == "babu") // [!code ++]
		{
			text = idLang.lang().Split(',').RandomItem() + " " + text;
		}
```

## BaseListPeople

[`@@ -109,11 +109,11 @@ public override void OnInstantiate(Chara a, ItemGeneral b)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/BaseListPeople.cs#L109-L119)
```cs:line-numbers=109
			t.note.AddHeader("infoWork".lang((roomWork != null) ? roomWork.Name : "none".lang()));
			foreach (Hobby item2 in a.ListWorks())
			{
				AddText(item2, "work"); // [!code --]
				AddText(item2, "work", a.source.works.Contains(item2.source.alias)); // [!code ++]
			}
			foreach (Hobby item3 in a.ListHobbies())
			{
				AddText(item3, "hobby"); // [!code --]
				AddText(item3, "hobby", a.source.hobbies.Contains(item3.source.alias)); // [!code ++]
			}
			t.note.Build();
			_ = roomWork;
```

[`@@ -162,24 +162,29 @@ public override void OnInstantiate(Chara a, ItemGeneral b)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/BaseListPeople.cs#L162-L185)
```cs:line-numbers=162
	{
		b.gameObject.AddComponent<CanvasGroup>().alpha = 0.6f;
	}
	void AddText(Hobby h, string lang) // [!code --]
	void AddText(Hobby h, string lang, bool fix) // [!code ++]
	{
		int efficiency = h.GetEfficiency(a);
		string text = h.Name.TagColor((efficiency == 0) ? FontColor.Warning : FontColor.Good); // [!code --]
		string text = h.Name; // [!code ++]
		if (fix) // [!code ++]
		{ // [!code ++]
			text += "*"; // [!code ++]
		} // [!code ++]
		text = text.TagColor((efficiency == 0) ? FontColor.Warning : FontColor.Good); // [!code ++]
		string[] array = Lang.GetList("work_lv");
		string text2 = array[Mathf.Clamp(efficiency / 50, (efficiency != 0) ? 1 : 0, array.Length - 1)];
		P_2.t.note.AddTopic("TopicLeft", lang.lang(), text + " (" + text2 + ")"); // [!code --]
		P_3.t.note.AddTopic("TopicLeft", lang.lang(), text + " (" + text2 + ")"); // [!code ++]
		if (!h.source.destTrait.IsEmpty())
		{
			bool flag2 = EClass._map.FindThing(Type.GetType("Trait" + h.source.destTrait + ", Elin"), a) != null;
			List<CardRow> obj = EClass.sources.cards.rows.Where((CardRow t) => t.trait.Length != 0 && Type.GetType("Trait" + h.source.destTrait).IsAssignableFrom(Type.GetType("Trait" + t.trait[0]))).ToList();
			obj.Sort((CardRow a, CardRow b) => a.LV - b.LV);
			CardRow cardRow = obj[0];
			P_2.t.note.AddText("NoteText_small", "・ " + "workDestTrait".lang(cardRow.GetName().ToTitleCase().TagColor(flag2 ? FontColor.Good : FontColor.Warning))); // [!code --]
			P_3.t.note.AddText("NoteText_small", "・ " + "workDestTrait".lang(cardRow.GetName().ToTitleCase().TagColor(flag2 ? FontColor.Good : FontColor.Warning))); // [!code ++]
		}
		if (efficiency == 0)
		{
			P_2.t.note.AddText("NoteText_small", "・ " + "workNotActive".lang()); // [!code --]
			P_3.t.note.AddText("NoteText_small", "・ " + "workNotActive".lang()); // [!code ++]
		}
		else
		{
```

[`@@ -188,7 +193,7 @@ void AddText(Hobby h, string lang)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/BaseListPeople.cs#L188-L194)
```cs:line-numbers=188
				int num = Mathf.Max(1, h.source.things[i + 1].ToInt() * efficiency * a.homeBranch.GetProductBonus(a) / 100 / 1000);
				string text3 = h.source.things[i];
				string s = (text3.StartsWith("#") ? EClass.sources.categories.map[text3.Replace("#", "")].GetName() : EClass.sources.cards.map[h.source.things[i]].GetName());
				P_2.t.note.AddText("NoteText_small", "・ " + "work_produce".lang(s.ToTitleCase(), num.ToString() ?? "")); // [!code --]
				P_3.t.note.AddText("NoteText_small", "・ " + "work_produce".lang(s.ToTitleCase(), num.ToString() ?? "")); // [!code ++]
			}
			if (!h.source.elements.IsEmpty())
			{
```

[`@@ -197,7 +202,7 @@ void AddText(Hobby h, string lang)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/BaseListPeople.cs#L197-L203)
```cs:line-numbers=197
					SourceElement.Row row = EClass.sources.elements.map[h.source.elements[j]];
					int num2 = h.source.elements[j + 1];
					int num3 = ((num2 < 0 || row.id == 2115 || row.id == 2207) ? (num2 / 10) : Mathf.Max(0, num2 * h.GetEfficiency(a) * a.homeBranch.efficiency / 100 / 1000));
					P_2.t.note.AddText("NoteText_small", "・ " + "workBonus_skill".lang(row.GetName().ToTitleCase(), ((num2 > 0) ? "+" : "") + num3) + ((row.id == 2115 || row.id == 2207) ? (" " + "fixedFactionSkill".lang()) : ""), (num2 >= 0) ? FontColor.Default : FontColor.Bad); // [!code --]
					P_3.t.note.AddText("NoteText_small", "・ " + "workBonus_skill".lang(row.GetName().ToTitleCase(), ((num2 > 0) ? "+" : "") + num3) + ((row.id == 2115 || row.id == 2207) ? (" " + "fixedFactionSkill".lang()) : ""), (num2 >= 0) ? FontColor.Default : FontColor.Bad); // [!code ++]
				}
			}
			string[] array2 = h.source.GetDetail().SplitNewline();
```

[`@@ -205,11 +210,11 @@ void AddText(Hobby h, string lang)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/BaseListPeople.cs#L205-L215)
```cs:line-numbers=205
				{
					if (!text4.IsEmpty())
					{
						P_2.t.note.AddText("NoteText_small", "・ " + text4); // [!code --]
						P_3.t.note.AddText("NoteText_small", "・ " + text4); // [!code ++]
					}
				}
			}
			P_2.t.note.Space(1); // [!code --]
			P_3.t.note.Space(1); // [!code ++]
		}
	}

```

## Card

[`@@ -2397,6 +2397,11 @@ public int Evalue(int ele)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/Card.cs#L2397-L2402)
```cs:line-numbers=2397
		return elements.Value(ele);
	}

	public int EvalueMax(int ele, int min = 0) // [!code ++]
	{ // [!code ++]
		return Mathf.Max(elements.Value(ele), min); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public int Evalue(string alias)
	{
		return elements.Value(EClass.sources.elements.alias[alias].id);
```

[`@@ -5751,17 +5756,24 @@ public void Talk(string idTopic, string ref1 = null, string ref2 = null, bool fo`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/Card.cs#L5751-L5767)
```cs:line-numbers=5751
	GameLang.refDrama1 = ref1;
	GameLang.refDrama2 = ref2;
	string text = GetTalkText(idTopic, stripPun: true);
	string text2 = id; // [!code --]
	if (!(text2 == "adv_gaki")) // [!code --]
	if (HasElement(1232) && idTopic != "baby") // [!code ++]
	{
		if (text2 == "corgon") // [!code --]
		{ // [!code --]
			BackerContent.GakiConvert(ref text, "mokyu"); // [!code --]
		} // [!code --]
		BackerContent.GakiConvert(ref text, "babu"); // [!code ++]
	}
	else
	{
		BackerContent.GakiConvert(ref text); // [!code --]
		string text2 = id; // [!code ++]
		if (!(text2 == "adv_gaki")) // [!code ++]
		{ // [!code ++]
			if (text2 == "corgon") // [!code ++]
			{ // [!code ++]
				BackerContent.GakiConvert(ref text, "mokyu"); // [!code ++]
			} // [!code ++]
		} // [!code ++]
		else // [!code ++]
		{ // [!code ++]
			BackerContent.GakiConvert(ref text); // [!code ++]
		} // [!code ++]
	}
	TalkRaw(text, ref1, ref2, forceSync);
}
```

[`@@ -6264,6 +6276,8 @@ public virtual int GetPrice(CurrencyType currency = CurrencyType.Money, bool sel`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/Card.cs#L6264-L6269)
```cs:line-numbers=6264
				return 20;
			case "wrench_tent_elec":
				return 3;
			case "wrench_tent_soil": // [!code ++]
				return 3; // [!code ++]
			case "wrench_bed":
				return 3;
			case "wrench_storage":
```

## CardRenderer

[`@@ -154,7 +154,7 @@ public override void Draw(RenderParam p, ref Vector3 v, bool drawShadow)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/CardRenderer.cs#L154-L160)
```cs:line-numbers=154
	else
	{
		SubPassData.Current = owner.GetSubPassData();
		SourcePref pref = owner.Pref; // [!code --]
		SourcePref pref = GetPref(); // [!code ++]
		RenderData renderData = data;
		int prefIndex = owner.PrefIndex;
		if (Player.seedHallucination != 0 && CanBeHallucinated())
```

[`@@ -233,33 +233,17 @@ public override void Draw(RenderParam p, ref Vector3 v, bool drawShadow)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/CardRenderer.cs#L233-L265)
```cs:line-numbers=233
			pref = replacer.pref;
			SubPassData.Current = SubPassData.Default;
		}
		int num2 = pref.shadow; // [!code --]
		bool flag2 = isChara && owner.isHidden && !EClass.pc.canSeeInvisible && (!EClass.pc.hasTelepathy || !owner.Chara.race.visibleWithTelepathy); // [!code --]
		if (isChara)
		{
			p.x += pref.x * (float)((!owner.flipX) ? 1 : (-1));
			if (owner.idSkin > 0) // [!code --]
			{ // [!code --]
				switch (owner.sourceCard.tiles.TryGet(owner.idSkin)) // [!code --]
				{ // [!code --]
				case 2319: // [!code --]
					num2 = 33; // [!code --]
					p.x += 0.04f * (float)((!owner.flipX) ? 1 : (-1)); // [!code --]
					p.y += 0.08f; // [!code --]
					break; // [!code --]
				case 2320: // [!code --]
					num2 = 7; // [!code --]
					p.x += 0.08f * (float)((!owner.flipX) ? 1 : (-1)); // [!code --]
					p.y += 0.2f; // [!code --]
					break; // [!code --]
				} // [!code --]
			} // [!code --]
		}
		p.y += pref.y;
		if (drawShadow && num2 != 1 && SubPassData.Current.shadow && (!flag2 || owner.IsPC)) // [!code --]
		int shadow = pref.shadow; // [!code ++]
		bool flag2 = isChara && owner.isHidden && !EClass.pc.canSeeInvisible && (!EClass.pc.hasTelepathy || !owner.Chara.race.visibleWithTelepathy); // [!code ++]
		if (drawShadow && shadow != 1 && SubPassData.Current.shadow && (!flag2 || owner.IsPC)) // [!code ++]
		{
			bool flag3 = ((!isChara) ? (owner.dir % 2 == 1) : (owner.dir == 1 || owner.dir == 2));
			EClass.scene.screenElin.tileMap.passShadow.AddShadow(position.x + (flag3 ? (-1f) : 1f) * renderData.offsetShadow.x, position.y + renderData.offsetShadow.y + (owner.TileType.UseMountHeight ? 0f : p.shadowFix) - RenderObject.altitudeFix * (float)owner.altitude, position.z + renderData.offsetShadow.z, ShadowData.Instance.items[num2], pref, prefIndex, p.snow); // [!code --]
			EClass.scene.screenElin.tileMap.passShadow.AddShadow(position.x + (flag3 ? (-1f) : 1f) * renderData.offsetShadow.x, position.y + renderData.offsetShadow.y + (owner.TileType.UseMountHeight ? 0f : p.shadowFix) - RenderObject.altitudeFix * (float)owner.altitude, position.z + renderData.offsetShadow.z, ShadowData.Instance.items[shadow], pref, prefIndex, p.snow); // [!code ++]
		}
		if (usePass)
		{
```

[`@@ -330,9 +314,9 @@ public override void Draw(RenderParam p, ref Vector3 v, bool drawShadow)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/CardRenderer.cs#L330-L338)
```cs:line-numbers=330
	{
		RenderObject.tempV = position;
		RenderObject.tempV.y += data.offset.y + data.size.y;
		for (int num3 = listTC.Count - 1; num3 >= 0; num3--) // [!code --]
		for (int num2 = listTC.Count - 1; num2 >= 0; num2--) // [!code ++]
		{
			listTC[num3].OnDraw(ref RenderObject.tempV); // [!code --]
			listTC[num2].OnDraw(ref RenderObject.tempV); // [!code ++]
		}
	}
	if (owner.trait.RenderExtra)
```

[`@@ -368,6 +352,21 @@ public virtual void DrawHeld()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/CardRenderer.cs#L368-L373)
```cs:line-numbers=368
	{
	}

	public SourcePref GetPref() // [!code ++]
	{ // [!code ++]
		if (isChara && owner.idSkin > 0) // [!code ++]
		{ // [!code ++]
			switch (owner.sourceCard.tiles.TryGet(owner.idSkin)) // [!code ++]
			{ // [!code ++]
			case 2319: // [!code ++]
				return EClass.core.refs.prefs.sonwputit1; // [!code ++]
			case 2320: // [!code ++]
				return EClass.core.refs.prefs.snowputit2; // [!code ++]
			} // [!code ++]
		} // [!code ++]
		return owner.Pref; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void RefreshSprite()
	{
		if (hasActor)
```

## Chara

[`@@ -2417,7 +2417,7 @@ public override MoveResult _Move(Point newPoint, MoveType type = MoveType.Walk)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/Chara.cs#L2417-L2423)
```cs:line-numbers=2417
				num2 += 20;
				num *= 1.8f;
			}
			num2 = num2 * 100 / (100 + Evalue(240) + Evalue(407) * 5); // [!code --]
			num2 = num2 * 100 / (100 + EvalueMax(240, -20) + EvalueMax(407, -5) * 5); // [!code ++]
			EClass.world.date.AdvanceMin(num2 * 6);
			EClass.player.lastZonePos = null;
			EClass.player.distanceTravel++;
```

[`@@ -2574,6 +2574,16 @@ public override MoveResult _Move(Point newPoint, MoveType type = MoveType.Walk)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/Chara.cs#L2574-L2579)
```cs:line-numbers=2574
		{
			text = cell.matObj.soundFoot;
		}
		if (IsPC) // [!code ++]
		{ // [!code ++]
			foreach (Thing thing2 in newPoint.Things) // [!code ++]
			{ // [!code ++]
				if (thing2.IsInstalled && (thing2.trait.CanChangeHeight || thing2.Pref.Surface)) // [!code ++]
				{ // [!code ++]
					text = thing2.material.soundFoot; // [!code ++]
				} // [!code ++]
			} // [!code ++]
		} // [!code ++]
		if (!text.IsEmpty())
		{
			SoundManager.altLastData = IsPC;
```

[`@@ -2620,9 +2630,9 @@ public override MoveResult _Move(Point newPoint, MoveType type = MoveType.Walk)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/Chara.cs#L2620-L2628)
```cs:line-numbers=2620
	}
	if (cell.hasDoor)
	{
		foreach (Thing thing2 in newPoint.Things) // [!code --]
		foreach (Thing thing3 in newPoint.Things) // [!code ++]
		{
			if (thing2.trait is TraitDoor traitDoor2) // [!code --]
			if (thing3.trait is TraitDoor traitDoor2) // [!code ++]
			{
				traitDoor2.TryOpen(this);
			}
```

[`@@ -6510,7 +6520,7 @@ public void TryTakeSharedItems(bool msg = true)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/Chara.cs#L6510-L6516)
```cs:line-numbers=6510

	public void TryTakeSharedItems(IEnumerable<Thing> containers, bool msg = true, bool shouldEat = true)
	{
		if (base.isSummon) // [!code --]
		if (base.isSummon || (memberType == FactionMemberType.Livestock && homeBranch != null && !homeBranch.policies.IsActive(2715))) // [!code ++]
		{
			return;
		}
```

[`@@ -6974,10 +6984,6 @@ public void ModAffinity(Chara c, int a, bool show = true, bool showOnlyEmo = fal`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/Chara.cs#L6974-L6983)
```cs:line-numbers=6974
		c.ModAffinity(EClass.pc, a, show);
		return;
	}
	if (c.IsPC) // [!code --]
	{ // [!code --]
		a = affinity.Mod(a); // [!code --]
	} // [!code --]
	int num = StatsHygiene.GetAffinityMod(EClass.pc.hygiene.GetPhase());
	if (IsPCFaction && homeBranch != null)
	{
```

[`@@ -6988,6 +6994,10 @@ public void ModAffinity(Chara c, int a, bool show = true, bool showOnlyEmo = fal`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/Chara.cs#L6988-L6993)
```cs:line-numbers=6988
	{
		a = a * num / 100;
	}
	if (c.IsPC) // [!code ++]
	{ // [!code ++]
		a = affinity.Mod(a); // [!code ++]
	} // [!code ++]
	if (!show)
	{
		return;
```

[`@@ -8566,7 +8576,7 @@ public void ResistCon(Condition con)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/Chara.cs#L8566-L8572)
```cs:line-numbers=8566
{
	if (con.power > 0 && resistCon != null)
	{
		int a = resistCon.TryGetValue(con.id, 0); // [!code --]
		int a = ClassExtension.TryGetValue<int, int>((IDictionary<int, int>)resistCon, con.id, 0); // [!code ++]
		if (1000 < EClass.rnd(a))
		{
			con.power = 0;
```

## CharaRenderer

[`@@ -299,10 +299,10 @@ public void DrawHat()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/CharaRenderer.cs#L299-L308)
```cs:line-numbers=299
	if (pccData == null || !owner.IsDeadOrSleeping)
	{
		CardRow cardRow = Zone.sourceHat ?? owner.hat;
		SourcePref pref = cardRow.pref; // [!code --]
		SourcePref pref = GetPref(); // [!code ++]
		bool flag = currentDir == 1 || currentDir == 3;
		int liquidLv = RenderObject.currentParam.liquidLv;
		float num = ((replacer != null) ? replacer.pref.hatY : owner.Pref.hatY); // [!code --]
		float num = ((replacer != null) ? replacer.pref.hatY : pref.hatY); // [!code ++]
		if (pccData != null)
		{
			num += RenderObject.renderSetting.hatPos[actor.GetFrame()].y;
```

## CoreRef

[`@@ -288,6 +288,14 @@ public class DefaultRoof`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/CoreRef.cs#L288-L293)
```cs:line-numbers=288
		public int idRamp;
	}

	[Serializable] // [!code ++]
	public class PrefData // [!code ++]
	{ // [!code ++]
		public SourcePref sonwputit1; // [!code ++]
 // [!code ++]
		public SourcePref snowputit2; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public Biomes biomes;

	public Crawlers crawlers;
```

[`@@ -362,6 +370,8 @@ public class DefaultRoof`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/CoreRef.cs#L362-L367)
```cs:line-numbers=362

	public UD_Int_String dictSketches;

	public PrefData prefs; // [!code ++]
 // [!code ++]
	public float testColor;

	public float testColor2;
```

## DramaActor

[`@@ -46,17 +46,24 @@ public void Talk(string text, List<DramaChoice> choices, bool center, bool unkno`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/DramaActor.cs#L46-L62)
```cs:line-numbers=46
	text = GameLang.ConvertDrama(text, owner.chara);
	if (chara != null)
	{
		string text2 = chara.id; // [!code --]
		if (!(text2 == "adv_gaki")) // [!code --]
		if (chara.HasElement(1232)) // [!code ++]
		{
			if (text2 == "corgon") // [!code --]
			{ // [!code --]
				BackerContent.GakiConvert(ref text, "mokyu"); // [!code --]
			} // [!code --]
			BackerContent.GakiConvert(ref text, "babu"); // [!code ++]
		}
		else
		{
			BackerContent.GakiConvert(ref text); // [!code --]
			string text2 = chara.id; // [!code ++]
			if (!(text2 == "adv_gaki")) // [!code ++]
			{ // [!code ++]
				if (text2 == "corgon") // [!code ++]
				{ // [!code ++]
					BackerContent.GakiConvert(ref text, "mokyu"); // [!code ++]
				} // [!code ++]
			} // [!code ++]
			else // [!code ++]
			{ // [!code ++]
				BackerContent.GakiConvert(ref text); // [!code ++]
			} // [!code ++]
		}
	}
	text = text.Replace("((", "(").Replace("))", ")").Replace("（（", "（")
```

## DropdownGrid

[`@@ -116,7 +116,7 @@ public void BuildIngredients(Recipe _recipe, Image _icon, Action _onValueChange,`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/DropdownGrid.cs#L116-L122)
```cs:line-numbers=116
					if (uid != 0)
					{
						Thing thing = EMono.pc.things.Find((Thing t) => t.uid == uid) ?? EMono._map.Stocked.Find(uid);
						if (thing != null && (!(thing.parent is Card card) || card.GetWindowSaveData() == null || !card.GetWindowSaveData().excludeCraft)) // [!code --]
						if (thing != null && ingredient.IsValidIngredient(thing) && (!(thing.parent is Card card) || card.GetWindowSaveData() == null || !card.GetWindowSaveData().excludeCraft)) // [!code ++]
						{
							ingredient.SetThing(thing);
							flag = true;
```

## FactionBranch

[`@@ -1219,6 +1219,10 @@ public void ValidateUpgradePolicies()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/FactionBranch.cs#L1219-L1224)
```cs:line-numbers=1219
		{
			policies.AddPolicy(2709);
		}
		if (!policies.HasPolicy(2715)) // [!code ++]
		{ // [!code ++]
			policies.AddPolicy(2715); // [!code ++]
		} // [!code ++]
	}
	foreach (int globalPolicy in EClass.pc.faction.globalPolicies)
	{
```

## LayerInventory

[`@@ -149,7 +149,11 @@ public static void TryShowGuide(UIList list)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/LayerInventory.cs#L149-L155)
```cs:line-numbers=149
public static void TryShowGuide(List<ButtonGrid> list)
{
	bool flag = InvOwner.HasTrader && InvOwner.Trader.UseGuide;
	bool flag2 = (bool)WidgetSearch.Instance && WidgetSearch.selected != null; // [!code --]
	if (flag) // [!code ++]
	{ // [!code ++]
		WidgetSearch.selected = null; // [!code ++]
	} // [!code ++]
	bool flag2 = (bool)WidgetSearch.Instance && WidgetSearch.selected != null && !ELayer.ui.IsDragging; // [!code ++]
	if (!flag2 && WidgetEquip.dragEquip == null && LayerAbility.hotElement == null && !flag)
	{
		return;
```

## POLICY

[`@@ -5,7 +5,7 @@ public class POLICY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/POLICY.cs#L5-L11)
```cs:line-numbers=5
{
	public const int store_ripoff = 2816;

	public const int forcePanty = 2712; // [!code --]
	public const int livestock_priv = 2715; // [!code ++]

	public const int home_discount = 2800;

```

[`@@ -33,7 +33,7 @@ public class POLICY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/POLICY.cs#L33-L39)
```cs:line-numbers=33

	public const int celeb = 2822;

	public const int incomeTransfer = 2711; // [!code --]
	public const int forcePanty = 2712; // [!code ++]

	public const int license_stolen = 2824;

```

[`@@ -47,14 +47,14 @@ public class POLICY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/POLICY.cs#L47-L60)
```cs:line-numbers=47

	public const int license_food = 2818;

	public const int noMother = 2710; // [!code --]
 // [!code --]
	public const int inquisition = 2507; // [!code --]
	public const int incomeTransfer = 2711; // [!code ++]

	public const int noDM = 2708; // [!code --]
	public const int nocturnal_life = 2508; // [!code ++]

	public const int noAnimal = 2709;

	public const int noMother = 2710; // [!code ++]
 // [!code ++]
	public const int prohibition = 2503;

	public const int food_for_people = 2502;
```

[`@@ -67,7 +67,7 @@ public class POLICY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/POLICY.cs#L67-L73)
```cs:line-numbers=67

	public const int human_right = 2506;

	public const int nocturnal_life = 2508; // [!code --]
	public const int wealth_tax = 2500; // [!code ++]

	public const int vaccination = 2509;

```

[`@@ -77,39 +77,42 @@ public class POLICY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/POLICY.cs#L77-L115)
```cs:line-numbers=77

	public const int resident_tax = 2512;

	public const int wealth_tax = 2500; // [!code --]
	public const int inquisition = 2507; // [!code ++]

	public const int taxfree = 2514;

	public const int resident_wanted = 2513;

	public const int auto_farm = 2707; // [!code ++]
 // [!code ++]
	public const int demon_invocation = 2706;

	public const int taxTransfer = 2705;

	public const int weed_no = 2703;

	public const int trash_no = 2702; // [!code --]
 // [!code --]
	public const int border_watch = 2704;

	public const int trash_sort = 2701; // [!code ++]
 // [!code ++]
	public const int energy_conservation = 2700;

	public const int speed_growth = 2516;

	public const int stop_growth = 2515;

	public const int trash_sort = 2701; // [!code --]
	public const int trash_no = 2702; // [!code ++]

	public const int auto_farm = 2707; // [!code --]
	public const int noDM = 2708; // [!code ++]

	public static readonly int[] IDS = new int[50] // [!code --]
	public static readonly int[] IDS = new int[51] // [!code ++]
	{
		2816, 2712, 2800, 2810, 2811, 2812, 2813, 2814, 2815, 2817, // [!code --]
		2823, 2819, 2820, 2821, 2822, 2711, 2824, 2825, 2826, 2827, // [!code --]
		2828, 2818, 2710, 2507, 2708, 2709, 2503, 2502, 2501, 2504, // [!code --]
		2505, 2506, 2508, 2509, 2510, 2511, 2512, 2500, 2514, 2513, // [!code --]
		2706, 2705, 2703, 2702, 2704, 2700, 2516, 2515, 2701, 2707 // [!code --]
		2816, 2715, 2800, 2810, 2811, 2812, 2813, 2814, 2815, 2817, // [!code ++]
		2823, 2819, 2820, 2821, 2822, 2712, 2824, 2825, 2826, 2827, // [!code ++]
		2828, 2818, 2711, 2508, 2709, 2710, 2503, 2502, 2501, 2504, // [!code ++]
		2505, 2506, 2500, 2509, 2510, 2511, 2512, 2507, 2514, 2513, // [!code ++]
		2707, 2706, 2705, 2703, 2704, 2701, 2700, 2516, 2515, 2702, // [!code ++]
		2708 // [!code ++]
	};
}
public class Policy : EClass
```

## Recipe

[`@@ -122,6 +122,37 @@ static string CatName(string id)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/Recipe.cs#L122-L127)
```cs:line-numbers=122
				return EClass.sources.categories.map[id].GetName();
			}
		}
 // [!code ++]
		public bool IsValidIngredient(Thing t) // [!code ++]
		{ // [!code ++]
			if (useCat) // [!code ++]
			{ // [!code ++]
				if (t.category.IsChildOf(id)) // [!code ++]
				{ // [!code ++]
					return true; // [!code ++]
				} // [!code ++]
				foreach (string item in idOther) // [!code ++]
				{ // [!code ++]
					if (t.category.IsChildOf(item)) // [!code ++]
					{ // [!code ++]
						return true; // [!code ++]
					} // [!code ++]
				} // [!code ++]
				return false; // [!code ++]
			} // [!code ++]
			if (t.id == id || t.source._origin == id) // [!code ++]
			{ // [!code ++]
				return true; // [!code ++]
			} // [!code ++]
			foreach (string item2 in idOther) // [!code ++]
			{ // [!code ++]
				if (t.id == id || t.source._origin == item2) // [!code ++]
				{ // [!code ++]
					return true; // [!code ++]
				} // [!code ++]
			} // [!code ++]
			return false; // [!code ++]
		} // [!code ++]
	}

	public static Dictionary<string, Recipe> recipeCache = new Dictionary<string, Recipe>();
```

## RecipeManager

[`@@ -243,9 +243,11 @@ public bool CanCeomUpWithRecipe(string idRecipe)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/RecipeManager.cs#L243-L251)
```cs:line-numbers=243
			return false;
		}
		int id = recipeSource.GetReqSkill().id;
		_ = EClass.pc.Evalue(id) + 5; // [!code --]
		_ = recipeSource.row.LV; // [!code --]
		return false; // [!code --]
		if (EClass.pc.Evalue(id) + 5 < recipeSource.row.LV) // [!code ++]
		{ // [!code ++]
			return false; // [!code ++]
		} // [!code ++]
		return true; // [!code ++]
	}

	public void ComeUpWithRecipe(string idRecipe, int chanceForRandomRecipe = 0)
```

## SKILL

[`@@ -2,16 +2,16 @@ public class SKILL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/SKILL.cs#L2-L17)
```cs:line-numbers=2
{
	public const int tactics = 132;

	public const int armorHeavy = 122; // [!code --]
	public const int shield = 123; // [!code ++]

	public const int twowield = 131;

	public const int twohand = 130;

	public const int shield = 123; // [!code --]
 // [!code --]
	public const int fireproof = 50;

	public const int armorLight = 120; // [!code ++]
 // [!code ++]
	public const int weaponBlunt = 111;

	public const int weaponScythe = 110;
```

[`@@ -20,11 +20,11 @@ public class SKILL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/SKILL.cs#L20-L30)
```cs:line-numbers=20

	public const int marksman = 133;

	public const int armorLight = 120; // [!code --]
	public const int armorHeavy = 122; // [!code ++]

	public const int eyeofmind = 134;

	public const int riding = 226; // [!code --]
	public const int parasite = 227; // [!code ++]

	public const int evasion = 150;

```

[`@@ -40,10 +40,10 @@ public class SKILL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/SKILL.cs#L40-L49)
```cs:line-numbers=40

	public const int digging = 230;

	public const int parasite = 227; // [!code --]
 // [!code --]
	public const int acidproof = 51;

	public const int riding = 226; // [!code ++]
 // [!code ++]
	public const int lumberjack = 225;

	public const int mining = 220;
```

[`@@ -62,7 +62,7 @@ public class SKILL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/SKILL.cs#L62-L68)
```cs:line-numbers=62

	public const int PDR = 55;

	public const int weaponAxe = 102; // [!code --]
	public const int weaponSword = 101; // [!code ++]

	public const int evasionPerfect = 57;

```

[`@@ -112,7 +112,7 @@ public class SKILL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/SKILL.cs#L112-L118)
```cs:line-numbers=112

	public const int martial = 100;

	public const int weaponSword = 101; // [!code --]
	public const int weaponAxe = 102; // [!code ++]

	public const int weaponStaff = 103;

```

[`@@ -264,12 +264,12 @@ public class SKILL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/SKILL.cs#L264-L275)
```cs:line-numbers=264

	public static readonly int[] IDS = new int[131]
	{
		132, 122, 131, 130, 123, 50, 111, 110, 109, 133, // [!code --]
		120, 134, 226, 150, 242, 241, 240, 237, 235, 230, // [!code --]
		227, 51, 225, 220, 210, 207, 200, 152, 151, 135, // [!code --]
		55, 102, 57, 245, 61, 62, 64, 65, 66, 67, // [!code --]
		132, 123, 131, 130, 50, 120, 111, 110, 109, 133, // [!code ++]
		122, 134, 227, 150, 242, 241, 240, 237, 235, 230, // [!code ++]
		51, 226, 225, 220, 210, 207, 200, 152, 151, 135, // [!code ++]
		55, 101, 57, 245, 61, 62, 64, 65, 66, 67, // [!code ++]
		68, 70, 71, 72, 73, 74, 75, 56, 76, 78,
		79, 80, 90, 91, 92, 100, 101, 103, 104, 105, // [!code --]
		79, 80, 90, 91, 92, 100, 102, 103, 104, 105, // [!code ++]
		106, 107, 60, 77, 250, 108, 256, 916, 917, 918,
		919, 920, 921, 922, 923, 924, 925, 950, 951, 952,
		953, 954, 955, 956, 957, 958, 959, 960, 961, 962,
```

## SerializedCards

[`@@ -617,7 +617,7 @@ public void Restore(Map map, Map orgMap, bool addToZone, PartialMap partial = nu`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/SerializedCards.cs#L617-L623)
```cs:line-numbers=617
					continue;
				}
			}
			if (isUserZone && dictionary.TryGetValue(index, 0) >= 3) // [!code --]
			if (isUserZone && ClassExtension.TryGetValue<int, int>((IDictionary<int, int>)dictionary, index, 0) >= 3) // [!code ++]
			{
				continue;
			}
```

[`@@ -643,13 +643,13 @@ public void Restore(Map map, Map orgMap, bool addToZone, PartialMap partial = nu`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/SerializedCards.cs#L643-L655)
```cs:line-numbers=643
			}
			if (isUserZone)
			{
				dictionary[index] = dictionary.TryGetValue(index, 0) + 1; // [!code --]
				dictionary[index] = ClassExtension.TryGetValue<int, int>((IDictionary<int, int>)dictionary, index, 0) + 1; // [!code ++]
			}
		}
		else
		{
			PlaceState placeState = card4.placeState.ToEnum<PlaceState>();
			if (isUserZone && ((dictionary2.TryGetValue(index, 0) >= 20 && text != "waystone" && text != "core_zone") || (placeState != PlaceState.installed && !card4.bits1.IsOn(13)) || text == "medal")) // [!code --]
			if (isUserZone && ((ClassExtension.TryGetValue<int, int>((IDictionary<int, int>)dictionary2, index, 0) >= 20 && text != "waystone" && text != "core_zone") || (placeState != PlaceState.installed && !card4.bits1.IsOn(13)) || text == "medal")) // [!code ++]
			{
				continue;
			}
```

[`@@ -668,7 +668,7 @@ public void Restore(Map map, Map orgMap, bool addToZone, PartialMap partial = nu`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/SerializedCards.cs#L668-L674)
```cs:line-numbers=668
			card2.c_lightColor = card4.lightColor;
			if (isUserZone)
			{
				dictionary2[index] = dictionary2.TryGetValue(index, 0) + 1; // [!code --]
				dictionary2[index] = ClassExtension.TryGetValue<int, int>((IDictionary<int, int>)dictionary2, index, 0) + 1; // [!code ++]
			}
		}
		if (num < 0)
```

[`@@ -687,12 +687,6 @@ public void Restore(Map map, Map orgMap, bool addToZone, PartialMap partial = nu`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/SerializedCards.cs#L687-L698)
```cs:line-numbers=687
		card2.refVal = card4.refVal;
		card2.idSkin = card4.idSkin;
		card2.c_idDeity = card4.idDeity;
		if (isUserZone && (card2.isHidden || card2.isMasked) && ((card2.TileType.IsBlockPass && card2.IsInstalled) || card2.trait is TraitCoreZone || card2.trait is TraitWaystone)) // [!code --]
		{ // [!code --]
			Card card3 = card2; // [!code --]
			bool isHidden = (card2.isMasked = false); // [!code --]
			card3.isHidden = isHidden; // [!code --]
		} // [!code --]
		if (card4.idBacker != 0)
		{
			Debug.Log(card4.idBacker);
```

[`@@ -745,9 +739,18 @@ public void Restore(Map map, Map orgMap, bool addToZone, PartialMap partial = nu`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/SerializedCards.cs#L745-L753)
```cs:line-numbers=745
				Debug.LogWarning("Could not convert editor tag:" + card2.Name + "/" + card4.tags);
			}
		}
		if (isUserZone && card2.IsContainer && card4.isEmpty) // [!code --]
		if (isUserZone) // [!code ++]
		{
			card2.things.DestroyAll(); // [!code --]
			if ((card2.isHidden || card2.isMasked) && ((card2.TileType.IsBlockPass && card2.IsInstalled) || card2.trait is TraitCoreZone || card2.trait is TraitWaystone)) // [!code ++]
			{ // [!code ++]
				Card card3 = card2; // [!code ++]
				bool isHidden = (card2.isMasked = false); // [!code ++]
				card3.isHidden = isHidden; // [!code ++]
			} // [!code ++]
			if (card2.IsContainer && card4.isEmpty) // [!code ++]
			{ // [!code ++]
				card2.things.DestroyAll(); // [!code ++]
			} // [!code ++]
		}
		if (card2.isChara)
		{
```

## SourceThingV

[`@@ -231,6 +231,9 @@ public override void OnAfterImportData()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/SourceThingV.cs#L231-L236)
```cs:line-numbers=231
							array2[4].ToInt()
						});
						break;
					case "skin": // [!code ++]
						row.skins = new int[1] { array2[1].ToInt() }; // [!code ++]
						break; // [!code ++]
					case "alt":
						row.altTiles = new int[1] { array2[1].ToInt() };
						row.ignoreAltFix = true;
```

## StatsHygiene

[`@@ -12,7 +12,7 @@ public class StatsHygiene : Stats`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/StatsHygiene.cs#L12-L18)
```cs:line-numbers=12

	public const int Garbage = 0;

	public static int[] listMod = new int[6] { 10, 50, 80, 100, 110, 120 }; // [!code --]
	public static int[] listMod = new int[6] { 10, 50, 80, 100, 110, 115 }; // [!code ++]

	public override int max => 100;

```

## StatsMana

[`@@ -34,7 +34,7 @@ public override void Mod(int a)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/StatsMana.cs#L34-L40)
```cs:line-numbers=34
	{
		return;
	}
	int num = -value * 400 / (100 + BaseStats.CC.Evalue(303) * 10); // [!code --]
	int num = -value * 400 / (100 + BaseStats.CC.EvalueMax(303, -5) * 10); // [!code ++]
	if (BaseStats.CC.HasElement(1201))
	{
		num /= 3;
```

## Trait

[`@@ -1721,6 +1721,7 @@ public void OnBarter()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/Trait.cs#L1721-L1726)
```cs:line-numbers=1721
				Add("container_magic", 1, 0).ChangeMaterial("iron").idSkin = 1;
				Add("container_magic", 1, 0).ChangeMaterial("bamboo").idSkin = 2;
				Add("wrench_tent_elec", 1, 0);
				Add("wrench_tent_soil", 1, 0); // [!code ++]
				Add("wrench_bed", 1, 0).SetNum(20);
				Add("wrench_storage", 1, 0).SetNum(10);
				Add("wrench_fridge", 1, 0).SetNum(1);
```

## TraitBaseSpellbook

[`@@ -275,7 +275,7 @@ public override void SetName(ref string s)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/TraitBaseSpellbook.cs#L275-L281)
```cs:line-numbers=275
		string c_idRefName = owner.c_idRefName;
		if (!c_idRefName.IsEmpty())
		{
			string @ref = ((BookType == Type.Dojin) ? EClass.game.religions.dictAll[c_idRefName].Name : EClass.sources.charas.map[c_idRefName].GetName()); // [!code --]
			string @ref = ((BookType == Type.Dojin) ? EClass.game.religions.dictAll[c_idRefName].Name : EClass.sources.charas.map.TryGetValue(c_idRefName, "putty").GetName()); // [!code ++]
			s = "_'s".lang(@ref, s);
		}
		break;
```

## TraitCanvas

[`@@ -17,4 +17,18 @@ public override void OnSetCardGrid(ButtonGrid b)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/TraitCanvas.cs#L17-L20)
```cs:line-numbers=17
			b.Attach<Image>("canvas", rightAttach: false).sprite = paintSprite;
		}
	}
 // [!code ++]
	public override void TrySetAct(ActPlan p) // [!code ++]
	{ // [!code ++]
		if (EClass._zone.IsUserZone && owner.Num == 1 && owner.c_textureData != null && owner.IsInstalled) // [!code ++]
		{ // [!code ++]
			p.TrySetAct("actTakeOut", delegate // [!code ++]
			{ // [!code ++]
				owner.noSell = true; // [!code ++]
				owner.isNPCProperty = false; // [!code ++]
				EClass.pc.PickOrDrop(owner.pos, owner.Thing); // [!code ++]
				return true; // [!code ++]
			}, owner); // [!code ++]
		} // [!code ++]
	} // [!code ++]
}
```

## TraitDrawingPaper

[`@@ -8,6 +8,7 @@ public class TraitDrawingPaper : TraitCanvas`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/TraitDrawingPaper.cs#L8-L13)
```cs:line-numbers=8

	public override void TrySetAct(ActPlan p)
	{
		base.TrySetAct(p); // [!code ++]
		if (p.altAction)
		{
			p.TrySetAct("actPaint", delegate
```

## TraitFoodEggFertilized

[`@@ -25,12 +25,8 @@ public static Chara Incubate(Thing egg, Point pos, Card incubator = null)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/TraitFoodEggFertilized.cs#L25-L36)
```cs:line-numbers=25
	EClass._zone.AddCard(chara, pos.GetNearestPoint(allowBlock: false, allowChara: false) ?? EClass.pc.pos);
	chara.SetLv(1);
	chara.SetMainElement(egg.c_idMainElement, 10, elemental: true);
	chara.SetFeat(1232, (incubator != null) ? 3 : 2, msg: true); // [!code --]
	chara.things.DestroyAll();
	if (chara.id == "putty_snow" && chara.idSkin == 0) // [!code --]
	{ // [!code --]
		chara.idSkin = 4 + EClass.rnd(2); // [!code --]
	} // [!code --]
	MakeBaby(chara, (incubator == null) ? 2 : 3); // [!code ++]
	if (chara.Evalue(1644) > 0)
	{
		for (int i = 0; i < chara.Evalue(1644); i++)
```

[`@@ -65,6 +61,15 @@ public static Chara Incubate(Thing egg, Point pos, Card incubator = null)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/TraitFoodEggFertilized.cs#L65-L70)
```cs:line-numbers=65
		return chara;
	}

	public static void MakeBaby(Chara c, int baby) // [!code ++]
	{ // [!code ++]
		c.SetFeat(1232, baby, msg: true); // [!code ++]
		if (c.id == "putty_snow" && c.idSkin == 0) // [!code ++]
		{ // [!code ++]
			c.idSkin = 4 + EClass.rnd(2); // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public override bool CanStackTo(Thing to)
	{
		if (to.c_idMainElement != owner.c_idMainElement)
```

## +TraitFoodPreparedPackage

::: details File Created
```cs
public class TraitFoodPreparedPackage : TraitFood
{
	public override string LangUse => "actContainer";

	public override bool CanEat(Chara c)
	{
		return owner.idSkin == 1;
	}

	public override bool CanUse(Chara c)
	{
		if (EClass._zone.IsUserZone && owner.isNPCProperty)
		{
			return false;
		}
		return owner.idSkin == 0;
	}

	public override bool OnUse(Chara c)
	{
		SE.Play("open");
		c.Say("openDoor", c, owner);
		owner.idSkin = 1;
		LayerInventory.SetDirty(owner.Thing);
		return true;
	}
}
```

:::
## TraitWrench

[`@@ -12,6 +12,19 @@ public bool IsValidTarget(Thing t)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/TraitWrench.cs#L12-L17)
```cs:line-numbers=12
	}
	switch (ID)
	{
	case "tent_soil": // [!code ++]
	{ // [!code ++]
		if (!(t.trait is TraitTent)) // [!code ++]
		{ // [!code ++]
			return false; // [!code ++]
		} // [!code ++]
		Zone zone = (t.trait as TraitTent).zone; // [!code ++]
		if (zone == null) // [!code ++]
		{ // [!code ++]
			return false; // [!code ++]
		} // [!code ++]
		return zone.Evalue(2200) < 10; // [!code ++]
	} // [!code ++]
	case "tent_elec":
		if (t.trait is TraitTent)
		{
```

[`@@ -46,6 +59,9 @@ public bool Upgrade(Thing t)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/TraitWrench.cs#L46-L51)
```cs:line-numbers=46
	case "tent_elec":
		(t.trait as TraitTent).zone.elements.ModBase(2201, 2);
		break;
	case "tent_soil": // [!code ++]
		(t.trait as TraitTent).zone.elements.ModBase(2200, 5); // [!code ++]
		break; // [!code ++]
	case "bed":
		t.c_containerSize++;
		if (EClass.debug.enable)
```

## WindowChara

[`@@ -481,7 +481,7 @@ public void RefreshInfo()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/WindowChara.cs#L481-L487)
```cs:line-numbers=481
	textMom.text = chara.bio.nameMom.ToTitleCase();
	textDad.text = chara.bio.nameDad.ToTitleCase();
	textBirthplace.text = chara.bio.nameBirthplace.ToTitleCase();
	textLike.text = EClass.sources.cards.map[bio.idLike].GetName(); // [!code --]
	textLike.text = EClass.sources.cards.map.TryGetValue(bio.idLike, EClass.sources.cards.map["ash"]).GetName(); // [!code ++]
	textHobby.text = EClass.sources.elements.map[bio.idHobby].GetText();
	textFaction.text = ((chara.faction == null) ? "???" : chara.faction.name.ToTitleCase());
	textFaith.text = chara.faith.Name.ToTitleCase();
```

## ZonePreEnterEncounter

[`@@ -29,6 +29,10 @@ public override void Execute()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/ZonePreEnterEncounter.cs#L29-L34)
```cs:line-numbers=29
				chara.hostility = hostility2;
				chara.enemy = EClass.pc.party.members.RandomItem();
				leader = chara;
				if (EClass.rnd(5) == 0) // [!code ++]
				{ // [!code ++]
					TraitFoodEggFertilized.MakeBaby(chara, 1); // [!code ++]
				} // [!code ++]
				list.Add(chara);
			}
		}
```

## Zone_Tent

[`@@ -8,7 +8,7 @@ public class Zone_Tent : Zone`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/d86d28e4dd23e213abc9226c1757c8b4fa1d6c20/Elin/Zone_Tent.cs#L8-L14)
```cs:line-numbers=8

	public override bool GrowPlant => true;

	public override int MaxSoil => 50; // [!code --]
	public override int MaxSoil => 50 + Evalue(2200) * 5; // [!code ++]

	public override ZoneTransition.EnterState RegionEnterState => ZoneTransition.EnterState.Bottom;

```

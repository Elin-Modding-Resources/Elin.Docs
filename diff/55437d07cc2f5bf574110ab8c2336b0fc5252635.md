---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 10 files modified.
version: EA 23.192 Nightly
changes: ActMelee/AttackProcess/Card/Chara/DOMAIN/ELEMENT/FACTION/TraitBaseSpellbook/TraitSpellbook/ZoneEventSiege
---

# EA 23.192 Nightly

September 2, 2025

10 files modified.

## Important Changes

Possible breaking changes. Click the filename to view the chunk.
### [Chara (1)](#chara)
```cs:no-line-numbers
public void GainAbility(int ele, int mtp = 100) // [!code --]
public void GainAbility(int ele, int mtp = 100, Thing origin = null) // [!code ++]
```
## ActMelee

[`public bool Attack(float dmgMulti = 1f)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/ActMelee.cs#L173-L178)
```cs:line-numbers=173
			new ActMeleeCounter().Perform(orgTC.Chara, cC);
		}
	}
	Act.TC = orgTC; // [!code ++]
	Act.CC = cC; // [!code ++]
	if (!hasHit)
	{
		Act.CC.PlaySound("miss");
```

[`void Attack(Card _tc, Point _tp, float mtp, bool subAttack)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/ActMelee.cs#L313-L319)
```cs:line-numbers=313
				if (num5 > 0 && !Act.CC.HasElement(439))
				{
					int num6 = EClass.curve(5 + num5 / 3, 10, 3, 70);
					num6 = num6 * 100 / (int)Mathf.Clamp((float)AttackProcess.Current.weaponSkill.Value / (float)Act.TC.Evalue(123) * 100f, 50f, 150f); // [!code --]
					int num7 = Act.TC.Evalue(123); // [!code ++]
					if (Act.TC.isChara) // [!code ++]
					{ // [!code ++]
						foreach (BodySlot slot2 in Act.TC.Chara.body.slots) // [!code ++]
						{ // [!code ++]
							if (slot2.thing != null && slot2.thing.HasElement(437) && Act.TC.Evalue(slot2.thing.category.skill) > num7) // [!code ++]
							{ // [!code ++]
								num7 = Act.TC.Evalue(slot2.thing.category.skill); // [!code ++]
							} // [!code ++]
						} // [!code ++]
					} // [!code ++]
					num6 = num6 * 100 / (int)Mathf.Clamp((float)AttackProcess.Current.weaponSkill.Value / (float)num7 * 100f, 50f, 150f); // [!code ++]
					if (EClass.rnd(100) < num6)
					{
						Act.TC.Say("parry");
```

[`void Attack(Card _tc, Point _tp, float mtp, bool subAttack)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/ActMelee.cs#L323-L341)
```cs:line-numbers=323
					}
				}
			}
			int num7 = 1; // [!code --]
			int num8 = 1; // [!code ++]
			if (chaser > 0)
			{
				for (int j = 0; j < 10; j++)
				{
					if (chaser > EClass.rnd(4 + (int)Mathf.Pow(4f, j + 2)))
					{
						num7++; // [!code --]
						num8++; // [!code ++]
					}
				}
			}
			bool flag = false;
			for (int k = 0; k < num7; k++) // [!code --]
			for (int k = 0; k < num8; k++) // [!code ++]
			{
				if (!Act.CC.IsAliveInCurrentZone)
				{
```

[`void Attack(Card _tc, Point _tp, float mtp, bool subAttack)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/ActMelee.cs#L446-L454)
```cs:line-numbers=446
			}
			if (Act.TC.isChara && !Act.TC.HasCondition<ConGravity>() && Act.TC.ExistsOnMap && knockback > 0 && knockback * 2 + 15 > EClass.rnd(100) && !Act.TC.isRestrained)
			{
				Card.MoveResult num8 = Act.TC.Chara.TryMoveFrom(Act.CC.pos); // [!code --]
				Card.MoveResult num9 = Act.TC.Chara.TryMoveFrom(Act.CC.pos); // [!code ++]
				bool flag3 = Act.CC.id == "tsunami";
				if (num8 == Card.MoveResult.Success) // [!code --]
				if (num9 == Card.MoveResult.Success) // [!code ++]
				{
					Act.TC.renderer.SetFirst(first: true);
					Act.TC.PlaySound("wave_hit_small");
```

[`void Attack(Card _tc, Point _tp, float mtp, bool subAttack)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/ActMelee.cs#L475-L489)
```cs:line-numbers=475
		}
		void AttackWithFlurry(Card _tc, Point _tp, float mtp, bool subAttack)
		{
			int num9 = 1; // [!code --]
			int num10 = 1; // [!code ++]
			if (flurry > 0)
			{
				for (int l = 0; l < 10 && flurry > EClass.rnd(25 + (int)Mathf.Pow(5f, l + 2)); l++)
				{
					num9++; // [!code --]
					num10++; // [!code ++]
				}
			}
			for (int m = 0; m < num9; m++) // [!code --]
			for (int m = 0; m < num10; m++) // [!code ++]
			{
				if (!Act.CC.IsAliveInCurrentZone)
				{
```

## AttackProcess

[`public bool IsCane`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/AttackProcess.cs#L113-L119)
```cs:line-numbers=113

	public static int GetWeaponEnc(Chara CC, Thing w, int ele, bool addSelfEnc = false)
	{
		return (addSelfEnc ? CC.Evalue(ele) : 0) + (w?.Evalue(ele) ?? 0) + (CC.IsPCFactionOrMinion ? EClass.pc.faction.charaElements.Value(ele) : 0); // [!code --]
		int num = w?.Evalue(ele) ?? 0; // [!code ++]
		if (CC.body.GetAttackStyle() == AttackStyle.TwoHand) // [!code ++]
		{ // [!code ++]
			num = num * (100 + Mathf.Clamp(CC.Evalue(130) / 15, 0, 2) * 25) / 100; // [!code ++]
		} // [!code ++]
		if (addSelfEnc) // [!code ++]
		{ // [!code ++]
			num += CC.Evalue(ele); // [!code ++]
		} // [!code ++]
		if (CC.IsPCFactionOrMinion) // [!code ++]
		{ // [!code ++]
			num += EClass.pc.faction.charaElements.Value(ele); // [!code ++]
		} // [!code ++]
		return num; // [!code ++]
	}

	public string GetText()
```

[`public static void ProcShieldEncs(Chara CC, Card TC, int mtpChance = 100)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/AttackProcess.cs#L448-L454)
```cs:line-numbers=448
	{
		if (slot.elementId == 35 && slot.thing != null && (slot.thing.category.IsChildOf("shield") || slot.thing.category.IsChildOf("martial")))
		{
			ProcAbility(slot.thing.elements.dict.Values.ToList(), CC, TC, CC.Evalue(123), subAttack: false, mtpChance); // [!code --]
			ProcAbility(slot.thing.elements.dict.Values.ToList(), CC, TC, CC.Evalue((slot.thing.category.skill == 0) ? 123 : slot.thing.category.skill), subAttack: false, mtpChance); // [!code ++]
		}
	}
}
```

## Card

[`public virtual int GetPrice(CurrencyType currency = CurrencyType.Money, bool sel`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/Card.cs#L7072-L7079)
```cs:line-numbers=7072
				return 6;
			case "monsterball":
				return LV / 8;
			case "spellbook": // [!code --]
				return 6; // [!code --]
			case "372": // [!code ++]
				return 3; // [!code ++]
			}
			break;
		}
```

## Chara

[`public void TryAbsorbRod(Thing t)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/Chara.cs#L4274-L4280)
```cs:line-numbers=4274
			SourceElement.Row current = enumerator.Current;
			if (IsPC)
			{
				GainAbility(current.id, t.c_charges * 100); // [!code --]
				GainAbility(current.id, t.c_charges * 100, t); // [!code ++]
				flag = true;
			}
		}
```

[`public bool MutateRandom(int vec = 0, int tries = 100, bool ether = false, Bless`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/Chara.cs#L9587-L9593)
```cs:line-numbers=9587
		return false;
	}

	public void GainAbility(int ele, int mtp = 100) // [!code --]
	public void GainAbility(int ele, int mtp = 100, Thing origin = null) // [!code ++]
	{
		Element orCreateElement = elements.GetOrCreateElement(ele);
		if (orCreateElement.ValueWithoutLink == 0)
```

[`public void GainAbility(int ele, int mtp = 100)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/Chara.cs#L9596-L9607)
```cs:line-numbers=9596
	}
	if (orCreateElement is Spell)
	{
		int num = mtp * orCreateElement.source.charge * (100 + Evalue(307) + (HasElement(307) ? 20 : 0)) / 100 / 100; // [!code --]
		int num = EClass.curve(Evalue(307), 50, 20) + (HasElement(307) ? 20 : 0); // [!code ++]
		int num2 = origin?.Evalue(765) ?? 0; // [!code ++]
		num = num * (100 - num2) / 100; // [!code ++]
		int a = mtp * orCreateElement.source.charge * (100 + num) / 100 / 100; // [!code ++]
		a = Mathf.Max(1, EClass.rndHalf(a)); // [!code ++]
		if (orCreateElement.source.charge == 1)
		{
			num = 1; // [!code --]
			a = 1; // [!code ++]
		}
		orCreateElement.vPotential += Mathf.Max(1, num / 2 + EClass.rnd(num / 2 + 1)); // [!code --]
		orCreateElement.vPotential += a; // [!code ++]
	}
	Say("spell_gain", this, orCreateElement.Name);
	LayerAbility.SetDirty(orCreateElement);
```

## DOMAIN

[``](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/DOMAIN.cs#L2-L43)
```cs:line-numbers=2

public class DOMAIN
{
	public const int domEarth = 812; // [!code --]
 // [!code --]
	public const int domOblivion = 813; // [!code --]
	public const int domHealing = 811; // [!code ++]

	public const int domLuck = 810; // [!code --]
	public const int domEarth = 812; // [!code ++]

	public const int domMachine = 809;

	public const int domHarvest = 808;

	public const int domEyth = 814; // [!code --]
 // [!code --]
	public const int domFaith = 802; // [!code --]
	public const int domWind = 807; // [!code ++]

	public const int domComm = 805; // [!code --]
	public const int domOblivion = 813; // [!code ++]

	public const int domHarmony = 815;

	public const int domWind = 807; // [!code --]
	public const int domArcane = 804; // [!code ++]
 // [!code ++]
	public const int domEyth = 814; // [!code ++]

	public const int domElement = 806;

	public const int domHealing = 811; // [!code --]
	public const int domComm = 805; // [!code ++]
 // [!code ++]
	public const int domLuck = 810; // [!code ++]

	public const int domSurvival = 801;

	public const int domMiracle = 803; // [!code --]
	public const int domFaith = 802; // [!code ++]

	public const int domArcane = 804; // [!code --]
	public const int domMiracle = 803; // [!code ++]

	public const int domTest = 800;

	public static readonly int[] IDS = new int[16]
	{
		812, 813, 810, 809, 808, 814, 802, 805, 815, 807, // [!code --]
		806, 811, 801, 803, 804, 800 // [!code --]
		811, 812, 809, 808, 807, 813, 815, 804, 814, 806, // [!code ++]
		805, 810, 801, 802, 803, 800 // [!code ++]
	};
}
public class Domain : EClass
```

## ELEMENT

[``](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/ELEMENT.cs#L5-L10)
```cs:line-numbers=5

public class ELEMENT
{
	public const int difficulty = 765; // [!code ++]
 // [!code ++]
	public const int air = 763;

	public const int recharge = 761;
```

[`public class ELEMENT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/ELEMENT.cs#L75-L86)
```cs:line-numbers=75

	public const int poison = 20;

	public static readonly int[] IDS = new int[35] // [!code --]
	public static readonly int[] IDS = new int[36] // [!code ++]
	{
		763, 761, 751, 752, 753, 754, 755, 756, 759, 760, // [!code --]
		762, 750, 0, 1, 2, 3, 5, 10, 11, 12, // [!code --]
		13, 15, 16, 17, 18, 14, 21, 22, 23, 24, // [!code --]
		25, 26, 29, 85, 20 // [!code --]
		765, 763, 761, 751, 752, 753, 754, 755, 756, 759, // [!code ++]
		760, 762, 750, 0, 1, 2, 3, 5, 10, 11, // [!code ++]
		12, 13, 15, 16, 17, 18, 14, 21, 22, 23, // [!code ++]
		24, 25, 26, 29, 85, 20 // [!code ++]
	};
}
public class Element : EClass
```

## FACTION

[`public class FACTION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/FACTION.cs#L10-L21)
```cs:line-numbers=10

	public const int bfHill = 3603;

	public const int bfRuin = 3702; // [!code --]
 // [!code --]
	public const int bfSea = 3605;

	public const int bfUndersea = 3606;

	public const int bfRuin = 3702; // [!code ++]
 // [!code ++]
	public const int bfPlain = 3600;

	public const int bfFertile = 3700;
```

[`public class FACTION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/FACTION.cs#L112-L118)
```cs:line-numbers=112

	public static readonly int[] IDS = new int[53]
	{
		3601, 3602, 3603, 3702, 3605, 3606, 3600, 3700, 3701, 3604, // [!code --]
		3601, 3602, 3603, 3605, 3606, 3702, 3600, 3700, 3701, 3604, // [!code ++]
		3500, 2201, 2206, 2205, 2204, 2203, 2202, 2200, 2120, 2119,
		2117, 3703, 2118, 2207, 3704, 3805, 3706, 2115, 4006, 4005,
		4004, 4003, 4002, 4001, 4000, 3900, 3804, 3803, 3802, 3801,
```

## TraitBaseSpellbook

[`public enum Type`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/TraitBaseSpellbook.cs#L21-L27)
```cs:line-numbers=21

	public virtual Type BookType => Type.Spell;

	public virtual int Difficulty => 10 + owner.LV; // [!code --]
	public virtual int Difficulty => (10 + owner.LV) * (100 + owner.Evalue(765) / 2) / 100; // [!code ++]

	public override bool CanStack => false;

```

[`public override void OnRead(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/TraitBaseSpellbook.cs#L174-L180)
```cs:line-numbers=174
	case Type.RandomSpell:
		if (c.IsPC)
		{
			c.GainAbility(source.id); // [!code --]
			c.GainAbility(source.id, 100, owner.Thing); // [!code ++]
		}
		ModCharge(c);
		break;
```

## TraitSpellbook

[`public static void Create(Card owner, int ele)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/TraitSpellbook.cs#L10-L15)
```cs:line-numbers=10
	{
		owner.elements.SetBase(759, 10);
	}
	switch (row.id) // [!code ++]
	{ // [!code ++]
	case 8430: // [!code ++]
		owner.elements.SetBase(765, 50); // [!code ++]
		break; // [!code ++]
	case 9155: // [!code ++]
		owner.elements.SetBase(765, 90); // [!code ++]
		break; // [!code ++]
	case 8390: // [!code ++]
	case 8550: // [!code ++]
		owner.elements.SetBase(765, 100); // [!code ++]
		break; // [!code ++]
	} // [!code ++]
	if (row.charge == 1)
	{
		owner.c_charges = 1;
```

## ZoneEventSiege

[`public class ZoneEventSiege : ZoneEvent`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/55437d07cc2f5bf574110ab8c2336b0fc5252635/Elin/ZoneEventSiege.cs#L27-L35)
```cs:line-numbers=27
	public virtual Chara CreateChara(Point p)
	{
		bool flag = idx == max - 1;
		SpawnSetting spawnSetting = ((lv >= 50 && idx == max - 2) ? SpawnSetting.Evolved(lv) : (flag ? SpawnSetting.Boss(lv) : SpawnSetting.DefenseEnemy(lv))); // [!code --]
		int num; // [!code ++]
		object obj; // [!code ++]
		if (lv >= 50) // [!code ++]
		{ // [!code ++]
			num = ((idx == max - 2) ? 1 : 0); // [!code ++]
			if (num != 0) // [!code ++]
			{ // [!code ++]
				obj = SpawnSetting.Evolved(lv); // [!code ++]
				goto IL_005a; // [!code ++]
			} // [!code ++]
		} // [!code ++]
		else // [!code ++]
		{ // [!code ++]
			num = 0; // [!code ++]
		} // [!code ++]
		obj = (flag ? SpawnSetting.Boss(lv) : SpawnSetting.DefenseEnemy(lv)); // [!code ++]
		goto IL_005a; // [!code ++]
		IL_005a: // [!code ++]
		SpawnSetting spawnSetting = (SpawnSetting)obj; // [!code ++]
		spawnSetting.dangerLv = lv + 1;
		return EClass._zone.SpawnMob(p, spawnSetting); // [!code --]
		if (num == 0) // [!code ++]
		{ // [!code ++]
			return EClass._zone.SpawnMob(p, spawnSetting); // [!code ++]
		} // [!code ++]
		return EClass._zone.TryGenerateEvolved(force: true, p); // [!code ++]
	}

	public override void OnInit()
```

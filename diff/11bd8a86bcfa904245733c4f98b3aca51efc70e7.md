---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 48 files modified. 2 new files created.
version: EA 23.62 Nightly hotfix 1
changes: ABILITY/AM_Build/ActEffect/Affinity/Biography/ButtonElement/CINT/Card/Chara/ContentConfigGame/CoreConfig/CraftUtil/DOMAIN/DramaActor/DramaOutcome/ELEMENT/ENC/FACTION/FEAT/FOOD/FoodEffect/+FortuneRollData/Game/InvOwnerDraglet/LayerDragGrid/MUTATION/POLICY/Player/RecipeCard/Religion/Scene/SerializedCards/Thing/ThingGen/Trait/TraitAltar/TraitCrafter/TraitDoor/TraitGiftJure/TraitGodStatue/TraitMusicBox/+TraitPartTimeMascot/TraitRollingFortune/UIDragGridInfo/UIDragGridIngredients/UIInventory/UIPlaceHelper/WindowChara/Zone
---

# EA 23.62 Nightly hotfix 1

December 21, 2024

48 files modified. 2 new files created.

## Important Changes

Possible breaking changes. Click the filename to view the chunk.
### [Chara (1)](#chara)
```cs:no-line-numbers
public List<Element> ListAvailabeFeats(bool pet = false) // [!code --]
public List<Element> ListAvailabeFeats(bool pet = false, bool showAll = false) // [!code ++]
```
### [FEAT (1)](#feat)
```cs:no-line-numbers
public bool IsAvailable(ElementContainer owner, int a = 1) // [!code --]

```
### [Religion (2)](#religion)
```cs:no-line-numbers
public void JoinFaith(Chara c) // [!code --]
public void JoinFaith(Chara c, ConvertType type = ConvertType.Default) // [!code ++]
```
```cs:no-line-numbers
public void LeaveFaith(Chara c, Religion newFaith) // [!code --]
public void LeaveFaith(Chara c, Religion newFaith, ConvertType type) // [!code ++]
```
### [TraitDoor (1)](#traitdoor)
```cs:no-line-numbers
public bool IsValid() // [!code --]
public bool IsValid(bool shouldLookGood = true) // [!code ++]
```
## ABILITY

[`@@ -4,6 +4,8 @@ public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ABILITY.cs#L4-L9)
```cs:line-numbers=4
{
	public const int ActChat = 5044;

	public const int TaskBuild = 5035; // [!code ++]
 // [!code ++]
	public const int TaskMoveInstalled = 5036;

	public const int ActNoItem = 5037;
```

[`@@ -30,11 +32,11 @@ public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ABILITY.cs#L30-L40)
```cs:line-numbers=30

	public const int AI_OpenLock = 5049;

	public const int AI_Sleep = 5050; // [!code --]
	public const int GoalIdle = 5034; // [!code ++]

	public const int TaskBuild = 5035; // [!code --]
	public const int AI_Sleep = 5050; // [!code ++]

	public const int ActZap = 5051; // [!code --]
	public const int ActBash = 5052; // [!code ++]

	public const int TaskHarvest = 5053;

```

[`@@ -62,15 +64,15 @@ public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ABILITY.cs#L62-L76)
```cs:line-numbers=62

	public const int ActPray = 6050;

	public const int ActEscape = 6400; // [!code --]
	public const int ActZap = 5051; // [!code ++]

	public const int ActBash = 5052; // [!code --]
	public const int ActEscape = 6400; // [!code ++]

	public const int ActSuicide = 6410; // [!code --]
	public const int ActCancelTask = 5033; // [!code ++]

	public const int GoalIdle = 5034; // [!code --]
	public const int AI_Deconstruct = 5031; // [!code ++]

	public const int AI_Equip = 5032; // [!code --]
	public const int ActMelee = 5001; // [!code ++]

	public const int Melee = 5002;

```

[`@@ -98,11 +100,11 @@ public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ABILITY.cs#L98-L108)
```cs:line-numbers=98

	public const int TaskPlow = 5014;

	public const int TaskAttack = 5015; // [!code --]
	public const int AI_Equip = 5032; // [!code ++]

	public const int ActCancelTask = 5033; // [!code --]
	public const int TaskAttack = 5015; // [!code ++]

	public const int TaskTame = 5016; // [!code --]
	public const int TaskTalk = 5017; // [!code ++]

	public const int TaskPick = 5018;

```

[`@@ -130,15 +132,13 @@ public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ABILITY.cs#L130-L144)
```cs:line-numbers=130

	public const int AI_ReleaseHeld = 5030;

	public const int AI_Deconstruct = 5031; // [!code --]
 // [!code --]
	public const int TaskTalk = 5017; // [!code --]
 // [!code --]
	public const int ActMelee = 5001; // [!code --]
	public const int TaskTame = 5016; // [!code ++]

	public const int ActDuplicate = 6420;

	public const int ActCrabBreathe = 6500; // [!code --]
	public const int ActSuicide = 6410; // [!code ++]
 // [!code ++]
	public const int breathe_Darkness = 50203; // [!code ++]

	public const int ActLulwyTrick = 6902;

```

[`@@ -158,10 +158,10 @@ public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ABILITY.cs#L158-L167)
```cs:line-numbers=158

	public const int breathe_Mind = 50204;

	public const int ActJureHeal = 6901; // [!code --]
 // [!code --]
	public const int breathe_Poison = 50205;

	public const int breathe_Nether = 50206; // [!code ++]
 // [!code ++]
	public const int breathe_Sound = 50207;

	public const int breathe_Nerve = 50208;
```

[`@@ -178,19 +178,19 @@ public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ABILITY.cs#L178-L196)
```cs:line-numbers=178

	public const int breathe_Cut = 50214;

	public const int ActWait = 5000; // [!code --]
	public const int ActJureHeal = 6901; // [!code ++]

	public const int breathe_Nether = 50206; // [!code --]
	public const int StManaCost = 6720; // [!code ++]

	public const int ActManaAbsorb = 6900;

	public const int breathe_Darkness = 50203; // [!code --]
	public const int ActGazeDim = 6620; // [!code ++]

	public const int StManaCost = 6720; // [!code --]
	public const int ActCurse = 6600; // [!code ++]

	public const int ActEntangle = 6601;

	public const int ActCurse = 6600; // [!code --]
	public const int ActWait = 5000; // [!code ++]

	public const int ActDraw = 6602;

```

[`@@ -202,11 +202,13 @@ public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ABILITY.cs#L202-L212)
```cs:line-numbers=202

	public const int ActTouchSleep = 6612;

	public const int StTaunt = 6700; // [!code ++]
 // [!code ++]
	public const int ActGazeInsane = 6621;

	public const int ActGazeMutation = 6622;

	public const int ActGazeDim = 6620; // [!code --]
	public const int ActDrainBlood = 6626; // [!code ++]

	public const int ActInsult = 6630;

```

[`@@ -224,24 +226,22 @@ public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ABILITY.cs#L224-L247)
```cs:line-numbers=224

	public const int ActThrowPotion = 6661;

	public const int StTaunt = 6700; // [!code --]
 // [!code --]
	public const int ActDrainBlood = 6626; // [!code --]
	public const int ActCrabBreathe = 6500; // [!code ++]

	public static readonly int[] IDS = new int[113]
	{
		5044, 5036, 5037, 5038, 5039, 5040, 5041, 5042, 5043, 5045, // [!code --]
		5046, 5047, 5048, 5049, 5050, 5035, 5051, 5053, 5054, 5055, // [!code --]
		6001, 6003, 6011, 6012, 6013, 6015, 6018, 6019, 6020, 6050, // [!code --]
		6400, 5052, 6410, 5034, 5032, 5002, 5003, 5004, 5005, 5006, // [!code --]
		5007, 5008, 5009, 5010, 5011, 5012, 5013, 5014, 5015, 5033, // [!code --]
		5016, 5018, 5019, 5020, 5021, 5022, 5023, 5024, 5025, 5026, // [!code --]
		5027, 5028, 5029, 5030, 5031, 5017, 5001, 6420, 6500, 6902, // [!code --]
		6903, 6904, 7000, 50200, 50201, 50202, 6450, 50204, 6901, 50205, // [!code --]
		50207, 50208, 50209, 50210, 50211, 50212, 50213, 50214, 5000, 50206, // [!code --]
		6900, 50203, 6720, 6601, 6600, 6602, 6603, 6610, 6611, 6612, // [!code --]
		6621, 6622, 6620, 6630, 6631, 6640, 6641, 6642, 6650, 6660, // [!code --]
		6661, 6700, 6626 // [!code --]
		5044, 5035, 5036, 5037, 5038, 5039, 5040, 5041, 5042, 5043, // [!code ++]
		5045, 5046, 5047, 5048, 5049, 5034, 5050, 5052, 5053, 5054, // [!code ++]
		5055, 6001, 6003, 6011, 6012, 6013, 6015, 6018, 6019, 6020, // [!code ++]
		6050, 5051, 6400, 5033, 5031, 5001, 5002, 5003, 5004, 5005, // [!code ++]
		5006, 5007, 5008, 5009, 5010, 5011, 5012, 5013, 5014, 5032, // [!code ++]
		5015, 5017, 5018, 5019, 5020, 5021, 5022, 5023, 5024, 5025, // [!code ++]
		5026, 5027, 5028, 5029, 5030, 5016, 6420, 6410, 50203, 6902, // [!code ++]
		6903, 6904, 7000, 50200, 50201, 50202, 6450, 50204, 50205, 50206, // [!code ++]
		50207, 50208, 50209, 50210, 50211, 50212, 50213, 50214, 6901, 6720, // [!code ++]
		6900, 6620, 6600, 6601, 5000, 6602, 6603, 6610, 6611, 6612, // [!code ++]
		6700, 6621, 6622, 6626, 6630, 6631, 6640, 6641, 6642, 6650, // [!code ++]
		6660, 6661, 6500 // [!code ++]
	};
}
public class Ability : Act
```

## AM_Build

[`@@ -379,6 +379,10 @@ public void ModAltitude(int a)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/AM_Build.cs#L379-L384)
```cs:line-numbers=379

	public void SetAltitude(int a)
	{
		if (mold == null) // [!code ++]
		{ // [!code ++]
			CreateNewMold(); // [!code ++]
		} // [!code ++]
		altitude = (mold.altitude = a);
		recipe.OnChangeAltitude(a);
		if (recipe.tileType.AltitudeAsDir && !IsRoofEditMode())
```

## ActEffect

[`@@ -2206,7 +2206,7 @@ public static bool Wish(string s, string name, int power)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ActEffect.cs#L2206-L2212)
```cs:line-numbers=2206
		{
			continue;
		}
		string text = r.GetName(1).ToLower(); // [!code --]
		string text = r.GetName().ToLower(); // [!code ++]
		int score = Compare(_s, text);
		if (score == 0)
		{
```

## Affinity

[`@@ -62,6 +62,7 @@ public bool CanSleepBeside()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Affinity.cs#L62-L67)
```cs:line-numbers=62

	public Thing OnGift(Thing t)
	{
		t.CheckJustCooked(); // [!code ++]
		Thing result = CC.AddThing(t.Thing);
		EClass.pc.PlaySound("build_resource");
		int num = 0;
```

[`@@ -73,7 +74,7 @@ public Thing OnGift(Thing t)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Affinity.cs#L73-L79)
```cs:line-numbers=73
		flag2 = true;
	}
	num = Mathf.Clamp(t.GetPrice() / (flag2 ? 10 : (flag ? 20 : 200)), 0, 50) + (flag2 ? 20 : (flag ? 5 : 0));
	num = num * 100 / (100 + CC.LV * 10); // [!code --]
	num = num * (100 + (t.HasElement(757) ? 50 : 0)) / (100 + CC.LV * 10); // [!code ++]
	if (num2)
	{
		num += 100;
```

## Biography

[`@@ -275,8 +275,6 @@ public int age`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Biography.cs#L275-L282)
```cs:line-numbers=275
		}
	}

	public int ageOriginal => EClass.game.Prologue.year - birthYear; // [!code --]
 // [!code --]
	public bool IsUnderAge => age < 18;

	public string TextAge(Chara c)
```

[`@@ -284,7 +282,7 @@ public string TextAge(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Biography.cs#L284-L290)
```cs:line-numbers=284
	object obj;
	if (age < 1000)
	{
		obj = (c.IsUnique ? ageOriginal : age).ToString(); // [!code --]
		obj = (c.IsUnique ? GetOriginalAge(c) : age).ToString(); // [!code ++]
		if (obj == null)
		{
			return "";
```

[`@@ -297,6 +295,16 @@ public string TextAge(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Biography.cs#L297-L302)
```cs:line-numbers=297
		return (string)obj;
	}

	public int GetOriginalAge(Chara c) // [!code ++]
	{ // [!code ++]
		string[] array = c.source.bio.Split('/'); // [!code ++]
		if (array.Length > 1) // [!code ++]
		{ // [!code ++]
			return int.Parse(array[1]); // [!code ++]
		} // [!code ++]
		return age; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void Generate(Chara c)
	{
		string bio = c.source.bio;
```

## ButtonElement

[`@@ -77,12 +77,12 @@ public void Refresh()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ButtonElement.cs#L77-L88)
```cs:line-numbers=77
		break;
	case Mode.LandFeat:
	{
		string text2 = text + e.Name; // [!code --]
		string text3 = text + e.Name; // [!code ++]
		if (e.HasTag("network") && EClass.Branch != null && EClass.Branch.HasNetwork)
		{
			text2 = "feat_network".lang(text2); // [!code --]
			text3 = "feat_network".lang(text3); // [!code ++]
		}
		mainText.SetText(text2 + " " + e.Value, FontColor.Default); // [!code --]
		mainText.SetText(text3 + " " + e.Value, FontColor.Default); // [!code ++]
		subText.horizontalOverflow = HorizontalWrapMode.Overflow;
		subText.text = e.GetDetail().SplitNewline()[0].StripLastPun();
		if ((bool)imagePotential)
```

[`@@ -96,20 +96,21 @@ public void Refresh()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ButtonElement.cs#L96-L115)
```cs:line-numbers=96
	case Mode.FeatMini:
		if (mode == Mode.FeatPurchase)
		{
			mainText.SetText(e.FullName, FontColor.Default); // [!code --]
			e.IsPurchaseFeatReqMet(EClass.pc.elements); // [!code ++]
			mainText.SetText(e.FullName, e.IsPurchaseFeatReqMet(EClass.pc.elements) ? FontColor.Default : FontColor.Warning); // [!code ++]
			subText.text = e.GetDetail().SplitNewline()[0].StripLastPun();
			subText2.text = "".TagColor((EClass.pc.feat >= e.CostLearn) ? EClass.Colors.Skin.textGood : EClass.Colors.Skin.textBad, e.CostLearn.ToString() ?? "");
		}
		else
		{
			string text3 = ((mode == Mode.FeatMini) ? e.FullName : e.source.GetText("textPhase").SplitNewline().TryGet(e.Value - 1) // [!code --]
			string text2 = ((mode == Mode.FeatMini) ? e.FullName : e.source.GetText("textPhase").SplitNewline().TryGet(e.Value - 1) // [!code ++]
				.StripLastPun());
			FontColor c = (e.HasTag("neg") ? FontColor.Bad : FontColor.ButtonSelectable);
			if (e.source.category == "ether")
			{
				c = FontColor.Ether;
			}
			mainText.SetText(text + text3, c); // [!code --]
			mainText.SetText(text + text2, c); // [!code ++]
			subText.text = ((mode == Mode.FeatMini) ? "" : (e as Feat).GetHint(owner));
		}
		if ((bool)imagePotential)
```

[`@@ -145,7 +146,7 @@ public void Refresh()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ButtonElement.cs#L145-L151)
```cs:line-numbers=145
		imagePotential.color = ((num >= 0) ? Color.white : new Color(1f, 0.7f, 0.7f));
	}
	e.SetImage(icon);
	if (mode == Mode.FeatPurchase && e.Value > 1) // [!code --]
	if (mode == Mode.FeatPurchase) // [!code ++]
	{
		Element refEle = Element.Create(e.id, e.Value - 1);
		SetTooltip("note", delegate(UITooltip tt)
```

## CINT

[`@@ -102,6 +102,8 @@ public class CINT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/CINT.cs#L102-L107)
```cs:line-numbers=102

	public const int bossType = 65;

	public const int dateCooked = 66; // [!code ++]
 // [!code ++]
	public const int fiamaPet = 100;

	public const int noRestock = 101;
```

## Card

[`@@ -1237,6 +1237,18 @@ public int c_fur`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Card.cs#L1237-L1242)
```cs:line-numbers=1237
		}
	}

	public int c_dateCooked // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			return GetInt(66); // [!code ++]
		} // [!code ++]
		set // [!code ++]
		{ // [!code ++]
			SetInt(66, value); // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public int c_containerSize
	{
		get
```

[`@@ -5549,6 +5561,10 @@ public void DecayNatural(int hour = 1)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Card.cs#L5549-L5554)
```cs:line-numbers=5549
		{
			t.DecayNatural(hour);
		});
		if (sourceCard._origin == "dish") // [!code ++]
		{ // [!code ++]
			CheckJustCooked(); // [!code ++]
		} // [!code ++]
		if (parent is Card && (parent as Card).trait.CanChildDecay(this))
		{
			Decay(10 * hour);
```

[`@@ -5560,6 +5576,15 @@ public void DecayNatural(int hour = 1)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Card.cs#L5560-L5565)
```cs:line-numbers=5560
		}
	}

	public void CheckJustCooked() // [!code ++]
	{ // [!code ++]
		if (HasElement(757) && c_dateCooked <= EClass.world.date.GetRaw() - 120) // [!code ++]
		{ // [!code ++]
			c_dateCooked = 0; // [!code ++]
			elements.Remove(757); // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void Decay(int a = 10)
	{
		Card card = parent as Card;
```

## Chara

[`@@ -1547,7 +1547,7 @@ public int GetBurden(Card t = null, int num = -1)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Chara.cs#L1547-L1553)
```cs:line-numbers=1547

	public void CalcBurden()
	{
		int num = base.ChildrenWeight * 100 / WeightLimit; // [!code --]
		int num = base.ChildrenWeight * 100 / Mathf.Max(1, WeightLimit); // [!code ++]
		if (num < 0)
		{
			num = 1000;
```

[`@@ -6220,13 +6220,20 @@ public void ShowDialog()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Chara.cs#L6220-L6232)
```cs:line-numbers=6220
		{
			string tag = ((trait is TraitDoorman_Fighter) ? "fighter" : ((trait is TraitDoorman_Mage) ? "mage" : "thief"));
			ShowDialog("guild_doorman", "main", tag);
			return; // [!code ++]
		}
		else if (trait is TraitGuildClerk) // [!code --]
		if (trait is TraitGuildClerk) // [!code ++]
		{
			string tag2 = ((trait is TraitClerk_Fighter) ? "fighter" : ((trait is TraitClerk_Mage) ? "mage" : "thief"));
			ShowDialog("guild_clerk", "main", tag2);
			return; // [!code ++]
		} // [!code ++]
		bool flag = true; // [!code ++]
		if (id == "parttimer_jure" && (!EClass._zone.IsFestival || !(EClass._zone is Zone_Noyel) || EClass.pc.faith == EClass.game.religions.Healing)) // [!code ++]
		{ // [!code ++]
			flag = false; // [!code ++]
		}
		else if (File.Exists(CorePath.DramaData + id + ".xlsx")) // [!code --]
		if (flag && File.Exists(CorePath.DramaData + id + ".xlsx")) // [!code ++]
		{
			ShowDialog(id);
		}
```

[`@@ -8577,14 +8584,14 @@ public void ModCorruption(int a)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Chara.cs#L8577-L8590)
```cs:line-numbers=8577
		corruption = num2 * 100 + corruption % 100;
	}

	public List<Element> ListAvailabeFeats(bool pet = false) // [!code --]
	public List<Element> ListAvailabeFeats(bool pet = false, bool showAll = false) // [!code ++]
	{
		List<Element> list = new List<Element>();
		foreach (SourceElement.Row item in EClass.sources.elements.rows.Where((SourceElement.Row a) => a.group == "FEAT" && a.cost[0] != -1 && !a.categorySub.IsEmpty()))
		{
			Feat feat = elements.GetOrCreateElement(item.id) as Feat;
			int num = ((feat.ValueWithoutLink <= 0) ? 1 : (feat.ValueWithoutLink + 1));
			if (num <= feat.source.max && !feat.HasTag("class") && !feat.HasTag("hidden") && !feat.HasTag("innate") && (!pet || !feat.HasTag("noPet")) && feat.IsAvailable(elements, feat.Value)) // [!code --]
			if (num <= feat.source.max && !feat.HasTag("class") && !feat.HasTag("hidden") && !feat.HasTag("innate") && (!pet || !feat.HasTag("noPet")) && (showAll || feat.IsPurchaseFeatReqMet(elements))) // [!code ++]
			{
				list.Add(Element.Create(feat.id, num) as Feat);
			}
```

## ContentConfigGame

[`@@ -45,6 +45,8 @@ public class ContentConfigGame : ContentConfig`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ContentConfigGame.cs#L45-L50)
```cs:line-numbers=45

	public UIButton toggleAutoBackup;

	public UIButton toggleSortEach; // [!code ++]
 // [!code ++]
	public UISelectableGroup groupBackerFilter;

	public UISelectableGroup groupBorder;
```

[`@@ -145,6 +147,10 @@ public override void OnInstantiate()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ContentConfigGame.cs#L145-L150)
```cs:line-numbers=145
	{
		base.config.game.advancedMenu = on;
	});
	toggleSortEach.SetToggle(base.config.game.sortEach, delegate(bool on) // [!code ++]
	{ // [!code ++]
		base.config.game.sortEach = on; // [!code ++]
	}); // [!code ++]
	toggleOffhand.SetToggle(base.config.game.showOffhand, delegate(bool on)
	{
		base.config.game.showOffhand = on;
```

## CoreConfig

[`@@ -108,6 +108,8 @@ public class GameConfig`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/CoreConfig.cs#L108-L113)
```cs:line-numbers=108

		public bool autoBackup;

		public bool sortEach; // [!code ++]
 // [!code ++]
		public bool autopause;

		public bool showQuickMenuHint;
```

## CraftUtil

[`@@ -151,7 +151,7 @@ public static Card MixIngredients(Card product, List<Thing> ings, MixType type,`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/CraftUtil.cs#L151-L157)
```cs:line-numbers=151
	foreach (Element value2 in product.elements.dict.Values)
	{
		int id = value2.id;
		if ((uint)(id - 914) > 1u && value2.Value >= 0 && IsValidTrait(value2)) // [!code --]
		if ((uint)(id - 914) > 1u && value2.Value >= 0 && (value2.HasTag("noInherit") || IsValidTrait(value2))) // [!code ++]
		{
			product.elements.SetTo(value2.id, 0);
		}
```

[`@@ -222,6 +222,10 @@ public static Card MixIngredients(Card product, List<Thing> ings, MixType type,`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/CraftUtil.cs#L222-L227)
```cs:line-numbers=222
	return product;
	bool IsValidTrait(Element e)
	{
		if (e.HasTag("noInherit")) // [!code ++]
		{ // [!code ++]
			return false; // [!code ++]
		} // [!code ++]
		switch (type)
		{
		case MixType.General:
```

## DOMAIN

[`@@ -2,42 +2,42 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/DOMAIN.cs#L2-L43)
```cs:line-numbers=2

public class DOMAIN
{
	public const int domArcane = 804; // [!code --]
	public const int domMiracle = 803; // [!code ++]

	public const int domTest = 800; // [!code --]
	public const int domFaith = 802; // [!code ++]

	public const int domSurvival = 801; // [!code --]
	public const int domTest = 800; // [!code ++]

	public const int domFaith = 802; // [!code --]
	public const int domArcane = 804; // [!code ++]

	public const int domMiracle = 803; // [!code --]
	public const int domSurvival = 801; // [!code ++]

	public const int domComm = 805;

	public const int domEarth = 812; // [!code --]
	public const int domEyth = 814; // [!code ++]

	public const int domWind = 807;

	public const int domHarvest = 808; // [!code --]
	public const int domEarth = 812; // [!code ++]

	public const int domMachine = 809; // [!code --]
	public const int domElement = 806; // [!code ++]

	public const int domLuck = 810; // [!code --]
	public const int domOblivion = 813; // [!code ++]

	public const int domHealing = 811; // [!code --]
	public const int domHarmony = 815; // [!code ++]

	public const int domEyth = 814; // [!code --]
	public const int domLuck = 810; // [!code ++]

	public const int domOblivion = 813; // [!code --]
	public const int domMachine = 809; // [!code ++]

	public const int domElement = 806; // [!code --]
	public const int domHarvest = 808; // [!code ++]

	public const int domHarmony = 815; // [!code --]
	public const int domHealing = 811; // [!code ++]

	public static readonly int[] IDS = new int[16]
	{
		804, 800, 801, 802, 803, 805, 812, 807, 808, 809, // [!code --]
		810, 811, 814, 813, 806, 815 // [!code --]
		803, 802, 800, 804, 801, 805, 814, 807, 812, 806, // [!code ++]
		813, 815, 810, 809, 808, 811 // [!code ++]
	};
}
public class Domain : EClass
```

## DramaActor

[`@@ -75,7 +75,7 @@ public void Talk(string text, List<DramaChoice> choices, bool center, bool unkno`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/DramaActor.cs#L75-L81)
```cs:line-numbers=75
			dialog.transRank.SetActive(flag);
			if (flag)
			{
				dialog.textRank.text = "factionRank2".lang() + " " + chara.trait.GetAdvRankText(); // [!code --]
				dialog.textRank.text = "factionRank2".lang() + " " + chara.trait.GetAdvRankText() + " " + ((chara.GetInt(111) > 0) ? "advDefeated".lang(chara.GetInt(111).ToString() ?? "") : ""); // [!code ++]
			}
		}
		if (chara != null)
```

## DramaOutcome

[`@@ -58,6 +58,16 @@ public void AddMaid()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/DramaOutcome.cs#L58-L63)
```cs:line-numbers=58
	{
	}

	public void convert_Jure() // [!code ++]
	{ // [!code ++]
		EMono.game.religions.Healing.JoinFaith(EMono.pc, Religion.ConvertType.Campaign); // [!code ++]
		if (!EMono.player.flags.gotJurePillow) // [!code ++]
		{ // [!code ++]
			EMono.player.flags.gotJurePillow = true; // [!code ++]
			EMono.player.DropReward(ThingGen.Create("pillow_jure")); // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void QuestSharedContainer_Drop1()
	{
		EMono.player.DropReward(ThingGen.Create("chest6"));
```

## ELEMENT

[`@@ -5,9 +5,9 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ELEMENT.cs#L5-L13)
```cs:line-numbers=5

public class ELEMENT
{
	public const int hotspring = 756; // [!code --]
	public const int justcooked = 757; // [!code ++]

	public const int blood = 755; // [!code --]
	public const int hotspring = 756; // [!code ++]

	public const int nerve = 754;

```

[`@@ -19,15 +19,17 @@ public class ELEMENT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ELEMENT.cs#L19-L33)
```cs:line-numbers=19

	public const int comfort = 750;

	public const int blood = 755; // [!code ++]
 // [!code ++]
	public const int _void = 0;

	public const int d = 3; // [!code --]
	public const int socket = 5; // [!code ++]

	public const int lv = 1;

	public const int quality = 2;

	public const int socket = 5; // [!code --]
	public const int d = 3; // [!code ++]

	public const int nutrition = 10;

```

[`@@ -65,11 +67,12 @@ public class ELEMENT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ELEMENT.cs#L65-L75)
```cs:line-numbers=65

	public const int poison = 20;

	public static readonly int[] IDS = new int[30] // [!code --]
	public static readonly int[] IDS = new int[31] // [!code ++]
	{
		756, 755, 754, 753, 752, 751, 750, 0, 3, 1, // [!code --]
		2, 5, 10, 11, 12, 13, 14, 16, 17, 18, // [!code --]
		15, 21, 22, 23, 24, 25, 26, 29, 85, 20 // [!code --]
		757, 756, 754, 753, 752, 751, 750, 755, 0, 5, // [!code ++]
		1, 2, 3, 10, 11, 12, 13, 14, 16, 17, // [!code ++]
		18, 15, 21, 22, 23, 24, 25, 26, 29, 85, // [!code ++]
		20 // [!code ++]
	};
}
public class Element : EClass
```

[`@@ -554,7 +557,14 @@ public void WriteNoteWithRef(UINote n, ElementContainer owner, Action<UINote> on`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ELEMENT.cs#L554-L560)
```cs:line-numbers=554
	{
		n.Clear();
		_WriteNote(n, owner, onWriteNote, isRef: false);
		refEle._WriteNote(n, owner, onWriteNote, isRef: true); // [!code --]
		if (refEle.Value > 0) // [!code ++]
		{ // [!code ++]
			refEle._WriteNote(n, owner, onWriteNote, isRef: true); // [!code ++]
		} // [!code ++]
		if (!IsPurchaseFeatReqMet(owner)) // [!code ++]
		{ // [!code ++]
			WritePurchaseReq(n); // [!code ++]
		} // [!code ++]
		n.Build();
	}

```

[`@@ -844,6 +854,15 @@ public virtual void SetTextValue(UIText text)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ELEMENT.cs#L844-L849)
```cs:line-numbers=844
		text.text = text2;
	}

	public virtual bool IsPurchaseFeatReqMet(ElementContainer owner, int lv = -1) // [!code ++]
	{ // [!code ++]
		return false; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public virtual void WritePurchaseReq(UINote n, int lv = 1) // [!code ++]
	{ // [!code ++]
	} // [!code ++]
 // [!code ++]
	public static Element Create(int id, int v = 0)
	{
		SourceElement.Row row = EClass.sources.elements.map.TryGetValue(id);
```

## ENC

[`@@ -1,30 +1,28 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ENC.cs#L1-L30)
```cs:line-numbers=1
public class ENC
{
	public const int noDamage = 654; // [!code ++]
 // [!code ++]
	public const int living = 653;

	public const int eco = 652;

	public const int r_PV = 651;

	public const int r_DV = 650; // [!code --]
 // [!code --]
	public const int mod_scatter = 607; // [!code --]
 // [!code --]
	public const int mod_precision = 605; // [!code --]
	public const int r_mana = 641; // [!code ++]

	public const int mod_drill = 606;

	public const int r_life = 640; // [!code --]
 // [!code --]
	public const int noDamage = 654; // [!code --]
	public const int mod_scatter = 607; // [!code ++]

	public const int r_mana = 641; // [!code --]
	public const int r_life = 640; // [!code ++]

	public const int onlyPet = 655;

	public const int convertCold = 851; // [!code --]
	public const int r_DV = 650; // [!code ++]

	public const int absorbHP = 660; // [!code --]
	public const int permaCurse = 656; // [!code ++]
 // [!code ++]
	public const int convertFire = 850; // [!code ++]

	public const int absorbMP = 661;

```

[`@@ -38,21 +36,21 @@ public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ENC.cs#L38-L58)
```cs:line-numbers=38

	public const int meleeDistance = 666;

	public const int convertLightning = 852; // [!code --]
	public const int convertCold = 851; // [!code ++]

	public const int mod_ammo_recover = 604; // [!code --]
	public const int mod_precision = 605; // [!code ++]

	public const int convertImpact = 865;

	public const int convertFire = 850; // [!code --]
	public const int convertLightning = 852; // [!code ++]

	public const int permaCurse = 656; // [!code --]
	public const int absorbHP = 660; // [!code ++]

	public const int mod_ammo_knockback = 603; // [!code --]
	public const int mod_ammo_recover = 604; // [!code ++]

	public const int sustain_MAG = 446; // [!code --]
	public const int sustain_CHA = 447; // [!code ++]

	public const int mod_reload = 601; // [!code --]
	public const int mod_rapid = 602; // [!code ++]

	public const int breathing = 429;

```

[`@@ -108,13 +106,17 @@ public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ENC.cs#L108-L120)
```cs:line-numbers=108

	public const int negateParalysis = 422;

	public const int revealFaith = 481; // [!code --]
	public const int force_weapon = 482; // [!code ++]
 // [!code ++]
	public const int mod_reload = 601; // [!code ++]

	public const int mod_ammo = 600;

	public const int optimizeMana = 483;

	public const int force_weapon = 482; // [!code --]
	public const int sustain_DEX = 442; // [!code ++]
 // [!code ++]
	public const int revealFaith = 481; // [!code ++]

	public const int strongStomach = 480;

```

[`@@ -132,11 +134,13 @@ public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ENC.cs#L132-L142)
```cs:line-numbers=132

	public const int bane_fairy = 462;

	public const int bane_undead = 461; // [!code --]
	public const int mod_ammo_knockback = 603; // [!code ++]

	public const int mod_rapid = 602; // [!code --]
	public const int bane_dragon = 460; // [!code ++]

	public const int sustain_CHA = 447; // [!code --]
	public const int bane_undead = 461; // [!code ++]
 // [!code ++]
	public const int sustain_MAG = 446; // [!code ++]

	public const int sustain_WIL = 445;

```

[`@@ -144,19 +148,15 @@ public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ENC.cs#L144-L162)
```cs:line-numbers=144

	public const int sustain_PER = 443;

	public const int sustain_DEX = 442; // [!code --]
 // [!code --]
	public const int bane_dragon = 460; // [!code --]
 // [!code --]
	public static readonly int[] IDS = new int[74]
	{
		653, 652, 651, 650, 607, 605, 606, 640, 654, 641, // [!code --]
		655, 851, 660, 661, 662, 663, 664, 665, 666, 852, // [!code --]
		604, 865, 850, 656, 603, 446, 601, 429, 428, 427, // [!code --]
		426, 425, 424, 423, 421, 420, 416, 415, 440, 412, // [!code --]
		410, 409, 408, 407, 406, 405, 404, 403, 402, 401, // [!code --]
		400, 411, 441, 422, 481, 600, 483, 482, 480, 468, // [!code --]
		467, 466, 465, 464, 463, 462, 461, 602, 447, 445, // [!code --]
		444, 443, 442, 460 // [!code --]
		654, 653, 652, 651, 641, 606, 607, 640, 655, 650, // [!code ++]
		656, 850, 661, 662, 663, 664, 665, 666, 851, 605, // [!code ++]
		865, 852, 660, 604, 447, 602, 429, 428, 427, 426, // [!code ++]
		425, 424, 423, 421, 420, 416, 415, 440, 412, 410, // [!code ++]
		409, 408, 407, 406, 405, 404, 403, 402, 401, 400, // [!code ++]
		411, 441, 422, 482, 601, 600, 483, 442, 481, 480, // [!code ++]
		468, 467, 466, 465, 464, 463, 462, 603, 460, 461, // [!code ++]
		446, 445, 444, 443 // [!code ++]
	};
}
```

## FACTION

[`@@ -4,25 +4,27 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FACTION.cs#L4-L28)
```cs:line-numbers=4

public class FACTION
{
	public const int fRation = 2207; // [!code --]
 // [!code --]
	public const int bfCave = 3500;

	public const int bfPlain = 3600;

	public const int bfForest = 3601;

	public const int bfBeach = 3604; // [!code --]
 // [!code --]
	public const int bfHill = 3603; // [!code --]
	public const int bfSnow = 3602; // [!code ++]

	public const int bfSea = 3605;

	public const int bfBeach = 3604; // [!code ++]
 // [!code ++]
	public const int fRation = 2207; // [!code ++]
 // [!code ++]
	public const int bfFertile = 3700;

	public const int bfGeyser = 3701;

	public const int bfSnow = 3602; // [!code --]
	public const int bfRuin = 3702; // [!code ++]
 // [!code ++]
	public const int bfHill = 3603; // [!code ++]

	public const int fAttraction = 2206;

```

[`@@ -36,29 +38,29 @@ public class FACTION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FACTION.cs#L36-L64)
```cs:line-numbers=36

	public const int fSoil = 2200;

	public const int fTaxEvasion = 2119; // [!code ++]
 // [!code ++]
	public const int fLuck = 2118;

	public const int fLoyal = 2117;

	public const int fEducation = 2116;

	public const int fHeirloom = 2120; // [!code --]
 // [!code --]
	public const int fAdmin = 2115;

	public const int bfRuin = 3702; // [!code --]
	public const int bfTranquil = 3703; // [!code ++]

	public const int fConstruction = 2003;

	public const int fSafety = 2205;

	public const int fTaxEvasion = 2119; // [!code --]
	public const int fHeirloom = 2120; // [!code ++]

	public const int bfTranquil = 3703; // [!code --]
	public const int bfVolcano = 3704; // [!code ++]

	public const int bfHunt = 3705; // [!code --]
	public const int bfFish = 3706; // [!code ++]

	public const int bfVolcano = 3704; // [!code --]
	public const int bfHunt = 3705; // [!code ++]

	public const int actBuildRecipe = 4005;

```

[`@@ -80,10 +82,10 @@ public class FACTION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FACTION.cs#L80-L89)
```cs:line-numbers=80

	public const int bfGum = 3803;

	public const int bfSilica = 3802; // [!code --]
 // [!code --]
	public const int actBuildInspect = 4006;

	public const int bfMushroom = 3801; // [!code ++]
 // [!code ++]
	public const int bfCoal = 3800;

	public const int bfLandmark5 = 3784;
```

[`@@ -104,18 +106,16 @@ public class FACTION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FACTION.cs#L104-L121)
```cs:line-numbers=104

	public const int bfMonster = 3707;

	public const int bfFish = 3706; // [!code --]
 // [!code --]
	public const int bfMushroom = 3801; // [!code --]
	public const int bfSilica = 3802; // [!code ++]

	public static readonly int[] IDS = new int[52]
	{
		2207, 3500, 3600, 3601, 3604, 3603, 3605, 3700, 3701, 3602, // [!code --]
		2206, 2203, 2204, 2202, 2201, 2200, 2118, 2117, 2116, 2120, // [!code --]
		2115, 3702, 2003, 2205, 2119, 3703, 3705, 3704, 4005, 4004, // [!code --]
		4003, 4002, 4001, 4000, 3900, 3805, 3804, 3803, 3802, 4006, // [!code --]
		3800, 3784, 3783, 3782, 3781, 3780, 3710, 3709, 3708, 3707, // [!code --]
		3706, 3801 // [!code --]
		3500, 3600, 3601, 3602, 3605, 3604, 2207, 3700, 3701, 3702, // [!code ++]
		3603, 2206, 2203, 2204, 2202, 2201, 2200, 2119, 2118, 2117, // [!code ++]
		2116, 2115, 3703, 2003, 2205, 2120, 3704, 3706, 3705, 4005, // [!code ++]
		4004, 4003, 4002, 4001, 4000, 3900, 3805, 3804, 3803, 4006, // [!code ++]
		3801, 3800, 3784, 3783, 3782, 3781, 3780, 3710, 3709, 3708, // [!code ++]
		3707, 3802 // [!code ++]
	};
}
public class Faction : EClass
```

[`@@ -379,7 +379,7 @@ public void OnAdvanceMonth()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FACTION.cs#L379-L385)
```cs:line-numbers=379
	Msg.Say("getBill", Lang._currency(num, "money"));
	TryPayBill(thing2);
	Msg.Say("bills", EClass.player.taxBills.ToString() ?? "");
	if (EClass.player.taxBills >= 4) // [!code --]
	if (EClass.player.taxBills >= 4 && !EClass.debug.godMode) // [!code ++]
	{
		EClass.player.ModKarma(-50);
	}
```

## FEAT

[`@@ -3,15 +3,13 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FEAT.cs#L3-L17)
```cs:line-numbers=3

public class FEAT
{
	public const int featStamina = 1612; // [!code --]
 // [!code --]
	public const int featSTR = 1620;

	public const int featDEX = 1621;

	public const int featCHA = 1627; // [!code --]
	public const int featEND = 1622; // [!code ++]

	public const int featPER = 1623; // [!code --]
	public const int featLuck = 1628; // [!code ++]

	public const int featLER = 1624;

```

[`@@ -19,17 +17,21 @@ public class FEAT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FEAT.cs#L19-L35)
```cs:line-numbers=19

	public const int featWIL = 1626;

	public const int featEND = 1622; // [!code --]
	public const int featCHA = 1627; // [!code ++]

	public const int featMana = 1611; // [!code --]
	public const int featPER = 1623; // [!code ++]

	public const int featSwordsage = 1418; // [!code --]
	public const int featStamina = 1612; // [!code ++]
 // [!code ++]
	public const int featMilitant = 1419; // [!code ++]
 // [!code ++]
	public const int featLife = 1610; // [!code ++]

	public const int featManaMeat = 1421;

	public const int featExecutioner = 1420;

	public const int featMilitant = 1419; // [!code --]
	public const int featSwordsage = 1418; // [!code ++]

	public const int featWitch = 1417;

```

[`@@ -41,19 +43,19 @@ public class FEAT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FEAT.cs#L41-L59)
```cs:line-numbers=41

	public const int featFairysan = 1413;

	public const int featLuckyCat = 1412; // [!code --]
	public const int featSPD = 1629; // [!code ++]

	public const int featLuck = 1628; // [!code --]
	public const int featMana = 1611; // [!code ++]

	public const int featLife = 1610; // [!code --]
	public const int featHardy = 1630; // [!code ++]

	public const int featSPD = 1629; // [!code --]
	public const int featLonelySoul = 1646; // [!code ++]

	public const int featParty = 1645; // [!code --]
	public const int featEvade = 1632; // [!code ++]

	public const int featDefense = 1631; // [!code --]
	public const int featLuckyCat = 1412; // [!code ++]

	public const int featEarthStrength = 1411; // [!code --]
	public const int featChef = 1658; // [!code ++]

	public const int featManaCost = 1657;

```

[`@@ -71,11 +73,11 @@ public class FEAT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FEAT.cs#L71-L81)
```cs:line-numbers=71

	public const int featDefender = 1649;

	public const int featRapidMagic = 1648; // [!code --]
	public const int featDefense = 1631; // [!code ++]

	public const int featHardy = 1630; // [!code --]
	public const int featRapidMagic = 1648; // [!code ++]

	public const int featSummoner = 1647; // [!code --]
	public const int featParty = 1645; // [!code ++]

	public const int featBodyParts = 1644;

```

[`@@ -95,15 +97,13 @@ public class FEAT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FEAT.cs#L95-L109)
```cs:line-numbers=95

	public const int featSpotting = 1633;

	public const int featEvade = 1632; // [!code --]
 // [!code --]
	public const int featLonelySoul = 1646; // [!code --]
	public const int featSummoner = 1647; // [!code ++]

	public const int featReboot = 1410; // [!code --]
	public const int featEarthStrength = 1411; // [!code ++]

	public const int featHeavyCasting = 1654;

	public const int featPaladin2 = 1408; // [!code --]
	public const int featBoost = 1409; // [!code ++]

	public const int featShiva = 1224;

```

[`@@ -155,7 +155,7 @@ public class FEAT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FEAT.cs#L155-L161)
```cs:line-numbers=155

	public const int featFate = 1220;

	public const int featBoost = 1409; // [!code --]
	public const int featReboot = 1410; // [!code ++]

	public const int featSlowFood = 1200;

```

[`@@ -203,7 +203,7 @@ public class FEAT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FEAT.cs#L203-L209)
```cs:line-numbers=203

	public const int featCosmicHorror = 1233;

	public const int featThief = 1401; // [!code --]
	public const int featWizard = 1402; // [!code ++]

	public const int featGod_moonshadow1 = 1350;

```

[`@@ -211,31 +211,34 @@ public class FEAT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FEAT.cs#L211-L241)
```cs:line-numbers=211

	public const int featWarrior = 1400;

	public const int featWizard = 1402; // [!code --]
	public const int featThief = 1401; // [!code ++]

	public const int featFarmer = 1403;

	public const int featPianist = 1405; // [!code --]
	public const int featArcher = 1404; // [!code ++]

	public const int featTourist = 1406;

	public const int featArcher = 1404; // [!code --]
	public const int featPianist = 1405; // [!code ++]
 // [!code ++]
	public const int featPaladin2 = 1408; // [!code ++]

	public const int featPaladin = 1407;

	public static readonly int[] IDS = new int[110] // [!code --]
	public static readonly int[] IDS = new int[111] // [!code ++]
	{
		1612, 1620, 1621, 1627, 1623, 1624, 1625, 1626, 1622, 1611, // [!code --]
		1418, 1421, 1420, 1419, 1417, 1416, 1415, 1414, 1413, 1412, // [!code --]
		1628, 1610, 1629, 1645, 1631, 1411, 1657, 1656, 1655, 1653, // [!code --]
		1652, 1651, 1650, 1649, 1648, 1630, 1647, 1644, 1643, 1642, // [!code --]
		1641, 1640, 1636, 1635, 1634, 1633, 1632, 1646, 1410, 1654, // [!code --]
		1408, 1224, 1225, 1226, 1227, 1228, 1229, 1230, 1231, 1232, // [!code --]
		1620, 1621, 1622, 1628, 1624, 1625, 1626, 1627, 1623, 1612, // [!code ++]
		1419, 1610, 1421, 1420, 1418, 1417, 1416, 1415, 1414, 1413, // [!code ++]
		1629, 1611, 1630, 1646, 1632, 1412, 1658, 1657, 1656, 1655, // [!code ++]
		1653, 1652, 1651, 1650, 1649, 1631, 1648, 1645, 1644, 1643, // [!code ++]
		1642, 1641, 1640, 1636, 1635, 1634, 1633, 1647, 1411, 1654, // [!code ++]
		1409, 1224, 1225, 1226, 1227, 1228, 1229, 1230, 1231, 1232, // [!code ++]
		1234, 1235, 1236, 1237, 1300, 1305, 1310, 1315, 1320, 1325,
		1330, 1335, 1223, 1340, 1222, 1220, 1409, 1200, 1201, 1202, // [!code --]
		1330, 1335, 1223, 1340, 1222, 1220, 1410, 1200, 1201, 1202, // [!code ++]
		1203, 1204, 1205, 1206, 1207, 1208, 1209, 1210, 1211, 1212,
		1213, 1214, 1215, 1216, 1217, 1218, 1219, 1221, 1345, 1233,
		1401, 1350, 1355, 1400, 1402, 1403, 1405, 1406, 1404, 1407 // [!code --]
		1402, 1350, 1355, 1400, 1401, 1403, 1404, 1406, 1405, 1408, // [!code ++]
		1407 // [!code ++]
	};
}
public class Feat : Element
```

[`@@ -293,12 +296,12 @@ public string GetHint(ElementContainer owner)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FEAT.cs#L293-L304)
```cs:line-numbers=293
		return text.TrimEnd(' ').TrimEnd(',');
	}

	public bool IsAvailable(ElementContainer owner, int a = 1) // [!code --]
	public override bool IsPurchaseFeatReqMet(ElementContainer owner, int lv = -1) // [!code ++]
	{
		if (base.source.req.Length != 0)
		{
			Element element = owner.GetElement(base.source.req[0]);
			if (element == null || element.ValueWithoutLink < ((base.source.req.Length == 1) ? 1 : base.source.req[Mathf.Clamp(a, 1, base.source.req.Length - 1)].ToInt())) // [!code --]
			if (element == null || element.ValueWithoutLink < ((base.source.req.Length == 1) ? 1 : base.source.req[Mathf.Clamp((lv == -1) ? (owner.Value(id) + 1) : lv, 1, base.source.req.Length - 1)].ToInt())) // [!code ++]
			{
				return false;
			}
```

[`@@ -306,6 +309,21 @@ public bool IsAvailable(ElementContainer owner, int a = 1)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FEAT.cs#L306-L311)
```cs:line-numbers=306
		return true;
	}

	public override void WritePurchaseReq(UINote n, int lv = -1) // [!code ++]
	{ // [!code ++]
		Debug.Log("a"); // [!code ++]
		if (base.source.req.Length != 0) // [!code ++]
		{ // [!code ++]
			Element element = Element.Create(base.source.req[0], (base.source.req.Length == 1) ? 1 : base.source.req[Mathf.Clamp((lv == -1) ? (owner.Value(id) + 1) : lv, 1, base.source.req.Length - 1)].ToInt()); // [!code ++]
			Debug.Log(element); // [!code ++]
			if (element != null) // [!code ++]
			{ // [!code ++]
				n.AddHeader("featReq"); // [!code ++]
				n.AddText(element.Name + ": " + element.Value, FontColor.Bad); // [!code ++]
			} // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public List<string> Apply(int a, ElementContainer owner, bool hint = false)
	{
		if (hint)
```

## FOOD

[`@@ -1,9 +1,11 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FOOD.cs#L1-L9)
```cs:line-numbers=1
public class FOOD
{
	public const int food_poison = 702; // [!code --]
	public const int food_cat = 701; // [!code ++]

	public const int food_CHA = 700;

	public const int food_poison = 702; // [!code ++]
 // [!code ++]
	public const int food_love = 703;

	public const int food_bug = 704;
```

[`@@ -12,7 +14,5 @@ public class FOOD`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FOOD.cs#L12-L18)
```cs:line-numbers=12

	public const int loseWeight = 706;

	public const int food_cat = 701; // [!code --]
 // [!code --]
	public static readonly int[] IDS = new int[7] { 702, 700, 703, 704, 705, 706, 701 }; // [!code --]
	public static readonly int[] IDS = new int[7] { 701, 700, 702, 703, 704, 705, 706 }; // [!code ++]
}
```

## FoodEffect

[`@@ -81,9 +81,10 @@ public static bool IsUndeadFlesh(CardRow r)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/FoodEffect.cs#L81-L89)
```cs:line-numbers=81

	public static void Proc(Chara c, Thing food)
	{
		food.CheckJustCooked(); // [!code ++]
		bool flag = EClass._zone.IsPCFaction && c.IsInSpot<TraitSpotDining>();
		int num = (food.isCrafted ? ((EClass.pc.Evalue(1650) >= 3) ? 5 : 0) : 0);
		float num2 = (float)(100 + (flag ? 10 : 0) + num + Mathf.Min(food.QualityLv * 10, 100)) / 200f; // [!code --]
		float num2 = (float)(100 + (food.HasElement(757) ? 10 : 0) + (flag ? 10 : 0) + num + Mathf.Min(food.QualityLv * 10, 100)) / 200f; // [!code ++]
		if (num2 < 0.1f)
		{
			num2 = 0.1f;
```

## +FortuneRollData

::: details File Created
```cs
using System.Collections.Generic;
using System.Linq;
using Newtonsoft.Json;
using UnityEngine;

public class FortuneRollData : EClass
{
	public class Prize : EClass
	{
		[JsonProperty]
		public int grade;

		[JsonProperty]
		public string id;

		[JsonProperty]
		public bool claimed;

		public Card model => EClass.sources.cards.map[id].model;

		public int GetNum()
		{
			if (id == "medal")
			{
				if (grade != 2)
				{
					if (grade != 3)
					{
						return 1;
					}
					return 10;
				}
				return 3;
			}
			if (id == "plat")
			{
				if (grade != 1)
				{
					if (grade != 2)
					{
						if (grade != 3)
						{
							return 1;
						}
						return 50;
					}
					return 20;
				}
				return 10;
			}
			if (id == "1165" && grade == 3)
			{
				return 3;
			}
			return 1;
		}

		public void AddNote(UINote n)
		{
			string text = "_circle".lang().TagColor(EClass.sources.materials.alias[mats[grade]].GetColor()) + "  " + Lang.GetList("fortuneroll")[grade];
			string text2 = (model.IsUnique ? "â˜…" : "") + EClass.sources.cards.map[id].GetName().ToTitleCase();
			int num = GetNum();
			if (num > 1)
			{
				text2 = text2 + " x " + num;
			}
			if (claimed)
			{
				text2 = "fortuneroll_claimed".lang();
			}
			n.AddTopic("TopicDomain", text, text2.TagColor(model.IsUnique ? FontColor.Great : FontColor.Good));
		}
	}

	public static string[] mats = new string[4] { "plastic", "water", "hide_dragon", "gold" };

	public static int[] chances = new int[4] { 1, 10, 20, 50 };

	[JsonProperty]
	public List<Prize> prizes = new List<Prize>();

	[JsonProperty]
	public int count;

	[JsonProperty]
	public int seed;

	[JsonProperty]
	public int dateNextRefresh;

	public void Refresh()
	{
		if (EClass.world.date.GetRaw() >= dateNextRefresh)
		{
			Date date = EClass.world.date.Copy();
			date.day = 1;
			date.hour = 0;
			date.min = 0;
			date.AddMonth(1);
			dateNextRefresh = date.GetRaw();
			count++;
			RefreshPrize();
		}
	}

	public void RefreshPrize()
	{
		prizes.Clear();
		Rand.SetSeed(EClass.game.seed + seed + count);
		List<List<string>> list = GetPrizeList();
		Add(3);
		Add(2);
		Add(2);
		Add(1);
		Add(1);
		Add(1);
		Rand.SetSeed();
		void Add(int grade)
		{
			List<string> list2 = list[grade];
			int index = EClass.rnd(list2.Count);
			Prize item = new Prize
			{
				id = list2[index],
				grade = grade
			};
			prizes.Add(item);
			list2.RemoveAt(index);
		}
	}

	public List<List<string>> GetPrizeList()
	{
		return new List<List<string>>
		{
			new List<string> { "scrubber", "tissue", "plat" },
			new List<string>
			{
				"microchip", "1089", "150", "855", "medal", "water", "goods_charm", "electronicsS", "electronics", "plat",
				"plat"
			},
			new List<string>
			{
				"computer", "834", "1090", "goods_figure", "goods_canvas", "mb_1", "mb_2", "mb_3", "mb_4", "mb_5",
				"1174", "1085", "toilet", "714", "nobility", "plat", "1165", "mathammer", "medal"
			},
			new List<string> { "goods_coin", "goods_coin", "plat", "1165", "boat3", "medal" }
		};
	}

	public void GetPrize(int grade, int seed)
	{
		Rand.SetSeed(seed);
		Prize prize = null;
		List<Prize> list = prizes.Where((Prize p) => p.grade == grade && !p.claimed).ToList();
		if (list.Count > 0)
		{
			prize = list.RandomItem();
		}
		Thing thing = null;
		if (prize != null)
		{
			thing = ThingGen.Create(prize.id).SetNum(prize.GetNum());
			if (grade != 3)
			{
				prize.claimed = true;
			}
		}
		else
		{
			thing = ThingGen.Create(GetPrizeList()[0].RandomItem());
		}
		EClass.pc.Pick(thing);
		Rand.SetSeed();
	}

	public void WriteNote(UINote n)
	{
		n.Clear();
		n.AddHeader("fortuneroll_prize");
		n.Space(4);
		foreach (Prize prize in prizes)
		{
			prize.AddNote(n);
		}
		string text = "_circle".lang().TagColor(Color.white) + "  " + Lang.GetList("fortuneroll")[0];
		n.AddTopic("TopicDomain", text, "fortuneroll_lose".lang());
		n.Build();
	}
}
```

:::
## Game

[`@@ -53,6 +53,9 @@ public class Config : EClass`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Game.cs#L53-L58)
```cs:line-numbers=53
		[JsonProperty]
		public bool cheat;

		[JsonProperty] // [!code ++]
		public bool showAllFeat; // [!code ++]
 // [!code ++]
		[JsonProperty]
		public int slopeMod = 50;

```

## InvOwnerDraglet

[`@@ -75,8 +75,9 @@ public override void OnClick(ButtonGrid button)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/InvOwnerDraglet.cs#L75-L82)
```cs:line-numbers=75
		{
			button.SetCard(null);
			dragGrid.RefreshCurrentGrid();
			dragGrid.uiIngredients.Refresh(); // [!code --]
		}
		dragGrid.TryPutBack(); // [!code ++]
		dragGrid.uiIngredients.Refresh(); // [!code ++]
		SE.Equip();
		if (EClass.pc.ai is AI_UseCrafter && EClass.pc.ai.IsRunning)
		{
```

## LayerDragGrid

[`@@ -5,8 +5,17 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/LayerDragGrid.cs#L5-L12)
```cs:line-numbers=5

public class LayerDragGrid : LayerBaseCraft
{
	public class PutbackInfo // [!code ++]
	{ // [!code ++]
		public Thing thing; // [!code ++]
 // [!code ++]
		public Thing container; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public static LayerDragGrid Instance;

	public List<PutbackInfo> putBacks = new List<PutbackInfo>(); // [!code ++]
 // [!code ++]
	public UIItem itemCost;

	public Image imageOwner;
```

[`@@ -310,6 +319,36 @@ public void Redraw()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/LayerDragGrid.cs#L310-L315)
```cs:line-numbers=310
		LayerInventory.SetDirtyAll(immediate: true);
	}

	public void AddPutBack(Thing t, Thing container) // [!code ++]
	{ // [!code ++]
		if (container != null) // [!code ++]
		{ // [!code ++]
			putBacks.Add(new PutbackInfo // [!code ++]
			{ // [!code ++]
				thing = t, // [!code ++]
				container = container // [!code ++]
			}); // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void TryPutBack() // [!code ++]
	{ // [!code ++]
		foreach (PutbackInfo putBack in putBacks) // [!code ++]
		{ // [!code ++]
			if (!putBack.thing.isDestroyed && putBack.thing.Num != 0 && putBack.thing.parent != putBack.container && !putBack.container.isDestroyed) // [!code ++]
			{ // [!code ++]
				putBack.container.AddCard(putBack.thing); // [!code ++]
			} // [!code ++]
		} // [!code ++]
		putBacks.Clear(); // [!code ++]
		RefreshCurrentGrid(); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public override void OnEndCraft() // [!code ++]
	{ // [!code ++]
		TryPutBack(); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public override void OnKill()
	{
		EInput.haltInput = false;
```

## MUTATION

[`@@ -6,19 +6,17 @@ public class MUTATION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/MUTATION.cs#L6-L24)
```cs:line-numbers=6

	public const int mutationDexN = 1515;

	public const int mutationDex = 1514; // [!code --]
	public const int etherPoisonHand = 1565; // [!code ++]

	public const int etherManaBattery = 1564; // [!code --]
	public const int mutationEyeN = 1513; // [!code ++]

	public const int mutationEye = 1512;

	public const int mutationSkinN = 1511;

	public const int etherPoisonHand = 1565; // [!code --]
 // [!code --]
	public const int mutationSpeed = 1518;

	public const int mutationEyeN = 1513; // [!code --]
	public const int mutationDex = 1514; // [!code ++]

	public const int mutationSpeedN = 1519;

```

[`@@ -26,6 +24,8 @@ public class MUTATION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/MUTATION.cs#L26-L31)
```cs:line-numbers=26

	public const int mutationStrN = 1521;

	public const int etherManaBattery = 1564; // [!code ++]
 // [!code ++]
	public const int etherProvoke = 1563;

	public const int mutationStr = 1520;
```

[`@@ -78,8 +78,8 @@ public class MUTATION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/MUTATION.cs#L78-L85)
```cs:line-numbers=78

	public static readonly int[] IDS = new int[38]
	{
		1517, 1516, 1515, 1514, 1564, 1512, 1511, 1565, 1518, 1513, // [!code --]
		1519, 1510, 1521, 1563, 1520, 1561, 1560, 1559, 1558, 1557, // [!code --]
		1517, 1516, 1515, 1565, 1513, 1512, 1511, 1518, 1514, 1519, // [!code ++]
		1510, 1521, 1564, 1563, 1520, 1561, 1560, 1559, 1558, 1557, // [!code ++]
		1556, 1555, 1554, 1553, 1552, 1562, 1551, 1522, 1524, 1525,
		1526, 1527, 1523, 1529, 1530, 1531, 1550, 1528
	};
```

## POLICY

[`@@ -49,7 +49,7 @@ public class POLICY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/POLICY.cs#L49-L55)
```cs:line-numbers=49

	public const int noAnimal = 2709;

	public const int inquisition = 2507; // [!code --]
	public const int human_right = 2506; // [!code ++]

	public const int auto_farm = 2707;

```

[`@@ -65,7 +65,7 @@ public class POLICY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/POLICY.cs#L65-L71)
```cs:line-numbers=65

	public const int legal_drug = 2505;

	public const int faith_tax = 2501; // [!code --]
	public const int inquisition = 2507; // [!code ++]

	public const int nocturnal_life = 2508;

```

[`@@ -75,7 +75,7 @@ public class POLICY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/POLICY.cs#L75-L81)
```cs:line-numbers=75

	public const int self_sufficient = 2511;

	public const int human_right = 2506; // [!code --]
	public const int faith_tax = 2501; // [!code ++]

	public const int resident_wanted = 2513;

```

[`@@ -105,8 +105,8 @@ public class POLICY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/POLICY.cs#L105-L112)
```cs:line-numbers=105
	{
		2816, 2711, 2800, 2810, 2811, 2812, 2813, 2814, 2815, 2817,
		2823, 2819, 2820, 2821, 2822, 2710, 2824, 2825, 2826, 2827,
		2828, 2818, 2709, 2507, 2707, 2708, 2500, 2502, 2503, 2504, // [!code --]
		2505, 2501, 2508, 2509, 2510, 2511, 2506, 2513, 2705, 2512, // [!code --]
		2828, 2818, 2709, 2506, 2707, 2708, 2500, 2502, 2503, 2504, // [!code ++]
		2505, 2507, 2508, 2509, 2510, 2511, 2501, 2513, 2705, 2512, // [!code ++]
		2704, 2706, 2702, 2703, 2700, 2516, 2515, 2514, 2701
	};
}
```

## Player

[`@@ -419,6 +419,18 @@ public bool toggleHotbarHighlightActivated`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Player.cs#L419-L424)
```cs:line-numbers=419
			}
		}

		public bool gotJurePillow // [!code ++]
		{ // [!code ++]
			get // [!code ++]
			{ // [!code ++]
				return bits[30]; // [!code ++]
			} // [!code ++]
			set // [!code ++]
			{ // [!code ++]
				bits[30] = value; // [!code ++]
			} // [!code ++]
		} // [!code ++]
 // [!code ++]
		public int start
		{
			get
```

## RecipeCard

[`@@ -249,6 +249,11 @@ public override Thing Craft(BlessedState blessed, bool sound = false, List<Thing`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/RecipeCard.cs#L249-L254)
```cs:line-numbers=249
			if (!flag)
			{
				MakeDish(thing);
				if (EClass.pc.HasElement(1658)) // [!code ++]
				{ // [!code ++]
					thing.elements.SetBase(757, 1); // [!code ++]
					thing.c_dateCooked = EClass.world.date.GetRaw(); // [!code ++]
				} // [!code ++]
			}
		}
		else
```

## Religion

[`@@ -4,6 +4,12 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Religion.cs#L4-L9)
```cs:line-numbers=4

public class Religion : EClass
{
	public enum ConvertType // [!code ++]
	{ // [!code ++]
		Default, // [!code ++]
		Campaign // [!code ++]
	} // [!code ++]
 // [!code ++]
	[JsonProperty]
	public int relation;

```

[`@@ -160,6 +166,7 @@ public string GetGodTalk(string suffix)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Religion.cs#L160-L165)
```cs:line-numbers=160

	public int GetOfferingValue(Thing t, int num = -1)
	{
		t.CheckJustCooked(); // [!code ++]
		if (num == -1)
		{
			num = t.Num;
```

[`@@ -194,7 +201,7 @@ public int GetOfferingValue(Thing t, int num = -1)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Religion.cs#L194-L200)
```cs:line-numbers=194
		{
			num2 /= 10;
		}
		num2 *= (t.LV * 2 + 100) / 100; // [!code --]
		num2 = num2 * (100 + Mathf.Min(t.LV * 2, 100) + (t.HasElement(757) ? 50 : 0)) / 100; // [!code ++]
		return Mathf.Max(num2, 1) * num;
	}

```

[`@@ -361,7 +368,7 @@ public virtual void OnBecomeBranchFaith()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Religion.cs#L361-L367)
```cs:line-numbers=361
	{
	}

	public void JoinFaith(Chara c) // [!code --]
	public void JoinFaith(Chara c, ConvertType type = ConvertType.Default) // [!code ++]
	{
		if (!c.IsPC)
		{
```

[`@@ -373,9 +380,12 @@ public void JoinFaith(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Religion.cs#L373-L381)
```cs:line-numbers=373
	}
	if (c.faith != this)
	{
		c.faith.LeaveFaith(c, this); // [!code --]
		c.faith.LeaveFaith(c, this, type); // [!code ++]
	} // [!code ++]
	if (type != ConvertType.Campaign) // [!code ++]
	{ // [!code ++]
		EClass.pc.c_daysWithGod = 0; // [!code ++]
	}
	EClass.pc.c_daysWithGod = 0; // [!code --]
	Msg.Say("worship", Name);
	Talk("worship", c);
	EClass.Sound.Play("worship");
```

[`@@ -401,7 +411,7 @@ public void JoinFaith(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Religion.cs#L401-L407)
```cs:line-numbers=401
		}
	}

	public void LeaveFaith(Chara c, Religion newFaith) // [!code --]
	public void LeaveFaith(Chara c, Religion newFaith, ConvertType type) // [!code ++]
	{
		if (IsEyth)
		{
```

[`@@ -411,7 +421,7 @@ public void LeaveFaith(Chara c, Religion newFaith)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Religion.cs#L411-L417)
```cs:line-numbers=411
	if (c.IsPC)
	{
		Msg.Say("worship2");
		if (!flag) // [!code --]
		if (!flag && type != ConvertType.Campaign) // [!code ++]
		{
			Punish(c);
		}
```

## Scene

[`@@ -314,7 +314,7 @@ public void Init(Mode newMode)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Scene.cs#L314-L320)
```cs:line-numbers=314
		{
			EMono.ui.widgets.Activate("QuestTracker");
		}
		if (EMono._zone is Zone_Town && !EMono._zone.isMapSaved) // [!code --]
		if (EMono._zone is Zone_Town && !EMono._zone.isMapSaved && !EMono.debug.enable) // [!code ++]
		{
			EMono.game.Save();
		}
```

## SerializedCards

[`@@ -673,7 +673,10 @@ public void Restore(Map map, Map orgMap, bool addToZone, PartialMap partial = nu`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/SerializedCards.cs#L673-L679)
```cs:line-numbers=673
		card2.isImported = true;
		card2.refVal = card4.refVal;
		card2.idSkin = card4.idSkin;
		card2.c_idDeity = card4.idDeity; // [!code --]
		if (isUserZone) // [!code ++]
		{ // [!code ++]
			card2.c_idDeity = card4.idDeity; // [!code ++]
		} // [!code ++]
		if (isUserZone && (card2.isHidden || card2.isMasked) && ((card2.TileType.IsBlockPass && card2.IsInstalled) || card2.trait is TraitCoreZone || card2.trait is TraitWaystone))
		{
			Card card3 = card2;
```

## Thing

[`@@ -836,6 +836,10 @@ public List<Element> ListValidTraits(bool isCraft, bool limit)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Thing.cs#L836-L841)
```cs:line-numbers=836

	public override void WriteNote(UINote n, Action<UINote> onWriteNote = null, IInspect.NoteMode mode = IInspect.NoteMode.Default, Recipe recipe = null)
	{
		if (sourceCard._origin == "dish") // [!code ++]
		{ // [!code ++]
			CheckJustCooked(); // [!code ++]
		} // [!code ++]
		n.Clear();
		string text = "";
		TraitAbility traitAbility = trait as TraitAbility;
```

## ThingGen

[`@@ -181,6 +181,13 @@ public static Thing CreatePerfume(int ele, int num = 1)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/ThingGen.cs#L181-L186)
```cs:line-numbers=181
		return thing;
	}

	public static Thing CreateLetter(string idLetter) // [!code ++]
	{ // [!code ++]
		Thing thing = Create("letter"); // [!code ++]
		thing.SetStr(53, idLetter); // [!code ++]
		return thing; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public static Thing CreateCardboardBox(int uidZone = -1)
	{
		Thing thing = Create("cardboard_box", new string[5] { "pine", "wood_birch", "wood_acacia", "oak", "cedar" }.RandomItem());
```

## Trait

[`@@ -1482,6 +1482,11 @@ public void OnBarter()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Trait.cs#L1482-L1487)
```cs:line-numbers=1482
			Thing thing4 = thing8.Duplicate(1);
			thing4.isStolen = false;
			thing4.isCopy = true;
			thing4.c_priceFix = 0; // [!code ++]
			foreach (Element item in thing4.elements.dict.Values.Where((Element e) => e.HasTag("noInherit")).ToList()) // [!code ++]
			{ // [!code ++]
				thing4.elements.Remove(item.id); // [!code ++]
			} // [!code ++]
			int num4 = 1;
			switch (owner.trait.CopyShop)
			{
```

[`@@ -1524,9 +1529,9 @@ public void OnBarter()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Trait.cs#L1524-L1532)
```cs:line-numbers=1524
			{
				break;
			}
			foreach (Thing item in new DramaOutcome().ListFelmeraBarter()) // [!code --]
			foreach (Thing item2 in new DramaOutcome().ListFelmeraBarter()) // [!code ++]
			{
				AddThing(item); // [!code --]
				AddThing(item2); // [!code ++]
			}
		}
		else
```

[`@@ -1733,18 +1738,18 @@ public void OnBarter()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Trait.cs#L1733-L1750)
```cs:line-numbers=1733
				break;
			}
			}
			foreach (RecipeSource item2 in RecipeManager.list) // [!code --]
			foreach (RecipeSource item3 in RecipeManager.list) // [!code ++]
			{
				if (item2.row.recipeKey.IsEmpty()) // [!code --]
				if (item3.row.recipeKey.IsEmpty()) // [!code ++]
				{
					continue;
				}
				string[] recipeKey = item2.row.recipeKey; // [!code --]
				string[] recipeKey = item3.row.recipeKey; // [!code ++]
				for (int m = 0; m < recipeKey.Length; m++)
				{
					if (recipeKey[m] == ShopType.ToString())
					{
						NoRestock(ThingGen.CreateRecipe(item2.id)); // [!code --]
						NoRestock(ThingGen.CreateRecipe(item3.id)); // [!code ++]
						break;
					}
				}
```

## TraitAltar

[`@@ -25,7 +25,7 @@ public override void OnCreate(int lv)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/TraitAltar.cs#L25-L31)
```cs:line-numbers=25

	public override void OnImportMap()
	{
		if (owner.c_idDeity.IsEmpty()) // [!code --]
		if (owner.c_idDeity.IsEmpty() || GetParam(1) != null) // [!code ++]
		{
			SetDeity(GetParam(1) ?? EClass.game.religions.GetRandomReligion().id);
		}
```

## TraitCrafter

[`@@ -277,8 +277,8 @@ public virtual Thing Craft(AI_UseCrafter ai)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/TraitCrafter.cs#L277-L284)
```cs:line-numbers=277
		break;
	case MixType.Resource:
	{
		string[] array3 = thing3.Split('%'); // [!code --]
		t = CraftUtil.MixIngredients(ThingGen.Create(array3[0], (array3.Length > 1) ? EClass.sources.materials.alias[array3[1]].id : thing.material.id), ai.ings, CraftUtil.MixType.General, 999, EClass.pc).Thing; // [!code --]
		string[] array = thing3.Split('%'); // [!code ++]
		t = CraftUtil.MixIngredients(ThingGen.Create(array[0], (array.Length > 1) ? EClass.sources.materials.alias[array[1]].id : thing.material.id), ai.ings, CraftUtil.MixType.General, 999, EClass.pc).Thing; // [!code ++]
		break;
	}
	case MixType.Dye:
```

[`@@ -344,13 +344,13 @@ public virtual Thing Craft(AI_UseCrafter ai)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/TraitCrafter.cs#L344-L356)
```cs:line-numbers=344
	case MixType.Fortune:
	{
		EClass.player.seedFortune++;
		string[] array = new string[4] { "plastic", "water", "hide_dragon", "gold" }; // [!code --]
		int[] array2 = new int[4] { 1, 10, 50, 200 }; // [!code --]
		int num2 = 0;
		Rand.SetSeed(EClass.game.seed + EClass.player.seedFortune); // [!code --]
		FortuneRollData orCreateFortuneRollData = EClass._zone.GetOrCreateFortuneRollData(refresh: false); // [!code ++]
		int seed = orCreateFortuneRollData.seed + orCreateFortuneRollData.count + EClass.player.seedFortune; // [!code ++]
		Rand.SetSeed(seed); // [!code ++]
		for (int num3 = 3; num3 > 0; num3--)
		{
			if (EClass.rnd(array2[num3]) == 0) // [!code --]
			if (EClass.rnd(FortuneRollData.chances[num3]) == 0) // [!code ++]
			{
				num2 = num3;
				break;
```

[`@@ -362,9 +362,14 @@ public virtual Thing Craft(AI_UseCrafter ai)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/TraitCrafter.cs#L362-L370)
```cs:line-numbers=362
			owner.PlaySound((num2 == 3) ? "fortuneroll_winBig" : "fortuneroll_win");
		}
		Thing thing4 = ThingGen.Create("fortune_ball");
		thing4.ChangeMaterial(array[num2]); // [!code --]
		thing4.ChangeMaterial(FortuneRollData.mats[num2]); // [!code ++]
		EClass._zone.AddCard(thing4, owner.pos);
		owner.PlaySound("fortuneroll_ball");
		orCreateFortuneRollData.GetPrize(num2, seed); // [!code ++]
		if ((bool)LayerDragGrid.Instance) // [!code ++]
		{ // [!code ++]
			LayerDragGrid.Instance.info.Refresh(); // [!code ++]
		} // [!code ++]
		break;
	}
	case MixType.Incubator:
```

[`@@ -408,10 +413,6 @@ public virtual Thing Craft(AI_UseCrafter ai)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/TraitCrafter.cs#L408-L417)
```cs:line-numbers=408

	public override void TrySetAct(ActPlan p)
	{
		if (!EClass.debug.enable && this is TraitRollingFortune) // [!code --]
		{ // [!code --]
			return; // [!code --]
		} // [!code --]
		if (IsFactory)
		{
			Thing _t = owner.Thing;
```

## TraitDoor

[`@@ -12,7 +12,17 @@ public class TraitDoor : Trait`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/TraitDoor.cs#L12-L18)
```cs:line-numbers=12

	public override bool HaveUpdate => true;

	public override bool IsOpenSight => IsOpen(); // [!code --]
	public override bool IsOpenSight // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			if (!IsOpen()) // [!code ++]
			{ // [!code ++]
				return !IsValid(shouldLookGood: false); // [!code ++]
			} // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
	} // [!code ++]

	public override bool IsDoor => true;

```

[`@@ -88,18 +98,21 @@ public virtual bool IsOpen()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/TraitDoor.cs#L88-L105)
```cs:line-numbers=88
	{
		int dir = owner.dir;
		Cell cell = owner.pos.cell;
		if (!cell.Right.HasFullBlockOrWallOrFence && (dir == 0 || dir == 2) && cell.Front.HasFullBlockOrWallOrFence) // [!code --]
		if (dir == 0 || dir == 2) // [!code ++]
		{
			return true; // [!code --]
			if (cell.Front.HasFullBlockOrWallOrFence || cell.Back.HasFullBlockOrWallOrFence) // [!code ++]
			{ // [!code ++]
				return true; // [!code ++]
			} // [!code ++]
		}
		if (!cell.Front.HasFullBlockOrWallOrFence && (dir == 1 || dir == 3) && cell.Right.HasFullBlockOrWallOrFence) // [!code --]
		else if (cell.Left.HasFullBlockOrWallOrFence || cell.Right.HasFullBlockOrWallOrFence) // [!code ++]
		{
			return true;
		}
		return false;
	}

	public bool IsValid() // [!code --]
	public bool IsValid(bool shouldLookGood = true) // [!code ++]
	{
		_ = owner.dir;
		Cell cell = owner.pos.cell;
```

[`@@ -107,21 +120,26 @@ public bool IsValid()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/TraitDoor.cs#L107-L127)
```cs:line-numbers=107
	{
		return false;
	}
	bool hasFullBlockOrWallOrFence = cell.Left.HasFullBlockOrWallOrFence; // [!code --]
	bool hasFullBlockOrWallOrFence2 = cell.Right.HasFullBlockOrWallOrFence; // [!code --]
	bool hasFullBlockOrWallOrFence3 = cell.Front.HasFullBlockOrWallOrFence; // [!code --]
	bool hasFullBlockOrWallOrFence4 = cell.Back.HasFullBlockOrWallOrFence; // [!code --]
	if ((hasFullBlockOrWallOrFence ? 1 : 0) + (hasFullBlockOrWallOrFence2 ? 1 : 0) + (hasFullBlockOrWallOrFence3 ? 1 : 0) + (hasFullBlockOrWallOrFence4 ? 1 : 0) >= 3) // [!code --]
	if (shouldLookGood) // [!code ++]
	{
		bool hasFullBlockOrWallOrFence = cell.Left.HasFullBlockOrWallOrFence; // [!code ++]
		bool hasFullBlockOrWallOrFence2 = cell.Right.HasFullBlockOrWallOrFence; // [!code ++]
		bool hasFullBlockOrWallOrFence3 = cell.Front.HasFullBlockOrWallOrFence; // [!code ++]
		bool hasFullBlockOrWallOrFence4 = cell.Back.HasFullBlockOrWallOrFence; // [!code ++]
		if (hasFullBlockOrWallOrFence && hasFullBlockOrWallOrFence2) // [!code ++]
		{ // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
		if (hasFullBlockOrWallOrFence3 && hasFullBlockOrWallOrFence4) // [!code ++]
		{ // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
		return false;
	}
	if (hasFullBlockOrWallOrFence && hasFullBlockOrWallOrFence2) // [!code --]
	int num = (cell.Left.HasFullBlockOrWallOrFence ? 1 : 0) + (cell.Right.HasFullBlockOrWallOrFence ? 1 : 0) + (cell.Front.HasFullBlockOrWallOrFence ? 1 : 0) + (cell.Back.HasFullBlockOrWallOrFence ? 1 : 0); // [!code ++]
	if (num > 0) // [!code ++]
	{
		return true; // [!code --]
	} // [!code --]
	if (hasFullBlockOrWallOrFence3 && hasFullBlockOrWallOrFence4) // [!code --]
	{ // [!code --]
		return true; // [!code --]
		return num < 3; // [!code ++]
	}
	return false;
}
```

## TraitGiftJure

[`@@ -16,7 +16,7 @@ public override bool OnUse(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/TraitGiftJure.cs#L16-L22)
```cs:line-numbers=16
	}
	EClass.pc.Say("openDoor", EClass.pc, owner);
	SE.Play("dropReward");
	List<string> list = new List<string> { "hat_santa", "musicbox_jure", "1228", "1229", "holyFeather" }; // [!code --]
	List<string> list = new List<string> { "hat_santa", "musicbox_jure", "1228", "musicbox_cat", "1229", "holyFeather" }; // [!code ++]
	Add(list[EClass.player.giftJure % list.Count], 1);
	foreach (string item in new List<string> { "xmas_wreath", "xmas_garland", "1232", "xmas_socks", "xmas_boot", "xmas_cane" })
	{
```

[`@@ -28,17 +28,20 @@ public override bool OnUse(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/TraitGiftJure.cs#L28-L44)
```cs:line-numbers=28
		Add("cake_festival", 3);
		Add("bushdenoel", 3);
		Add("mancookie", 3);
		Thing thing = ThingGen.CreateLetter("letter_juremas"); // [!code ++]
		thing.ChangeMaterial("grass_forest"); // [!code ++]
		EClass.pc.Pick(thing); // [!code ++]
		EClass.player.giftJure++;
		owner.ModNum(-1);
		return true;
		static void Add(string id, int num)
		{
			Thing thing = ThingGen.Create(id).SetNum(num).SetNoSell(); // [!code --]
			Thing thing2 = ThingGen.Create(id).SetNum(num).SetNoSell(); // [!code ++]
			if (id == "snow_globe")
			{
				thing.idSkin = EClass.player.giftJure % 3; // [!code --]
				thing2.idSkin = EClass.player.giftJure % 3; // [!code ++]
			}
			EClass.pc.Pick(thing); // [!code --]
			EClass.pc.Pick(thing2); // [!code ++]
		}
	}
}
```

## TraitGodStatue

[`@@ -51,14 +51,14 @@ public override void _OnUse(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/TraitGodStatue.cs#L51-L64)
```cs:line-numbers=51
	{
	case "harvest":
	{
		Thing t = ThingGen.Create("book_kumiromi"); // [!code --]
		EClass.pc.Pick(t); // [!code --]
		Thing t2 = ThingGen.Create("book_kumiromi"); // [!code ++]
		EClass.pc.Pick(t2); // [!code ++]
		break;
	}
	case "machine":
	{
		Thing t2 = owner.things.Find("gene") ?? GetManiGene(); // [!code --]
		EClass.pc.Pick(t2); // [!code --]
		Thing t = owner.things.Find("gene") ?? GetManiGene(); // [!code ++]
		EClass.pc.Pick(t); // [!code ++]
		break;
	}
	case "healing":
```

[`@@ -76,7 +76,7 @@ public override void _OnUse(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/TraitGodStatue.cs#L76-L82)
```cs:line-numbers=76
	case "element":
	{
		Rand.SetSeed(owner.c_seed);
		SourceMaterial.Row randomMaterial = MATERIAL.GetRandomMaterial(owner.LV / 2 + 20, (Religion.id == "earth") ? "metal" : "leather", tryLevelMatTier: true); // [!code --]
		SourceMaterial.Row randomMaterial = MATERIAL.GetRandomMaterial(((owner.LV < 200) ? (owner.LV / 2) : (owner.LV % 50 * 2)) + 10, (Religion.id == "earth") ? "metal" : "leather", tryLevelMatTier: true); // [!code ++]
		Thing thing = ThingGen.Create("mathammer");
		thing.ChangeMaterial(randomMaterial);
		thing.noSell = true;
```

## TraitMusicBox

[`@@ -6,7 +6,7 @@ public class TraitMusicBox : TraitJukeBox`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/TraitMusicBox.cs#L6-L12)
```cs:line-numbers=6

	public override bool OnUse(Chara c)
	{
		owner.refVal = 115; // [!code --]
		owner.refVal = GetParam(1).ToInt(); // [!code ++]
		Toggle(!owner.isOn);
		return true;
	}
```

## +TraitPartTimeMascot

::: details File Created
```cs
public class TraitPartTimeMascot : TraitChara
{
}
```

:::
## TraitRollingFortune

[`@@ -23,7 +23,7 @@ public override void OnEndAI(AI_UseCrafter ai)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/TraitRollingFortune.cs#L23-L29)
```cs:line-numbers=23
		}
		foreach (Card item in owner.pos.ListThings<TraitFortuneBall>(onlyInstalled: false))
		{
			EClass.pc.Pick(item.Thing, msg: false); // [!code --]
			item.Destroy(); // [!code ++]
		}
	}
}
```

## UIDragGridInfo

[`@@ -27,6 +27,8 @@ public class UIDragGridInfo : EMono`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/UIDragGridInfo.cs#L27-L32)
```cs:line-numbers=27

	public Card owner;

	public UINote note; // [!code ++]
 // [!code ++]
	private void Awake()
	{
		window.SetActive(enable: false);
```

[`@@ -100,6 +102,12 @@ public void Init(Card _owner)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/UIDragGridInfo.cs#L100-L105)
```cs:line-numbers=100
		}
	};
	list.List();
	TraitRollingFortune traitRollingFortune = owner.trait as TraitRollingFortune; // [!code ++]
	note.SetActive(traitRollingFortune != null); // [!code ++]
	if (traitRollingFortune != null) // [!code ++]
	{ // [!code ++]
		EMono._zone.GetOrCreateFortuneRollData().WriteNote(note); // [!code ++]
	} // [!code ++]
	window.SetActive(enable: true);
	window.RebuildLayout(recursive: true);
	void AddThing(string id)
```

## UIDragGridIngredients

[`@@ -14,9 +14,9 @@ public class UIDragGridIngredients : EMono`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/UIDragGridIngredients.cs#L14-L22)
```cs:line-numbers=14
public void Update()
{
	bool activeSelf = goList.activeSelf;
	bool isNoGoal = EMono.pc.ai.IsNoGoal; // [!code --]
	goList.SetActive(isNoGoal); // [!code --]
	if (activeSelf != isNoGoal) // [!code --]
	bool flag = EMono.pc.ai.IsNoGoal || !EMono.pc.ai.IsRunning; // [!code ++]
	goList.SetActive(flag); // [!code ++]
	if (activeSelf != flag) // [!code ++]
	{
		Refresh();
	}
```

[`@@ -28,11 +28,13 @@ public void Update()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/UIDragGridIngredients.cs#L28-L38)
```cs:line-numbers=28
	if ((bool)componentOf && (bool)componentOf.GetComponentInParent<UIDragGridIngredients>())
	{
		Thing t = componentOf.card.Thing;
		Thing container = t.parent as Thing; // [!code ++]
		t.ShowSplitMenu2(componentOf, "actPutIn", delegate(int n)
		{
			Thing t2 = t.Split(n);
			t2 = EMono.pc.Pick(t2, msg: true, tryStack: false);
			int currentIndex = layer.currentIndex;
			layer.AddPutBack(t2, container); // [!code ++]
			layer.buttons[currentIndex].SetCardGrid(t2, layer.owner);
			layer.owner.OnProcess(t2);
		});
```

[`@@ -66,6 +68,7 @@ public void Refresh()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/UIDragGridIngredients.cs#L66-L71)
```cs:line-numbers=66
			int currentIndex = layer.currentIndex;
			layer.buttons[currentIndex].SetCardGrid(a, layer.owner);
			layer.owner.OnProcess(a);
			layer.AddPutBack(a, a.parent as Thing); // [!code ++]
		},
		onInstantiate = delegate(Thing a, ButtonGrid b)
		{
```

## UIInventory

[`@@ -158,6 +158,8 @@ public bool UseBG`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/UIInventory.cs#L158-L163)
```cs:line-numbers=158

	public bool IsShop => owner.Container.trait is TraitChestMerchant;

	public bool IsAdvSort => EMono.core.config.game.sortEach; // [!code ++]
 // [!code ++]
	public CoreRef.InventoryStyle InvStyle => EMono.core.refs.invStyle[(UseBG || IsToolbelt) ? owner.Container.trait.IDInvStyle : "transparent"];

	public bool IsMainMode
```

[`@@ -462,7 +464,7 @@ public void RefreshMenu()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/UIInventory.cs#L462-L468)
```cs:line-numbers=462
			foreach (UIList.SortMode sortMode in sorts)
			{
				UIList.SortMode _sort = sortMode;
				uIContextMenu2.AddButton((((IsShop ? EMono.player.pref.sortInvShop : EMono.player.pref.sortInv) == _sort) ? "context_checker".lang() : "") + _sort.ToString().lang(), delegate // [!code --]
				uIContextMenu2.AddButton((((IsShop ? EMono.player.pref.sortInvShop : (IsAdvSort ? data.sortMode : EMono.player.pref.sortInv)) == _sort) ? "context_checker".lang() : "") + _sort.ToString().lang(), delegate // [!code ++]
				{
					if (IsShop)
					{
```

[`@@ -472,11 +474,12 @@ public void RefreshMenu()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/UIInventory.cs#L472-L482)
```cs:line-numbers=472
					{
						EMono.player.pref.sortInv = _sort;
					}
					data.sortMode = _sort; // [!code ++]
					Sort();
					SE.Click();
				});
			}
			uIContextMenu2.AddToggle("sort_ascending", IsShop ? EMono.player.pref.sort_ascending_shop : EMono.player.pref.sort_ascending, delegate(bool a) // [!code --]
			uIContextMenu2.AddToggle("sort_ascending", IsShop ? EMono.player.pref.sort_ascending_shop : (IsAdvSort ? data.sort_ascending : EMono.player.pref.sort_ascending), delegate(bool a) // [!code ++]
			{
				if (IsShop)
				{
```

[`@@ -486,6 +489,7 @@ public void RefreshMenu()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/UIInventory.cs#L486-L491)
```cs:line-numbers=486
				{
					EMono.player.pref.sort_ascending = a;
				}
				data.sort_ascending = a; // [!code ++]
				Sort();
				SE.Click();
			});
```

[`@@ -995,7 +999,7 @@ public Transform ShowAdvDistribution(UIContextMenu dis, Window.SaveData data)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/UIInventory.cs#L995-L1001)
```cs:line-numbers=995

	public void Sort(bool redraw = true)
	{
		UIList.SortMode i = (IsShop ? EMono.player.pref.sortInvShop : EMono.player.pref.sortInv); // [!code --]
		UIList.SortMode i = (IsShop ? EMono.player.pref.sortInvShop : (IsAdvSort ? window.saveData.sortMode : EMono.player.pref.sortInv)); // [!code ++]
		bool flag = true;
		while (flag)
		{
```

[`@@ -1033,7 +1037,7 @@ public void Sort(bool redraw = true)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/UIInventory.cs#L1033-L1039)
```cs:line-numbers=1033
	}
	owner.Container.things.Sort(delegate(Thing a, Thing b)
	{
		bool flag2 = (IsShop ? EMono.player.pref.sort_ascending_shop : EMono.player.pref.sort_ascending); // [!code --]
		bool flag2 = (IsShop ? EMono.player.pref.sort_ascending_shop : (IsAdvSort ? window.saveData.sort_ascending : EMono.player.pref.sort_ascending)); // [!code ++]
		if (i == UIList.SortMode.ByName)
		{
			if (flag2)
```

## UIPlaceHelper

[`@@ -21,6 +21,7 @@ public void Refresh()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/UIPlaceHelper.cs#L21-L26)
```cs:line-numbers=21
	base.gameObject.SetActive(flag);
	if (flag)
	{
		ActionMode.Build.recipe = recipe; // [!code ++]
		buttonAutoWall.SetActive(enable: false);
		buttonAutoWall.mainText.text = (EMono.game.config.autoWall ? "On" : "Off");
		buttonAutoWall.icon.SetAlpha(EMono.game.config.autoWall ? 1f : 0.4f);
```

## WindowChara

[`@@ -136,6 +136,8 @@ public class WindowChara : WindowController`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/WindowChara.cs#L136-L141)
```cs:line-numbers=136

	public UIButton buttonFeatMode;

	public UIButton buttonFeatOption; // [!code ++]
 // [!code ++]
	public Image imageView;

	public Sprite mask;
```

[`@@ -204,6 +206,7 @@ public override void OnSwitchContent(Window window)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/WindowChara.cs#L204-L209)
```cs:line-numbers=204
			}
			listEquipment2.transform.parent.SetActive(flag);
			buttonFeatMode.SetActive(idTab == 2 && chara.IsPC);
			buttonFeatOption.SetActive(idTab == 2 && chara.IsPC && featMode); // [!code ++]
		}
	}

```

[`@@ -235,6 +238,12 @@ public void ToggleFeatMode()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/WindowChara.cs#L235-L240)
```cs:line-numbers=235
	{
		featMode = !featMode;
		RefreshSkill(window.idTab);
		buttonFeatOption.SetActive(featMode); // [!code ++]
		buttonFeatOption.SetToggle(EClass.game.config.showAllFeat, delegate(bool a) // [!code ++]
		{ // [!code ++]
			EClass.game.config.showAllFeat = a; // [!code ++]
			RefreshSkill(window.idTab); // [!code ++]
		}); // [!code ++]
	}

	public void RefreshFeatMode()
```

[`@@ -763,7 +772,11 @@ void List(string lang, string idSubCat)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/WindowChara.cs#L763-L769)
```cs:line-numbers=763
		{
			onClick = delegate(Element a, ButtonElement b)
			{
				if (EClass.pc.feat < a.CostLearn) // [!code --]
				if (!a.IsPurchaseFeatReqMet(chara.elements) && !EClass.debug.enable) // [!code ++]
				{ // [!code ++]
					SE.BeepSmall(); // [!code ++]
				} // [!code ++]
				else if (EClass.pc.feat < a.CostLearn) // [!code ++]
				{
					SE.BeepSmall();
					Msg.Say("notEnoughFeatPoint");
```

[`@@ -787,7 +800,7 @@ void List(string lang, string idSubCat)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/WindowChara.cs#L787-L793)
```cs:line-numbers=787
			},
			onList = delegate
			{
				foreach (Element item9 in chara.ListAvailabeFeats()) // [!code --]
				foreach (Element item9 in chara.ListAvailabeFeats(pet: false, EClass.game.config.showAllFeat)) // [!code ++]
				{
					if (item9.source.categorySub == idSubCat)
					{
```

## Zone

[`@@ -54,6 +54,9 @@ public class PortalReturnData`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Zone.cs#L54-L59)
```cs:line-numbers=54
	[JsonProperty]
	public List<int> landFeats;

	[JsonProperty] // [!code ++]
	private FortuneRollData fortuneRoll; // [!code ++]
 // [!code ++]
	public Map map;

	public MapSubset subset;
```

[`@@ -3428,4 +3431,18 @@ public void ApplyBackerPet(bool draw)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/11bd8a86bcfa904245733c4f98b3aca51efc70e7/Elin/Zone.cs#L3428-L3431)
```cs:line-numbers=3428
			}
		}
	}
 // [!code ++]
	public FortuneRollData GetOrCreateFortuneRollData(bool refresh = true) // [!code ++]
	{ // [!code ++]
		if (fortuneRoll == null) // [!code ++]
		{ // [!code ++]
			fortuneRoll = new FortuneRollData(); // [!code ++]
			fortuneRoll.seed = EClass.rnd(50000) + 1; // [!code ++]
		} // [!code ++]
		if (refresh || fortuneRoll.count == 0) // [!code ++]
		{ // [!code ++]
			fortuneRoll.Refresh(); // [!code ++]
		} // [!code ++]
		return fortuneRoll; // [!code ++]
	} // [!code ++]
}
```

---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 12 files modified.
version: EA 23.193 Nightly
changes: ActEffect/ActMelee/ActRanged/AttackProcess/Card/ContentConfigTest/CoreConfig/Msg/Recipe/Thing/TraitSpellbook/WindowChara
---

# EA 23.193 Nightly

September 4, 2025

12 files modified.

## Important Changes

Possible breaking changes. Click the filename to view the chunk.
### [Msg (1)](#msg)
```cs:no-line-numbers
public static string GetGameText(string idLang) // [!code --]
public static string GetGameText(string idLang, Card card = null) // [!code ++]
```
## ActEffect

[`public static bool DamageEle(Card CC, EffectId id, int power, Element e, List<Po`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/ActEffect.cs#L1415-L1422)
```cs:line-numbers=1415
	}
	case EffectId.Draw:
	{
		Point point = CC.pos.GetRandomPoint(1)?.GetNearestPoint(allowBlock: false, allowChara: false); // [!code --]
		if (point == null || !CC.CanSeeLos(point) || (CC.IsPCFactionOrMinion && TC.IsPCFactionOrMinion && TC.isRestrained)) // [!code --]
		if (CC.Dist(TC) <= 1 || (CC.IsPCFactionOrMinion && TC.IsPCFactionOrMinion && TC.isRestrained)) // [!code ++]
		{ // [!code ++]
			break; // [!code ++]
		} // [!code ++]
		Point point = CC.GetFirstStep(TC.pos, PathManager.MoveType.Combat); // [!code ++]
		if (!point.IsValid) // [!code ++]
		{ // [!code ++]
			point = CC.pos.GetRandomPoint(1)?.GetNearestPoint(allowBlock: false, allowChara: false); // [!code ++]
		} // [!code ++]
		if (point == null || !CC.CanSeeLos(point)) // [!code ++]
		{
			break;
		}
```

## ActMelee

[`public bool Attack(float dmgMulti = 1f)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/ActMelee.cs#L169-L175)
```cs:line-numbers=169
		}
		else if (AllowCounter && hasMissed && !cC.HasElement(439) && orgTC.HasElement(380))
		{
			orgTC.Say("counter"); // [!code --]
			orgTC.Say((orgTC.isChara && orgTC.Chara.IsHostile()) ? "counter_enemy" : "counter"); // [!code ++]
			new ActMeleeCounter().Perform(orgTC.Chara, cC);
		}
	}
```

[`void Attack(Card _tc, Point _tp, float mtp, bool subAttack)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/ActMelee.cs#L329-L335)
```cs:line-numbers=329
					num6 = num6 * 100 / (int)Mathf.Clamp((float)AttackProcess.Current.weaponSkill.Value / (float)num7 * 100f, 50f, 150f);
					if (EClass.rnd(100) < num6)
					{
						Act.TC.Say("parry"); // [!code --]
						Act.TC.Say((Act.TC.isChara && Act.TC.Chara.IsHostile()) ? "parry_enemy" : "parry"); // [!code ++]
						Act.TC.PlaySound("parry");
						parried = true;
						return;
```

[`void Attack(Card _tc, Point _tp, float mtp, bool subAttack)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/ActMelee.cs#L369-L387)
```cs:line-numbers=369
					flag = AttackProcess.Current.Perform(count, hasHit, dmgMulti * mtp, maxRoll, subAttack);
					AttackProcess.Current.critFury = false;
				}
				if (flag) // [!code --]
				{ // [!code --]
					hasHit = true; // [!code --]
				} // [!code --]
				else // [!code --]
				{ // [!code --]
					hasMissed = true; // [!code --]
				} // [!code --]
				if (flag || !Act.CC.IsAliveInCurrentZone || !Act.TC.IsAliveInCurrentZone)
				{
					break;
				}
			}
			if (flag) // [!code ++]
			{ // [!code ++]
				hasHit = true; // [!code ++]
			} // [!code ++]
			else // [!code ++]
			{ // [!code ++]
				hasMissed = true; // [!code ++]
			} // [!code ++]
			Act.TC = _tc;
			Act.TP = _tp;
			if (w != null && w.c_ammo > 0 && !Act.CC.HasCondition<ConReload>() && !safety)
```

[`void AttackWithFlurry(Card _tc, Point _tp, float mtp, bool subAttack)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/ActMelee.cs#L508-L514)
```cs:line-numbers=508
				}
				if (m > 0)
				{
					Act.CC.Say("attack_flurry"); // [!code --]
					Act.CC.Say(Act.CC.IsHostile() ? "attack_flurry_enemy" : "attack_flurry"); // [!code ++]
				}
				Attack(_tc, _tp, mtp, subAttack);
				if (parried)
```

## ActRanged

[`void Shoot(Card _tc, Point _tp)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/ActRanged.cs#L316-L322)
```cs:line-numbers=316
					{
						if (chaser > EClass.rnd(4 + (int)Mathf.Pow(4f, k + 2 + j)))
						{
							Act.CC.Say("attack_chaser"); // [!code --]
							Act.CC.Say(Act.CC.IsHostile() ? "attack_chaser_enemy" : "attack_chaser"); // [!code ++]
							if (AttackProcess.Current.Perform(j, hasHit, dmgMulti))
							{
								hasHit = true;
```

## AttackProcess

[`public bool IsCane`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/AttackProcess.cs#L114-L132)
```cs:line-numbers=114
	public static int GetWeaponEnc(Chara CC, Thing w, int ele, bool addSelfEnc = false)
	{
		int num = w?.Evalue(ele) ?? 0;
		if (CC.body.GetAttackStyle() == AttackStyle.TwoHand) // [!code --]
		if (CC.IsPCFactionOrMinion) // [!code ++]
		{
			num = num * (100 + Mathf.Clamp(CC.Evalue(130) / 15, 0, 2) * 25) / 100; // [!code --]
			num += EClass.pc.faction.charaElements.Value(ele); // [!code ++]
		}
		num = num * (100 + GetTwoHandEncBonus(CC)) / 100; // [!code ++]
		if (addSelfEnc)
		{
			num += CC.Evalue(ele);
		}
		if (CC.IsPCFactionOrMinion) // [!code --]
		return num; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public static int GetTwoHandEncBonus(Chara CC) // [!code ++]
	{ // [!code ++]
		if (CC == null || CC.body.GetAttackStyle() != AttackStyle.TwoHand) // [!code ++]
		{
			num += EClass.pc.faction.charaElements.Value(ele); // [!code --]
			return 0; // [!code ++]
		}
		return num; // [!code --]
		return Mathf.Clamp(CC.Evalue(130) / 15, 0, 2) * 25; // [!code ++]
	}

	public string GetText()
```

[`public void Prepare(Chara _CC, Thing _weapon, Card _TC = null, Point _TP = null,`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/AttackProcess.cs#L318-L326)
```cs:line-numbers=318
	{
		toHit += 25 + (int)Mathf.Sqrt(Mathf.Max(0, CC.Evalue(130)) * 2);
	}
	else if (attackStyle == AttackStyle.TwoWield && toHit > 0) // [!code --]
	else if (attackStyle == AttackStyle.TwoWield) // [!code ++]
	{
		toHit = toHit * 100 / (115 + attackIndex * 15 + attackIndex * Mathf.Clamp(2000 / (20 + CC.EvalueMax(131, -10)), 0, 100)); // [!code --]
		int num4 = CC.EvalueMax(131, -10); // [!code ++]
		int num5 = ((num4 >= 25) ? 12 : 15); // [!code ++]
		int max = 100 + ((num4 >= 50) ? ((int)Mathf.Sqrt(num4)) : 0); // [!code ++]
		if (toHit > 0) // [!code ++]
		{ // [!code ++]
			toHit = toHit * 100 / (100 + (attackIndex + 1) * num5 + attackIndex * Mathf.Clamp(2000 / (20 + num4), 0, max)); // [!code ++]
		} // [!code ++]
	}
	if (CC.isBlind)
	{
```

[`public static void ProcAbility(Element e, Chara CC, Card TC, int bonus, bool sub`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/AttackProcess.cs#L486-L491)
```cs:line-numbers=486
	}
	int num = (10 + e.Value / 5) * mtpChance / 100;
	int power = EClass.curve((100 + e.Value * 10) * (100 + bonus) / 100, 400, 100);
	if (e.id == 6602) // [!code ++]
	{ // [!code ++]
		num = 100; // [!code ++]
	} // [!code ++]
	if (num <= EClass.rnd(100))
	{
		return;
```

[`public bool Perform(int count, bool hasHit, float dmgMulti = 1f, bool maxRoll =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/AttackProcess.cs#L654-L660)
```cs:line-numbers=654
			ModExpDef(150, 90);
			ModExpDef(151, 90);
		}
		ProcAbility(list, CC, TC, weaponSkill.Value, subAttack); // [!code --]
		ProcAbility(list, CC, TC, weaponSkill.Value + GetTwoHandEncBonus(CC), subAttack); // [!code ++]
		return false;
	}
	if (TC.IsPC)
```

[`public bool Perform(int count, bool hasHit, float dmgMulti = 1f, bool maxRoll =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/AttackProcess.cs#L773-L790)
```cs:line-numbers=773
			if (item.IsActive(weapon) && item.source.categorySub == "eleAttack")
			{
				int num10 = 25;
				int dmg = EClass.rnd(num * (100 + item.Value * 10) / 500 + 5); // [!code --]
				int num11 = EClass.rnd(num * (100 + item.Value * 10) / 500 + 5); // [!code ++]
				num11 = num11 * (100 + GetTwoHandEncBonus(CC)) / 100; // [!code ++]
				if (conWeapon == null && weapon != null && weapon.trait is TraitToolRangeCane)
				{
					num10 = 0;
				}
				if (num10 > EClass.rnd(100))
				{
					TC.DamageHP(dmg, item.id, isThrow ? (100 + item.Value * 5) : (30 + item.Value), AttackSource.WeaponEnchant, CC); // [!code --]
					TC.DamageHP(num11, item.id, isThrow ? (100 + item.Value * 5) : (30 + item.Value), AttackSource.WeaponEnchant, CC); // [!code ++]
				}
			}
		}
		ProcAbility(list, CC, TC, weaponSkill.Value, subAttack); // [!code --]
		ProcAbility(list, CC, TC, weaponSkill.Value + GetTwoHandEncBonus(CC), subAttack); // [!code ++]
	}
	if (!CC.IsAliveInCurrentZone || !TC.IsAliveInCurrentZone)
	{
```

[`public bool Perform(int count, bool hasHit, float dmgMulti = 1f, bool maxRoll =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/AttackProcess.cs#L792-L803)
```cs:line-numbers=792
	}
	if (!IsRanged && !flag2 && attackStyle == AttackStyle.Shield)
	{
		int num11 = CC.Evalue(123); // [!code --]
		int num12 = CC.Evalue(381); // [!code --]
		if (CC.elements.ValueWithoutLink(123) >= 10 && Mathf.Clamp(Mathf.Sqrt(num11) - 2f, 8f, 15f) + Mathf.Min(Mathf.Sqrt(num12), 25f) > (float)EClass.rnd(100)) // [!code --]
		int num12 = CC.Evalue(123); // [!code ++]
		int num13 = CC.Evalue(381); // [!code ++]
		if (CC.elements.ValueWithoutLink(123) >= 10 && Mathf.Clamp(Mathf.Sqrt(num12) - 2f, 8f, 15f) + Mathf.Min(Mathf.Sqrt(num13), 25f) > (float)EClass.rnd(100)) // [!code ++]
		{
			num = num7 * (Mathf.Min(50 + num11 + num12, 200) + (int)Mathf.Min(Mathf.Sqrt(num12), 100f)) / 100; // [!code --]
			penetration = (int)Mathf.Sqrt(num12); // [!code --]
			num = num7 * (Mathf.Min(50 + num12 + num13, 200) + (int)Mathf.Min(Mathf.Sqrt(num13), 100f)) / 100; // [!code ++]
			penetration = (int)Mathf.Sqrt(num13) + ((num13 != 0) ? 20 : 0); // [!code ++]
			if (penetration > 100)
			{
				penetration = 100;
```

[`public bool Perform(int count, bool hasHit, float dmgMulti = 1f, bool maxRoll =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/AttackProcess.cs#L813-L823)
```cs:line-numbers=813
			{
				if (EClass.rnd(2) == 0)
				{
					TC.Chara.AddCondition<ConDim>(50 + (int)Mathf.Sqrt(num11) * 10); // [!code --]
					TC.Chara.AddCondition<ConDim>(50 + (int)Mathf.Sqrt(num12) * 10); // [!code ++]
				}
				TC.Chara.AddCondition<ConParalyze>(EClass.rnd(2), force: true);
			}
			ProcShieldEncs(CC, TC, 500 + num12); // [!code --]
			ProcShieldEncs(CC, TC, 500 + num13); // [!code ++]
		}
	}
	if (!CC.IsAliveInCurrentZone || !TC.IsAliveInCurrentZone)
```

## Card

[`public void DamageHP(int dmg, int ele, int eleP = 100, AttackSource attackSource`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/Card.cs#L4726-L4732)
```cs:line-numbers=4726
	{
		Chara.AddCondition<ConFear>(100 + EClass.rnd(100));
	}
	if (Chara.ai.Current.CancelWhenDamaged && attackSource != AttackSource.Hunger && attackSource != AttackSource.Fatigue) // [!code --]
	if (Chara.ai.Current.CancelWhenDamaged && attackSource != AttackSource.Hunger && attackSource != AttackSource.Fatigue && (!EClass.core.config.test.dontCancelIfZeroDamage || dmg != 0 || !IsPC)) // [!code ++]
	{
		Chara.ai.Current.TryCancel(origin);
	}
```

## ContentConfigTest

[`public class ContentConfigTest : ContentConfig`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/ContentConfigTest.cs#L41-L46)
```cs:line-numbers=41

	public UIButton toggleCompressSave;

	public UIButton toggledDntCancelIfZeroDamage; // [!code ++]
 // [!code ++]
	public Slider sliderBrightness;

	public override void OnInstantiate()
```

[`public override void OnInstantiate()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/ContentConfigTest.cs#L92-L97)
```cs:line-numbers=92
	{
		base.config.test.compressSave = on;
	});
	toggledDntCancelIfZeroDamage.SetToggle(base.config.test.dontCancelIfZeroDamage, delegate(bool on) // [!code ++]
	{ // [!code ++]
		base.config.test.dontCancelIfZeroDamage = on; // [!code ++]
	}); // [!code ++]
	toggleAlwaysRun.SetToggle(base.config.test.alwaysRun, delegate(bool on)
	{
		base.config.test.alwaysRun = on;
```

## CoreConfig

[`public class Test`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/CoreConfig.cs#L550-L555)
```cs:line-numbers=550

		public bool allowBlockOnItem;

		public bool dontCancelIfZeroDamage; // [!code ++]
 // [!code ++]
		public bool alwaysFixCamera;

		public bool ignoreBackerDestoryFlag;
```

## Msg

[`public static PopItem TalkMaid(string id)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/Msg.cs#L249-L255)
```cs:line-numbers=249
		return TalkHomeMemeber(id);
	}

	public static string GetGameText(string idLang) // [!code --]
	public static string GetGameText(string idLang, Card card = null) // [!code ++]
	{
		LangGame.Row row = EClass.core.sources.langGame.map.TryGetValue(idLang);
		if (row == null)
```

## Recipe

[`public bool HasSameTile(Point point, int dir, int altitude, int bridgeHeight)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/Recipe.cs#L609-L615)
```cs:line-numbers=609
			return true;
		}
	}
	else if (IsBlock && point.matBlock == GetColorMaterial() && point.sourceBlock == tileRow) // [!code --]
	else if (IsBlock && point.matBlock == GetColorMaterial() && (point.sourceBlock == tileRow || (tileRow.tileType == point.sourceBlock.tileType && tileRow.tileType == TileType.Slope))) // [!code ++]
	{
		if (point.sourceBlock.tileType.AltitudeAsDir && dir != point.cell.objDir)
		{
```

## Thing

[`public override void OnCreate(int genLv)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/Thing.cs#L263-L268)
```cs:line-numbers=263
			{
				num2 = EClass.rnd(2) + 1;
			}
			if (id == "bow_vindale") // [!code ++]
			{ // [!code ++]
				num2 = 4; // [!code ++]
			} // [!code ++]
			if (num2 > 0)
			{
				for (int j = 0; j < num2; j++)
```

[`public override void WriteNote(UINote n, Action<UINote> onWriteNote = null, IIns`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/Thing.cs#L1021-L1028)
```cs:line-numbers=1021
	{
		n.AddText("(id:" + id + " tile:" + (source.tiles.IsEmpty() ? "-" : ((object)source.tiles[0]))?.ToString() + ") lv:" + base.LV + " price:" + GetPrice());
	}
	Card rootCard = GetRootCard(); // [!code --]
	if (rootCard != null && rootCard != EClass.pc && rootCard != this && rootCard.ExistsOnMap && !((parent as Thing)?.trait is TraitChestMerchant)) // [!code --]
	Card root = GetRootCard(); // [!code ++]
	if (root != null && root != EClass.pc && root != this && root.ExistsOnMap && !((parent as Thing)?.trait is TraitChestMerchant)) // [!code ++]
	{
		n.AddText("isChildOf".lang(GetRootCard().Name), FontColor.ItemName);
	}
```

[`public override void WriteNote(UINote n, Action<UINote> onWriteNote = null, IIns`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/Thing.cs#L1270-L1276)
```cs:line-numbers=1270
					return false;
				}
				return (!showEQStats || (e.id != 64 && e.id != 65 && e.id != 66 && e.id != 67)) ? true : false;
			}, null, ElementContainer.NoteMode.Default, addRaceFeat: false, (Element e, string s) => (mode != IInspect.NoteMode.Info) ? s : (s + " (" + e.Value + ")")); // [!code --]
			}, null, ElementContainer.NoteMode.Default, addRaceFeat: false, delegate(Element e, string s) // [!code ++]
			{ // [!code ++]
				if (mode != IInspect.NoteMode.Info) // [!code ++]
				{ // [!code ++]
					return s; // [!code ++]
				} // [!code ++]
				int num4 = e.Value; // [!code ++]
				if (e.source.IsWeaponEnc && !e.source.tag.Contains("modRanged") && isEquipped && root.isChara) // [!code ++]
				{ // [!code ++]
					num4 = num4 * (100 + AttackProcess.GetTwoHandEncBonus(root.Chara)) / 100; // [!code ++]
				} // [!code ++]
				return s + " (" + e.Value + ((e.Value == num4) ? "" : (" → " + num4)) + ")"; // [!code ++]
			}); // [!code ++]
		}
		if (sockets != null)
		{
```

## TraitSpellbook

[`public static void Create(Card owner, int ele)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/TraitSpellbook.cs#L13-L22)
```cs:line-numbers=13
	switch (row.id)
	{
	case 8430:
		owner.elements.SetBase(765, 50); // [!code --]
		owner.elements.SetBase(765, 40); // [!code ++]
		break;
	case 9155:
		owner.elements.SetBase(765, 90); // [!code --]
		owner.elements.SetBase(765, 70); // [!code ++]
		break;
	case 8390:
	case 8550:
```

## WindowChara

[`public void RefreshSkill(int idTab)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/65d5c80ce3039cde73b55f7f0cbdba5ca9ef3c29/Elin/WindowChara.cs#L677-L682)
```cs:line-numbers=677
					{
						return true;
					}
					if (a.source.category == "enchant") // [!code ++]
					{ // [!code ++]
						return true; // [!code ++]
					} // [!code ++]
				}
				if ((a.owner == chara.elements && a.vLink == 0 && !a.IsFactionElement(chara)) || a.source.category == "resist")
				{
```

---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 24 files modified. 3 new files created.
version: EA 23.186 Nyaightly
changes: CTAG/CardRenderer/Chara/ContentCodex/ContentConfigTest/CoreConfig/CoreDebug/DramaManager/EffectMeteor/Game/GameIO/+GameType/Map/Prologue/SourceChara/+SurvivalManager/TaskBuild/TaskHarvest/TraitDreamBug/TraitDrink/TraitFakeBlock/TraitFigure/TraitMapBoard/TraitWaystone/Zone/+Zone_StartSiteSky/Zone_VernisMine
---

# EA 23.186 Nyaightly

August 22, 2025

24 files modified. 3 new files created.

## Important Changes

Possible breaking changes. Click the filename to view the chunk.
### [TraitDrink (2)](#traitdrink)
```cs:no-line-numbers
public static void BlendLove(Chara c, Thing t, bool dream = false) // [!code --]
public static void BlendLove(Chara c, Thing t, Card source, bool dream = false) // [!code ++]
```
```cs:no-line-numbers
public static void BlendPoison(Chara c, Thing t) // [!code --]
public static void BlendPoison(Chara c, Thing t, Card source) // [!code ++]
```
### [Zone (1)](#zone)
```cs:no-line-numbers
public void ClaimZone(bool debug = false) // [!code --]
public void ClaimZone(bool debug = false, Point pos = null) // [!code ++]
```
## CTAG

[`public enum CTAG`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/CTAG.cs#L47-L51)
```cs:line-numbers=47
	fairy,
	god,
	dragon,
	plant // [!code --]
	plant, // [!code ++]
	antiSpider // [!code ++]
}
```

## CardRenderer

[`public override void Draw(RenderParam p, ref Vector3 v, bool drawShadow)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/CardRenderer.cs#L215-L223)
```cs:line-numbers=215
				}
				else
				{
					if (EClass.core.config.game.antiSpider && row.race == "spider" && row._tiles.Length > 1) // [!code --]
					if (EClass.core.config.game.antiSpider && row.skinAntiSpider != 0) // [!code ++]
					{
						owner.refVal = 1; // [!code --]
						owner.refVal = row.skinAntiSpider; // [!code ++]
					}
					p.tile = row._tiles[owner.refVal % row._tiles.Length] * ((owner.dir % 2 == 0) ? 1 : (-1));
					p.matColor = traitFigure.GetMatColor();
```

## Chara

[`public override void Tick()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/Chara.cs#L3950-L3983)
```cs:line-numbers=3950
			EClass.player.returnInfo.turns--;
			if (EClass.player.returnInfo.turns <= 0)
			{
				if (EClass.pc.burden.GetPhase() != 4 || EClass.debug.ignoreWeight) // [!code --]
				if (EClass.game.Prologue.type == GameType.Survival && EClass._zone is Zone_StartSiteSky) // [!code ++]
				{
					int uidDest = EClass.player.returnInfo.uidDest; // [!code --]
					Zone zone = null; // [!code --]
					if (uidDest != 0) // [!code --]
					{ // [!code --]
						zone = EClass.game.spatials.map.TryGetValue(uidDest) as Zone; // [!code --]
					} // [!code --]
					if (zone == null || zone.destryoed) // [!code --]
					{ // [!code --]
						zone = EClass.world.region; // [!code --]
					} // [!code --]
					if (zone == EClass.game.activeZone || EClass.game.activeZone.IsRegion) // [!code --]
					{ // [!code --]
						Msg.Say("returnFail"); // [!code --]
					} // [!code --]
					else // [!code --]
					Msg.SayNothingHappen(); // [!code ++]
				} // [!code ++]
				else // [!code ++]
				{ // [!code ++]
					if (EClass.pc.burden.GetPhase() != 4 || EClass.debug.ignoreWeight) // [!code ++]
					{
						Msg.Say("returnComplete"); // [!code --]
						EClass.player.uidLastTravelZone = 0; // [!code --]
						EClass.pc.MoveZone(zone, ZoneTransition.EnterState.Return); // [!code --]
						EClass.player.lastZonePos = null; // [!code --]
						int uidDest = EClass.player.returnInfo.uidDest; // [!code ++]
						Zone zone = null; // [!code ++]
						if (uidDest != 0) // [!code ++]
						{ // [!code ++]
							zone = EClass.game.spatials.map.TryGetValue(uidDest) as Zone; // [!code ++]
						} // [!code ++]
						if (zone == null || zone.destryoed) // [!code ++]
						{ // [!code ++]
							zone = EClass.world.region; // [!code ++]
						} // [!code ++]
						if (zone == EClass.game.activeZone || EClass.game.activeZone.IsRegion) // [!code ++]
						{ // [!code ++]
							Msg.Say("returnFail"); // [!code ++]
						} // [!code ++]
						else // [!code ++]
						{ // [!code ++]
							Msg.Say("returnComplete"); // [!code ++]
							EClass.player.uidLastTravelZone = 0; // [!code ++]
							EClass.pc.MoveZone(zone, ZoneTransition.EnterState.Return); // [!code ++]
							EClass.player.lastZonePos = null; // [!code ++]
						} // [!code ++]
						EClass.player.returnInfo = null; // [!code ++]
						return; // [!code ++]
					}
					EClass.player.returnInfo = null;
					return; // [!code --]
					Msg.Say("returnOverweight"); // [!code ++]
				}
				EClass.player.returnInfo = null; // [!code --]
				Msg.Say("returnOverweight"); // [!code --]
			}
		}
		if ((HasNoGoal || !ai.IsRunning) && !WillConsumeTurn())
```

[`public override CardRenderer _CreateRenderer()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/Chara.cs#L6330-L6338)
```cs:line-numbers=6330
{
	CardRenderer cardRenderer = renderer;
	CharaRenderer charaRenderer = new CharaRenderer();
	if (race.id == "spider" && source.tiles.Length > 1) // [!code --]
	if (source.skinAntiSpider != 0 && EClass.core.config.game.antiSpider) // [!code ++]
	{
		base.idSkin = (EClass.core.config.game.antiSpider ? 1 : 0); // [!code --]
		base.idSkin = source.skinAntiSpider; // [!code ++]
	}
	if (host != null)
	{
```

## ContentCodex

[`public void RefreshList()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/ContentCodex.cs#L78-L84)
```cs:line-numbers=78
			{
				b.icon.transform.localScale = new Vector3(1f / EClass.core.uiScale, 1f / EClass.core.uiScale, 1f);
			}
			int idSkin = ((EClass.core.config.game.antiSpider && a.source.race == "spider" && a.source.tiles.Length > 1) ? 1 : 0); // [!code --]
			int idSkin = ((EClass.core.config.game.antiSpider && a.source.skinAntiSpider != 0) ? a.source.skinAntiSpider : 0); // [!code ++]
			a.SetImage(b.icon, idSkin);
		},
		onList = delegate
```

[`public void RefreshInfo()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/ContentCodex.cs#L119-L125)
```cs:line-numbers=119
		SourceChara.Row source = codexCreature.source;
		uINote.Clear();
		UIItem uIItem = uINote.AddHeader("HeaderCodex", codexCreature.Name.Replace("『", Environment.NewLine + "『"));
		int idSkin = ((EClass.core.config.game.antiSpider && codexCreature.source.race == "spider" && codexCreature.source.tiles.Length > 1) ? 1 : 0); // [!code --]
		int idSkin = ((EClass.core.config.game.antiSpider && codexCreature.source.skinAntiSpider != 0) ? codexCreature.source.skinAntiSpider : 0); // [!code ++]
		codexCreature.SetImage(uIItem.image1, idSkin);
		uIItem.text2.text = "Lv." + source.LV + Environment.NewLine + EClass.sources.races.map[source.race].GetName().ToTitleCase(wholeText: true) + Environment.NewLine + EClass.sources.jobs.map[source.job].GetName().ToTitleCase(wholeText: true);
		uIItem.image1.rectTransform.pivot = pivot;
```

## ContentConfigTest

[`public class ContentConfigTest : ContentConfig`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/ContentConfigTest.cs#L39-L44)
```cs:line-numbers=39

	public UIButton toggleToolNoPick;

	public UIButton toggleCompressSave; // [!code ++]
 // [!code ++]
	public Slider sliderBrightness;

	public override void OnInstantiate()
```

[`public override void OnInstantiate()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/ContentConfigTest.cs#L86-L91)
```cs:line-numbers=86
	{
		base.config.test.toolNoPick = on;
	});
	toggleCompressSave.SetToggle(base.config.test.compressSave, delegate(bool on) // [!code ++]
	{ // [!code ++]
		base.config.test.compressSave = on; // [!code ++]
	}); // [!code ++]
	toggleAlwaysRun.SetToggle(base.config.test.alwaysRun, delegate(bool on)
	{
		base.config.test.alwaysRun = on;
```

## CoreConfig

[`public class Test`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/CoreConfig.cs#L560-L565)
```cs:line-numbers=560

		public bool toolNoPick;

		public bool compressSave; // [!code ++]
 // [!code ++]
		public float brightnessNight;
	}

```

[`public class Fix`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/CoreConfig.cs#L583-L590)
```cs:line-numbers=583

	public int maxPlayedHours;

	public bool compressSave; // [!code --]
 // [!code --]
	public bool ignoreParallelsWarning;

	public bool ignoreLinuxModWarning;
```

## CoreDebug

[`public enum StartParty`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/CoreDebug.cs#L46-L51)
```cs:line-numbers=46
public enum StartScene
{
	Title,
	Survival, // [!code ++]
	Zone,
	Home,
	Home_Cave,
```

[`public void QuickStart()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/CoreDebug.cs#L348-L353)
```cs:line-numbers=348
	case StartScene.Home:
		EClass.game.world.date.hour = EClass.debug.startHour;
		break;
	case StartScene.Survival: // [!code ++]
		EClass.game.idPrologue = 3; // [!code ++]
		break; // [!code ++]
	case StartScene.Home_Cave:
		EClass.game.idPrologue = 2;
		break;
```

[`public void QuickStart()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/CoreDebug.cs#L417-L422)
```cs:line-numbers=417
		break;
	case StartLoadout.FewItem:
	{
		if (startScene == StartScene.Survival) // [!code ++]
		{ // [!code ++]
			AddHotbar("pickaxe").ChangeMaterial(0); // [!code ++]
			break; // [!code ++]
		} // [!code ++]
		Thing thing = ThingGen.Create("backpack");
		thing.AddCard(ThingGen.Create("rp_food", -1, 10).SetNum(30));
		thing.AddCard(ThingGen.Create("rp_block", -1, 10).SetNum(30));
```

## DramaManager

[`public bool CheckIF(string IF)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/DramaManager.cs#L1046-L1051)
```cs:line-numbers=1046
	string[] array = IF.Split(',');
	switch (array[0])
	{
	case "survival": // [!code ++]
		return EMono.game.Prologue.type == GameType.Survival; // [!code ++]
	case "fromBook":
		return LayerDrama.fromBook;
	case "!fromBook":
```

## EffectMeteor

[`public static void Create(Point center, int radius, int count, Action<int, Point`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/EffectMeteor.cs#L43-L55)
```cs:line-numbers=43
			int num = 0;
			if (num < 1000)
			{
				Point randomSurface = EMono._map.GetRandomSurface(center.x, center.z, radius); // [!code --]
				Point point = ((radius == 0) ? center : EMono._map.GetRandomSurface(center.x, center.z, radius)); // [!code ++]
				foreach (Point item in list)
				{
					randomSurface.Equals(item); // [!code --]
					point.Equals(item); // [!code ++]
				}
				p.Set(randomSurface); // [!code --]
				list.Add(randomSurface); // [!code --]
				p.Set(point); // [!code ++]
				list.Add(point); // [!code ++]
			}
		}
		int _i = i;
```

## Game

[`private void _OnDeserialized(StreamingContext context)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/Game.cs#L220-L225)
```cs:line-numbers=220
	[JsonProperty]
	public GamePrincipal principal = new GamePrincipal();

	[JsonProperty] // [!code ++]
	public SurvivalManager survival; // [!code ++]
 // [!code ++]
	public int gameSpeedIndex = 1;

	public int lastGameSpeedIndex = 1;
```

[`public void StartNewGame()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/Game.cs#L774-L781)
```cs:line-numbers=774
	EClass.pc.SetGlobal();
	parties.Create(EClass.pc);
	Prologue prologue = EClass.game.Prologue;
	CharaGen.Create("fiama").SetGlobal(EClass.game.StartZone, prologue.posFiama.x, prologue.posFiama.y); // [!code --]
	CharaGen.Create("ashland").SetGlobal(EClass.game.StartZone, prologue.posAsh.x, prologue.posAsh.y); // [!code --]
	if (prologue.type == GameType.Survival) // [!code ++]
	{ // [!code ++]
		survival = new SurvivalManager(); // [!code ++]
	} // [!code ++]
	else // [!code ++]
	{ // [!code ++]
		CharaGen.Create("fiama").SetGlobal(EClass.game.StartZone, prologue.posFiama.x, prologue.posFiama.y); // [!code ++]
		CharaGen.Create("ashland").SetGlobal(EClass.game.StartZone, prologue.posAsh.x, prologue.posAsh.y); // [!code ++]
	} // [!code ++]
	if ((bool)LayerTitle.actor)
	{
		world.date.hour = EClass.game.Prologue.hour;
```

[`public void StartNewGame()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/Game.cs#L826-L831)
```cs:line-numbers=826
				z = EClass.game.Prologue.startZ
			};
			break;
		case CoreDebug.StartScene.Survival: // [!code ++]
			EClass.game.idPrologue = 3; // [!code ++]
			zone5 = EClass.game.spatials.Find(EClass.game.Prologue.idStartZone); // [!code ++]
			transition = new ZoneTransition // [!code ++]
			{ // [!code ++]
				state = ZoneTransition.EnterState.Exact, // [!code ++]
				x = EClass.game.Prologue.startX, // [!code ++]
				z = EClass.game.Prologue.startZ // [!code ++]
			}; // [!code ++]
			break; // [!code ++]
		case CoreDebug.StartScene.Home_Cave:
			EClass.game.idPrologue = 2;
			zone5 = EClass.game.spatials.Find(EClass.game.Prologue.idStartZone);
```

## GameIO

[`public class GameIO : EClass`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/GameIO.cs#L36-L52)
```cs:line-numbers=36

	public static int NumBackup => (int)MathF.Max(5f, EClass.core.config.game.numBackup);

	public static bool compressSave // [!code --]
	{ // [!code --]
		get // [!code --]
		{ // [!code --]
			if (EClass.core.config.compressSave) // [!code --]
			{ // [!code --]
				return !EClass.debug.dontCompressSave; // [!code --]
			} // [!code --]
			return false; // [!code --]
		} // [!code --]
	} // [!code --]
	public static bool compressSave => EClass.core.config.test.compressSave; // [!code ++]

	public static void ResetTemp()
	{
```

## +GameType

::: details File Created
```cs
public enum GameType
{
	Default,
	Survival
}
```

:::
## Map

[`public void Save(string path, ZoneExportData export = null, PartialMap partial =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/Map.cs#L450-L475)
```cs:line-numbers=450
			num6++;
		}
	}
	compression = IO.Compression.None; // [!code --]
	IO.WriteLZ4(path + "objVals", array); // [!code --]
	IO.WriteLZ4(path + "blocks", array2); // [!code --]
	IO.WriteLZ4(path + "blockMats", array3); // [!code --]
	IO.WriteLZ4(path + "floors", array4); // [!code --]
	IO.WriteLZ4(path + "floorMats", array5); // [!code --]
	IO.WriteLZ4(path + "objs", array6); // [!code --]
	IO.WriteLZ4(path + "objMats", array7); // [!code --]
	IO.WriteLZ4(path + "decal", array8); // [!code --]
	IO.WriteLZ4(path + "flags", array10); // [!code --]
	IO.WriteLZ4(path + "flags2", array11); // [!code --]
	IO.WriteLZ4(path + "dirs", array9); // [!code --]
	IO.WriteLZ4(path + "heights", array12); // [!code --]
	IO.WriteLZ4(path + "bridges", array13); // [!code --]
	IO.WriteLZ4(path + "bridgeMats", array14); // [!code --]
	IO.WriteLZ4(path + "bridgeHeights", array15); // [!code --]
	IO.WriteLZ4(path + "bridgePillars", array16); // [!code --]
	IO.WriteLZ4(path + "roofBlocks", array18); // [!code --]
	IO.WriteLZ4(path + "roofBlockMats", array19); // [!code --]
	IO.WriteLZ4(path + "roofBlockDirs", array17); // [!code --]
	compression = ((!EClass.core.config.test.compressSave) ? IO.Compression.None : IO.Compression.LZ4); // [!code ++]
	Write(path + "objVals", array); // [!code ++]
	Write(path + "blocks", array2); // [!code ++]
	Write(path + "blockMats", array3); // [!code ++]
	Write(path + "floors", array4); // [!code ++]
	Write(path + "floorMats", array5); // [!code ++]
	Write(path + "objs", array6); // [!code ++]
	Write(path + "objMats", array7); // [!code ++]
	Write(path + "decal", array8); // [!code ++]
	Write(path + "flags", array10); // [!code ++]
	Write(path + "flags2", array11); // [!code ++]
	Write(path + "dirs", array9); // [!code ++]
	Write(path + "heights", array12); // [!code ++]
	Write(path + "bridges", array13); // [!code ++]
	Write(path + "bridgeMats", array14); // [!code ++]
	Write(path + "bridgeHeights", array15); // [!code ++]
	Write(path + "bridgePillars", array16); // [!code ++]
	Write(path + "roofBlocks", array18); // [!code ++]
	Write(path + "roofBlockMats", array19); // [!code ++]
	Write(path + "roofBlockDirs", array17); // [!code ++]
	things.Sort((Thing a, Thing b) => a.stackOrder - b.stackOrder);
	if (export == null)
	{
```

[`public void Save(string path, ZoneExportData export = null, PartialMap partial =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/Map.cs#L526-L531)
```cs:line-numbers=526
			things = list;
		}
		serializedCharas.Clear();
		void Write(string _path, byte[] bytes) // [!code ++]
		{ // [!code ++]
			IO.WriteLZ4(_path, bytes, compression); // [!code ++]
		} // [!code ++]
	}

	public byte[] TryLoadFile(string path, string s, int size)
```

[`public void MineObj(Point point, Task task = null, Chara c = null)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/Map.cs#L1884-L1889)
```cs:line-numbers=1884
			{
				MineBlock(point, recoverBlock: false, c, mineObj: false);
			}
			if (EClass.game.Prologue.type == GameType.Survival && EClass._zone is Zone_StartSiteSky && !EClass.scene.actionMode.IsBuildMode) // [!code ++]
			{ // [!code ++]
				if (TrySpawnSurvivalItem(point)) // [!code ++]
				{ // [!code ++]
					Rand.SetSeed(); // [!code ++]
					return; // [!code ++]
				} // [!code ++]
				Rand.SetSeed(); // [!code ++]
			} // [!code ++]
			switch (sourceObj.alias)
			{
			case "nest_bird":
```

[`public void MineObjSound(Point point)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/Map.cs#L1926-L1931)
```cs:line-numbers=1926
		point.PlaySound(point.cell.matObj.GetSoundDead(point.cell.sourceObj));
	}

	public bool TrySpawnSurvivalItem(Point point) // [!code ++]
	{ // [!code ++]
		SourceObj.Row sourceObj = point.cell.sourceObj; // [!code ++]
		int searchWreck = EClass.game.survival.flags.searchWreck; // [!code ++]
		string[] array = new string[6] { "log", "rock", "branch", "bone", "grass", "vine" }; // [!code ++]
		int chanceChange = 25; // [!code ++]
		int num = searchWreck / 50 + 3; // [!code ++]
		switch (sourceObj.alias) // [!code ++]
		{ // [!code ++]
		case "nest_bird": // [!code ++]
			chanceChange = 100; // [!code ++]
			return Pop(ThingGen.Create((EClass.rnd(10) == 0) ? "egg_fertilized" : "_egg").TryMakeRandomItem(num)); // [!code ++]
		case "wreck_wood": // [!code ++]
			array = new string[5] { "log", "log", "branch", "grass", "vine" }; // [!code ++]
			break; // [!code ++]
		case "wreck_junk": // [!code ++]
			chanceChange = 50; // [!code ++]
			return Pop(ThingGen.CreateFromFilter("shop_junk", num)); // [!code ++]
		case "wreck_stone": // [!code ++]
			array = new string[4] { "rock", "rock", "stone", "bone" }; // [!code ++]
			break; // [!code ++]
		case "wreck_scrap": // [!code ++]
			chanceChange = 75; // [!code ++]
			array = new string[1] { "scrap" }; // [!code ++]
			break; // [!code ++]
		case "wreck_cloth": // [!code ++]
			chanceChange = 75; // [!code ++]
			array = new string[1] { "fiber" }; // [!code ++]
			break; // [!code ++]
		case "wreck_precious": // [!code ++]
			chanceChange = 100; // [!code ++]
			return Pop(ThingGen.CreateFromFilter("shop_magic", num)); // [!code ++]
		default: // [!code ++]
			return false; // [!code ++]
		} // [!code ++]
		if (EClass.rnd(3) == 0 && EClass.game.survival.flags.spawnedFloor < 4) // [!code ++]
		{ // [!code ++]
			EClass.game.survival.flags.spawnedFloor++; // [!code ++]
			return Pop(ThingGen.CreateFloor(40, 45).SetNum(3)); // [!code ++]
		} // [!code ++]
		if (EClass.rnd(20) == 0) // [!code ++]
		{ // [!code ++]
			return Pop(TraitSeed.MakeRandomSeed()); // [!code ++]
		} // [!code ++]
		if (EClass.rnd(12) == 0) // [!code ++]
		{ // [!code ++]
			return Pop(ThingGen.Create("money2")); // [!code ++]
		} // [!code ++]
		if (EClass.rnd(12) == 0) // [!code ++]
		{ // [!code ++]
			Point pos = point.GetNearestPoint(allowBlock: false, allowChara: false, allowInstalled: false, ignoreCenter: true) ?? point; // [!code ++]
			if (searchWreck < 50 || EClass.rnd(3) != 0) // [!code ++]
			{ // [!code ++]
				EClass._zone.SpawnMob(pos, SpawnSetting.HomeWild(num)); // [!code ++]
			} // [!code ++]
			else // [!code ++]
			{ // [!code ++]
				EClass._zone.SpawnMob(pos, SpawnSetting.HomeEnemy(Mathf.Max(num - 5, 1))); // [!code ++]
			} // [!code ++]
		} // [!code ++]
		return Pop(ThingGen.Create(array.RandomItem()).SetNum(1 + EClass.rnd(3))); // [!code ++]
		bool Next() // [!code ++]
		{ // [!code ++]
			EClass.game.survival.flags.searchWreck++; // [!code ++]
			Point pos2 = point.GetNearestPoint(allowBlock: false, allowChara: false, allowInstalled: false, ignoreCenter: true) ?? point; // [!code ++]
			if (EClass.game.survival.flags.searchWreck == 20) // [!code ++]
			{ // [!code ++]
				EffectMeteor.Create(pos2, 0, 1, delegate // [!code ++]
				{ // [!code ++]
					EClass._zone.AddCard(ThingGen.CreateRecipe("container_shipping"), pos2); // [!code ++]
				}); // [!code ++]
			} // [!code ++]
			NextObj(); // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
		void NextObj() // [!code ++]
		{ // [!code ++]
			if (EClass.rnd(100) < chanceChange) // [!code ++]
			{ // [!code ++]
				string[] source = new string[11] // [!code ++]
				{ // [!code ++]
					"nest_bird", "wreck_wood", "wreck_wood", "wreck_wood", "wreck_wood", "wreck_stone", "wreck_stone", "wreck_scrap", "wreck_junk", "wreck_cloth", // [!code ++]
					"wreck_precious" // [!code ++]
				}; // [!code ++]
				SetObj(point.x, point.z, EClass.sources.objs.alias[source.RandomItem()].id); // [!code ++]
			} // [!code ++]
		} // [!code ++]
		bool Pop(Thing t) // [!code ++]
		{ // [!code ++]
			TrySmoothPick(point, t, EClass.pc); // [!code ++]
			Next(); // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public PlantData TryGetPlant(Point p)
	{
		return plants.TryGetValue(p.index);
```

## Prologue

[`[Serializable]`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/Prologue.cs#L4-L9)
```cs:line-numbers=4
[Serializable]
public class Prologue
{
	public GameType type; // [!code ++]
 // [!code ++]
	public string idStartZone;

	public int startX;
```

## SourceChara

[`public class Row : CardRow`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/SourceChara.cs#L56-L61)
```cs:line-numbers=56

		public int[] _tiles_snow;

		public int skinAntiSpider; // [!code ++]
 // [!code ++]
		[NonSerialized]
		public SourceRace.Row _race_row;

```

[`public override void SetTiles()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/SourceChara.cs#L98-L104)
```cs:line-numbers=98
	{
		base.SetTiles();
		staticSkin = HasTag(CTAG.staticSkin);
		if ((bool)renderData && (bool)renderData.pass && (_tiles_snow == null || _tiles_snow.Length != tiles_snow.Length)) // [!code --]
		if (!renderData || !renderData.pass) // [!code ++]
		{ // [!code ++]
			return; // [!code ++]
		} // [!code ++]
		if (_tiles_snow == null || _tiles_snow.Length != tiles_snow.Length) // [!code ++]
		{
			_tiles_snow = new int[tiles_snow.Length];
			for (int i = 0; i < tiles_snow.Length; i++)
```

[`public override void SetTiles()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/SourceChara.cs#L106-L111)
```cs:line-numbers=106
					_tiles_snow[i] = tiles_snow[i] / 100 * (int)renderData.pass.pmesh.tiling.x + tiles_snow[i] % 100;
				}
			}
			skinAntiSpider = ((staticSkin && HasTag(CTAG.antiSpider)) ? 1 : 0); // [!code ++]
		}

		public override string GetName()
```

## +SurvivalManager

::: details File Created
```cs
using System.Runtime.Serialization;
using Newtonsoft.Json;

public class SurvivalManager : EClass
{
	public class Flags : EClass
	{
		[JsonProperty]
		public int[] ints = new int[50];

		public BitArray32 bits;

		public int spawnedFloor
		{
			get
			{
				return ints[3];
			}
			set
			{
				ints[3] = value;
			}
		}

		public int floors
		{
			get
			{
				return ints[4];
			}
			set
			{
				ints[4] = value;
			}
		}

		public int searchWreck
		{
			get
			{
				return ints[5];
			}
			set
			{
				ints[5] = value;
			}
		}

		[OnSerializing]
		private void _OnSerializing(StreamingContext context)
		{
			ints[0] = (int)bits.Bits;
		}

		[OnDeserialized]
		private void _OnDeserialized(StreamingContext context)
		{
			bits.Bits = (uint)ints[0];
		}
	}

	[JsonProperty]
	public Flags flags = new Flags();
}
```

:::
## TaskBuild

[`public override void OnProgressComplete()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/TaskBuild.cs#L368-L387)
```cs:line-numbers=368
				_ = (item.trait as TraitNewZone).IsDownstairs;
			}
		}
		if (ActionMode.Build.IsActive && ActionMode.Build.IsRoofEditMode()) // [!code --]
		if (!ActionMode.Build.IsActive || !ActionMode.Build.IsRoofEditMode()) // [!code ++]
		{ // [!code ++]
			pos.ForeachMultiSize(recipe.W, recipe.H, delegate(Point p, bool center) // [!code ++]
			{ // [!code ++]
				if (p.IsBlocked && p.HasChara) // [!code ++]
				{ // [!code ++]
					foreach (Chara item2 in p.ListCharas()) // [!code ++]
					{ // [!code ++]
						EClass.pc.Kick(item2, ignoreSelf: true, karmaLoss: false, show: false); // [!code ++]
					} // [!code ++]
				} // [!code ++]
			}); // [!code ++]
		} // [!code ++]
		if (EClass.game.Prologue.type != GameType.Survival || !(EClass._zone is Zone_StartSiteSky)) // [!code ++]
		{
			return;
		}
		pos.ForeachMultiSize(recipe.W, recipe.H, delegate(Point p, bool center) // [!code --]
		int i = 0; // [!code ++]
		EClass._map.ForeachCell(delegate(Cell c) // [!code ++]
		{
			if (p.IsBlocked && p.HasChara) // [!code --]
			if (!c.sourceFloor.tileType.IsSkipFloor) // [!code ++]
			{
				foreach (Chara item2 in p.ListCharas()) // [!code --]
				{ // [!code --]
					EClass.pc.Kick(item2, ignoreSelf: true, karmaLoss: false, show: false); // [!code --]
				} // [!code --]
				i++; // [!code ++]
			}
		});
		if (EClass.game.survival.flags.floors < 9 && i >= 9) // [!code ++]
		{ // [!code ++]
			EffectMeteor.Create(pos, 0, 1, delegate // [!code ++]
			{ // [!code ++]
				EClass._zone.ClaimZone(debug: false, pos); // [!code ++]
			}); // [!code ++]
			EClass.game.survival.flags.floors = 9; // [!code ++]
		} // [!code ++]
		else if (EClass.game.survival.flags.floors < 15 && i >= 15) // [!code ++]
		{ // [!code ++]
			EffectMeteor.Create(pos, 0, 1, delegate // [!code ++]
			{ // [!code ++]
				EClass.pc.homeBranch.AddMemeber(EClass._zone.AddCard(CharaGen.Create("fiama"), pos.x, pos.z).Chara); // [!code ++]
			}); // [!code ++]
			EClass.game.survival.flags.floors = 15; // [!code ++]
		} // [!code ++]
		else if (EClass.game.survival.flags.floors < 25 && i >= 25) // [!code ++]
		{ // [!code ++]
			EffectMeteor.Create(pos, 0, 1, delegate // [!code ++]
			{ // [!code ++]
				EClass.pc.homeBranch.AddMemeber(EClass._zone.AddCard(CharaGen.Create("nino"), pos.x, pos.z).Chara); // [!code ++]
			}); // [!code ++]
			EClass.game.survival.flags.floors = 25; // [!code ++]
		} // [!code ++]
		else if (EClass.game.survival.flags.floors < 40 && i >= 40) // [!code ++]
		{ // [!code ++]
			EffectMeteor.Create(pos, 0, 1, delegate // [!code ++]
			{ // [!code ++]
				EClass.pc.homeBranch.AddMemeber(EClass._zone.AddCard(CharaGen.Create("loytel"), pos.x, pos.z).Chara); // [!code ++]
			}); // [!code ++]
			EClass.game.survival.flags.floors = 40; // [!code ++]
		} // [!code ++]
		else if (EClass.game.survival.flags.floors < 50 && i >= 50) // [!code ++]
		{ // [!code ++]
			EffectMeteor.Create(pos, 0, 1, delegate // [!code ++]
			{ // [!code ++]
				EClass._zone.AddCard(ThingGen.Create("core_defense"), pos).Install(); // [!code ++]
			}); // [!code ++]
			EClass.game.survival.flags.floors = 50; // [!code ++]
		} // [!code ++]
	}

	public override void OnDestroy()
```

## TaskHarvest

[`public override bool IsHostileAct`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/TaskHarvest.cs#L70-L75)
```cs:line-numbers=70
		}
	}

	public override bool Loop // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			if (EClass.game.Prologue.type == GameType.Survival && EClass._zone is Zone_StartSite) // [!code ++]
			{ // [!code ++]
				return CanProgress(); // [!code ++]
			} // [!code ++]
			return false; // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public override bool CanManualCancel()
	{
		return true;
```

## TraitDreamBug

[`public override bool CanBlend(Thing t)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/TraitDreamBug.cs#L16-L22)
```cs:line-numbers=16

	public override void OnBlend(Thing t, Chara c)
	{
		TraitDrink.BlendLove(EClass.pc, t, dream: true); // [!code --]
		TraitDrink.BlendLove(EClass.pc, t, owner, dream: true); // [!code ++]
		owner.ModNum(-1);
	}
}
```

## TraitDrink

[`public override void OnBlend(Thing t, Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/TraitDrink.cs#L102-L111)
```cs:line-numbers=102
	switch (IdEffect)
	{
	case EffectId.Love:
		BlendLove(c, t); // [!code --]
		BlendLove(c, t, owner); // [!code ++]
		break;
	case EffectId.Poison:
		BlendPoison(c, t); // [!code --]
		BlendPoison(c, t, owner); // [!code ++]
		break;
	case EffectId.Acidproof:
		c.Say("coated", t, c);
```

[`public override void OnBlend(Thing t, Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/TraitDrink.cs#L145-L163)
```cs:line-numbers=145
		owner.ModNum(-1);
	}

	public static void BlendLove(Chara c, Thing t, bool dream = false) // [!code --]
	public static void BlendLove(Chara c, Thing t, Card source, bool dream = false) // [!code ++]
	{
		Msg.Say("blend_love", t);
		Thing thing = t.Split(1);
		thing.elements.ModBase(dream ? 704 : 703, t.IsBlessed ? 15 : (t.IsCursed ? 5 : 10)); // [!code --]
		thing.elements.ModBase(dream ? 704 : 703, source.IsBlessed ? 15 : (source.IsCursed ? 5 : 10)); // [!code ++]
		c.Pick(thing);
	}

	public static void BlendPoison(Chara c, Thing t) // [!code --]
	public static void BlendPoison(Chara c, Thing t, Card source) // [!code ++]
	{
		Msg.Say("blend_poison", t);
		Thing thing = t.Split(1);
		thing.elements.ModBase(702, t.IsBlessed ? 5 : (t.IsCursed ? 15 : 10)); // [!code --]
		thing.elements.ModBase(702, source.IsBlessed ? 5 : (source.IsCursed ? 15 : 10)); // [!code ++]
		c.Pick(thing);
	}

```

## TraitFakeBlock

[`public override void OnCreate(int lv)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/TraitFakeBlock.cs#L14-L19)
```cs:line-numbers=14

	public override void OnCrafted(Recipe recipe, List<Thing> ings)
	{
		if (ings == null || ings.Count == 0) // [!code ++]
		{ // [!code ++]
			owner.refVal = 1; // [!code ++]
			return; // [!code ++]
		} // [!code ++]
		TraitBlock traitBlock = ings[0].trait as TraitBlock;
		owner.refVal = traitBlock.source.id;
	}
```

## TraitFigure

[`public override void OnSetCardGrid(ButtonGrid b)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/TraitFigure.cs#L20-L26)
```cs:line-numbers=20
	{
		SourceChara.Row row = EClass.sources.charas.map.TryGetValue(owner.c_idRefCard) ?? EClass.sources.charas.map["putty"];
		Transform transform = b.Attach<Transform>("figure", rightAttach: false);
		int idSkin = ((EClass.core.config.game.antiSpider && row.race == "spider" && row.tiles.Length > 1) ? 1 : 0); // [!code --]
		int idSkin = ((EClass.core.config.game.antiSpider && row.skinAntiSpider != 0) ? row.skinAntiSpider : 0); // [!code ++]
		row.SetImage(transform.GetChild(0).GetComponent<Image>(), null, 0, setNativeSize: false, 0, idSkin);
	}
}
```

## TraitMapBoard

[`public override void TrySetAct(ActPlan p)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/TraitMapBoard.cs#L52-L67)
```cs:line-numbers=52
		uIContextMenu3.Show();
		return false;
	}, owner);
	p.TrySetAct("actChangeSkyBlockHeight", delegate // [!code --]
	if (EClass._zone.IsSkyLevel) // [!code ++]
	{
		UIContextMenu uIContextMenu2 = EClass.ui.CreateContextMenuInteraction(); // [!code --]
		uIContextMenu2.AddSlider("adjustment", (float a) => a.ToString() ?? "", EClass._map.config.skyBlockHeight, delegate(float b) // [!code --]
		p.TrySetAct("actChangeSkyBlockHeight", delegate // [!code ++]
		{
			EClass._map.config.skyBlockHeight = (int)b; // [!code --]
		}, 1f, 20f, isInt: true, hideOther: false); // [!code --]
		uIContextMenu2.Show(); // [!code --]
		return false; // [!code --]
	}, owner); // [!code --]
			UIContextMenu uIContextMenu2 = EClass.ui.CreateContextMenuInteraction(); // [!code ++]
			uIContextMenu2.AddSlider("adjustment", (float a) => a.ToString() ?? "", EClass._map.config.skyBlockHeight, delegate(float b) // [!code ++]
			{ // [!code ++]
				EClass._map.config.skyBlockHeight = (int)b; // [!code ++]
			}, 1f, 20f, isInt: true, hideOther: false); // [!code ++]
			uIContextMenu2.Show(); // [!code ++]
			return false; // [!code ++]
		}, owner); // [!code ++]
	} // [!code ++]
	p.TrySetAct("actChangeMapBG", delegate
	{
		LayerList layerList2 = EClass.ui.AddLayer<LayerList>().SetSize(400f);
```

## TraitWaystone

[`public override void TrySetAct(ActPlan p)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/TraitWaystone.cs#L44-L50)
```cs:line-numbers=44
	}
	else
	{
		if (!EClass._zone.parent.IsRegion || (EClass._zone.IsInstance && !EClass._zone.IsUserZone) || EClass._zone is Zone_Dungeon) // [!code --]
		if (!EClass._zone.parent.IsRegion || (EClass._zone.IsInstance && !EClass._zone.IsUserZone) || EClass._zone is Zone_Dungeon || EClass._zone is Zone_StartSiteSky) // [!code ++]
		{
			return;
		}
```

## Zone

[`public void UnloadMap()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/Zone.cs#L1697-L1703)
```cs:line-numbers=1697
		Debug.Log("Unloaded Map:" + this);
	}

	public void ClaimZone(bool debug = false) // [!code --]
	public void ClaimZone(bool debug = false, Point pos = null) // [!code ++]
	{
		EClass._map.RevealAll();
		SetMainFaction(EClass.pc.faction);
```

[`public void ClaimZone(bool debug = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/Zone.cs#L1732-L1740)
```cs:line-numbers=1732
		EClass.Branch.Log("claimedZone");
		EClass.Sound.Play("jingle_embark");
		EClass.pc.PlaySound("build");
		Effect.Get("aura_heaven").Play(EClass.pc.pos); // [!code --]
		Point nearestPoint = EClass.pc.pos.GetNearestPoint(allowBlock: false, allowChara: true, allowInstalled: false); // [!code --]
		EClass._zone.AddCard(ThingGen.Create("core_zone"), nearestPoint).SetPlaceState(PlaceState.installed); // [!code --]
		if (pos == null) // [!code ++]
		{ // [!code ++]
			pos = EClass.pc.pos.GetNearestPoint(allowBlock: false, allowChara: true, allowInstalled: false); // [!code ++]
		} // [!code ++]
		Effect.Get("aura_heaven").Play(pos); // [!code ++]
		EClass._zone.AddCard(ThingGen.Create("core_zone"), pos).SetPlaceState(PlaceState.installed); // [!code ++]
	}
	base.idPrefix = 0;
	if (EClass._zone == EClass.game.StartZone)
```

## +Zone_StartSiteSky

::: details File Created
```cs
public class Zone_StartSiteSky : Zone_StartSite
{
	public override bool UseFog => false;

	public override bool IsSkyLevel => true;

	public override string IDBaseLandFeat => "bfPlain,bfFertile,bfStart";

	public override bool BlockBorderExit => true;
}
```

:::
## Zone_VernisMine

[`using UnityEngine;`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/bba01f73c7742d9657506da6640066a15abd7ad3/Elin/Zone_VernisMine.cs#L1-L10)
```cs:line-numbers=1
using UnityEngine; // [!code ++]
 // [!code ++]
public class Zone_VernisMine : Zone_QuestDungeon
{
	public const int LvBoss = -8;

	public bool IsBossLv => base.lv == -8;

	public override int DangerLv => base.DangerLv + 5; // [!code --]
	public override int DangerLv => 5 + Mathf.Abs(base.lv); // [!code ++]

	public override bool LockExit
	{
```

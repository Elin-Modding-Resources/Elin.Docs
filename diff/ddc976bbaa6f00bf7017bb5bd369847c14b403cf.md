---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 24 files modified.
version: EA 23.188 Stable Patch 2
changes: ActThrow/BiomeProfile/DramaOutcome/EloMap/ModManager/ModUtil/QuestManager/SourcePref/SurvivalManager/TaskPoint/ThingGen/TraitCoreDefense/TraitDemitas/TraitKettle/TraitMerchantPlat/TraitSpotBiome/TraitStrangeGirl/TreasureType/Zone/ZoneEventRaid/ZoneEventSiege/ZoneEventSurvival/Zone_Nymelle/Zone_StartSiteSky
---

# EA 23.188 Stable Patch 2

August 26, 2025

24 files modified.

## Important Changes

Possible breaking changes. Click the filename to view the chunk.
### [Zone (1)](#zone)
```cs:no-line-numbers
public Card AddChara(string id, int x, int z) // [!code --]
public Chara AddChara(string id, int x, int z) // [!code ++]
```
## ActThrow

[`public static EffectIRenderer Throw(Card c, Point p, Card target, Thing t, Throw`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/ActThrow.cs#L226-L232)
```cs:line-numbers=226
		TraitMonsterBall traitMonsterBall = t.trait as TraitMonsterBall;
		if (traitMonsterBall.chara != null)
		{
			if (traitMonsterBall.IsLittleBall && !(EClass._zone is Zone_LittleGarden)) // [!code --]
			if (traitMonsterBall.IsLittleBall && !(EClass._zone is Zone_LittleGarden) && !EClass.game.IsSurvival) // [!code ++]
			{
				break;
			}
```

## BiomeProfile

[`public override bool TryCreate(Point p)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/BiomeProfile.cs#L560-L566)
```cs:line-numbers=560
		}
		p.SetObj(item.idObj);
		cell.objDir = EScriptable.rnd(8);
		if (cell.sourceObj.HasGrowth && cell.sourceObj.id != 103) // [!code --]
		if (cell.sourceObj.HasGrowth && !EClass._zone.IsPCFactionOrTent && cell.sourceObj.id != 103) // [!code ++]
		{
			cell.growth.SetRandomStage();
		}
```

## DramaOutcome

[`public void QuestCraft_Drop1()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/DramaOutcome.cs#L146-L154)
```cs:line-numbers=146
	public void QuestDefense_0()
	{
		Prologue prologue = EMono.game.Prologue;
		Card card = EMono._zone.AddChara("punk", prologue.posPunk.x, prologue.posPunk.y); // [!code --]
		card.things.DestroyAll(); // [!code --]
		(EMono._zone.AddThing("gallows", prologue.posPunk.x, prologue.posPunk.y).Install().trait as TraitShackle).Restrain(card); // [!code --]
		Chara chara = EMono._zone.AddChara("punk", prologue.posPunk.x, prologue.posPunk.y); // [!code ++]
		chara.things.DestroyAll(); // [!code ++]
		(EMono._zone.AddThing("gallows", prologue.posPunk.x, prologue.posPunk.y).Install().trait as TraitShackle).Restrain(chara); // [!code ++]
		CardBlueprint.SetNormalRarity();
	}

```

[`public void QuestVernis_DropRecipe()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/DramaOutcome.cs#L160-L166)
```cs:line-numbers=160
public void QuestDefense_1()
{
	Prologue prologue = EMono.game.Prologue;
	Card tc = EMono._zone.AddChara("boar", prologue.posPunk.x + 1, prologue.posPunk.y); // [!code --]
	Chara tc = EMono._zone.AddChara("boar", prologue.posPunk.x + 1, prologue.posPunk.y); // [!code ++]
	(EMono._zone.AddThing("gallows", prologue.posPunk.x + 1, prologue.posPunk.y).Install().trait as TraitShackle).Restrain(tc);
	EMono.player.DropReward(ThingGen.Create("stone").SetNum(20));
	EMono.player.DropReward(ThingGen.Create("330").SetNum(3), silent: true).Identify(show: false);
```

## EloMap

[`public void Init(EloMapActor _actor)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/EloMap.cs#L196-L206)
```cs:line-numbers=196
		if (cell == null)
		{
			Debug.Log("cell is null:" + x + "/" + y);
			continue; // [!code --]
		}
		cell.zone = zone; // [!code --]
		if (!zone.IsInstance) // [!code --]
		else if (!zone.IsInstance) // [!code ++]
		{
			cell.zone = zone; // [!code ++]
			cell.obj = zone.icon;
		}
	}
```

## ModManager

[`public IEnumerator RefreshMods(Action onComplete, bool syncMods)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/ModManager.cs#L204-L209)
```cs:line-numbers=204
		}
	}
	ModUtil.OnModsActivated();
	ModUtil.LoadTypeFallback(); // [!code ++]
	BaseModManager.isInitialized = true;
	yield return new WaitForEndOfFrame();
	onComplete?.Invoke();
```

## ModUtil

[`public static void Test()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/ModUtil.cs#L16-L22)
```cs:line-numbers=16

	public static void OnModsActivated()
	{
		RegisterSerializedTypeFallback("TrueArena", "ArenaWaveEvent", "ZoneEvent"); // [!code --]
	} // [!code ++]
 // [!code ++]
	public static void LoadTypeFallback() // [!code ++]
	{ // [!code ++]
		string text = "type_resolver.txt"; // [!code ++]
		string[] array = new string[0]; // [!code ++]
		if (File.Exists(CorePath.RootData + text)) // [!code ++]
		{ // [!code ++]
			array = IO.LoadTextArray(CorePath.RootData + text); // [!code ++]
		} // [!code ++]
		else // [!code ++]
		{ // [!code ++]
			array = new string[2] { "TrueArena,ArenaWaveEvent,ZoneEvent", "Elin-GeneRecombinator,Elin_GeneRecombinator.IncubationSacrifice,Chara" }; // [!code ++]
			IO.SaveTextArray(CorePath.RootData + text, array); // [!code ++]
		} // [!code ++]
		string[] array2 = array; // [!code ++]
		for (int i = 0; i < array2.Length; i++) // [!code ++]
		{ // [!code ++]
			string[] array3 = array2[i].Split(','); // [!code ++]
			if (array3.Length >= 2) // [!code ++]
			{ // [!code ++]
				RegisterSerializedTypeFallback(array3[0], array3[1], array3[2]); // [!code ++]
			} // [!code ++]
		} // [!code ++]
	}

	public static void RegisterSerializedTypeFallback(string nameAssembly, string nameType, string nameFallbackType)
```

## QuestManager

[`public void OnAdvanceHour()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/QuestManager.cs#L126-L132)
```cs:line-numbers=126

	public bool IsAdded<T>() where T : Quest
	{
		if (IsStarted<T>()) // [!code --]
		if (IsStarted<T>() || GetPhase<T>() == 999) // [!code ++]
		{
			return true;
		}
```

## SourcePref

[`public static SourcePref ReadFromIni(string path)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/SourcePref.cs#L381-L387)
```cs:line-numbers=381
	sourcePref.pivotY = iniData.Global["pivotY"].ToInt();
	sourcePref.shadow = iniData.Global["shadow"].ToInt();
	sourcePref.shadowX = iniData.Global["shadowX"].ToInt();
	sourcePref.shadowY = iniData.Global["shadowY"].ToInt(); // [!code --]
	sourcePref.shadowRX = -sourcePref.shadowX; // [!code ++]
	int num2 = (sourcePref.shadowRY = iniData.Global["shadowY"].ToInt()); // [!code ++]
	sourcePref.shadowY = num2; // [!code ++]
	sourcePref.ints[3] = iniData.Global["height"].ToInt();
	sourcePref.scaleIcon = iniData.Global["scaleIcon"].ToInt();
	sourcePref.liquidMod = iniData.Global["liquidMod"].ToInt();
```

## SurvivalManager

[`public bool gotTaxChest`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/SurvivalManager.cs#L110-L115)
```cs:line-numbers=110
			}
		}

		public bool gotGaragara // [!code ++]
		{ // [!code ++]
			get // [!code ++]
			{ // [!code ++]
				return bits[2]; // [!code ++]
			} // [!code ++]
			set // [!code ++]
			{ // [!code ++]
				bits[2] = value; // [!code ++]
			} // [!code ++]
		} // [!code ++]
 // [!code ++]
		[OnSerializing]
		private void _OnSerializing(StreamingContext context)
		{
```

[`private void _OnDeserialized(StreamingContext context)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/SurvivalManager.cs#L126-L131)
```cs:line-numbers=126
	[JsonProperty]
	public Flags flags = new Flags();

	[JsonProperty] // [!code ++]
	public List<string> listReward = new List<string>(); // [!code ++]
 // [!code ++]
	public bool IsInRaid => GetRaidEvent() != null;

	public ZoneEventRaid GetRaidEvent()
```

[`public void MeteorThing(Point pos, string id, bool install = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/SurvivalManager.cs#L146-L151)
```cs:line-numbers=146
		Meteor(pos, delegate
		{
			Card card = EClass._zone.AddCard(ThingGen.Create(id), pos);
			if (card.id == "rod_wish") // [!code ++]
			{ // [!code ++]
				card.SetCharge(1); // [!code ++]
			} // [!code ++]
			if (install) // [!code ++]
			{ // [!code ++]
				card.Install(); // [!code ++]
			} // [!code ++]
		}); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void MeteorThing(Point pos, Thing t, bool install = false) // [!code ++]
	{ // [!code ++]
		Meteor(pos, delegate // [!code ++]
		{ // [!code ++]
			Card card = EClass._zone.AddCard(t, pos); // [!code ++]
			if (install)
			{
				card.Install();
```

[`public void MeteorThing(Point pos, string id, bool install = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/SurvivalManager.cs#L153-L158)
```cs:line-numbers=153
		});
	}

	public void RefreshRewards() // [!code ++]
	{ // [!code ++]
		if (listReward.Count <= 0) // [!code ++]
		{ // [!code ++]
			Add(new string[7] { "659", "758", "759", "806", "828", "1190", "1191" }); // [!code ++]
			if (flags.raidLv < 50) // [!code ++]
			{ // [!code ++]
				Add(new string[7] { "pillow_jure", "pillow_ehekatl", "pillow_opatos", "pillow_kumiromi", "pillow_lulwy", "pillow_mani", "pillow_itzpalt" }); // [!code ++]
			} // [!code ++]
			else // [!code ++]
			{ // [!code ++]
				Add(new string[1] { "rod_wish" }); // [!code ++]
			} // [!code ++]
		} // [!code ++]
		void Add(string[] ids) // [!code ++]
		{ // [!code ++]
			foreach (string item in ids) // [!code ++]
			{ // [!code ++]
				listReward.Add(item); // [!code ++]
			} // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void OnExpandFloor(Point pos)
	{
		int i = 0;
```

[`public void OnExpandFloor(Point pos)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/SurvivalManager.cs#L183-L188)
```cs:line-numbers=183
	Check(60, delegate
	{
		EClass.pc.homeBranch.AddMemeber(EClass._zone.AddCard(CharaGen.Create("loytel"), pos.x, pos.z).Chara);
		CheckLoytelDebt(); // [!code ++]
	});
	Check(80, delegate
	{
```

[`void Check(int a, Action action)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/SurvivalManager.cs#L199-L215)
```cs:line-numbers=199
		}
	}

	public void CheckLoytelDebt() // [!code ++]
	{ // [!code ++]
		if (EClass.game.cards.globalCharas.Find("loytel") != null && !EClass.game.quests.IsAdded<QuestDebt>()) // [!code ++]
		{ // [!code ++]
			Quest quest = EClass.game.quests.Add("debt", "loytel"); // [!code ++]
			EClass.game.quests.globalList.Remove(quest); // [!code ++]
			EClass.game.quests.Start(quest); // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public bool OnMineWreck(Point point)
	{
		if (EClass._zone.events.GetEvent<ZoneEventSurvival>() == null)
		{
			EClass._zone.events.Add(new ZoneEventSurvival());
		}
		CheckLoytelDebt(); // [!code ++]
		SourceObj.Row sourceObj = point.cell.sourceObj;
		int searchWreck = EClass.game.survival.flags.searchWreck;
		string[] array = new string[6] { "log", "rock", "branch", "bone", "grass", "vine" };
		int chanceChange = 25;
		int num = searchWreck / 50 + 3; // [!code --]
		int num = searchWreck / 50 + 1; // [!code ++]
		if (searchWreck == 0)
		{
			Thing t2 = ThingGen.CreateParcel(null, ThingGen.Create("log").SetNum(6), ThingGen.Create("rock").SetNum(4), ThingGen.Create("resin").SetNum(2), ThingGen.Create("money2").SetNum(10), ThingGen.Create("1267"), ThingGen.CreateRod(50311, 8));
```

[`public bool OnMineWreck(Point point)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/SurvivalManager.cs#L253-L266)
```cs:line-numbers=253
	{
		return Pop(TraitSeed.MakeRandomSeed());
	}
	if (EClass.rnd(12) == 0) // [!code --]
	if (EClass.rnd(12 + num / 5) == 0) // [!code ++]
	{
		return Pop(ThingGen.Create("money2"));
	}
	if (searchWreck > 10 && EClass.rnd(40 + num) == 0) // [!code ++]
	{ // [!code ++]
		TreasureType treasureType = ((EClass.rnd(10) == 0) ? TreasureType.BossNefia : ((EClass.rnd(10) == 0) ? TreasureType.Map : TreasureType.RandomChest)); // [!code ++]
		Thing t3 = ThingGen.Create(treasureType switch // [!code ++]
		{ // [!code ++]
			TreasureType.Map => "chest_treasure",  // [!code ++]
			TreasureType.BossNefia => "chest_boss",  // [!code ++]
			_ => "chest3",  // [!code ++]
		}); // [!code ++]
		ThingGen.CreateTreasureContent(t3, num, treasureType, clearContent: true); // [!code ++]
		MeteorThing(GetRandomPoint(), t3, install: true); // [!code ++]
	} // [!code ++]
	if (EClass.rnd(12) == 0)
	{
		Point pos = point.GetNearestPoint(allowBlock: false, allowChara: false, allowInstalled: false, ignoreCenter: true) ?? point;
		if (searchWreck < 50 || EClass.rnd(3) != 0) // [!code --]
		if (searchWreck < 100 || EClass.rnd(3) != 0) // [!code ++]
		{
			EClass._zone.SpawnMob(pos, SpawnSetting.HomeWild(num));
		}
```

[`bool Next()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/SurvivalManager.cs#L277-L285)
```cs:line-numbers=277
		Point pos2 = point.GetNearestPoint(allowBlock: false, allowChara: false, allowInstalled: false, ignoreCenter: true) ?? point;
		if (searchWreck2 == 20)
		{
			Thing container = ThingGen.CreateParcel(null, ThingGen.CreateRecipe("container_shipping"), ThingGen.CreateRecipe("stonecutter"), ThingGen.CreateRecipe("workbench2")); // [!code ++]
			Meteor(pos2, delegate
			{
				EClass._zone.AddCard(ThingGen.CreateRecipe("container_shipping"), pos2); // [!code --]
				EClass._zone.AddCard(container, pos2); // [!code ++]
			});
		}
		if (searchWreck2 > (EClass.debug.enable ? 5 : 100) && !flags.gotTaxChest)
```

[`bool Next()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/SurvivalManager.cs#L287-L292)
```cs:line-numbers=287
			MeteorThing(pos2, "chest_tax");
			flags.gotTaxChest = true;
		}
		if (searchWreck2 > (EClass.debug.enable ? 10 : 200) && !flags.gotGaragara) // [!code ++]
		{ // [!code ++]
			MeteorThing(pos2, "rolling_fortune"); // [!code ++]
			flags.gotGaragara = true; // [!code ++]
		} // [!code ++]
		NextObj();
		return true;
	}
```

[`public void OnUpdateRecruit(FactionBranch branch)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/SurvivalManager.cs#L369-L376)
```cs:line-numbers=369

	public void StartRaid()
	{
		SE.Play("warhorn"); // [!code --]
		Msg.Say("warhorn"); // [!code --]
		flags.raid = true;
		Point pos = EClass.pc.pos.GetNearestPoint(allowBlock: false, allowChara: false, allowInstalled: false, ignoreCenter: true) ?? EClass.pc.pos;
		Meteor(pos, delegate
```

## TaskPoint

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/TaskPoint.cs#L117-L122)
```cs:line-numbers=117
		{
			AM_Adv.actCount++;
		}
		if (child != null && child.status == Status.Fail) // [!code ++]
		{ // [!code ++]
			yield return Cancel(); // [!code ++]
		} // [!code ++]
	}
	while (Loop);
}
```

## ThingGen

[`public static void CreateTreasureContent(Thing t, int lv, TreasureType type, boo`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/ThingGen.cs#L277-L282)
```cs:line-numbers=277
		}
		t.c_lockLv /= 2;
		break;
	case TreasureType.SurvivalRaid: // [!code ++]
		t.Add("plat", EClass.rndHalf(Mathf.Min(3 + num / 10, 15))); // [!code ++]
		t.Add("money2", EClass.rndHalf(Mathf.Min(3 + num / 10, 10))); // [!code ++]
		t.Add("medal", EClass.rndHalf(8)); // [!code ++]
		t.Add("book_skill", 1, lv); // [!code ++]
		t.Add("book_skill", 1, lv); // [!code ++]
		t.c_lockLv /= 3; // [!code ++]
		break; // [!code ++]
	case TreasureType.RandomChest:
		flag2 = false;
		miracleChance /= 2;
```

## TraitCoreDefense

[`public override void TrySetAct(ActPlan p)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/TraitCoreDefense.cs#L16-L21)
```cs:line-numbers=16
		{
			p.TrySetAct("actWarhorn", delegate
			{
				SE.Play("warhorn"); // [!code ++]
				Msg.Say("warhorn"); // [!code ++]
				EClass.game.survival.StartRaid();
				return true;
			});
```

[`public override void TrySetAct(ActPlan p)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/TraitCoreDefense.cs#L24-L29)
```cs:line-numbers=24
		{
			p.TrySetAct("actWarhornRaid", delegate
			{
				SE.Play("warhorn"); // [!code ++]
				Msg.Say("warhorn"); // [!code ++]
				EClass._zone.events.Add(new ZoneEventRaid());
				return true;
			});
```

## TraitDemitas

[`public bool CanSpellwrite`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/TraitDemitas.cs#L8-L16)
```cs:line-numbers=8
{
	get
	{
		if (!EClass.debug.enable) // [!code --]
		if (!EClass.debug.enable && !EClass.game.quests.IsCompleted("demitas_spellwriter")) // [!code ++]
		{
			return EClass.game.quests.IsCompleted("demitas_spellwriter"); // [!code --]
			return EClass.game.IsSurvival; // [!code ++]
		}
		return true;
	}
```

## TraitKettle

[`public override bool CanJoinParty`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/TraitKettle.cs#L34-L40)
```cs:line-numbers=34
{
	get
	{
		if (!EClass.game.quests.IsCompleted("vernis_gold")) // [!code --]
		if (!EClass.game.quests.IsCompleted("vernis_gold") && !EClass.game.IsSurvival) // [!code ++]
		{
			return EClass.debug.enable;
		}
```

## TraitMerchantPlat

[`public override ShopType ShopType`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/TraitMerchantPlat.cs#L4-L10)
```cs:line-numbers=4
{
	get
	{
		if (!base.owner.IsPCFaction) // [!code --]
		if (!base.owner.IsPCFaction || EClass.game.IsSurvival) // [!code ++]
		{
			return ShopType.Plat;
		}
```

## TraitSpotBiome

[`using System.Collections.Generic;`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/TraitSpotBiome.cs#L1-L3)
```cs:line-numbers=1
using System.Collections.Generic; // [!code ++]
 // [!code ++]
public class TraitSpotBiome : TraitSpot
{
	public override int radius => 6;
```

[`public class TraitSpotBiome : TraitSpot`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/TraitSpotBiome.cs#L6-L25)
```cs:line-numbers=6

	public override void Update()
	{
		if (EClass.rnd(5) != 0) // [!code --]
		if (EClass.rnd(10) != 0 || !EClass._zone.IsPCFactionOrTent || !owner.IsInstalled) // [!code ++]
		{
			return;
		}
		Point randomPoint = GetRandomPoint();
		if (!randomPoint.IsSky && !randomPoint.HasObj && !randomPoint.HasBlock && !randomPoint.HasThing && randomPoint.cell.room == null) // [!code --]
		if (randomPoint.IsSky || randomPoint.HasObj || randomPoint.HasBlock || randomPoint.HasThing || randomPoint.cell.room != null) // [!code ++]
		{
			if (EClass.rnd(5) == 0) // [!code --]
			return; // [!code ++]
		} // [!code ++]
		if (EClass.game.IsSurvival) // [!code ++]
		{ // [!code ++]
			int num = 0; // [!code ++]
			foreach (Thing thing2 in EClass._map.props.installed.things) // [!code ++]
			{
				EClass._zone.SpawnMob(randomPoint); // [!code --]
				if (thing2.trait is TraitSpotBiome) // [!code ++]
				{ // [!code ++]
					num++; // [!code ++]
				} // [!code ++]
			} // [!code ++]
			int num2 = CountNotableThing(); // [!code ++]
			if (EClass.rnd(num * 10) == 0) // [!code ++]
			{ // [!code ++]
				if (num2 < 2) // [!code ++]
				{ // [!code ++]
					string text = ((EClass.rnd(10) == 0) ? "statue_god" : ((EClass.rnd(2) == 0) ? "statue_power" : "altar")); // [!code ++]
					if (text == "altar" && EClass.rnd(20) == 0) // [!code ++]
					{ // [!code ++]
						text = ((EClass.rnd(5) == 0) ? "altar_machine" : ((EClass.rnd(3) == 0) ? "altar_fox" : ((EClass.rnd(2) == 0) ? "altar_fox2" : "altar_strife"))); // [!code ++]
					} // [!code ++]
					Thing thing = ThingGen.Create(text); // [!code ++]
					thing.SetPriceFix(-100); // [!code ++]
					EClass._zone.AddCard(thing, randomPoint).Install(); // [!code ++]
				} // [!code ++]
				if (EClass.rnd(40) == 0 && EClass._map.FindChara("big_daddy") == null) // [!code ++]
				{ // [!code ++]
					CardBlueprint.Set(new CardBlueprint // [!code ++]
					{ // [!code ++]
						lv = EClass.game.survival.flags.raidLv + 10 // [!code ++]
					}); // [!code ++]
					Chara t = CharaGen.Create("big_daddy"); // [!code ++]
					EClass._zone.AddCard(t, randomPoint); // [!code ++]
					Msg.Say("sign_bigdaddy"); // [!code ++]
				} // [!code ++]
				return; // [!code ++]
			} // [!code ++]
		} // [!code ++]
		if (EClass.rnd(5) == 0) // [!code ++]
		{ // [!code ++]
			if (EClass.game.IsSurvival && EClass.game.survival.flags.raidLv < 20) // [!code ++]
			{ // [!code ++]
				EClass._zone.SpawnMob(randomPoint, SpawnSetting.HomeWild(1)); // [!code ++]
			}
			else
			{
				randomPoint.cell.biome.Populate(randomPoint, interior: false, 100f); // [!code --]
				EClass._zone.SpawnMob(randomPoint); // [!code ++]
			} // [!code ++]
		} // [!code ++]
		else // [!code ++]
		{ // [!code ++]
			randomPoint.cell.biome.Populate(randomPoint, interior: false, 100f); // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public int CountNotableThing(bool tryRemove = true) // [!code ++]
	{ // [!code ++]
		int num = 0; // [!code ++]
		List<Thing> listRemove = new List<Thing>(); // [!code ++]
		foreach (Point item in ListPoints(null, onlyPassable: false)) // [!code ++]
		{ // [!code ++]
			if (!item.HasThing) // [!code ++]
			{ // [!code ++]
				continue; // [!code ++]
			} // [!code ++]
			foreach (Thing thing in item.Things) // [!code ++]
			{ // [!code ++]
				if (!thing.IsInstalled) // [!code ++]
				{ // [!code ++]
					continue; // [!code ++]
				} // [!code ++]
				if (thing.trait is TraitAltar) // [!code ++]
				{ // [!code ++]
					num++; // [!code ++]
					if (tryRemove && thing.c_priceFix == -100) // [!code ++]
					{ // [!code ++]
						TryRemove(thing, 4); // [!code ++]
					} // [!code ++]
				} // [!code ++]
				else if (thing.trait is TraitPowerStatue) // [!code ++]
				{ // [!code ++]
					num++; // [!code ++]
					if (tryRemove && !thing.isOn && thing.c_priceFix == -100) // [!code ++]
					{ // [!code ++]
						TryRemove(thing, 2); // [!code ++]
					} // [!code ++]
				} // [!code ++]
			} // [!code ++]
		} // [!code ++]
		if (tryRemove) // [!code ++]
		{ // [!code ++]
			foreach (Thing item2 in listRemove) // [!code ++]
			{ // [!code ++]
				item2.Destroy(); // [!code ++]
			} // [!code ++]
		} // [!code ++]
		return num; // [!code ++]
		void TryRemove(Thing t, int h) // [!code ++]
		{ // [!code ++]
			if (t.c_dateStockExpire == 0) // [!code ++]
			{ // [!code ++]
				t.c_dateStockExpire = EClass.world.date.GetRaw(h); // [!code ++]
			} // [!code ++]
			else if (EClass.world.date.IsExpired(t.c_dateStockExpire)) // [!code ++]
			{ // [!code ++]
				listRemove.Add(t); // [!code ++]
			}
		}
	}
```

## TraitStrangeGirl

[`public override ShopType ShopType`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/TraitStrangeGirl.cs#L4-L10)
```cs:line-numbers=4
{
	get
	{
		if (!(EClass._zone is Zone_LittleGarden)) // [!code --]
		if (!(EClass._zone is Zone_LittleGarden) && !EClass.game.IsSurvival) // [!code ++]
		{
			return ShopType.None;
		}
```

## TreasureType

[`public enum TreasureType`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/TreasureType.cs#L4-L8)
```cs:line-numbers=4
	BossNefia,
	BossQuest,
	Map,
	RandomChest // [!code --]
	RandomChest, // [!code ++]
	SurvivalRaid // [!code ++]
}
```

## Zone

[`public Card AddCardSplinkle(Card t, Point center, int radius = 4)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/Zone.cs#L1919-L1927)
```cs:line-numbers=1919
		return AddCard(t, center);
	}

	public Card AddChara(string id, int x, int z) // [!code --]
	public Chara AddChara(string id, int x, int z) // [!code ++]
	{
		return AddCard(CharaGen.Create(id), x, z); // [!code --]
		return AddCard(CharaGen.Create(id), x, z) as Chara; // [!code ++]
	}

	public Card AddThing(string id, int x, int z)
```

## ZoneEventRaid

[`public override void OnKill()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/ZoneEventRaid.cs#L30-L37)
```cs:line-numbers=30
		EClass.game.survival.flags.raidRound++;
		EClass.game.survival.flags.raidLv += 5;
		EClass.game.survival.flags.dateNextRaid = EClass.world.date.GetRaw(168);
		EClass.game.survival.RefreshRewards(); // [!code ++]
		Point pos = EClass.game.survival.GetRandomPoint() ?? EClass.pc.pos;
		string text = ((EClass.game.survival.flags.raidLv >= 50 && EClass.rnd(3) == 0) ? "statue_god" : ((EClass.game.survival.flags.raidLv >= 25 && EClass.rnd(2) == 0) ? "statue_power" : "altar")); // [!code --]
		EClass.game.survival.MeteorThing(pos, text, install: true); // [!code --]
		string item = EClass.game.survival.listReward.RandomItem(); // [!code ++]
		EClass.game.survival.listReward.Remove(item); // [!code ++]
		EClass.game.survival.MeteorThing(pos, item, install: true); // [!code ++]
	}
}
```

## ZoneEventSiege

[`public override void OnKill()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/ZoneEventSiege.cs#L111-L116)
```cs:line-numbers=111
		Msg.Say("endSiege");
		SE.Play("kill_boss");
		EClass._zone.RefreshBGM();
		EClass._zone.AddCard(ThingGen.CreateTreasure("chest_boss", lv, TreasureType.BossNefia), GetSpawnPos().GetNearestPoint(allowBlock: false, allowChara: false, allowInstalled: false, ignoreCenter: true) ?? EClass.pc.pos).Install(); // [!code --]
		EClass._zone.AddCard(ThingGen.CreateTreasure("chest_boss", lv, TreasureType.SurvivalRaid), GetSpawnPos().GetNearestPoint(allowBlock: false, allowChara: false, allowInstalled: false, ignoreCenter: true) ?? EClass.pc.pos).Install(); // [!code ++]
	}
}
```

## ZoneEventSurvival

[`public override void OnTickRound()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/ZoneEventSurvival.cs#L11-L20)
```cs:line-numbers=11
	{
		EClass._map.SetObj(cell.x, cell.z, 46);
	}
	if (EClass.player.stats.days >= 10 && !EClass.game.survival.flags.raid) // [!code --]
	{ // [!code --]
		EClass.game.survival.StartRaid(); // [!code --]
	} // [!code --]
	if (EClass.game.survival.flags.raid)
	{
		TraitVoidgate traitVoidgate = EClass._map.FindThing<TraitVoidgate>();
```

## Zone_Nymelle

[`public override void OnBeforeSimulate()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/Zone_Nymelle.cs#L97-L103)
```cs:line-numbers=97
	}
	if (IsBossLv)
	{
		EClass._zone.AddChara("isygarad", 40, 37); // [!code --]
		EClass._zone.AddChara("isygarad", 40, 37).ScaleByPrincipal(); // [!code ++]
		SoundManager.ForceBGM();
		LayerDrama.ActivateMain("mono", "nymelle_boss");
	}
```

## Zone_StartSiteSky

[`public class Zone_StartSiteSky : Zone_StartSite`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/ddc976bbaa6f00bf7017bb5bd369847c14b403cf/Elin/Zone_StartSiteSky.cs#L9-L12)
```cs:line-numbers=9
	public override bool BlockBorderExit => true;

	public override string IdBiome => "Plain";
 // [!code ++]
	public override bool ScaleMonsterLevel // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			if (EClass.game.IsSurvival) // [!code ++]
			{ // [!code ++]
				return EClass.game.survival.flags.raidLv >= 100; // [!code ++]
			} // [!code ++]
			return false; // [!code ++]
		} // [!code ++]
	} // [!code ++]
}
```

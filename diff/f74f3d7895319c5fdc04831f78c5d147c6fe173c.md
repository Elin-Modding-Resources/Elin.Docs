---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 27 files modified.
version: EA 23.67 Hotfix 2
changes: Card/Chara/CharaAbility/ContentPolicy/CoreDebug/DropdownGrid/ELEMENT/FACTION/FEAT/FactionBranch/FortuneRollData/GrowSystem/GrowSystemWeed/LayerCraft/POLICY/Recipe/RecipeCard/RecipeManager/SKILL/Trait/TraitAdventurer/TraitBigDaddy/TraitChara/TraitUniqueMonsterAdv/UIMagicChest/Widget/ZoneEventDefenseGame
---

# EA 23.67 Hotfix 2

December 25, 2024

27 files modified.

## Important Changes

**None.**
## Card

[`@@ -2006,7 +2006,7 @@ public bool ShowFoodEnc`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/Card.cs#L2006-L2012)
```cs:line-numbers=2006
{
	get
	{
		if (!IsFood && !category.IsChildOf("seed") && !(id == "pasture")) // [!code --]
		if (!IsFood && Evalue(10) <= 0 && !category.IsChildOf("seed") && !(id == "pasture") && !(id == "grass")) // [!code ++]
		{
			return category.IsChildOf("drug");
		}
```

[`@@ -4465,15 +4465,19 @@ public void SpawnLoot(Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/Card.cs#L4465-L4479)
```cs:line-numbers=4465
		}
		if (!isBackerContent && !flag)
		{
			int num2 = ((this.rarity >= Rarity.Legendary) ? 1 : 0); // [!code --]
			if (EClass.rnd(20) == 0) // [!code --]
			int num2 = ((EClass._zone.Boss == this) ? 2 : ((this.rarity >= Rarity.Legendary) ? 1 : 0)); // [!code ++]
			if (EClass._zone is Zone_Void) // [!code ++]
			{ // [!code ++]
				num2++; // [!code ++]
			} // [!code ++]
			if (EClass.rnd(5) == 0) // [!code ++]
			{
				num2++;
			}
			string text2 = id;
			if (text2 == "big_daddy" || text2 == "santa")
			{
				num2++; // [!code --]
				num2 += 2; // [!code ++]
			}
			List<Thing> list2 = new List<Thing>();
			foreach (Thing thing4 in things)
```

[`@@ -4492,7 +4496,7 @@ public void SpawnLoot(Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/Card.cs#L4492-L4498)
```cs:line-numbers=4492
					{
						list2.Add(thing4);
					}
					else if (EClass.rnd(150) == 0) // [!code --]
					else if (EClass.rnd(100) == 0) // [!code ++]
					{
						list.Add(thing4);
					}
```

[`@@ -4508,6 +4512,7 @@ public void SpawnLoot(Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/Card.cs#L4508-L4513)
```cs:line-numbers=4508
				for (int j = 0; j < list2.Count && j < num2; j++)
				{
					list.Add(list2[j]);
					num2--; // [!code ++]
				}
			}
			if (this.rarity >= Rarity.Legendary && !IsUnique && c_bossType != BossType.Evolved)
```

[`@@ -4522,22 +4527,30 @@ public void SpawnLoot(Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/Card.cs#L4522-L4543)
```cs:line-numbers=4522
				}
				if (num3 == 0)
				{
					Rand.SetSeed(uid); // [!code --]
					if (EClass.rnd((EClass._zone.events.GetEvent<ZoneEventDefenseGame>() != null) ? 3 : 2) == 0) // [!code --]
					int num4 = ((!(EClass._zone is Zone_Void)) ? 1 : 2); // [!code ++]
					if (num2 < num4) // [!code ++]
					{
						Rarity rarity = ((EClass.rnd(20) == 0) ? Rarity.Mythical : Rarity.Legendary); // [!code --]
						CardBlueprint.Set(new CardBlueprint // [!code --]
						{ // [!code --]
							rarity = rarity // [!code --]
						}); // [!code --]
						Thing item = ThingGen.CreateFromFilter("eq", LV); // [!code --]
						list.Add(item); // [!code --]
						num2 = num4; // [!code ++]
					}
					else if (EClass.rnd(3) == 0) // [!code --]
					for (int k = 0; k < num2; k++) // [!code ++]
					{
						list.Add(ThingGen.Create("medal")); // [!code --]
						Rand.SetSeed(uid + k); // [!code ++]
						if (EClass.rnd((EClass._zone.events.GetEvent<ZoneEventDefenseGame>() != null) ? 3 : 2) == 0) // [!code ++]
						{ // [!code ++]
							Rarity rarity = ((EClass.rnd(20) == 0) ? Rarity.Mythical : Rarity.Legendary); // [!code ++]
							CardBlueprint.Set(new CardBlueprint // [!code ++]
							{ // [!code ++]
								rarity = rarity // [!code ++]
							}); // [!code ++]
							Thing item = ThingGen.CreateFromFilter("eq", LV); // [!code ++]
							list.Add(item); // [!code ++]
						} // [!code ++]
						else if (EClass.rnd(3) == 0) // [!code ++]
						{ // [!code ++]
							list.Add(ThingGen.Create("medal")); // [!code ++]
						} // [!code ++]
						Rand.SetSeed(); // [!code ++]
					}
					Rand.SetSeed(); // [!code --]
				}
			}
		}
```

## Chara

[`@@ -2746,11 +2746,6 @@ public void DestroyPath(Point pos)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/Chara.cs#L2746-L2756)
```cs:line-numbers=2746
				}
				broke = true;
			}
			if (_p.HasBridge) // [!code --]
			{ // [!code --]
				EClass._map.MineFloor(_p); // [!code --]
				broke = true; // [!code --]
			} // [!code --]
			if (_p.HasObj && _p.IsBlocked)
			{
				EClass._map.MineObj(_p, null, this);
```

## CharaAbility

[`@@ -29,9 +29,9 @@ public void Refresh()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/CharaAbility.cs#L29-L37)
```cs:line-numbers=29
			pt = (array.Length > 2)
		});
	}
	if (owner.trait.UseRandomAbility && owner._listAbility == null) // [!code --]
	if (owner.trait.MaxRandomAbility > 0 && owner._listAbility == null) // [!code ++]
	{
		int num = 3 + EClass.rnd(2) - list.items.Count; // [!code --]
		int num = owner.trait.MaxRandomAbility + EClass.rnd(2) - list.items.Count; // [!code ++]
		if (num > 1)
		{
			if (randomAbilities.Count == 0)
```

## ContentPolicy

[`@@ -74,6 +74,10 @@ public void RefreshPolicyList(UIList list, string cat, string plan)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/ContentPolicy.cs#L74-L79)
```cs:line-numbers=74
				{
					EClass.pc.faction.SetGlobalPolicyActive(2711, a.active);
				}
				if (a.id == 2712) // [!code ++]
				{ // [!code ++]
					EClass.pc.faction.SetGlobalPolicyActive(2712, a.active); // [!code ++]
				} // [!code ++]
				EClass.Branch.policies.RefreshEffects();
				RefreshPolicyIcons();
			});
```

## CoreDebug

[`@@ -905,8 +905,16 @@ public void UpdateInput()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/CoreDebug.cs#L905-L912)
```cs:line-numbers=905
	}
	if (Input.GetKeyDown(KeyCode.F2))
	{
		EClass._zone.SpawnMob(EClass.pc.pos.GetNearestPoint(), SpawnSetting.Boss(EClass._zone.DangerLv)); // [!code --]
		EClass.player.recipes.OnSleep(); // [!code --]
		EClass.pc.Pick(EClass.pc.MakeMilk(effect: true, 10)); // [!code ++]
		EClass.pc.Pick(EClass.pc.MakeEgg(effect: true, 10)); // [!code ++]
		Chara targetChara = EClass.scene.mouseTarget.TargetChara; // [!code ++]
		if (targetChara != null) // [!code ++]
		{ // [!code ++]
			EClass.pc.Pick(targetChara.MakeMilk()); // [!code ++]
			EClass.pc.Pick(targetChara.MakeGene()); // [!code ++]
			EClass.pc.Pick(targetChara.MakeBraineCell()); // [!code ++]
			EClass.pc.Pick(targetChara.MakeEgg(effect: true, 10)); // [!code ++]
		} // [!code ++]
		return;
	}
	if (Input.GetKeyDown(KeyCode.F3))
```

## DropdownGrid

[`@@ -106,74 +106,93 @@ public void BuildIngredients(Recipe _recipe, Image _icon, Action _onValueChange,`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/DropdownGrid.cs#L106-L179)
```cs:line-numbers=106
			}
			else
			{
				List<Thing> things = ListIngredients(ingredient, searchMode); // [!code --]
				if (things.Count == 0) // [!code --]
				bool flag = false; // [!code ++]
				List<int> list = EMono.player.recipes.lastIngredients.TryGetValue(recipe.id); // [!code ++]
				int num = recipe.ingredients.IndexOf(ingredient); // [!code ++]
				if (num != -1 && list != null && list.Count > num) // [!code ++]
				{
					if (EMono.debug.godBuild && ingredient.thing == null) // [!code --]
					int uid = list[num]; // [!code ++]
					if (uid != 0) // [!code ++]
					{
						Thing thing = ThingGen.Create(ingredient.IdThing, recipe.DefaultMaterial.alias).SetNum(99); // [!code --]
						things.Add(thing); // [!code --]
						ingredient.SetThing(thing); // [!code --]
					} // [!code --]
					else // [!code --]
					{ // [!code --]
						ingredient.SetThing(); // [!code --]
						things.Insert(0, null); // [!code --]
						Thing thing = EMono.pc.things.Find((Thing t) => t.uid == uid) ?? EMono._map.Stocked.Find(uid); // [!code ++]
						if (thing != null) // [!code ++]
						{ // [!code ++]
							ingredient.SetThing(thing); // [!code ++]
							flag = true; // [!code ++]
						} // [!code ++]
					}
				}
				else if (!ingredient.optional) // [!code --]
				if (!flag) // [!code ++]
				{
					if (ingredient.thing == null) // [!code --]
					List<Thing> list2 = ListIngredients(ingredient, searchMode); // [!code ++]
					if (list2.Count == 0) // [!code ++]
					{
						int num = lastMats.TryGetValue(recipe.id, -1); // [!code --]
						if (num != -1) // [!code --]
						if (EMono.debug.godBuild && ingredient.thing == null) // [!code ++]
						{
							foreach (Thing item in things) // [!code --]
							Thing thing2 = ThingGen.Create(ingredient.IdThing, recipe.DefaultMaterial.alias).SetNum(99); // [!code ++]
							list2.Add(thing2); // [!code ++]
							ingredient.SetThing(thing2); // [!code ++]
						} // [!code ++]
						else // [!code ++]
						{ // [!code ++]
							ingredient.SetThing(); // [!code ++]
							list2.Insert(0, null); // [!code ++]
						} // [!code ++]
					} // [!code ++]
					else if (!ingredient.optional) // [!code ++]
					{ // [!code ++]
						if (ingredient.thing == null) // [!code ++]
						{ // [!code ++]
							int num2 = lastMats.TryGetValue(recipe.id, -1); // [!code ++]
							if (num2 != -1) // [!code ++]
							{
								if (item.material.id == num && item.Num >= ingredient.req) // [!code --]
								foreach (Thing item in list2) // [!code ++]
								{
									ingredient.SetThing(item); // [!code --]
									break; // [!code --]
									if (item.material.id == num2 && item.Num >= ingredient.req) // [!code ++]
									{ // [!code ++]
										ingredient.SetThing(item); // [!code ++]
										break; // [!code ++]
									} // [!code ++]
								}
							}
						} // [!code --]
						if (ingredient.thing == null) // [!code --]
						{ // [!code --]
							SourceMaterial.Row defaultMaterial = recipe.DefaultMaterial; // [!code --]
							foreach (Thing item2 in things) // [!code --]
							if (ingredient.thing == null) // [!code ++]
							{
								if (item2.material.id == defaultMaterial.id && item2.Num >= ingredient.req) // [!code --]
								SourceMaterial.Row defaultMaterial = recipe.DefaultMaterial; // [!code ++]
								foreach (Thing item2 in list2) // [!code ++]
								{
									ingredient.SetThing(item2); // [!code --]
									break; // [!code --]
									if (item2.material.id == defaultMaterial.id && item2.Num >= ingredient.req) // [!code ++]
									{ // [!code ++]
										ingredient.SetThing(item2); // [!code ++]
										break; // [!code ++]
									} // [!code ++]
								} // [!code ++]
								if (EMono.debug.godBuild && ingredient.thing == null) // [!code ++]
								{ // [!code ++]
									Thing thing3 = (ingredient.useCat ? ThingGen.CreateFromCategory(ingredient.id) : ThingGen.Create(ingredient.id, defaultMaterial.alias)).SetNum(99); // [!code ++]
									list2.Add(thing3); // [!code ++]
									ingredient.SetThing(thing3); // [!code ++]
								}
							}
							if (EMono.debug.godBuild && ingredient.thing == null) // [!code --]
							if (ingredient.thing == null) // [!code ++]
							{
								Thing thing2 = (ingredient.useCat ? ThingGen.CreateFromCategory(ingredient.id) : ThingGen.Create(ingredient.id, defaultMaterial.alias)).SetNum(99); // [!code --]
								things.Add(thing2); // [!code --]
								ingredient.SetThing(thing2); // [!code --]
								ingredient.SetThing(list2[0]); // [!code ++]
							}
						}
						if (ingredient.thing == null) // [!code --]
						{ // [!code --]
							ingredient.SetThing(things[0]); // [!code --]
						} // [!code --]
					} // [!code --]
					else // [!code --]
					{ // [!code --]
						bool flag = true; // [!code --]
						foreach (Thing item3 in things) // [!code --]
						else // [!code ++]
						{
							if (ingredient.thing == item3) // [!code --]
							bool flag2 = true; // [!code ++]
							foreach (Thing item3 in list2) // [!code ++]
							{
								flag = false; // [!code --]
								break; // [!code --]
								if (ingredient.thing == item3) // [!code ++]
								{ // [!code ++]
									flag2 = false; // [!code ++]
									break; // [!code ++]
								} // [!code ++]
							} // [!code ++]
							if (flag2) // [!code ++]
							{ // [!code ++]
								ingredient.SetThing(list2[0]); // [!code ++]
							}
						} // [!code --]
						if (flag) // [!code --]
						{ // [!code --]
							ingredient.SetThing(things[0]); // [!code --]
						}
					}
				}
```

[`@@ -181,10 +200,10 @@ public void BuildIngredients(Recipe _recipe, Image _icon, Action _onValueChange,`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/DropdownGrid.cs#L181-L190)
```cs:line-numbers=181
				b.onClick.RemoveAllListeners();
				b.onClick.AddListener(delegate
				{
					things = ListIngredients(ingredient, searchMode); // [!code --]
					List<Thing> list3 = ListIngredients(ingredient, searchMode); // [!code ++]
					if (ingredient.optional)
					{
						if (things.Count == 0 || things[0] == null) // [!code --]
						if (list3.Count == 0 || list3[0] == null) // [!code ++]
						{
							SE.Beep();
							return;
```

[`@@ -197,7 +216,7 @@ public void BuildIngredients(Recipe _recipe, Image _icon, Action _onValueChange,`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/DropdownGrid.cs#L197-L203)
```cs:line-numbers=197
					}
					if ((bool)rectDrop)
					{
						Activate(ingredient, things); // [!code --]
						Activate(ingredient, list3); // [!code ++]
					}
				});
			}
```

[`@@ -241,6 +260,7 @@ public void Activate(Recipe.Ingredient ingredient, List<Thing> things)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/DropdownGrid.cs#L241-L246)
```cs:line-numbers=241
		{
			SE.Resource();
			ingredient.SetThing(a);
			recipe.SaveLastIngredients(); // [!code ++]
			OnChangeIngredient();
			if (onValueChange != null)
			{
```

## ELEMENT

[`@@ -560,7 +560,7 @@ public void WriteNoteWithRef(UINote n, ElementContainer owner, Action<UINote> on`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/ELEMENT.cs#L560-L566)
```cs:line-numbers=560
	}
	if (!IsPurchaseFeatReqMet(owner))
	{
		WritePurchaseReq(n); // [!code --]
		WritePurchaseReq(n, owner.Value(id)); // [!code ++]
	}
	n.Build();
}
```

## FACTION

[`@@ -294,6 +294,25 @@ public bool HasMember(string id, bool includeReserve = true)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/FACTION.cs#L294-L299)
```cs:line-numbers=294
		return false;
	}

	public bool IsWearingPanty(Chara c) // [!code ++]
	{ // [!code ++]
		if ((!c.IsUnique || c.bio.gender != 2) && (c.race.IsHuman || c.race.IsFairy) && !(c.trait is TraitMerchant)) // [!code ++]
		{ // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
		if (IsGlobalPolicyActive(2712)) // [!code ++]
		{ // [!code ++]
			foreach (Chara value in EClass.game.cards.globalCharas.Values) // [!code ++]
			{ // [!code ++]
				if (value.id == c.id && value.IsHomeMember()) // [!code ++]
				{ // [!code ++]
					return true; // [!code ++]
				} // [!code ++]
			} // [!code ++]
		} // [!code ++]
		return false; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void AddContribution(int a)
	{
		if (a != 0 && relation.type == FactionRelation.RelationType.Member)
```

## FEAT

[`@@ -301,7 +301,7 @@ public override bool IsPurchaseFeatReqMet(ElementContainer owner, int lv = -1)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/FEAT.cs#L301-L307)
```cs:line-numbers=301
	if (base.source.req.Length != 0)
	{
		Element element = owner.GetElement(base.source.req[0]);
		if (element == null || element.ValueWithoutLink < ((base.source.req.Length == 1) ? 1 : base.source.req[Mathf.Clamp((lv == -1) ? (owner.Value(id) + 1) : lv, 1, base.source.req.Length - 1)].ToInt())) // [!code --]
		if (element == null || element.ValueWithoutLink < ((base.source.req.Length == 1) ? 1 : base.source.req[Mathf.Clamp(((lv == -1 && owner != null) ? owner.Value(id) : lv) + 1, 1, base.source.req.Length - 1)].ToInt())) // [!code ++]
		{
			return false;
		}
```

[`@@ -311,11 +311,9 @@ public override bool IsPurchaseFeatReqMet(ElementContainer owner, int lv = -1)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/FEAT.cs#L311-L321)
```cs:line-numbers=311

	public override void WritePurchaseReq(UINote n, int lv = -1)
	{
		Debug.Log("a"); // [!code --]
		if (base.source.req.Length != 0)
		{
			Element element = Element.Create(base.source.req[0], (base.source.req.Length == 1) ? 1 : base.source.req[Mathf.Clamp((lv == -1) ? (owner.Value(id) + 1) : lv, 1, base.source.req.Length - 1)].ToInt()); // [!code --]
			Debug.Log(element); // [!code --]
			Element element = Element.Create(base.source.req[0], (base.source.req.Length == 1) ? 1 : base.source.req[Mathf.Clamp(((lv == -1 && owner != null) ? owner.Value(id) : lv) + 1, 1, base.source.req.Length - 1)].ToInt()); // [!code ++]
			if (element != null)
			{
				n.AddHeader("featReq");
```

## FactionBranch

[`@@ -680,10 +680,15 @@ public void ReceivePackages(VirtualDate date)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/FactionBranch.cs#L680-L689)
```cs:line-numbers=680
public void DailyOutcome(VirtualDate date)
{
	Thing thing = null;
	Chara i; // [!code --]
	foreach (Chara member in members)
	{
		i = member; // [!code --]
		Chara i = member; // [!code ++]
		if (EClass.rnd(EClass.debug.enable ? 2 : (360 * members.Count)) == 0 && !i.IsPC && EClass.pc.faction.IsGlobalPolicyActive(2712) && i.things.Find((Thing t) => t.id == "panty" && t.c_idRefCard == i.id) == null && !i.things.IsFull()) // [!code ++]
		{ // [!code ++]
			Thing thing2 = ThingGen.Create("panty"); // [!code ++]
			thing2.c_idRefCard = i.id; // [!code ++]
			i.AddThing(thing2); // [!code ++]
		} // [!code ++]
		if (i.IsPCParty || !i.ExistsOnMap)
		{
			continue;
```

[`@@ -737,169 +742,169 @@ public void DailyOutcome(VirtualDate date)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/FactionBranch.cs#L737-L905)
```cs:line-numbers=737
		{
			GetOutcome(item2);
		}
	} // [!code --]
	int soilCost = EClass._zone.GetSoilCost(); // [!code --]
	int num = Mathf.Min(100, 70 + (MaxSoil - soilCost)); // [!code --]
	int flower = 5; // [!code --]
	int lv = 1; // [!code --]
	EClass._map.bounds.ForeachCell(delegate(Cell cell) // [!code --]
	{ // [!code --]
		if (cell.obj != 0 && cell.sourceObj.tag.Contains("flower")) // [!code --]
		{ // [!code --]
			PlantData plantData = cell.TryGetPlant(); // [!code --]
			if (plantData != null && plantData.seed != null) // [!code --]
			{ // [!code --]
				lv += plantData.seed.encLV + 1; // [!code --]
			} // [!code --]
			else // [!code --]
			{ // [!code --]
				lv++; // [!code --]
			} // [!code --]
			flower++; // [!code --]
		} // [!code --]
	}); // [!code --]
	lv /= flower; // [!code --]
	int num2 = 0; // [!code --]
	foreach (Thing thing6 in EClass._map.things) // [!code --]
	{ // [!code --]
		if (thing6.IsInstalled && thing6.trait is TraitBeekeep && !thing6.things.IsFull()) // [!code --]
		{ // [!code --]
			flower -= 3 + EClass.rnd(5 + num2 * 4); // [!code --]
			num2++; // [!code --]
			if (flower < 0) // [!code --]
			{ // [!code --]
				break; // [!code --]
			} // [!code --]
			if (EClass.rnd(100) <= num) // [!code --]
			{ // [!code --]
				Thing thing2 = ThingGen.Create("honey"); // [!code --]
				thing2.SetEncLv(lv / 10); // [!code --]
				thing2.elements.SetBase(2, EClass.curve(lv, 50, 10, 80)); // [!code --]
				thing6.AddThing(thing2); // [!code --]
			} // [!code --]
		} // [!code --]
	} // [!code --]
	void GetOutcome(Hobby h) // [!code --]
	{ // [!code --]
		int num3 = h.GetEfficiency(i) * GetProductBonus(i) / 100; // [!code --]
		int num4 = h.GetLv(i); // [!code --]
		int id = EClass.sources.elements.alias[h.source.skill].id; // [!code --]
		if (!i.elements.HasBase(id)) // [!code --]
		{ // [!code --]
			i.elements.SetBase(id, 1); // [!code --]
		} // [!code --]
		i.ModExp(id, 100); // [!code --]
		for (int j = 0; j < h.source.things.Length; j += 2) // [!code --]
		void GetOutcome(Hobby h) // [!code ++]
		{
			string text = h.source.things[j]; // [!code --]
			int num5 = Mathf.Max(1, h.source.things[j + 1].ToInt() * num3 / 1000); // [!code --]
			int num6 = num5 / 1000; // [!code --]
			if (num5 % 1000 > EClass.rnd(1000)) // [!code --]
			int num3 = h.GetEfficiency(i) * GetProductBonus(i) / 100; // [!code ++]
			int num4 = h.GetLv(i); // [!code ++]
			int id = EClass.sources.elements.alias[h.source.skill].id; // [!code ++]
			if (!i.elements.HasBase(id)) // [!code ++]
			{
				num6++; // [!code --]
				i.elements.SetBase(id, 1); // [!code ++]
			}
			if (num6 != 0) // [!code --]
			i.ModExp(id, 100); // [!code ++]
			for (int j = 0; j < h.source.things.Length; j += 2) // [!code ++]
			{
				if (!(text == "_egg")) // [!code --]
				string text = h.source.things[j]; // [!code ++]
				int num5 = Mathf.Max(1, h.source.things[j + 1].ToInt() * num3 / 1000); // [!code ++]
				int num6 = num5 / 1000; // [!code ++]
				if (num5 % 1000 > EClass.rnd(1000)) // [!code ++]
				{
					if (text == "milk") // [!code --]
					{ // [!code --]
						i.MakeMilk(date.IsRealTime, num6); // [!code --]
					} // [!code --]
					else // [!code --]
					num6++; // [!code ++]
				} // [!code ++]
				if (num6 != 0) // [!code ++]
				{ // [!code ++]
					if (!(text == "_egg")) // [!code ++]
					{
						Thing thing3 = ((!text.StartsWith("#")) ? ThingGen.Create(h.source.things[j], -1, num4) : ThingGen.CreateFromCategory(text.Replace("#", ""), num4)); // [!code --]
						if (thing3 != null) // [!code --]
						if (text == "milk") // [!code ++]
						{
							if (!thing3.trait.CanStack) // [!code --]
							{ // [!code --]
								num6 = 1; // [!code --]
							} // [!code --]
							thing3.SetNum(thing3.trait.CraftNum * num6); // [!code --]
							thing3.SetBlessedState(BlessedState.Normal); // [!code --]
							thing3.TryMakeRandomItem(num4); // [!code --]
							if (thing3.IsAmmo) // [!code --]
							{ // [!code --]
								thing3.ChangeMaterial("iron"); // [!code --]
								thing3.c_IDTState = 0; // [!code --]
							} // [!code --]
							bool flag = thing3.category.id == "garbage"; // [!code --]
							if (thing3.trait is TraitFoodMeal) // [!code --]
							i.MakeMilk(date.IsRealTime, num6); // [!code ++]
						} // [!code ++]
						else // [!code ++]
						{ // [!code ++]
							Thing thing4 = ((!text.StartsWith("#")) ? ThingGen.Create(h.source.things[j], -1, num4) : ThingGen.CreateFromCategory(text.Replace("#", ""), num4)); // [!code ++]
							if (thing4 != null) // [!code ++]
							{
								if (thing3.HasTag(CTAG.dish_fail)) // [!code --]
								if (!thing4.trait.CanStack) // [!code ++]
								{
									flag = true; // [!code --]
									num6 = 1; // [!code ++]
								} // [!code ++]
								thing4.SetNum(thing4.trait.CraftNum * num6); // [!code ++]
								thing4.SetBlessedState(BlessedState.Normal); // [!code ++]
								thing4.TryMakeRandomItem(num4); // [!code ++]
								if (thing4.IsAmmo) // [!code ++]
								{ // [!code ++]
									thing4.ChangeMaterial("iron"); // [!code ++]
									thing4.c_IDTState = 0; // [!code ++]
								} // [!code ++]
								bool flag = thing4.category.id == "garbage"; // [!code ++]
								if (thing4.trait is TraitFoodMeal) // [!code ++]
								{ // [!code ++]
									if (thing4.HasTag(CTAG.dish_fail)) // [!code ++]
									{ // [!code ++]
										flag = true; // [!code ++]
									} // [!code ++]
									else // [!code ++]
									{ // [!code ++]
										CraftUtil.MakeDish(thing4, num4 + 10, i); // [!code ++]
									} // [!code ++]
								} // [!code ++]
								if (flag) // [!code ++]
								{ // [!code ++]
									TryTrash(thing4); // [!code ++]
								}
								else
								{
									CraftUtil.MakeDish(thing3, num4 + 10, i); // [!code --]
									i.TryPutShared(thing4); // [!code ++]
								}
							}
							if (flag) // [!code --]
							{ // [!code --]
								TryTrash(thing3); // [!code --]
							} // [!code --]
							else // [!code --]
							{ // [!code --]
								i.TryPutShared(thing3); // [!code --]
							} // [!code --]
						}
					}
					else // [!code ++]
					{ // [!code ++]
						i.MakeEgg(date.IsRealTime, num6); // [!code ++]
					} // [!code ++]
				}
				else // [!code --]
			} // [!code ++]
			switch (h.source.alias) // [!code ++]
			{ // [!code ++]
			case "Nurse": // [!code ++]
			{ // [!code ++]
				foreach (Chara member2 in members) // [!code ++]
				{
					i.MakeEgg(date.IsRealTime, num6); // [!code --]
					if (!member2.IsPCParty) // [!code ++]
					{ // [!code ++]
						if (member2.isDead && EClass.rnd(num3) > EClass.rnd(100)) // [!code ++]
						{ // [!code ++]
							Log("bNurse", i, member2); // [!code ++]
							member2.Revive(member2.pos, msg: true); // [!code ++]
							break; // [!code ++]
						} // [!code ++]
						if (EClass.rnd(num3) > EClass.rnd(100)) // [!code ++]
						{ // [!code ++]
							member2.CureHost(CureType.HealComplete); // [!code ++]
						} // [!code ++]
					} // [!code ++]
				}
				break; // [!code ++]
			}
		} // [!code --]
		switch (h.source.alias) // [!code --]
		{ // [!code --]
		case "Nurse": // [!code --]
		{ // [!code --]
			foreach (Chara member2 in members) // [!code --]
			case "Chore": // [!code ++]
			case "Clean": // [!code ++]
			{
				if (!member2.IsPCParty) // [!code --]
				for (int k = 0; k < num3 / 2; k++) // [!code ++]
				{
					if (member2.isDead && EClass.rnd(num3) > EClass.rnd(100)) // [!code --]
					Point randomPoint = EClass._map.bounds.GetRandomPoint(); // [!code ++]
					if (randomPoint.HasDecal) // [!code ++]
					{
						Log("bNurse", i, member2); // [!code --]
						member2.Revive(member2.pos, msg: true); // [!code --]
						break; // [!code --]
						EClass._map.SetDecal(randomPoint.x, randomPoint.z); // [!code ++]
					}
					if (EClass.rnd(num3) > EClass.rnd(100)) // [!code --]
				} // [!code ++]
				break; // [!code ++]
			} // [!code ++]
			case "TreasureHunt": // [!code ++]
				if (EClass.rnd(num3) > EClass.rnd(EClass.debug.enable ? 100 : 5000)) // [!code ++]
				{ // [!code ++]
					Thing thing5 = EClass._zone.TryGetThingFromSharedContainer((Thing t) => t.trait is TraitScrollMapTreasure); // [!code ++]
					if (thing5 != null) // [!code ++]
					{
						member2.CureHost(CureType.HealComplete); // [!code --]
						Thing thing6 = ThingGen.CreateTreasure("chest_treasure", thing5.LV); // [!code ++]
						i.TryPutShared(thing6); // [!code ++]
						thing5.Destroy(); // [!code ++]
						WidgetPopText.Say("foundTreasure".lang(thing6.Name)); // [!code ++]
					}
				}
				break; // [!code ++]
			}
			break; // [!code --]
		}
		case "Chore": // [!code --]
		case "Clean": // [!code --]
	} // [!code ++]
	int soilCost = EClass._zone.GetSoilCost(); // [!code ++]
	int num = Mathf.Min(100, 70 + (MaxSoil - soilCost)); // [!code ++]
	int flower = 5; // [!code ++]
	int lv = 1; // [!code ++]
	EClass._map.bounds.ForeachCell(delegate(Cell cell) // [!code ++]
	{ // [!code ++]
		if (cell.obj != 0 && cell.sourceObj.tag.Contains("flower")) // [!code ++]
		{
			for (int k = 0; k < num3 / 2; k++) // [!code --]
			PlantData plantData = cell.TryGetPlant(); // [!code ++]
			if (plantData != null && plantData.seed != null) // [!code ++]
			{
				Point randomPoint = EClass._map.bounds.GetRandomPoint(); // [!code --]
				if (randomPoint.HasDecal) // [!code --]
				{ // [!code --]
					EClass._map.SetDecal(randomPoint.x, randomPoint.z); // [!code --]
				} // [!code --]
				lv += plantData.seed.encLV + 1; // [!code ++]
			}
			break; // [!code --]
			else // [!code ++]
			{ // [!code ++]
				lv++; // [!code ++]
			} // [!code ++]
			flower++; // [!code ++]
		}
		case "TreasureHunt": // [!code --]
			if (EClass.rnd(num3) > EClass.rnd(EClass.debug.enable ? 100 : 5000)) // [!code --]
	}); // [!code ++]
	lv /= flower; // [!code ++]
	int num2 = 0; // [!code ++]
	foreach (Thing thing7 in EClass._map.things) // [!code ++]
	{ // [!code ++]
		if (thing7.IsInstalled && thing7.trait is TraitBeekeep && !thing7.things.IsFull()) // [!code ++]
		{ // [!code ++]
			flower -= 3 + EClass.rnd(5 + num2 * 4); // [!code ++]
			num2++; // [!code ++]
			if (flower < 0) // [!code ++]
			{
				Thing thing4 = EClass._zone.TryGetThingFromSharedContainer((Thing t) => t.trait is TraitScrollMapTreasure); // [!code --]
				if (thing4 != null) // [!code --]
				{ // [!code --]
					Thing thing5 = ThingGen.CreateTreasure("chest_treasure", thing4.LV); // [!code --]
					i.TryPutShared(thing5); // [!code --]
					thing4.Destroy(); // [!code --]
					WidgetPopText.Say("foundTreasure".lang(thing5.Name)); // [!code --]
				} // [!code --]
				break; // [!code ++]
			} // [!code ++]
			if (EClass.rnd(100) <= num) // [!code ++]
			{ // [!code ++]
				Thing thing3 = ThingGen.Create("honey"); // [!code ++]
				thing3.SetEncLv(lv / 10); // [!code ++]
				thing3.elements.SetBase(2, EClass.curve(lv, 50, 10, 80)); // [!code ++]
				thing7.AddThing(thing3); // [!code ++]
			}
			break; // [!code --]
		}
	}
}
```

## FortuneRollData

[`@@ -172,7 +172,7 @@ void Add(int grade)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/FortuneRollData.cs#L172-L178)
```cs:line-numbers=172

	public List<List<string>> GetPrizeList()
	{
		return new List<List<string>> // [!code --]
		List<List<string>> list = new List<List<string>> // [!code ++]
		{
			new List<string> { "scrubber", "tissue", "plat" },
			new List<string>
```

[`@@ -195,6 +195,14 @@ public List<List<string>> GetPrizeList()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/FortuneRollData.cs#L195-L200)
```cs:line-numbers=195
				"medal"
			}
		};
		if (EClass.pc.faction.IsGlobalPolicyActive(2712)) // [!code ++]
		{ // [!code ++]
			for (int i = 0; i < (EClass.debug.enable ? 50 : 5); i++) // [!code ++]
			{ // [!code ++]
				list[2].Add("panty"); // [!code ++]
			} // [!code ++]
		} // [!code ++]
		return list; // [!code ++]
	}

	public void GetPrize(int grade, int seed)
```

## GrowSystem

[`@@ -630,7 +630,7 @@ public void PopHarvest(Chara c, Thing t = null, int num = -1)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/GrowSystem.cs#L630-L636)
```cs:line-numbers=630
	{
		Debug.Log("harvest count not set:" + source.id + "/" + source.alias);
	}
	if (num != -1) // [!code --]
	if (num > 0) // [!code ++]
	{
		t.SetNum(num);
	}
```

[`@@ -656,9 +656,10 @@ public void ApplySeed(Thing t)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/GrowSystem.cs#L656-L664)
```cs:line-numbers=656
		return;
	}
	int encLv = thing.encLV / 10 + ((thing.encLV > 0) ? 1 : 0);
	bool flag = t.IsFood || t.Evalue(10) > 0 || t.id == "grass"; // [!code ++]
	foreach (Element value in thing.elements.dict.Values)
	{
		if ((!value.IsFoodTrait || t.IsFood) && (value.IsFoodTrait || value.id == 2)) // [!code --]
		if ((!value.IsFoodTrait || flag) && (value.IsFoodTrait || value.id == 2)) // [!code ++]
		{
			t.elements.ModBase(value.id, value.Value / 10 * 10);
		}
```

## GrowSystemWeed

[`@@ -13,7 +13,7 @@ public override bool CanReapSeed()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/GrowSystemWeed.cs#L13-L19)
```cs:line-numbers=13

	public override void OnMineObj(Chara c = null)
	{
		TryPick(GrowSystem.cell, "grass", EClass.sources.materials.alias["grass"].id, EClass.rnd(5)); // [!code --]
		PopHarvest(c ?? EClass.pc, ThingGen.Create("grass", EClass.sources.materials.alias["grass"].id), EClass.rnd(5)); // [!code ++]
		base.OnMineObj(c);
	}
}
```

## LayerCraft

[`@@ -181,6 +181,7 @@ public void OnClickCraft()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/LayerCraft.cs#L181-L186)
```cs:line-numbers=181
		pickaxeCrafted = true;
		break;
	}
	recipe.SaveLastIngredients(); // [!code ++]
	ELayer.pc.SetAI(new AI_UseCrafter
	{
		crafter = traitCrafter,
```

[`@@ -285,6 +286,10 @@ public void RefreshCategory(string cat, bool first = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/LayerCraft.cs#L285-L290)
```cs:line-numbers=285
	{
		onClick = delegate(Recipe a, ButtonGrid b)
		{
			if (recipe != null) // [!code ++]
			{ // [!code ++]
				recipe.SaveLastIngredients(); // [!code ++]
			} // [!code ++]
			recipe = a;
			SE.Play("click_recipe");
			RefreshRecipe(first: true);
```

## POLICY

[`@@ -11,13 +11,13 @@ public class POLICY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/POLICY.cs#L11-L23)
```cs:line-numbers=11

	public const int suite_room = 2813;

	public const int noMother = 2710; // [!code --]
	public const int incomeTransfer = 2711; // [!code ++]

	public const int open_business = 2810;

	public const int home_discount = 2800;

	public const int incomeTransfer = 2711; // [!code --]
	public const int forcePanty = 2712; // [!code ++]

	public const int store_ripoff = 2816;

```

[`@@ -47,11 +47,13 @@ public class POLICY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/POLICY.cs#L47-L57)
```cs:line-numbers=47

	public const int license_food = 2818;

	public const int noAnimal = 2709; // [!code --]
	public const int noMother = 2710; // [!code ++]

	public const int human_right = 2506;

	public const int auto_farm = 2707; // [!code --]
	public const int noDM = 2708; // [!code ++]
 // [!code ++]
	public const int noAnimal = 2709; // [!code ++]

	public const int food_for_people = 2502;

```

[`@@ -65,49 +67,49 @@ public class POLICY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/POLICY.cs#L65-L113)
```cs:line-numbers=65

	public const int legal_drug = 2505;

	public const int inquisition = 2507; // [!code --]
 // [!code --]
	public const int nocturnal_life = 2508;

	public const int vaccination = 2509;

	public const int ban_radio = 2510; // [!code ++]
 // [!code ++]
	public const int self_sufficient = 2511;

	public const int resident_tax = 2512;

	public const int ban_radio = 2510; // [!code --]
	public const int inquisition = 2507; // [!code ++]

	public const int taxfree = 2514;

	public const int stop_growth = 2515; // [!code --]
 // [!code --]
	public const int speed_growth = 2516; // [!code --]
	public const int auto_farm = 2707; // [!code ++]

	public const int energy_conservation = 2700; // [!code --]
	public const int resident_wanted = 2513; // [!code ++]

	public const int trash_sort = 2701; // [!code --]
	public const int taxTransfer = 2705; // [!code ++]

	public const int trash_no = 2702; // [!code --]
	public const int border_watch = 2704; // [!code ++]

	public const int weed_no = 2703;

	public const int border_watch = 2704; // [!code --]
 // [!code --]
	public const int taxTransfer = 2705; // [!code --]
	public const int trash_no = 2702; // [!code ++]

	public const int demon_invocation = 2706;

	public const int resident_wanted = 2513; // [!code --]
	public const int energy_conservation = 2700; // [!code ++]

	public const int noDM = 2708; // [!code --]
	public const int speed_growth = 2516; // [!code ++]
 // [!code ++]
	public const int stop_growth = 2515; // [!code ++]
 // [!code ++]
	public const int trash_sort = 2701; // [!code ++]

	public static readonly int[] IDS = new int[49] // [!code --]
	public static readonly int[] IDS = new int[50] // [!code ++]
	{
		2812, 2815, 2814, 2813, 2710, 2810, 2800, 2711, 2816, 2811, // [!code --]
		2812, 2815, 2814, 2813, 2711, 2810, 2800, 2712, 2816, 2811, // [!code ++]
		2817, 2824, 2819, 2820, 2821, 2822, 2823, 2825, 2826, 2827,
		2828, 2818, 2709, 2506, 2707, 2502, 2501, 2500, 2503, 2504, // [!code --]
		2505, 2507, 2508, 2509, 2511, 2512, 2510, 2514, 2515, 2516, // [!code --]
		2700, 2701, 2702, 2703, 2704, 2705, 2706, 2513, 2708 // [!code --]
		2828, 2818, 2710, 2506, 2708, 2709, 2502, 2501, 2500, 2503, // [!code ++]
		2504, 2505, 2508, 2509, 2510, 2511, 2512, 2507, 2514, 2707, // [!code ++]
		2513, 2705, 2704, 2703, 2702, 2706, 2700, 2516, 2515, 2701 // [!code ++]
	};
}
public class Policy : EClass
```

## Recipe

[`@@ -926,4 +926,15 @@ public void TryGetFirstTimeBonus()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/Recipe.cs#L926-L929)
```cs:line-numbers=926
			EClass.pc.Pick(ThingGen.Create("ticket_fortune").SetNum(num));
		}
	}
 // [!code ++]
	public void SaveLastIngredients() // [!code ++]
	{ // [!code ++]
		List<int> list = new List<int>(); // [!code ++]
		foreach (Ingredient ingredient in ingredients) // [!code ++]
		{ // [!code ++]
			int item = ((ingredient.thing != null) ? ingredient.thing.uid : 0); // [!code ++]
			list.Add(item); // [!code ++]
		} // [!code ++]
		EClass.player.recipes.lastIngredients[id] = list; // [!code ++]
	} // [!code ++]
}
```

## RecipeCard

[`@@ -319,7 +319,7 @@ public void MakeDish(Thing t)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/RecipeCard.cs#L319-L325)
```cs:line-numbers=319
		if (EClass.pc.HasElement(1658))
		{
			t.elements.SetBase(757, 1);
			t.c_dateCooked = EClass.world.date.GetRaw() + (EClass.pc.Evalue(1658) - 1) * 24 * 60; // [!code --]
			t.c_dateCooked = EClass.world.date.GetRaw() + (EClass.pc.Evalue(1658) - 1) * 48 * 60; // [!code ++]
		}
	}

```

## RecipeManager

[`@@ -25,6 +25,9 @@ public class RecipeManager : EClass`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/RecipeManager.cs#L25-L30)
```cs:line-numbers=25
	[JsonProperty]
	public HashSet<string> newRecipes = new HashSet<string>();

	[JsonProperty] // [!code ++]
	public Dictionary<string, List<int>> lastIngredients = new Dictionary<string, List<int>>(); // [!code ++]
 // [!code ++]
	public static void BuildList()
	{
		if (!rebuild && list.Count > 0)
```

## SKILL

[`@@ -1,26 +1,26 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/SKILL.cs#L1-L26)
```cs:line-numbers=1
public class SKILL
{
	public const int shield = 123; // [!code --]
	public const int fireproof = 50; // [!code ++]

	public const int tactics = 132; // [!code --]
	public const int marksman = 133; // [!code ++]

	public const int twowield = 131; // [!code --]
	public const int weaponCrossbow = 109; // [!code ++]

	public const int twohand = 130; // [!code --]
	public const int weaponScythe = 110; // [!code ++]

	public const int fireproof = 50; // [!code --]
	public const int weaponBlunt = 111; // [!code ++]

	public const int armorLight = 120;

	public const int weaponBlunt = 111; // [!code --]
	public const int armorHeavy = 122; // [!code ++]

	public const int weaponScythe = 110; // [!code --]
	public const int shield = 123; // [!code ++]

	public const int weaponCrossbow = 109; // [!code --]
	public const int twohand = 130; // [!code ++]

	public const int marksman = 133; // [!code --]
	public const int twowield = 131; // [!code ++]

	public const int armorHeavy = 122; // [!code --]
	public const int tactics = 132; // [!code ++]

	public const int eyeofmind = 134;

```

[`@@ -120,7 +120,7 @@ public class SKILL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/SKILL.cs#L120-L126)
```cs:line-numbers=120

	public const int weaponPolearm = 106;

	public const int throwing = 108; // [!code --]
	public const int weaponDagger = 107; // [!code ++]

	public const int mana = 61;

```

[`@@ -130,7 +130,7 @@ public class SKILL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/SKILL.cs#L130-L136)
```cs:line-numbers=130

	public const int gathering = 250;

	public const int weaponDagger = 107; // [!code --]
	public const int throwing = 108; // [!code ++]

	public const int blacksmith = 256;

```

[`@@ -264,13 +264,13 @@ public class SKILL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/SKILL.cs#L264-L276)
```cs:line-numbers=264

	public static readonly int[] IDS = new int[131]
	{
		123, 132, 131, 130, 50, 120, 111, 110, 109, 133, // [!code --]
		122, 134, 227, 150, 242, 241, 240, 237, 235, 230, // [!code --]
		50, 133, 109, 110, 111, 120, 122, 123, 130, 131, // [!code ++]
		132, 134, 227, 150, 242, 241, 240, 237, 235, 230, // [!code ++]
		51, 226, 225, 220, 210, 207, 200, 152, 151, 135,
		55, 102, 57, 245, 62, 64, 65, 66, 67, 68,
		70, 71, 72, 73, 74, 75, 76, 56, 77, 79,
		80, 90, 91, 92, 100, 101, 103, 104, 105, 106,
		108, 61, 60, 78, 250, 107, 256, 916, 917, 918, // [!code --]
		107, 61, 60, 78, 250, 108, 256, 916, 917, 918, // [!code ++]
		919, 920, 921, 922, 923, 924, 925, 950, 951, 952,
		953, 954, 955, 956, 957, 958, 959, 960, 961, 962,
		963, 964, 970, 971, 972, 255, 915, 914, 965, 912,
```

## Trait

[`@@ -1869,6 +1869,7 @@ public void OnBarter()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/Trait.cs#L1869-L1874)
```cs:line-numbers=1869
				AddThing(ThingGen.CreateRecipe("detector").SetPriceFix(700));
				AddThing(ThingGen.CreatePlan(2710)).SetPriceFix(-100);
				AddThing(ThingGen.CreatePlan(2711)).SetPriceFix(-100);
				AddThing(ThingGen.CreatePlan(2712)).SetPriceFix(200); // [!code ++]
				break;
			}
			if (Guild.Thief.IsCurrentZone)
```

## TraitAdventurer

[`@@ -2,7 +2,7 @@ public class TraitAdventurer : TraitChara`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/TraitAdventurer.cs#L2-L8)
```cs:line-numbers=2
{
	public override bool UseGlobalGoal => base.owner.IsGlobal;

	public override bool UseRandomAbility => true; // [!code --]
	public override int MaxRandomAbility => 3; // [!code ++]

	public override bool UseRandomAlias => true;

```

## TraitBigDaddy

[`@@ -1,4 +1,16 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/TraitBigDaddy.cs#L1-L4)
```cs:line-numbers=1
public class TraitBigDaddy : TraitChara
{
	public override bool IsCountAsResident => true;
 // [!code ++]
	public override int MaxRandomAbility // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			if (EClass._zone.DangerLv < 50) // [!code ++]
			{ // [!code ++]
				return 0; // [!code ++]
			} // [!code ++]
			return 3; // [!code ++]
		} // [!code ++]
	} // [!code ++]
}
```

## TraitChara

[`@@ -84,7 +84,7 @@ public virtual bool CanSellPlan`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/TraitChara.cs#L84-L90)
```cs:line-numbers=84

	public virtual bool ShowAdvRank => owner.IsPC;

	public virtual bool UseRandomAbility => false; // [!code --]
	public virtual int MaxRandomAbility => 0; // [!code ++]

	public virtual Adv_Type AdvType => Adv_Type.None;

```

[`@@ -118,17 +118,7 @@ public virtual bool CanGiveRandomQuest`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/TraitChara.cs#L118-L134)
```cs:line-numbers=118

	public virtual bool UseRandomAlias => false;

	public virtual bool IsWearingPanty // [!code --]
	{ // [!code --]
		get // [!code --]
		{ // [!code --]
			if ((!IsUnique || owner.bio.gender != 2) && (owner.race.IsHuman || owner.race.IsFairy)) // [!code --]
			{ // [!code --]
				return !(this is TraitMerchant); // [!code --]
			} // [!code --]
			return false; // [!code --]
		} // [!code --]
	} // [!code --]
	public virtual bool IsWearingPanty => EClass.pc.faction.IsWearingPanty(owner); // [!code ++]

	public override string IDInvStyle => "backpack";

```

## TraitUniqueMonsterAdv

[`@@ -1,6 +1,6 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/TraitUniqueMonsterAdv.cs#L1-L6)
```cs:line-numbers=1
public class TraitUniqueMonsterAdv : TraitUniqueMonster
{
	public override bool UseRandomAbility => true; // [!code --]
	public override int MaxRandomAbility => 4; // [!code ++]

	public override bool UseRandomAlias => true;

```

## UIMagicChest

[`@@ -70,10 +70,13 @@ public void Init()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/UIMagicChest.cs#L70-L79)
```cs:line-numbers=70
		int _i = i;
		b.SetOnClick(delegate
		{
			page = _i; // [!code --]
			groupPage.Select(b); // [!code --]
			SE.Tab(); // [!code --]
			Redraw(); // [!code --]
			if (!UIContextMenu.Current) // [!code ++]
			{ // [!code ++]
				page = _i; // [!code ++]
				groupPage.Select(b); // [!code ++]
				SE.Tab(); // [!code ++]
				Redraw(); // [!code ++]
			} // [!code ++]
		});
	}
	groupPage.Init();
```

[`@@ -109,16 +112,19 @@ public void RefreshCats()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/UIMagicChest.cs#L109-L124)
```cs:line-numbers=109
		string _c = cat;
		uIButton.SetOnClick(delegate
		{
			SE.Tab(); // [!code --]
			if (idCat == _c) // [!code --]
			{ // [!code --]
				idCat = ""; // [!code --]
			} // [!code --]
			else // [!code --]
			if (!UIContextMenu.Current) // [!code ++]
			{
				idCat = _c; // [!code --]
				SE.Tab(); // [!code ++]
				if (idCat == _c) // [!code ++]
				{ // [!code ++]
					idCat = ""; // [!code ++]
				} // [!code ++]
				else // [!code ++]
				{ // [!code ++]
					idCat = _c; // [!code ++]
				} // [!code ++]
				Redraw(); // [!code ++]
			}
			Redraw(); // [!code --]
		});
	}
	foreach (KeyValuePair<string, UIButton> item in catButton)
```

[`@@ -150,7 +156,7 @@ private void LateUpdate()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/UIMagicChest.cs#L150-L156)
```cs:line-numbers=150
			Search(inputSearch.text);
		}
	}
	if (EInput.wheel != 0) // [!code --]
	if (EInput.wheel != 0 && !UIContextMenu.Current) // [!code ++]
	{
		SE.Tab();
		page -= EInput.wheel;
```

## Widget

[`@@ -607,26 +607,29 @@ public void ShowContextMenu()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/Widget.cs#L607-L632)
```cs:line-numbers=607

	public void SetBaseContextMenu(UIContextMenu m)
	{
		UIContextMenu uIContextMenu = m.AddChild("anchor"); // [!code --]
		SkinConfig cfg = config.skin;
		foreach (RectPosition p2 in Util.EnumToList<RectPosition>()) // [!code --]
		if (!(this is WidgetSideScreen)) // [!code ++]
		{
			uIContextMenu.AddButton(((config.userAnchor == p2) ? "★ " : "") + p2.ToString().lang(), delegate // [!code --]
			UIContextMenu uIContextMenu = m.AddChild("anchor"); // [!code ++]
			foreach (RectPosition p2 in Util.EnumToList<RectPosition>()) // [!code ++]
			{
				SetAnchor(p2); // [!code --]
				SE.ClickGeneral(); // [!code --]
				m.Hide(); // [!code --]
			}); // [!code --]
		} // [!code --]
		uIContextMenu = m.AddChild("pivot"); // [!code --]
		foreach (RectPosition p in Util.EnumToList<RectPosition>()) // [!code --]
		{ // [!code --]
			uIContextMenu.AddButton(((config.pivot == p) ? "★ " : "") + p.ToString().lang(), delegate // [!code --]
				uIContextMenu.AddButton(((config.userAnchor == p2) ? "★ " : "") + p2.ToString().lang(), delegate // [!code ++]
				{ // [!code ++]
					SetAnchor(p2); // [!code ++]
					SE.ClickGeneral(); // [!code ++]
					m.Hide(); // [!code ++]
				}); // [!code ++]
			} // [!code ++]
			uIContextMenu = m.AddChild("pivot"); // [!code ++]
			foreach (RectPosition p in Util.EnumToList<RectPosition>()) // [!code ++]
			{
				SetPivot(p); // [!code --]
				SE.ClickGeneral(); // [!code --]
				m.Hide(); // [!code --]
			}); // [!code --]
				uIContextMenu.AddButton(((config.pivot == p) ? "★ " : "") + p.ToString().lang(), delegate // [!code ++]
				{ // [!code ++]
					SetPivot(p); // [!code ++]
					SE.ClickGeneral(); // [!code ++]
					m.Hide(); // [!code ++]
				}); // [!code ++]
			} // [!code ++]
		}
		UIContextMenuItem sliderB = null;
		Action Refresh = delegate
```

## ZoneEventDefenseGame

[`@@ -53,7 +53,7 @@ public bool CanCallAlly`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/f74f3d7895319c5fdc04831f78c5d147c6fe173c/Elin/ZoneEventDefenseGame.cs#L53-L59)
```cs:line-numbers=53
		}
	}

	public override string TextWidgetDate => "defenseWave".lang(wave.ToString() ?? "", kills.ToString() ?? "") + ((instance != null && retreated) ? "defenseRetreating" : (CanRetreat ? "defenseRetreat" : "")).lang() + (CanCallAlly ? "defenseAlly" : "").lang(); // [!code --]
	public override string TextWidgetDate => "defenseWave".lang(wave.ToString() ?? "", kills.ToString() ?? "", EClass._zone.DangerLv.ToString() ?? "") + ((instance != null && retreated) ? "defenseRetreating" : (CanRetreat ? "defenseRetreat" : "")).lang() + (CanCallAlly ? "defenseAlly" : "").lang(); // [!code ++]

	public virtual Chara CreateChara()
	{
```

---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 33 files modified. 2 new files created.
version: EA 23.112 Nightly
changes: ABILITY/AI_PlayMusic/AM_Terrain/ActMelee/+ActMeleeSwarm/+ActSwarm/BaseTileMap/BuildMenu/Card/Chara/DOMAIN/DramaCustomSequence/EClass/ELEMENT/ENC/EffectId/FACTION/FEAT/FOOD/GamePrincipal/GenRoom/HotbarManager/LayerUploader/LayerWorldSetting/MUTATION/MapGenDungen/ModManager/Net/POLICY/SKILL/TileTypeWallHang/Trait/TraitMoongate/TraitWaystone/WidgetSearch
---

# EA 23.112 Nightly

March 24, 2025

33 files modified. 2 new files created.

## Important Changes

Possible breaking changes. Click the filename to view the chunk.
### [Net (1)](#net)
```cs:no-line-numbers
public static async UniTask<bool> UploadFile(string id, string password, string name, string title, string path, string idLang) // [!code --]
public static async UniTask<bool> UploadFile(string id, string password, string name, string title, string path, string idLang, string cat = "Home") // [!code ++]
```
## ABILITY

[`@@ -2,9 +2,7 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ABILITY.cs#L2-L10)
```cs:line-numbers=2

public class ABILITY
{
	public const int AI_TendAnimal = 5043; // [!code --]
 // [!code --]
	public const int ActThrow = 5038; // [!code --]
	public const int ActChat = 5044; // [!code ++]

	public const int AI_Fish = 5039;

```

[`@@ -14,7 +12,7 @@ public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ABILITY.cs#L14-L20)
```cs:line-numbers=14

	public const int ActKick = 5042;

	public const int ActChat = 5044; // [!code --]
	public const int AI_TendAnimal = 5043; // [!code ++]

	public const int AI_Drink = 5045;

```

[`@@ -32,11 +30,11 @@ public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ABILITY.cs#L32-L42)
```cs:line-numbers=32

	public const int ActBash = 5052;

	public const int ActNoItem = 5037; // [!code --]
 // [!code --]
	public const int TaskHarvest = 5053;

	public const int ActRestrain = 5055; // [!code --]
	public const int ActThrow = 5038; // [!code ++]
 // [!code ++]
	public const int AI_Bladder = 5054; // [!code ++]

	public const int AI_PlayMusic = 6001;

```

[`@@ -64,15 +62,15 @@ public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ABILITY.cs#L64-L78)
```cs:line-numbers=64

	public const int ActRush = 6450;

	public const int AI_Bladder = 5054; // [!code --]
 // [!code --]
	public const int ActCrabBreathe = 6500;

	public const int TaskMoveInstalled = 5036; // [!code --]
	public const int ActRestrain = 5055; // [!code ++]

	public const int GoalIdle = 5034; // [!code --]
	public const int ActCurse = 6600; // [!code ++]

	public const int Sleep = 5004; // [!code --]
	public const int ActNoItem = 5037; // [!code ++]
 // [!code ++]
	public const int TaskBuild = 5035; // [!code ++]

	public const int Wait = 5005;

```

[`@@ -100,11 +98,11 @@ public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ABILITY.cs#L100-L110)
```cs:line-numbers=100

	public const int TaskTalk = 5017;

	public const int TaskBuild = 5035; // [!code --]
 // [!code --]
	public const int TaskPick = 5018;

	public const int TaskFarm = 5020; // [!code --]
	public const int TaskMoveInstalled = 5036; // [!code ++]
 // [!code ++]
	public const int TaskReadBoard = 5019; // [!code ++]

	public const int TaskTrain = 5021;

```

[`@@ -132,13 +130,15 @@ public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ABILITY.cs#L132-L144)
```cs:line-numbers=132

	public const int ActCancelTask = 5033;

	public const int TaskReadBoard = 5019; // [!code --]
	public const int GoalIdle = 5034; // [!code ++]

	public const int ActCurse = 6600; // [!code --]
	public const int TaskFarm = 5020; // [!code ++]
 // [!code ++]
	public const int ActEntangle = 6601; // [!code ++]

	public const int ActDuplicate = 6420;

	public const int ActDraw = 6602; // [!code --]
	public const int ActNTR = 6603; // [!code ++]

	public const int breathe_ = 7000;

```

[`@@ -156,14 +156,14 @@ public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ABILITY.cs#L156-L169)
```cs:line-numbers=156

	public const int breathe_Nether = 50206;

	public const int ActEntangle = 6601; // [!code --]
 // [!code --]
	public const int breathe_Nerve = 50208; // [!code --]
	public const int breathe_Sound = 50207; // [!code ++]

	public const int ActHeadpat = 6904; // [!code --]
	public const int ActDraw = 6602; // [!code ++]

	public const int breathe_Holy = 50209;

	public const int breathe_Chaos = 50210; // [!code ++]
 // [!code ++]
	public const int breathe_Magic = 50211;

	public const int breathe_Ether = 50212;
```

[`@@ -184,21 +184,23 @@ public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ABILITY.cs#L184-L204)
```cs:line-numbers=184

	public const int Ranged = 5003;

	public const int breathe_Chaos = 50210; // [!code --]
	public const int Sleep = 5004; // [!code ++]
 // [!code ++]
	public const int ActHeadpat = 6904; // [!code ++]

	public const int ActKizuamiTrick = 6903;

	public const int breathe_Sound = 50207; // [!code --]
	public const int breathe_Nerve = 50208; // [!code ++]

	public const int ActJureHeal = 6901;

	public const int ActWeaken = 6610; // [!code --]
	public const int ActTouchSleep = 6612; // [!code ++]

	public const int ActNTR = 6603; // [!code --]
	public const int ActFear = 6611; // [!code ++]

	public const int ActLulwyTrick = 6902; // [!code --]
	public const int ActWeaken = 6610; // [!code ++]

	public const int ActTouchSleep = 6612; // [!code --]
	public const int ActLulwyTrick = 6902; // [!code ++]

	public const int ActTouchDrown = 6613;

```

[`@@ -212,44 +214,44 @@ public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ABILITY.cs#L212-L255)
```cs:line-numbers=212

	public const int ActInsult = 6630;

	public const int ActGazeMana = 6623; // [!code --]
	public const int ActScream = 6631; // [!code ++]

	public const int ActSteal = 6640; // [!code --]
	public const int ActGazeMana = 6623; // [!code ++]

	public const int ActManaAbsorb = 6900; // [!code --]
	public const int ActStealFood = 6641; // [!code ++]

	public const int StManaCost = 6720; // [!code --]
	public const int ActStealMoney = 6642; // [!code ++]

	public const int ActScream = 6631; // [!code --]
	public const int ActNeckHunt = 6650; // [!code ++]

	public const int StTaunt = 6700; // [!code --]
	public const int ActDropMine = 6660; // [!code ++]

	public const int ActThrowPotion = 6661;

	public const int ActFear = 6611; // [!code --]
	public const int ActSwarm = 6662; // [!code ++]

	public const int ActNeckHunt = 6650; // [!code --]
	public const int ActManaAbsorb = 6900; // [!code ++]

	public const int ActStealMoney = 6642; // [!code --]
	public const int StManaCost = 6720; // [!code ++]

	public const int ActStealFood = 6641; // [!code --]
	public const int ActSteal = 6640; // [!code ++]

	public const int ActDropMine = 6660; // [!code --]
	public const int StTaunt = 6700; // [!code ++]

	public static readonly int[] IDS = new int[117] // [!code --]
	public static readonly int[] IDS = new int[118] // [!code ++]
	{
		5043, 5038, 5039, 5040, 5041, 5042, 5044, 5045, 5046, 5047, // [!code --]
		5048, 5049, 5050, 5051, 5052, 5037, 5053, 5055, 6001, 6003, // [!code --]
		6011, 6012, 6013, 6015, 6018, 6019, 6020, 6050, 6400, 6410, // [!code --]
		6450, 5054, 6500, 5036, 5034, 5004, 5005, 5006, 5007, 5008, // [!code --]
		5009, 5010, 5011, 5012, 5013, 5014, 5015, 5016, 5017, 5035, // [!code --]
		5018, 5020, 5021, 5022, 5023, 5024, 5025, 5026, 5027, 5028, // [!code --]
		5029, 5030, 5031, 5032, 5033, 5019, 6600, 6420, 6602, 7000, // [!code --]
		50200, 50201, 50202, 50203, 50204, 50205, 50206, 6601, 50208, 6904, // [!code --]
		50209, 50211, 50212, 50213, 50214, 50215, 50216, 5000, 5001, 5002, // [!code --]
		5003, 50210, 6903, 50207, 6901, 6610, 6603, 6902, 6612, 6613, // [!code --]
		6620, 6621, 6622, 6626, 6630, 6623, 6640, 6900, 6720, 6631, // [!code --]
		6700, 6661, 6611, 6650, 6642, 6641, 6660 // [!code --]
		5044, 5039, 5040, 5041, 5042, 5043, 5045, 5046, 5047, 5048, // [!code ++]
		5049, 5050, 5051, 5052, 5053, 5038, 5054, 6001, 6003, 6011, // [!code ++]
		6012, 6013, 6015, 6018, 6019, 6020, 6050, 6400, 6410, 6450, // [!code ++]
		6500, 5055, 6600, 5037, 5035, 5005, 5006, 5007, 5008, 5009, // [!code ++]
		5010, 5011, 5012, 5013, 5014, 5015, 5016, 5017, 5018, 5036, // [!code ++]
		5019, 5021, 5022, 5023, 5024, 5025, 5026, 5027, 5028, 5029, // [!code ++]
		5030, 5031, 5032, 5033, 5034, 5020, 6601, 6420, 6603, 7000, // [!code ++]
		50200, 50201, 50202, 50203, 50204, 50205, 50206, 50207, 6602, 50209, // [!code ++]
		50210, 50211, 50212, 50213, 50214, 50215, 50216, 5000, 5001, 5002, // [!code ++]
		5003, 5004, 6904, 6903, 50208, 6901, 6612, 6611, 6610, 6902, // [!code ++]
		6613, 6620, 6621, 6622, 6626, 6630, 6631, 6623, 6641, 6642, // [!code ++]
		6650, 6660, 6661, 6662, 6900, 6720, 6640, 6700 // [!code ++]
	};
}
public class Ability : Act
```

## AI_PlayMusic

[`@@ -117,6 +117,12 @@ public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/AI_PlayMusic.cs#L117-L122)
```cs:line-numbers=117
		case "lute":
			idSong = "guitar_sad";
			break;
		case "recorder": // [!code ++]
			idSong = "recorder"; // [!code ++]
			break; // [!code ++]
		case "flute": // [!code ++]
			idSong = "flute"; // [!code ++]
			break; // [!code ++]
		case "taiko":
			idSong = "taiko";
			break;
```

## AM_Terrain

[`@@ -67,7 +67,14 @@ public override void OnProcessTiles(Point point, int dir)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/AM_Terrain.cs#L67-L73)
```cs:line-numbers=67
			p.cell.height -= (byte)num2;
			if (p.cell._bridge != 0)
			{
				p.cell.bridgeHeight -= (byte)num2; // [!code --]
				if (p.cell.bridgeHeight - num2 < 0) // [!code ++]
				{ // [!code ++]
					p.cell.bridgeHeight = 0; // [!code ++]
				} // [!code ++]
				else // [!code ++]
				{ // [!code ++]
					p.cell.bridgeHeight -= (byte)num2; // [!code ++]
				} // [!code ++]
			}
		}
		else
```

[`@@ -92,7 +99,14 @@ public override void OnProcessTiles(Point point, int dir)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/AM_Terrain.cs#L92-L98)
```cs:line-numbers=92
			p.cell.height += (byte)num3;
			if (p.cell._bridge != 0)
			{
				p.cell.bridgeHeight += (byte)num3; // [!code --]
				if (p.cell.bridgeHeight + num3 < 0) // [!code ++]
				{ // [!code ++]
					p.cell.bridgeHeight = 0; // [!code ++]
				} // [!code ++]
				else // [!code ++]
				{ // [!code ++]
					p.cell.bridgeHeight += (byte)num3; // [!code ++]
				} // [!code ++]
			}
		}
		p.RefreshNeighborTiles();
```

## ActMelee

[`@@ -3,6 +3,8 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ActMelee.cs#L3-L8)
```cs:line-numbers=3

public class ActMelee : ActBaseAttack
{
	public virtual bool UseWeaponDist => true; // [!code ++]
 // [!code ++]
	public override int PerformDistance
	{
		get
```

[`@@ -66,7 +68,7 @@ public override bool CanPerform()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ActMelee.cs#L66-L72)
```cs:line-numbers=66
	{
		return false;
	}
	if (Act.CC.Dist(Act.TC) > PerformDistance) // [!code --]
	if (UseWeaponDist && Act.CC.Dist(Act.TC) > PerformDistance) // [!code ++]
	{
		return false;
	}
```

[`@@ -165,7 +167,7 @@ void _Attack(BodySlot slot)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ActMelee.cs#L165-L171)
```cs:line-numbers=165
				w = slot.thing;
			}
			int num = 1 + Mathf.Max(Act.CC.Evalue(666), (w != null) ? w.Evalue(666) : 0);
			if (dist <= 1 || dist <= num) // [!code --]
			if (!UseWeaponDist || dist <= 1 || dist <= num) // [!code ++]
			{
				if (w != null)
				{
```

## +ActMeleeSwarm

::: details File Created
```cs
public class ActMeleeSwarm : ActMelee
{
	public override bool UseWeaponDist => false;

	public override int PerformDistance => 99;
}
```

:::
## +ActSwarm

::: details File Created
```cs
using System.Linq;

public class ActSwarm : Ability
{
	public override bool CanPerform()
	{
		if (Act.TC == null || !Act.CC.IsHostile(Act.TC.Chara))
		{
			return false;
		}
		return base.CanPerform();
	}

	public override bool Perform()
	{
		float num = 0f;
		foreach (Chara item in EClass._map.charas.ToList())
		{
			if (!Act.CC.IsAliveInCurrentZone)
			{
				break;
			}
			if (item.IsAliveInCurrentZone && item != Act.CC && item.IsHostile(Act.CC) && Act.CC.CanSeeLos(item))
			{
				Point pos = item.pos;
				TweenUtil.Delay(num, delegate
				{
					pos.PlayEffect("ab_swarm");
					pos.PlaySound("ab_swarm");
				});
				if (num < 1f)
				{
					num += 0.07f;
				}
				new ActMeleeSwarm().Perform(Act.CC, item);
			}
		}
		return true;
	}
}
```

:::
## BaseTileMap

[`@@ -1096,7 +1096,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1096-L1102)
```cs:line-numbers=1096
		this.tileType = row.tileType;
		param.mat = row2;
		param.dir = this.cell._roofBlockDir % 4;
		param.snow = isSnowCovered; // [!code --]
		param.snow = isSnowCovered && !this.cell.isClearSnow; // [!code ++]
		orgX = param.x;
		orgY = param.y;
		orgZ = param.z;
```

[`@@ -1183,7 +1183,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1183-L1189)
```cs:line-numbers=1183
	bool flag4 = this.cell.isSurrounded && innerMode != 0 && sourceBlock.tileType.IsFullBlock;
	if (!(!isSeen || flag4))
	{
		goto IL_1668; // [!code --]
		goto IL_167b; // [!code ++]
	}
	bool isRoomEdge = this.cell.IsRoomEdge;
	orgY = param.y;
```

[`@@ -1245,7 +1245,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1245-L1251)
```cs:line-numbers=1245
	{
		if (isRoomEdge)
		{
			goto IL_1668; // [!code --]
			goto IL_167b; // [!code ++]
		}
		if (detail == null || !EMono.pc.hasTelepathy)
		{
```

[`@@ -1256,8 +1256,441 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1256-L1263)
```cs:line-numbers=1256
			fogged = true;
		}
	}
	goto IL_7b6d; // [!code --]
	IL_6fb2: // [!code --]
	goto IL_7b80; // [!code ++]
	IL_7b80: // [!code ++]
	if (detail.things.Count == 0 && detail.charas.Count == 0) // [!code ++]
	{ // [!code ++]
		return; // [!code ++]
	} // [!code ++]
	int num3 = 0; // [!code ++]
	thingPos.x = 0f; // [!code ++]
	thingPos.y = 0f; // [!code ++]
	thingPos.z = 0f; // [!code ++]
	freePos.x = (freePos.y = (freePos.z = 0f)); // [!code ++]
	if (this.cell.HasRamp) // [!code ++]
	{ // [!code ++]
		Vector3 rampFix = sourceBlock.tileType.GetRampFix(this.cell.blockDir); // [!code ++]
		param.x += rampFix.x; // [!code ++]
		param.y += rampFix.y; // [!code ++]
		param.z += rampFix.z; // [!code ++]
		freePos.x += rampFix.x; // [!code ++]
		freePos.y += rampFix.y; // [!code ++]
		freePos.z += rampFix.z; // [!code ++]
	} // [!code ++]
	param.y += (flag ? 0f : ((this.cell._bridge != 0) ? this.cell.sourceBridge.tileType.FloorHeight : sourceFloor.tileType.FloorHeight)); // [!code ++]
	orgPos.x = (orgX = param.x); // [!code ++]
	orgPos.y = (orgY = param.y); // [!code ++]
	orgPos.z = (orgZ = param.z); // [!code ++]
	if (flag && liquidLv > 0) // [!code ++]
	{ // [!code ++]
		if (liquidLv > 10) // [!code ++]
		{ // [!code ++]
			liquidLv = TileType.FloorWaterShallow.LiquidLV * 10; // [!code ++]
		} // [!code ++]
		liquidLv -= (int)(floatY * 0.5f); // [!code ++]
		param.liquidLv = liquidLv; // [!code ++]
		param.y -= TileType.FloorWaterShallow.FloorHeight; // [!code ++]
	} // [!code ++]
	Thing thing = null; // [!code ++]
	bool shadow = liquidLv == 0; // [!code ++]
	float num4 = 0f; // [!code ++]
	float num5 = 0f; // [!code ++]
	bool flag6 = false; // [!code ++]
	float num6 = 0f; // [!code ++]
	bool flag7 = false; // [!code ++]
	float num7 = 0f; // [!code ++]
	if (detail.things.Count > 0 && isSeen) // [!code ++]
	{ // [!code ++]
		_ = zSetting.max1; // [!code ++]
		float num8 = 0f; // [!code ++]
		for (int j = 0; j < detail.things.Count; j++) // [!code ++]
		{ // [!code ++]
			Thing t = detail.things[j]; // [!code ++]
			if ((fogged && !t.isRoofItem) || ((t.isHidden || t.trait.HideInAdv || t.isMasked) && !EMono.scene.actionMode.ShowMaskedThings) || (t.isRoofItem && ((this.room == null && !sourceBlock.tileType.IsFullBlock && !EMono._zone.IsPCFaction) || (lowBlock && !showFullWall && this.room != null) || (noRoofMode && currentRoom == null))) || (flag3 && !t.isRoofItem)) // [!code ++]
			{ // [!code ++]
				continue; // [!code ++]
			} // [!code ++]
			TileType tileType = t.trait.tileType; // [!code ++]
			bool isInstalled = t.IsInstalled; // [!code ++]
			SourcePref pref = t.Pref; // [!code ++]
			if (!isInstalled && t.category.tileDummy != 0) // [!code ++]
			{ // [!code ++]
				pref = rendererObjDummy.shadowPref; // [!code ++]
			} // [!code ++]
			float num9 = ((tileType.UseMountHeight && isInstalled) ? 0f : ((pref.height < 0f) ? 0f : ((pref.height == 0f) ? 0.1f : pref.height))); // [!code ++]
			if (t.ignoreStackHeight) // [!code ++]
			{ // [!code ++]
				thingPos.y -= num4; // [!code ++]
			} // [!code ++]
			shadow = thingPos.y < 0.16f && num7 < 0.16f; // [!code ++]
			_ = pref.bypassShadow; // [!code ++]
			param.shadowFix = 0f - thingPos.y; // [!code ++]
			param.liquidLv = ((thingPos.y + (float)t.altitude < 0.1f) ? liquidLv : 0); // [!code ++]
			if (t.isRoofItem) // [!code ++]
			{ // [!code ++]
				param.snow = isSnowCovered && !this.cell.isClearSnow; // [!code ++]
				SetRoofHeight(param, this.cell, cx, cz); // [!code ++]
				_actorPos.x = param.x; // [!code ++]
				_actorPos.y = param.y; // [!code ++]
				_actorPos.z = param.z + num8; // [!code ++]
				if (this.room != null) // [!code ++]
				{ // [!code ++]
					param.color = GetRoofLight(this.room.lot); // [!code ++]
				} // [!code ++]
				shadow = false; // [!code ++]
				param.liquidLv = 0; // [!code ++]
			} // [!code ++]
			else // [!code ++]
			{ // [!code ++]
				param.snow = snowed; // [!code ++]
				_actorPos.x = orgX + num5; // [!code ++]
				_actorPos.y = orgY; // [!code ++]
				_actorPos.z = orgZ + num8 + thingPos.z; // [!code ++]
				if (tileType.CanStack || !isInstalled) // [!code ++]
				{ // [!code ++]
					if (thing?.id != t.id) // [!code ++]
					{ // [!code ++]
						_actorPos.x += thingPos.x; // [!code ++]
					} // [!code ++]
					_actorPos.y += thingPos.y; // [!code ++]
					if (t.trait.IgnoreLastStackHeight && (thing == null || !thing.trait.IgnoreLastStackHeight)) // [!code ++]
					{ // [!code ++]
						thingPos.y -= num4; // [!code ++]
						if (thing != null) // [!code ++]
						{ // [!code ++]
							_actorPos.z -= 0.2f; // [!code ++]
							thingPos.z -= 0.2f; // [!code ++]
						} // [!code ++]
						_actorPos.y -= num4; // [!code ++]
					} // [!code ++]
					_actorPos.z += renderSetting.thingZ + (float)j * -0.01f + zSetting.mod1 * thingPos.y; // [!code ++]
				} // [!code ++]
				if (isInstalled) // [!code ++]
				{ // [!code ++]
					if (t.TileType.IsRamp) // [!code ++]
					{ // [!code ++]
						Vector3 rampFix2 = t.TileType.GetRampFix(t.dir, pref); // [!code ++]
						orgX += rampFix2.x; // [!code ++]
						orgY += rampFix2.y; // [!code ++]
						orgZ += rampFix2.z; // [!code ++]
						freePos.x += rampFix2.x; // [!code ++]
						freePos.y += rampFix2.y; // [!code ++]
						freePos.z += rampFix2.z; // [!code ++]
						if (!this.cell.IsTopWater || t.altitude > 0) // [!code ++]
						{ // [!code ++]
							num7 += rampFix2.y; // [!code ++]
						} // [!code ++]
						liquidLv -= (int)(rampFix2.y * 150f); // [!code ++]
						if (liquidLv < 0) // [!code ++]
						{ // [!code ++]
							liquidLv = 0; // [!code ++]
						} // [!code ++]
					} // [!code ++]
					else if (!flag7 && t.trait.IsChangeFloorHeight && !t.ignoreStackHeight) // [!code ++]
					{ // [!code ++]
						orgY += num9 + (float)t.altitude * altitudeFix.y; // [!code ++]
						orgZ += (float)t.altitude * altitudeFix.z; // [!code ++]
						freePos.y += num9 + (float)t.altitude * altitudeFix.y; // [!code ++]
						if (!this.cell.IsTopWater || t.altitude > 0) // [!code ++]
						{ // [!code ++]
							num7 += num9 + (float)t.altitude * altitudeFix.y; // [!code ++]
						} // [!code ++]
						_actorPos.x += pref.x * (float)((!t.flipX) ? 1 : (-1)); // [!code ++]
						_actorPos.z += pref.z; // [!code ++]
						thingPos.z += pref.z; // [!code ++]
						liquidLv -= (int)(num9 * 150f); // [!code ++]
						if (liquidLv < 0) // [!code ++]
						{ // [!code ++]
							liquidLv = 0; // [!code ++]
						} // [!code ++]
					} // [!code ++]
					else // [!code ++]
					{ // [!code ++]
						thingPos.y += num9; // [!code ++]
						_actorPos.x += pref.x * (float)((!t.flipX) ? 1 : (-1)); // [!code ++]
						_actorPos.z += pref.z; // [!code ++]
						if (pref.height >= 0f) // [!code ++]
						{ // [!code ++]
							thingPos.z += pref.z; // [!code ++]
						} // [!code ++]
					} // [!code ++]
					if (!tileType.UseMountHeight && j > 10) // [!code ++]
					{ // [!code ++]
						flag7 = true; // [!code ++]
					} // [!code ++]
				} // [!code ++]
				else // [!code ++]
				{ // [!code ++]
					thingPos.y += num9; // [!code ++]
					_actorPos.x += pref.x * (float)((!t.flipX) ? 1 : (-1)); // [!code ++]
					_actorPos.z += pref.z; // [!code ++]
					thingPos.z += pref.z; // [!code ++]
				} // [!code ++]
				if (t.isFloating && isWater && !hasBridge && !flag) // [!code ++]
				{ // [!code ++]
					flag = true; // [!code ++]
					float num10 = ((this.cell._bridge != 0) ? sourceBridge.tileType.FloorHeight : sourceFloor.tileType.FloorHeight); // [!code ++]
					orgY += 0.01f * floatY - num10; // [!code ++]
					num6 = num9; // [!code ++]
					_actorPos.y += 0.01f * floatY - num10; // [!code ++]
					if (liquidLv > 10) // [!code ++]
					{ // [!code ++]
						liquidLv = TileType.FloorWaterShallow.LiquidLV * 10; // [!code ++]
					} // [!code ++]
					liquidLv -= (int)(floatY * 0.5f); // [!code ++]
					if (liquidLv < 0) // [!code ++]
					{ // [!code ++]
						liquidLv = 0; // [!code ++]
					} // [!code ++]
					param.liquidLv = liquidLv; // [!code ++]
				} // [!code ++]
				num4 = num9; // [!code ++]
				if (t.sourceCard.multisize && !t.trait.IsGround) // [!code ++]
				{ // [!code ++]
					num8 += zSetting.multiZ; // [!code ++]
				} // [!code ++]
				orgZ += t.renderer.data.stackZ; // [!code ++]
				if (param.liquidLv > 0) // [!code ++]
				{ // [!code ++]
					param.liquidLv += pref.liquidMod; // [!code ++]
					if (param.liquidLv < 1) // [!code ++]
					{ // [!code ++]
						param.liquidLv = 1; // [!code ++]
					} // [!code ++]
					else if (param.liquidLv > 99 + pref.liquidModMax) // [!code ++]
					{ // [!code ++]
						param.liquidLv = 99 + pref.liquidModMax; // [!code ++]
					} // [!code ++]
				} // [!code ++]
			} // [!code ++]
			if (isInstalled && tileType.UseMountHeight) // [!code ++]
			{ // [!code ++]
				if (tileType != TileType.Illumination || !this.cell.HasObj) // [!code ++]
				{ // [!code ++]
					if (noRoofMode && currentRoom == null && t.altitude >= lowWallObjAltitude) // [!code ++]
					{ // [!code ++]
						continue; // [!code ++]
					} // [!code ++]
					if (hideHang && (this.cell.room?.lot != currentLot || (!this.cell.lotWall && this.cell.room != currentRoom))) // [!code ++]
					{ // [!code ++]
						Room room = ((t.dir == 0) ? this.cell.Back.room : this.cell.Left.room); // [!code ++]
						if (t.trait.AlwaysHideOnLowWall) // [!code ++]
						{ // [!code ++]
							if (room == null || !room.data.showWallItem) // [!code ++]
							{ // [!code ++]
								continue; // [!code ++]
							} // [!code ++]
						} // [!code ++]
						else if (t.altitude >= lowWallObjAltitude) // [!code ++]
						{ // [!code ++]
							continue; // [!code ++]
						} // [!code ++]
					} // [!code ++]
				} // [!code ++]
				if (tileType.UseHangZFix) // [!code ++]
				{ // [!code ++]
					flag6 = true; // [!code ++]
				} // [!code ++]
				tileType.GetMountHeight(ref _actorPos, Point.shared.Set(index), t.dir, t); // [!code ++]
				shadow = false; // [!code ++]
				param.liquidLv = 0; // [!code ++]
				if (t.freePos) // [!code ++]
				{ // [!code ++]
					_actorPos.x += t.fx; // [!code ++]
					_actorPos.y += t.fy; // [!code ++]
				} // [!code ++]
			} // [!code ++]
			else // [!code ++]
			{ // [!code ++]
				if (t.altitude != 0) // [!code ++]
				{ // [!code ++]
					_actorPos += altitudeFix * t.altitude; // [!code ++]
					if (t.altitude > 2 && ((this.cell.Back.room != null && this.cell.Back.IsRoomEdge) || (this.cell.Left.room != null && this.cell.Left.IsRoomEdge)) && hideHang && (this.cell.room?.lot != currentLot || (!this.cell.lotWall && this.cell.room != currentRoom))) // [!code ++]
					{ // [!code ++]
						continue; // [!code ++]
					} // [!code ++]
				} // [!code ++]
				if (t.freePos) // [!code ++]
				{ // [!code ++]
					_actorPos.x = orgX + t.fx - freePos.x; // [!code ++]
					_actorPos.y = orgY + t.fy - freePos.y; // [!code ++]
				} // [!code ++]
				if (t.trait is TraitDoor && (t.trait as TraitDoor).IsOpen()) // [!code ++]
				{ // [!code ++]
					_actorPos.z += -0.5f; // [!code ++]
				} // [!code ++]
			} // [!code ++]
			if (!t.sourceCard.multisize || (t.pos.x == cx && t.pos.z == cz)) // [!code ++]
			{ // [!code ++]
				if (iconMode != 0) // [!code ++]
				{ // [!code ++]
					int num11 = 0; // [!code ++]
					switch (iconMode) // [!code ++]
					{ // [!code ++]
					case CardIconMode.Visibility: // [!code ++]
						if (t.isMasked) // [!code ++]
						{ // [!code ++]
							num11 = 17; // [!code ++]
						} // [!code ++]
						break; // [!code ++]
					case CardIconMode.State: // [!code ++]
						if (t.placeState == PlaceState.installed) // [!code ++]
						{ // [!code ++]
							num11 = 18; // [!code ++]
						} // [!code ++]
						break; // [!code ++]
					case CardIconMode.Deconstruct: // [!code ++]
						if (t.isDeconstructing) // [!code ++]
						{ // [!code ++]
							num11 = 14; // [!code ++]
						} // [!code ++]
						break; // [!code ++]
					} // [!code ++]
					if (t.isNPCProperty && !EMono.debug.godBuild) // [!code ++]
					{ // [!code ++]
						num11 = 13; // [!code ++]
					} // [!code ++]
					if (num11 != 0) // [!code ++]
					{ // [!code ++]
						passGuideBlock.Add(_actorPos.x, _actorPos.y, _actorPos.z - 10f, num11); // [!code ++]
					} // [!code ++]
				} // [!code ++]
				t.SetRenderParam(param); // [!code ++]
				if (_lowblock && t.trait.UseLowblock && !this.cell.HasFullBlock) // [!code ++]
				{ // [!code ++]
					param.tile += ((param.tile < 0f) ? (-64) : 64); // [!code ++]
				} // [!code ++]
				if (t.trait is TraitTrolley && EMono.pc.ai is AI_Trolley aI_Trolley && aI_Trolley.trolley.owner == t) // [!code ++]
				{ // [!code ++]
					RenderParam _param = new RenderParam(param); // [!code ++]
					EMono.core.actionsLateUpdate.Add(delegate // [!code ++]
					{ // [!code ++]
						t.SetRenderParam(_param); // [!code ++]
						_actorPos.x = EMono.pc.renderer.position.x; // [!code ++]
						_actorPos.y = EMono.pc.renderer.position.y - pref.height; // [!code ++]
						_actorPos.z = EMono.pc.renderer.position.z + 0.02f; // [!code ++]
						t.renderer.Draw(_param, ref _actorPos, !t.noShadow && (shadow || tileType.AlwaysShowShadow)); // [!code ++]
					}); // [!code ++]
				} // [!code ++]
				else // [!code ++]
				{ // [!code ++]
					t.renderer.Draw(param, ref _actorPos, !t.noShadow && (shadow || tileType.AlwaysShowShadow)); // [!code ++]
				} // [!code ++]
			} // [!code ++]
			if (isInstalled) // [!code ++]
			{ // [!code ++]
				num5 += pref.stackX * (float)((!t.flipX) ? 1 : (-1)); // [!code ++]
			} // [!code ++]
			param.x = orgX; // [!code ++]
			param.y = orgY; // [!code ++]
			param.z = orgZ; // [!code ++]
			param.color = floorLight; // [!code ++]
			thing = t; // [!code ++]
			if (pref.Float) // [!code ++]
			{ // [!code ++]
				liquidLv = 0; // [!code ++]
			} // [!code ++]
		} // [!code ++]
	} // [!code ++]
	orgY += num6; // [!code ++]
	if (detail.charas.Count <= 0) // [!code ++]
	{ // [!code ++]
		return; // [!code ++]
	} // [!code ++]
	param.shadowFix = 0f - num7; // [!code ++]
	param.color += 1310720f; // [!code ++]
	float max = zSetting.max2; // [!code ++]
	for (int k = 0; k < detail.charas.Count; k++) // [!code ++]
	{ // [!code ++]
		Chara chara = detail.charas[k]; // [!code ++]
		if (chara.host != null || (chara != EMono.pc && chara != LayerDrama.alwaysVisible && (flag3 || fogged || (!showAllCards && !EMono.player.CanSee(chara))))) // [!code ++]
		{ // [!code ++]
			continue; // [!code ++]
		} // [!code ++]
		_actorPos.x = orgX; // [!code ++]
		_actorPos.y = orgY; // [!code ++]
		_actorPos.z = orgZ; // [!code ++]
		chara.SetRenderParam(param); // [!code ++]
		_ = chara.IsAliveInCurrentZone; // [!code ++]
		if (chara.isRestrained) // [!code ++]
		{ // [!code ++]
			TraitShackle restrainer = chara.GetRestrainer(); // [!code ++]
			if (restrainer != null) // [!code ++]
			{ // [!code ++]
				Vector3 getRestrainPos = restrainer.GetRestrainPos; // [!code ++]
				if (getRestrainPos != default(Vector3)) // [!code ++]
				{ // [!code ++]
					Vector3 position = restrainer.owner.renderer.position; // [!code ++]
					float defCharaHeight = EMono.setting.render.defCharaHeight; // [!code ++]
					float num12 = getRestrainPos.y + defCharaHeight - ((chara.Pref.height == 0f) ? defCharaHeight : chara.source.pref.height); // [!code ++]
					_actorPos.x = position.x + getRestrainPos.x * (float)((restrainer.owner.dir % 2 == 0) ? 1 : (-1)); // [!code ++]
					_actorPos.y = position.y + num12; // [!code ++]
					_actorPos.z = position.z + getRestrainPos.z; // [!code ++]
					param.liquidLv = 0; // [!code ++]
					param.shadowFix = orgY - _actorPos.y; // [!code ++]
					chara.renderer.SetFirst(first: true); // [!code ++]
					chara.renderer.Draw(param, ref _actorPos, drawShadow: true); // [!code ++]
					param.shadowFix = 0f; // [!code ++]
					continue; // [!code ++]
				} // [!code ++]
			} // [!code ++]
		} // [!code ++]
		if (!chara.sourceCard.multisize || (chara.pos.x == cx && chara.pos.z == cz)) // [!code ++]
		{ // [!code ++]
			if (chara.IsDeadOrSleeping && chara.IsPCC) // [!code ++]
			{ // [!code ++]
				float num13 = chara.renderer.data.size.y * 0.3f; // [!code ++]
				if (thingPos.y > max) // [!code ++]
				{ // [!code ++]
					thingPos.y = max; // [!code ++]
				} // [!code ++]
				float num14 = thingPos.y + num13; // [!code ++]
				float num15 = (float)k * -0.01f; // [!code ++]
				if (num14 > zSetting.thresh1) // [!code ++]
				{ // [!code ++]
					num15 = zSetting.mod1; // [!code ++]
				} // [!code ++]
				_actorPos.x += thingPos.x; // [!code ++]
				_actorPos.y += thingPos.y; // [!code ++]
				_actorPos.z += renderSetting.laydownZ + num15; // [!code ++]
				param.liquidLv = ((thingPos.y == 0f && liquidLv > 0) ? 90 : 0); // [!code ++]
				thingPos.y += num13 * 0.8f; // [!code ++]
				chara.renderer.Draw(param, ref _actorPos, liquidLv == 0); // [!code ++]
			} // [!code ++]
			else // [!code ++]
			{ // [!code ++]
				param.liquidLv = liquidLv; // [!code ++]
				if (param.liquidLv > 0) // [!code ++]
				{ // [!code ++]
					param.liquidLv += chara.Pref.liquidMod; // [!code ++]
					if (param.liquidLv < 1) // [!code ++]
					{ // [!code ++]
						param.liquidLv = 1; // [!code ++]
					} // [!code ++]
					else if (param.liquidLv > 99 + chara.Pref.liquidModMax) // [!code ++]
					{ // [!code ++]
						param.liquidLv = 99 + chara.Pref.liquidModMax; // [!code ++]
					} // [!code ++]
				} // [!code ++]
				if (!chara.IsPC && !chara.renderer.IsMoving && detail.charas.Count > 1 && (detail.charas.Count != 2 || !detail.charas[0].IsDeadOrSleeping || !detail.charas[0].IsPCC)) // [!code ++]
				{ // [!code ++]
					_actorPos += renderSetting.charaPos[1 + ((num3 < 4) ? num3 : 3)]; // [!code ++]
				} // [!code ++]
				_actorPos.z += 0.01f * (float)k + renderSetting.charaZ; // [!code ++]
				num3++; // [!code ++]
				if (flag6) // [!code ++]
				{ // [!code ++]
					_actorPos.z += chara.renderer.data.hangedFixZ; // [!code ++]
				} // [!code ++]
				chara.renderer.Draw(param, ref _actorPos, liquidLv == 0); // [!code ++]
			} // [!code ++]
		} // [!code ++]
		param.x = orgX; // [!code ++]
		param.y = orgY; // [!code ++]
		param.z = orgZ; // [!code ++]
	} // [!code ++]
	return; // [!code ++]
	IL_6fc5: // [!code ++]
	if (isSnowCovered && (sourceBlock.id != 0 || this.cell.hasDoor) && !snowed && !this.cell.isClearSnow && ((!this.cell.Front.HasRoof && !this.cell.Front.HasBlock) || (!this.cell.Right.HasRoof && !this.cell.Right.HasBlock)))
	{
		snowed = true;
```

[`@@ -1282,16 +1715,16 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1282-L1297)
```cs:line-numbers=1282
			{
				if (sourceEffect2.anime.Length > 2)
				{
					float num3 = Time.realtimeSinceStartup * 1000f / (float)sourceEffect2.anime[1] % (float)sourceEffect2.anime[2]; // [!code --]
					if (!(num3 >= (float)sourceEffect2.anime[0])) // [!code --]
					float num16 = Time.realtimeSinceStartup * 1000f / (float)sourceEffect2.anime[1] % (float)sourceEffect2.anime[2]; // [!code ++]
					if (!(num16 >= (float)sourceEffect2.anime[0])) // [!code ++]
					{
						param.tile += num3; // [!code --]
						param.tile += num16; // [!code ++]
					}
				}
				else
				{
					float num4 = Time.realtimeSinceStartup * 1000f / (float)sourceEffect2.anime[1] % (float)sourceEffect2.anime[0]; // [!code --]
					param.tile += num4; // [!code --]
					float num17 = Time.realtimeSinceStartup * 1000f / (float)sourceEffect2.anime[1] % (float)sourceEffect2.anime[0]; // [!code ++]
					param.tile += num17; // [!code ++]
				}
			}
			if (this.cell.effect.IsFire)
```

[`@@ -1480,11 +1913,19 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1480-L1490)
```cs:line-numbers=1480
		param.matColor = 104025f;
		renderFootmark.Draw(param);
	}
	goto IL_7b6d; // [!code --]
	IL_1668: // [!code --]
	goto IL_7b80; // [!code ++]
	IL_6f65: // [!code ++]
	int num18; // [!code ++]
	if (!showRoof || !roof || this.cell.room == null || this.cell.Front.room == null || this.cell.Right.room == null) // [!code ++]
	{ // [!code ++]
		param.tile = num18; // [!code ++]
		rendererFov.Draw(param); // [!code ++]
	} // [!code ++]
	goto IL_6fc5; // [!code ++]
	IL_167b: // [!code ++]
	if (this.cell.isSlopeEdge)
	{
		float num5 = (float)height * _heightMod.y; // [!code --]
		float num19 = (float)height * _heightMod.y; // [!code ++]
		orgY = param.y;
		orgZ = param.z;
		param.dir = this.cell.blockDir;
```

[`@@ -1514,17 +1955,17 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1514-L1530)
```cs:line-numbers=1514
				param.matColor = 104025f;
			}
		}
		for (int j = 0; (float)j < num5 / heightBlockSize; j++) // [!code --]
		for (int l = 0; (float)l < num19 / heightBlockSize; l++) // [!code ++]
		{
			param.y += ugFix.y;
			param.z += ugFix.z + slopeFixZ * (float)j; // [!code --]
			param.z += ugFix.z + slopeFixZ * (float)l; // [!code ++]
			defBlock.renderData.Draw(param);
			if (this.cell.pcSync && EMono.player.lightPower > 0f)
			{
				float num6 = param.tile; // [!code --]
				float num20 = param.tile; // [!code ++]
				param.tile = 0f;
				rendererFov.Draw(param);
				param.tile = num6; // [!code --]
				param.tile = num20; // [!code ++]
			}
		}
		param.y = orgY;
```

[`@@ -1535,29 +1976,29 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1535-L1563)
```cs:line-numbers=1535
	{
		orgY = param.y;
		orgZ = param.z;
		int num7 = 0; // [!code --]
		int num21 = 0; // [!code ++]
		if (sourceBlock.tileType.IsFullBlock)
		{
			SourceBlock.Row row3 = sourceBlock;
			num7 = sourceBlock._tiles[this.cell.blockDir % sourceBlock._tiles.Length]; // [!code --]
			num21 = sourceBlock._tiles[this.cell.blockDir % sourceBlock._tiles.Length]; // [!code ++]
		}
		else
		{
			SourceBlock.Row row3 = sourceFloor._defBlock;
			num7 = row3._tiles[this.cell.blockDir % row3._tiles.Length]; // [!code --]
			num21 = row3._tiles[this.cell.blockDir % row3._tiles.Length]; // [!code ++]
		}
		if (((this.cell.Front.shore / 12) & 1) == 0 && this.cell.Front.sourceFloor.tileType.IsWater && this.cell.Front.height <= height && this.cell.Front.sourceBlock.tileType.RenderWaterBlock)
		{
			param.y = (float)(cz - cx) * screen.tileAlign.y - (this.cell.Front.sourceFloor.tileType.IsDeepWater ? 0.6f : 0.4f) + (float)(int)this.cell.Front.height * _heightMod.y;
			param.z = 1000f + param.x * screen.tileWeight.x + param.y * screen.tileWeight.z;
			param.tile = num7 + ((!this.cell.Front.sourceFloor.tileType.IsDeepWater) ? 3000000 : 0); // [!code --]
			param.tile = num21 + ((!this.cell.Front.sourceFloor.tileType.IsDeepWater) ? 3000000 : 0); // [!code ++]
			rendererWaterBlock.Draw(param);
		}
		if (((this.cell.Right.shore / 12) & 8) == 0 && this.cell.Right.sourceFloor.tileType.IsWater && this.cell.Right.height <= height && this.cell.Right.sourceBlock.tileType.RenderWaterBlock)
		{
			param.y = (float)(cz - cx) * screen.tileAlign.y - (this.cell.Right.sourceFloor.tileType.IsDeepWater ? 0.6f : 0.4f) + (float)(int)this.cell.Right.height * _heightMod.y;
			param.z = 1000f + param.x * screen.tileWeight.x + param.y * screen.tileWeight.z;
			param.tile = num7 + ((!this.cell.Right.sourceFloor.tileType.IsDeepWater) ? 3000000 : 0); // [!code --]
			param.tile = num21 + ((!this.cell.Right.sourceFloor.tileType.IsDeepWater) ? 3000000 : 0); // [!code ++]
			rendererWaterBlock.Draw(param);
		}
		param.y = orgY;
```

[`@@ -1598,10 +2039,10 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1598-L1607)
```cs:line-numbers=1598
		{
			param.matColor = 104025f;
		}
		for (int k = 0; k < ((!this.cell.isSkyFloor) ? 1 : EMono._map.config.skyBlockHeight); k++) // [!code --]
		for (int m = 0; m < ((!this.cell.isSkyFloor) ? 1 : EMono._map.config.skyBlockHeight); m++) // [!code ++]
		{
			param.y += ugFix.y;
			param.z += ugFix.z + slopeFixZ * (float)k; // [!code --]
			param.z += ugFix.z + slopeFixZ * (float)m; // [!code ++]
			defBlock2.renderData.Draw(param);
		}
		param.y = orgY;
```

[`@@ -1655,20 +2096,20 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1655-L1674)
```cs:line-numbers=1655
				}
				sourceFloor.renderData.Draw(param);
			}
			int num8 = 0; // [!code --]
			int num22 = 0; // [!code ++]
			if (isSnowCovered && sourceFloor == FLOOR.sourceSnow && !this.cell.hasDoor)
			{
				if (!this.cell.Right.IsSnowTile && this.cell.Right.topHeight == this.cell.topHeight)
				{
					num8++; // [!code --]
					num22++; // [!code ++]
				}
				if (!this.cell.Front.IsSnowTile && this.cell.Front.topHeight == this.cell.topHeight)
				{
					num8 += 2; // [!code --]
					num22 += 2; // [!code ++]
				}
				if (num8 != 0) // [!code --]
				if (num22 != 0) // [!code ++]
				{
					param.tile = 448 + num8 + 12; // [!code --]
					param.tile = 448 + num22 + 12; // [!code ++]
					param.z -= 0.1f;
					sourceFloor.renderData.Draw(param);
					param.z += 0.1f;
```

[`@@ -1739,7 +2180,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1739-L1745)
```cs:line-numbers=1739
					}
				}
			}
			if (this.cell.autotile != 0 && sourceFloor.autotile != 0 && (!hasBridge || this.cell.bridgeHeight - this.cell.height > 3) && !this.cell.skipRender && num8 == 0) // [!code --]
			if (this.cell.autotile != 0 && sourceFloor.autotile != 0 && (!hasBridge || this.cell.bridgeHeight - this.cell.height > 3) && !this.cell.skipRender && num22 == 0) // [!code ++]
			{
				pass = (isWater ? passAutoTileWater : passAutoTile);
				batch = pass.batches[pass.batchIdx];
```

[`@@ -1758,16 +2199,16 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1758-L1773)
```cs:line-numbers=1758
		}
		if (isWater)
		{
			int num9 = 12; // [!code --]
			int num10 = this.cell.shore / num9; // [!code --]
			int num11 = this.cell.shore % num9; // [!code --]
			int num23 = 12; // [!code ++]
			int num24 = this.cell.shore / num23; // [!code ++]
			int num25 = this.cell.shore % num23; // [!code ++]
			bool isShoreSand = this.cell.isShoreSand;
			if (this.cell.shore != 0)
			{
				Cell cell = ((((uint)num10 & (true ? 1u : 0u)) != 0) ? this.cell.Back : ((((uint)num10 & 2u) != 0) ? this.cell.Right : ((((uint)num10 & 4u) != 0) ? this.cell.Front : this.cell.Left))); // [!code --]
				Cell cell = ((((uint)num24 & (true ? 1u : 0u)) != 0) ? this.cell.Back : ((((uint)num24 & 2u) != 0) ? this.cell.Right : ((((uint)num24 & 4u) != 0) ? this.cell.Front : this.cell.Left))); // [!code ++]
				if (isShoreSand && !cell.sourceFloor.isBeach)
				{
					cell = ((((uint)num10 & 8u) != 0) ? this.cell.Left : ((((uint)num10 & 4u) != 0) ? this.cell.Front : ((((uint)num10 & 2u) != 0) ? this.cell.Right : this.cell.Back))); // [!code --]
					cell = ((((uint)num24 & 8u) != 0) ? this.cell.Left : ((((uint)num24 & 4u) != 0) ? this.cell.Front : ((((uint)num24 & 2u) != 0) ? this.cell.Right : this.cell.Back))); // [!code ++]
				}
				if (!cell.IsSnowTile)
				{
```

[`@@ -1779,7 +2220,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1779-L1785)
```cs:line-numbers=1779
						batch.matrices[pass.idx].m03 = param.x;
						batch.matrices[pass.idx].m13 = param.y;
						batch.matrices[pass.idx].m23 = param.z;
						batch.tiles[pass.idx] = 768 + this.cell.shore / num9; // [!code --]
						batch.tiles[pass.idx] = 768 + this.cell.shore / num23; // [!code ++]
						batch.colors[pass.idx] = param.color;
						batch.matColors[pass.idx] = param.matColor;
						pass.idx++;
```

[`@@ -1787,38 +2228,38 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1787-L1824)
```cs:line-numbers=1787
						{
							pass.NextBatch();
						}
						num11 = 2; // [!code --]
						num25 = 2; // [!code ++]
					}
					else
					{
						num11 = cell.sourceFloor.edge; // [!code --]
						num25 = cell.sourceFloor.edge; // [!code ++]
					}
					param.tile = (24 + num11 / 2) * 32 + num11 % 2 * 16 + num10; // [!code --]
					param.tile = (24 + num25 / 2) * 32 + num25 % 2 * 16 + num24; // [!code ++]
					rendererShore.Draw(param);
				}
			}
			if (this.cell.Back.isShoreSand && ((uint)(this.cell.Back.shore / num9) & 8u) != 0 && this.cell.Left.isShoreSand && ((uint)(this.cell.Left.shore / num9) & (true ? 1u : 0u)) != 0) // [!code --]
			if (this.cell.Back.isShoreSand && ((uint)(this.cell.Back.shore / num23) & 8u) != 0 && this.cell.Left.isShoreSand && ((uint)(this.cell.Left.shore / num23) & (true ? 1u : 0u)) != 0) // [!code ++]
			{
				param.tile = 785f;
				param.matColor = GetColorInt(ref this.cell.BackLeft.matFloor.matColor, this.cell.BackLeft.sourceFloor.colorMod);
				passShore.Add(param);
				Draw(60);
			}
			if (this.cell.Back.isShoreSand && ((uint)(this.cell.Back.shore / num9) & 2u) != 0 && this.cell.Right.isShoreSand && ((uint)(this.cell.Right.shore / num9) & (true ? 1u : 0u)) != 0) // [!code --]
			if (this.cell.Back.isShoreSand && ((uint)(this.cell.Back.shore / num23) & 2u) != 0 && this.cell.Right.isShoreSand && ((uint)(this.cell.Right.shore / num23) & (true ? 1u : 0u)) != 0) // [!code ++]
			{
				param.tile = 786f;
				param.matColor = GetColorInt(ref this.cell.BackRight.matFloor.matColor, this.cell.BackRight.sourceFloor.colorMod);
				passShore.Add(param);
				Draw(56);
			}
			if (this.cell.Front.isShoreSand && ((uint)(this.cell.Front.shore / num9) & 2u) != 0 && this.cell.Right.isShoreSand && ((uint)(this.cell.Right.shore / num9) & 4u) != 0) // [!code --]
			if (this.cell.Front.isShoreSand && ((uint)(this.cell.Front.shore / num23) & 2u) != 0 && this.cell.Right.isShoreSand && ((uint)(this.cell.Right.shore / num23) & 4u) != 0) // [!code ++]
			{
				param.tile = 787f;
				param.matColor = GetColorInt(ref this.cell.FrontRight.matFloor.matColor, this.cell.FrontRight.sourceFloor.colorMod);
				passShore.Add(param);
				Draw(48);
			}
			if (this.cell.Front.isShoreSand && ((uint)(this.cell.Front.shore / num9) & 8u) != 0 && this.cell.Left.isShoreSand && ((uint)(this.cell.Left.shore / num9) & 4u) != 0) // [!code --]
			if (this.cell.Front.isShoreSand && ((uint)(this.cell.Front.shore / num23) & 8u) != 0 && this.cell.Left.isShoreSand && ((uint)(this.cell.Left.shore / num23) & 4u) != 0) // [!code ++]
			{
				param.tile = 788f;
				param.matColor = GetColorInt(ref this.cell.FrontLeft.matFloor.matColor, this.cell.FrontLeft.sourceFloor.colorMod);
```

[`@@ -1841,48 +2282,48 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1841-L1888)
```cs:line-numbers=1841
					pass.NextBatch();
				}
			}
			bool flag6 = false; // [!code --]
			bool flag8 = false; // [!code ++]
			if (isShoreSand)
			{
				if (((uint)num10 & (true ? 1u : 0u)) != 0) // [!code --]
				if (((uint)num24 & (true ? 1u : 0u)) != 0) // [!code ++]
				{
					if (((uint)num10 & 8u) != 0) // [!code --]
					if (((uint)num24 & 8u) != 0) // [!code ++]
					{
						if ((num10 & 2) == 0 && (num10 & 4) == 0) // [!code --]
						if ((num24 & 2) == 0 && (num24 & 4) == 0) // [!code ++]
						{
							Draw(16);
						}
						flag6 = true; // [!code --]
						flag8 = true; // [!code ++]
					}
					if (((uint)num10 & 2u) != 0) // [!code --]
					if (((uint)num24 & 2u) != 0) // [!code ++]
					{
						if ((num10 & 8) == 0 && (num10 & 4) == 0) // [!code --]
						if ((num24 & 8) == 0 && (num24 & 4) == 0) // [!code ++]
						{
							Draw(20);
						}
						flag6 = true; // [!code --]
						flag8 = true; // [!code ++]
					}
				}
				if (((uint)num10 & 4u) != 0) // [!code --]
				if (((uint)num24 & 4u) != 0) // [!code ++]
				{
					if (((uint)num10 & 8u) != 0) // [!code --]
					if (((uint)num24 & 8u) != 0) // [!code ++]
					{
						if ((num10 & 2) == 0 && (num10 & 1) == 0) // [!code --]
						if ((num24 & 2) == 0 && (num24 & 1) == 0) // [!code ++]
						{
							Draw(24);
						}
						flag6 = true; // [!code --]
						flag8 = true; // [!code ++]
					}
					if (((uint)num10 & 2u) != 0) // [!code --]
					if (((uint)num24 & 2u) != 0) // [!code ++]
					{
						if ((num10 & 8) == 0 && (num10 & 1) == 0) // [!code --]
						if ((num24 & 8) == 0 && (num24 & 1) == 0) // [!code ++]
						{
							Draw(28);
						}
						flag6 = true; // [!code --]
						flag8 = true; // [!code ++]
					}
				}
				if (!flag6) // [!code --]
				if (!flag8) // [!code ++]
				{
					if (!this.cell.Front.sourceFloor.tileType.IsWater && !this.cell.Front.isDeck)
					{
```

[`@@ -1894,7 +2335,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1894-L1900)
```cs:line-numbers=1894
					}
				}
			}
			if (!flag6) // [!code --]
			if (!flag8) // [!code ++]
			{
				if (!this.cell.Back.sourceFloor.tileType.IsWater && !this.cell.Back.isDeck)
				{
```

[`@@ -1902,7 +2343,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1902-L1908)
```cs:line-numbers=1902
					batch = pass.batches[pass.batchIdx];
					batch.tiles[pass.idx] = 608 + waterAnimeIndex % 4;
					batch.matColors[pass.idx] = 104025f;
					if (((uint)(this.cell.shore / num9) & (true ? 1u : 0u)) != 0) // [!code --]
					if (((uint)(this.cell.shore / num23) & (true ? 1u : 0u)) != 0) // [!code ++]
					{
						if (isShoreSand)
						{
```

[`@@ -1940,7 +2381,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L1940-L1946)
```cs:line-numbers=1940
					batch = pass.batches[pass.batchIdx];
					batch.tiles[pass.idx] = 612 + waterAnimeIndex % 4;
					batch.matColors[pass.idx] = 104025f;
					if (((uint)(this.cell.shore / num9) & 8u) != 0) // [!code --]
					if (((uint)(this.cell.shore / num23) & 8u) != 0) // [!code ++]
					{
						if (isShoreSand)
						{
```

[`@@ -2056,16 +2497,16 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L2056-L2071)
```cs:line-numbers=2056
			param.z += bridgeFix.z;
			param.dir = 0;
			SourceBlock.Row row4 = sourceBridge._bridgeBlock;
			float num12 = (float)(this.cell.bridgeHeight - this.cell.height) * _heightMod.y; // [!code --]
			float num26 = (float)(this.cell.bridgeHeight - this.cell.height) * _heightMod.y; // [!code ++]
			if (this.cell.sourceFloor.tileType == TileType.Sky)
			{
				num12 += (float)EMono._map.config.skyBlockHeight; // [!code --]
				num26 += (float)EMono._map.config.skyBlockHeight; // [!code ++]
			}
			int num13 = (int)(num12 / heightBlockSize) + 2; // [!code --]
			int num27 = (int)(num26 / heightBlockSize) + 2; // [!code ++]
			if (this.cell.bridgePillar != 0)
			{
				row4 = EMono.sources.blocks.rows[this.cell.bridgePillar];
				param.tile = row4._tiles[0] + ((num13 == 2) ? 32 : 0); // [!code --]
				param.tile = row4._tiles[0] + ((num27 == 2) ? 32 : 0); // [!code ++]
				param.mat = ((sourceBridge.DefaultMaterial == row4.DefaultMaterial) ? sourceBridge.DefaultMaterial : row4.DefaultMaterial);
				param.matColor = ((row4.colorMod == 0) ? 104025 : GetColorInt(ref param.mat.matColor, row4.colorMod));
			}
```

[`@@ -2077,9 +2518,9 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L2077-L2085)
```cs:line-numbers=2077
			}
			param.y += ugFixBridgeTop.y;
			param.z += ugFixBridgeTop.z;
			for (int l = 0; l < num13; l++) // [!code --]
			for (int n = 0; n < num27; n++) // [!code ++]
			{
				if (l == num13 - 1) // [!code --]
				if (n == num27 - 1) // [!code ++]
				{
					param.y = (float)(cz - cx) * screen.tileAlign.y + (float)height * _heightMod.y + ugFixBridgeBottom.y;
					param.z = 1000f + param.x * screen.tileWeight.x + param.y * screen.tileWeight.z + (float)height * _heightMod.z + ugFixBridgeBottom.z;
```

[`@@ -2111,13 +2552,13 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L2111-L2123)
```cs:line-numbers=2111
	{
		snowed = false;
	}
	int num14 = 0; // [!code --]
	num18 = 0; // [!code ++]
	if (sourceBlock.id != 0)
	{
		this.tileType = sourceBlock.tileType;
		roomHeight = 0f;
		int blockDir = this.cell.blockDir;
		bool flag7 = false; // [!code --]
		bool flag9 = false; // [!code ++]
		switch (wallClipMode)
		{
		case WallClipMode.ByRoom:
```

[`@@ -2161,8 +2602,8 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L2161-L2168)
```cs:line-numbers=2161
					}
				}
			}
			flag7 = (this.room != null && this.room.data.atrium) || (this.cell.room != null && this.cell.room.data.atrium); // [!code --]
			if (flag7) // [!code --]
			flag9 = (this.room != null && this.room.data.atrium) || (this.cell.room != null && this.cell.room.data.atrium); // [!code ++]
			if (flag9) // [!code ++]
			{
				_lowblock = false;
			}
```

[`@@ -2184,8 +2625,8 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L2184-L2191)
```cs:line-numbers=2184
					roomHeight = 0f;
					break;
				}
				int num15 = ((this.room.data.maxHeight == 0) ? 2 : this.room.data.maxHeight); // [!code --]
				roomHeight = EMono.setting.render.roomHeightMod * (float)((this.room.lot.height < num15) ? this.room.lot.height : num15) + 0.01f * (float)this.room.lot.heightFix; // [!code --]
				int num28 = ((this.room.data.maxHeight == 0) ? 2 : this.room.data.maxHeight); // [!code ++]
				roomHeight = EMono.setting.render.roomHeightMod * (float)((this.room.lot.height < num28) ? this.room.lot.height : num28) + 0.01f * (float)this.room.lot.heightFix; // [!code ++]
			}
			break;
		case WallClipMode.ByLot:
```

[`@@ -2231,11 +2672,11 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L2231-L2241)
```cs:line-numbers=2231
		}
		if (!_lowblock && (double)roomHeight > 1.2 && this.tileType.RepeatBlock)
		{
			num14 = 1; // [!code --]
			num18 = 1; // [!code ++]
		}
		else if (lowBlock)
		{
			num14 = 2; // [!code --]
			num18 = 2; // [!code ++]
		}
		param.mat = matBlock;
		param.dir = this.cell.blockDir;
```

[`@@ -2282,11 +2723,11 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L2282-L2292)
```cs:line-numbers=2282
				}
				if (!_lowblock)
				{
					int num16 = ((currentRoom.data.maxHeight == 0) ? 2 : currentRoom.data.maxHeight); // [!code --]
					roomHeight = EMono.setting.render.roomHeightMod * (float)((currentRoom.lot.height < num16) ? currentRoom.lot.height : num16) + 0.01f * (float)currentRoom.lot.heightFix; // [!code --]
					int num29 = ((currentRoom.data.maxHeight == 0) ? 2 : currentRoom.data.maxHeight); // [!code ++]
					roomHeight = EMono.setting.render.roomHeightMod * (float)((currentRoom.lot.height < num29) ? currentRoom.lot.height : num29) + 0.01f * (float)currentRoom.lot.heightFix; // [!code ++]
				}
			}
			if (flag7) // [!code --]
			if (flag9) // [!code ++]
			{
				_lowblock = (!this.cell.Front.HasFullBlock || !this.cell.Right.HasFullBlock) && (!this.cell.Front.HasFullBlock || !this.cell.Left.HasFullBlock) && (!this.cell.Back.HasFullBlock || !this.cell.Right.HasFullBlock) && (!this.cell.Back.HasFullBlock || !this.cell.Left.HasFullBlock);
				if (_lowblock)
```

[`@@ -2316,62 +2757,62 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L2316-L2377)
```cs:line-numbers=2316
			{
				sourceBlock.renderData.DrawRepeatTo(param, maxHeight, roomHeight, ref renderSetting.peakFixBlock, this.cell.hasDoor, this.cell.effect?.FireAmount ?? 0, isBlock: true);
			}
			Room room = this.cell.Front.room ?? this.cell.room; // [!code --]
			if (room == null && this.cell.Right.room != null) // [!code --]
			Room room2 = this.cell.Front.room ?? this.cell.room; // [!code ++]
			if (room2 == null && this.cell.Right.room != null) // [!code ++]
			{
				room = this.cell.Right.room; // [!code --]
				room2 = this.cell.Right.room; // [!code ++]
			}
			if (!invisible && room != null) // [!code --]
			if (!invisible && room2 != null) // [!code ++]
			{
				if (room.lot.idDeco != 0 && !this.cell.hasDoor) // [!code --]
				if (room2.lot.idDeco != 0 && !this.cell.hasDoor) // [!code ++]
				{
					param.tile = EMono.sources.blocks.rows[0].ConvertTile(1000 + room.lot.idDeco); // [!code --]
					param.matColor = room.lot.colDeco; // [!code --]
					param.tile = EMono.sources.blocks.rows[0].ConvertTile(1000 + room2.lot.idDeco); // [!code ++]
					param.matColor = room2.lot.colDeco; // [!code ++]
					float y = param.y;
					param.y += (float)room.lot.decoFix * 0.01f; // [!code --]
					param.y += (float)room2.lot.decoFix * 0.01f; // [!code ++]
					rendererWallDeco.Draw(param);
					param.y = y;
				}
				if (room.lot.idDeco2 != 0 && roomHeight != 0f && (float)room.lot.decoFix2 * 0.01f + heightLimitDeco < roomHeight + maxHeight - param.y) // [!code --]
				if (room2.lot.idDeco2 != 0 && roomHeight != 0f && (float)room2.lot.decoFix2 * 0.01f + heightLimitDeco < roomHeight + maxHeight - param.y) // [!code ++]
				{
					param.tile = EMono.sources.blocks.rows[0].ConvertTile(1000 + room.lot.idDeco2); // [!code --]
					param.matColor = room.lot.colDeco2; // [!code --]
					param.tile = EMono.sources.blocks.rows[0].ConvertTile(1000 + room2.lot.idDeco2); // [!code ++]
					param.matColor = room2.lot.colDeco2; // [!code ++]
					float y2 = param.y;
					float num17 = param.z; // [!code --]
					param.y += (float)room.lot.decoFix2 * 0.01f; // [!code --]
					param.z += (float)room.lot.decoFix2 * 0.01f * heightModDeco; // [!code --]
					float num30 = param.z; // [!code ++]
					param.y += (float)room2.lot.decoFix2 * 0.01f; // [!code ++]
					param.z += (float)room2.lot.decoFix2 * 0.01f * heightModDeco; // [!code ++]
					rendererWallDeco.Draw(param);
					param.y = y2;
					param.z = num17; // [!code --]
					param.z = num30; // [!code ++]
				}
			}
			room = this.cell.Right.room ?? this.cell.room; // [!code --]
			if (room == null && this.cell.Front.room != null) // [!code --]
			room2 = this.cell.Right.room ?? this.cell.room; // [!code ++]
			if (room2 == null && this.cell.Front.room != null) // [!code ++]
			{
				room = this.cell.Front.room; // [!code --]
				room2 = this.cell.Front.room; // [!code ++]
			}
			if (!invisible && room != null) // [!code --]
			if (!invisible && room2 != null) // [!code ++]
			{
				if (room.lot.idDeco != 0 && !this.cell.hasDoor) // [!code --]
				if (room2.lot.idDeco != 0 && !this.cell.hasDoor) // [!code ++]
				{
					param.tile = EMono.sources.blocks.rows[0].ConvertTile(1000 + room.lot.idDeco) * -1; // [!code --]
					param.matColor = room.lot.colDeco; // [!code --]
					param.tile = EMono.sources.blocks.rows[0].ConvertTile(1000 + room2.lot.idDeco) * -1; // [!code ++]
					param.matColor = room2.lot.colDeco; // [!code ++]
					float y3 = param.y;
					param.y += (float)room.lot.decoFix * 0.01f; // [!code --]
					param.y += (float)room2.lot.decoFix * 0.01f; // [!code ++]
					rendererWallDeco.Draw(param);
					param.y = y3;
				}
				if (room.lot.idDeco2 != 0 && roomHeight != 0f && (float)room.lot.decoFix2 * 0.01f + heightLimitDeco < roomHeight + maxHeight - param.y) // [!code --]
				if (room2.lot.idDeco2 != 0 && roomHeight != 0f && (float)room2.lot.decoFix2 * 0.01f + heightLimitDeco < roomHeight + maxHeight - param.y) // [!code ++]
				{
					param.tile = EMono.sources.blocks.rows[0].ConvertTile(1000 + room.lot.idDeco2) * -1; // [!code --]
					param.matColor = room.lot.colDeco2; // [!code --]
					param.tile = EMono.sources.blocks.rows[0].ConvertTile(1000 + room2.lot.idDeco2) * -1; // [!code ++]
					param.matColor = room2.lot.colDeco2; // [!code ++]
					float y4 = param.y;
					float num18 = param.z; // [!code --]
					param.y += (float)room.lot.decoFix2 * 0.01f; // [!code --]
					param.z += (float)room.lot.decoFix2 * 0.01f * heightModDeco; // [!code --]
					float num31 = param.z; // [!code ++]
					param.y += (float)room2.lot.decoFix2 * 0.01f; // [!code ++]
					param.z += (float)room2.lot.decoFix2 * 0.01f * heightModDeco; // [!code ++]
					rendererWallDeco.Draw(param);
					param.y = y4;
					param.z = num18; // [!code --]
					param.z = num31; // [!code ++]
				}
			}
			break;
```

[`@@ -2386,167 +2827,56 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L2386-L2552)
```cs:line-numbers=2386
			orgY = param.y;
			orgZ = param.z;
			param.color = (this.tileType.IsFence ? (floorLight - (float)((int)(_shadowStrength * 0.8f * 50f) * 262144)) : blockLight);
			bool flag8 = blockDir == 1 || _lowblock || flag7; // [!code --]
			bool flag9 = blockDir == 0 || _lowblock || flag7; // [!code --]
			bool flag10 = blockDir == 1 || _lowblock || flag9; // [!code ++]
			bool flag11 = blockDir == 0 || _lowblock || flag9; // [!code ++]
			if (!showFullWall && currentRoom != null)
			{
				if (!flag8) // [!code --]
				if (!flag10) // [!code ++]
				{
					if (currentRoom == this.cell.room || (this.cell.lotWall && this.cell.room?.lot == currentLot && this.cell.Front.room != currentRoom))
					{
						if (!this.cell.IsRoomEdge || (this.cell.Front.room != this.cell.room && this.cell.FrontRight.room != this.cell.room))
						{
							flag8 = true; // [!code --]
							flag10 = true; // [!code ++]
						}
					}
					else if ((!this.cell.Front.lotWall || this.cell.Front.room?.lot != currentLot) && this.cell.Front.room != currentRoom)
					{
						flag8 = true; // [!code --]
						flag10 = true; // [!code ++]
					}
				}
				if (!flag9) // [!code --]
				if (!flag11) // [!code ++]
				{
					if (currentRoom == this.cell.room || (this.cell.lotWall && this.cell.room?.lot == currentLot && this.cell.Right.room != currentRoom))
					{
						if (!this.cell.IsRoomEdge || (this.cell.Right.room != this.cell.room && this.cell.FrontRight.room != this.cell.room))
						{
							flag9 = true; // [!code --]
							flag11 = true; // [!code ++]
						}
					}
					else if ((!this.cell.Right.lotWall || this.cell.Right.room?.lot != currentLot) && this.cell.Right.room != currentRoom)
					{
						flag9 = true; // [!code --]
						flag11 = true; // [!code ++]
					}
				}
			}
			if (blockDir == 0 || blockDir == 2)
			{ // [!code --]
				param.dir = 0; // [!code --]
				Room room2 = this.cell.Front.room ?? this.cell.room; // [!code --]
				if (room2 != null && this.tileType.IsWall) // [!code --]
				{ // [!code --]
					if (room2.lot.idDeco != 0 && !this.cell.hasDoor) // [!code --]
					{ // [!code --]
						param.tile = EMono.sources.blocks.rows[0].ConvertTile(1000 + room2.lot.idDeco); // [!code --]
						param.matColor = room2.lot.colDeco; // [!code --]
						param.y += (float)room2.lot.decoFix * 0.01f; // [!code --]
						rendererWallDeco.Draw(param); // [!code --]
						param.y = orgY; // [!code --]
					} // [!code --]
					if (room2.lot.idDeco2 != 0 && roomHeight != 0f && !flag8 && (float)room2.lot.decoFix2 * 0.01f + heightLimitDeco < roomHeight + maxHeight - param.y) // [!code --]
					{ // [!code --]
						param.tile = EMono.sources.blocks.rows[0].ConvertTile(1000 + room2.lot.idDeco2); // [!code --]
						param.matColor = room2.lot.colDeco2; // [!code --]
						param.y += (float)room2.lot.decoFix2 * 0.01f; // [!code --]
						param.z += (float)room2.lot.decoFix2 * 0.01f * heightModDeco; // [!code --]
						rendererWallDeco.Draw(param); // [!code --]
						param.y = orgY; // [!code --]
						param.z = orgZ; // [!code --]
					} // [!code --]
				} // [!code --]
				Cell left = this.cell.Left; // [!code --]
				if (blockDir == 2 && left.sourceBlock.tileType.IsWallOrFence && !this.cell.crossWall) // [!code --]
				{ // [!code --]
					_sourceBlock = left.sourceBlock; // [!code --]
					param.mat = left.matBlock; // [!code --]
				} // [!code --]
				else // [!code --]
				{ // [!code --]
					_sourceBlock = sourceBlock; // [!code --]
					param.mat = matBlock; // [!code --]
				} // [!code --]
				this.tileType = _sourceBlock.tileType; // [!code --]
				param.tile = (tile = _sourceBlock._tiles[0] + ((flag8 && !this.tileType.IsFence) ? 32 : 0)); // [!code --]
				if (_sourceBlock.useAltColor) // [!code --]
				{ // [!code --]
					param.matColor = ((_sourceBlock.colorMod == 0) ? 104025 : GetColorInt(ref param.mat.altColor, _sourceBlock.colorMod)); // [!code --]
				} // [!code --]
				else // [!code --]
				{ // [!code --]
					param.matColor = ((_sourceBlock.colorMod == 0) ? 104025 : GetColorInt(ref param.mat.matColor, _sourceBlock.colorMod)); // [!code --]
				} // [!code --]
				if (roomHeight == 0f || flag8 || !this.tileType.RepeatBlock) // [!code --]
				{ // [!code --]
					if (!this.cell.hasDoor) // [!code --]
					{ // [!code --]
						_sourceBlock.renderData.Draw(param); // [!code --]
					} // [!code --]
				} // [!code --]
				else // [!code --]
				{ // [!code --]
					_sourceBlock.renderData.DrawRepeatTo(param, maxHeight, roomHeight, ref renderSetting.peakFix, this.cell.hasDoor, this.cell.effect?.FireAmount ?? 0); // [!code --]
				} // [!code --]
				param.z += cornerWallFix2.z; // [!code --]
				if ((blockDir == 2 || (this.cell.Front.HasWallOrFence && this.cell.Front.blockDir != 0)) != this.cell.isToggleWallPillar) // [!code --]
				{ // [!code --]
					if (this.cell.Back.IsSnowTile && this.cell.Right.IsSnowTile) // [!code --]
					{ // [!code --]
						param.snow = true; // [!code --]
					} // [!code --]
					param.tile = _sourceBlock._tiles[0] + ((flag8 && flag9 && !this.tileType.IsFence && !flag7) ? 32 : 0) + (this.tileType.IsFence ? 32 : 64); // [!code --]
					if (roomHeight == 0f || !this.tileType.RepeatBlock || (flag8 && flag9 && !flag7)) // [!code --]
					{ // [!code --]
						_sourceBlock.renderData.Draw(param); // [!code --]
					} // [!code --]
					else // [!code --]
					{ // [!code --]
						_sourceBlock.renderData.DrawRepeatTo(param, maxHeight, roomHeight, ref renderSetting.peakFix); // [!code --]
					} // [!code --]
				} // [!code --]
				if (!flag8 && !showRoof && this.cell.Left.HasWallOrFence && this.cell.Left.blockDir != 0 && !this.cell.isToggleWallPillar) // [!code --]
				{ // [!code --]
					orgX = param.x; // [!code --]
					param.tile = _sourceBlock._tiles[0] + ((flag8 && !this.tileType.IsFence && !flag7) ? 32 : 0) + (this.tileType.IsFence ? 32 : 64); // [!code --]
					param.x += cornerWallFix3.x; // [!code --]
					param.y += cornerWallFix3.y; // [!code --]
					param.z += cornerWallFix3.z; // [!code --]
					if (!flag7 && (roomHeight == 0f || flag8)) // [!code --]
					{ // [!code --]
						_sourceBlock.renderData.Draw(param); // [!code --]
					} // [!code --]
					else // [!code --]
					{ // [!code --]
						_sourceBlock.renderData.DrawRepeatTo(param, maxHeight, roomHeight + cornerWallFix.y, ref renderSetting.peakFix); // [!code --]
					} // [!code --]
					param.x = orgX; // [!code --]
				} // [!code --]
				else if (this.cell.FrontLeft.HasWallOrFence && this.cell.FrontLeft.blockDir != 0 && (!flag8 || !this.cell.Left.HasWall) && !this.cell.isToggleWallPillar) // [!code --]
				{ // [!code --]
					orgX = param.x; // [!code --]
					param.tile = _sourceBlock._tiles[0] + ((flag8 && !this.tileType.IsFence && !flag7) ? 32 : 0) + (this.tileType.IsFence ? 32 : 64); // [!code --]
					param.x += cornerWallFix.x; // [!code --]
					param.y += cornerWallFix.y; // [!code --]
					param.z += cornerWallFix.z; // [!code --]
					if (!flag7 && (roomHeight == 0f || flag8)) // [!code --]
					{ // [!code --]
						_sourceBlock.renderData.Draw(param); // [!code --]
					} // [!code --]
					else // [!code --]
					{ // [!code --]
						_sourceBlock.renderData.DrawRepeatTo(param, maxHeight, roomHeight + cornerWallFix.y, ref renderSetting.peakFix); // [!code --]
					} // [!code --]
					param.x = orgX; // [!code --]
				} // [!code --]
			} // [!code --]
			if (blockDir == 1 || blockDir == 2) // [!code --]
			{ // [!code --]
				param.y = orgY; // [!code --]
				param.z = orgZ; // [!code --]
				param.dir = 1; // [!code --]
				Room room3 = this.cell.Right.room ?? this.cell.room; // [!code --]
			{ // [!code ++]
				param.dir = 0; // [!code ++]
				Room room3 = this.cell.Front.room ?? this.cell.room; // [!code ++]
				if (room3 != null && this.tileType.IsWall)
				{
					if (room3.lot.idDeco != 0 && !this.cell.hasDoor)
					{
						param.tile = -EMono.sources.blocks.rows[0].ConvertTile(1000 + room3.lot.idDeco); // [!code --]
						param.tile = EMono.sources.blocks.rows[0].ConvertTile(1000 + room3.lot.idDeco); // [!code ++]
						param.matColor = room3.lot.colDeco;
						param.y += (float)room3.lot.decoFix * 0.01f;
						rendererWallDeco.Draw(param);
						param.y = orgY;
					}
					if (room3.lot.idDeco2 != 0 && roomHeight != 0f && !flag9 && (float)room3.lot.decoFix2 * 0.01f + heightLimitDeco < roomHeight + maxHeight - param.y) // [!code --]
					if (room3.lot.idDeco2 != 0 && roomHeight != 0f && !flag10 && (float)room3.lot.decoFix2 * 0.01f + heightLimitDeco < roomHeight + maxHeight - param.y) // [!code ++]
					{
						param.tile = -EMono.sources.blocks.rows[0].ConvertTile(1000 + room3.lot.idDeco2); // [!code --]
						param.tile = EMono.sources.blocks.rows[0].ConvertTile(1000 + room3.lot.idDeco2); // [!code ++]
						param.matColor = room3.lot.colDeco2;
						param.y += (float)room3.lot.decoFix2 * 0.01f;
						param.z += (float)room3.lot.decoFix2 * 0.01f * heightModDeco;
```

[`@@ -2555,29 +2885,11 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L2555-L2583)
```cs:line-numbers=2555
						param.z = orgZ;
					}
				}
				if (blockDir == 2 && this.cell.room == null && this.cell.Right.room != null) // [!code --]
				{ // [!code --]
					Room room4 = this.cell.Right.room; // [!code --]
					maxHeight = (float)(cz - cx) * screen.tileAlign.y + (float)room4.lot.mh * _heightMod.y; // [!code --]
					if (showRoof) // [!code --]
					{ // [!code --]
						roomHeight = room4.lot.realHeight; // [!code --]
					} // [!code --]
					else if ((noRoofMode && currentRoom == null) || (_lowblock && !this.tileType.ForceRpeatBlock)) // [!code --]
					{ // [!code --]
						roomHeight = 0f; // [!code --]
					} // [!code --]
					else // [!code --]
					{ // [!code --]
						int num19 = ((room4.data.maxHeight == 0) ? 2 : room4.data.maxHeight); // [!code --]
						roomHeight = EMono.setting.render.roomHeightMod * (float)((room4.lot.height < num19) ? room4.lot.height : num19) + 0.01f * (float)room4.lot.heightFix; // [!code --]
					} // [!code --]
				} // [!code --]
				Cell back2 = this.cell.Back; // [!code --]
				if (blockDir == 2 && back2.sourceBlock.tileType.IsWallOrFence && !this.cell.crossWall) // [!code --]
				Cell left = this.cell.Left; // [!code ++]
				if (blockDir == 2 && left.sourceBlock.tileType.IsWallOrFence && !this.cell.crossWall) // [!code ++]
				{
					_sourceBlock = back2.sourceBlock; // [!code --]
					param.mat = back2.matBlock; // [!code --]
					_sourceBlock = left.sourceBlock; // [!code ++]
					param.mat = left.matBlock; // [!code ++]
				}
				else
				{
```

[`@@ -2585,7 +2897,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L2585-L2591)
```cs:line-numbers=2585
					param.mat = matBlock;
				}
				this.tileType = _sourceBlock.tileType;
				param.tile = (tile = -_sourceBlock._tiles[0] + ((flag9 && !this.tileType.IsFence) ? (-32) : 0)); // [!code --]
				param.tile = (tile = _sourceBlock._tiles[0] + ((flag10 && !this.tileType.IsFence) ? 32 : 0)); // [!code ++]
				if (_sourceBlock.useAltColor)
				{
					param.matColor = ((_sourceBlock.colorMod == 0) ? 104025 : GetColorInt(ref param.mat.altColor, _sourceBlock.colorMod));
```

[`@@ -2594,8 +2906,7 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L2594-L2601)
```cs:line-numbers=2594
				{
					param.matColor = ((_sourceBlock.colorMod == 0) ? 104025 : GetColorInt(ref param.mat.matColor, _sourceBlock.colorMod));
				}
				param.color += _rightWallShade; // [!code --]
				if (roomHeight == 0f || flag9 || !this.tileType.RepeatBlock) // [!code --]
				if (roomHeight == 0f || flag10 || !this.tileType.RepeatBlock) // [!code ++]
				{
					if (!this.cell.hasDoor)
					{
```

[`@@ -2606,15 +2917,15 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L2606-L2620)
```cs:line-numbers=2606
				{
					_sourceBlock.renderData.DrawRepeatTo(param, maxHeight, roomHeight, ref renderSetting.peakFix, this.cell.hasDoor, this.cell.effect?.FireAmount ?? 0);
				}
				if ((this.cell.Right.HasWallOrFence && this.cell.Right.blockDir != 1) != this.cell.isToggleWallPillar && (blockDir != 2 || !this.cell.isToggleWallPillar)) // [!code --]
				param.z += cornerWallFix2.z; // [!code ++]
				if ((blockDir == 2 || (this.cell.Front.HasWallOrFence && this.cell.Front.blockDir != 0)) != this.cell.isToggleWallPillar) // [!code ++]
				{
					if (this.cell.Left.IsSnowTile && this.cell.Front.IsSnowTile) // [!code --]
					if (this.cell.Back.IsSnowTile && this.cell.Right.IsSnowTile) // [!code ++]
					{
						param.snow = true;
					}
					orgX = param.x; // [!code --]
					param.tile = _sourceBlock._tiles[0] + ((flag9 && !this.tileType.IsFence && !flag7) ? 32 : 0) + (this.tileType.IsFence ? 32 : 64); // [!code --]
					if (!flag7 && (roomHeight == 0f || !this.tileType.RepeatBlock || flag9)) // [!code --]
					param.tile = _sourceBlock._tiles[0] + ((flag10 && flag11 && !this.tileType.IsFence && !flag9) ? 32 : 0) + (this.tileType.IsFence ? 32 : 64); // [!code ++]
					if (roomHeight == 0f || !this.tileType.RepeatBlock || (flag10 && flag11 && !flag9)) // [!code ++]
					{
						_sourceBlock.renderData.Draw(param);
					}
```

[`@@ -2622,513 +2933,203 @@ public virtual void DrawTile()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BaseTileMap.cs#L2622-L3134)
```cs:line-numbers=2622
					{
						_sourceBlock.renderData.DrawRepeatTo(param, maxHeight, roomHeight, ref renderSetting.peakFix);
					}
					param.x = orgX; // [!code --]
				} // [!code --]
			} // [!code --]
			param.y = orgY; // [!code --]
			param.z = orgZ; // [!code --]
			break; // [!code --]
		} // [!code --]
		case BlockRenderMode.HalfBlock: // [!code --]
			param.color = floorLight; // [!code --]
			_sourceBlock = ((sourceBlock.id == 5) ? EMono.sources.blocks.rows[matBlock.defBlock] : sourceBlock); // [!code --]
			param.tile = _sourceBlock._tiles[0]; // [!code --]
			param.matColor = ((_sourceBlock.colorMod == 0) ? 104025 : GetColorInt(ref matBlock.matColor, _sourceBlock.colorMod)); // [!code --]
			param.tile2 = _sourceBlock.sourceAutoFloor._tiles[0]; // [!code --]
			param.halfBlockColor = ((_sourceBlock.sourceAutoFloor.colorMod == 0) ? 104025 : GetColorInt(ref matBlock.matColor, _sourceBlock.sourceAutoFloor.colorMod)); // [!code --]
			sourceBlock.renderData.Draw(param); // [!code --]
			break; // [!code --]
		case BlockRenderMode.Pillar: // [!code --]
		{ // [!code --]
			RenderData renderData2 = sourceBlock.renderData; // [!code --]
			param.tile = sourceBlock._tiles[this.cell.blockDir % sourceBlock._tiles.Length]; // [!code --]
			param.matColor = ((sourceBlock.colorMod == 0) ? 104025 : GetColorInt(ref matBlock.matColor, sourceBlock.colorMod)); // [!code --]
			int num20 = this.cell.objDir + ((this.cell.objDir >= 7) ? this.cell.objDir : 0) + 1; // [!code --]
			if (num20 == 0) // [!code --]
			{ // [!code --]
				renderData2.Draw(param); // [!code --]
			} // [!code --]
			else // [!code --]
			{ // [!code --]
				renderData2.DrawRepeat(param, num20, sourceBlock.tileType.RepeatSize); // [!code --]
			} // [!code --]
			param.tile = renderData2.idShadow; // [!code --]
			SourcePref shadowPref2 = renderData2.shadowPref; // [!code --]
			int shadow4 = shadowPref2.shadow; // [!code --]
			passShadow.AddShadow(param.x + renderData2.offsetShadow.x, param.y + renderData2.offsetShadow.y, param.z + renderData2.offsetShadow.z, ShadowData.Instance.items[shadow4], shadowPref2, 0, param.snow); // [!code --]
			break; // [!code --]
		} // [!code --]
		default: // [!code --]
			param.color = floorLight; // [!code --]
			param.tile = sourceBlock._tiles[this.cell.blockDir % sourceBlock._tiles.Length] + ((_lowblock && this.tileType.UseLowWallTiles) ? 3000000 : 0); // [!code --]
			param.matColor = ((sourceBlock.colorMod == 0) ? 104025 : GetColorInt(ref matBlock.matColor, sourceBlock.colorMod)); // [!code --]
			if (roomHeight == 0f) // [!code --]
			{ // [!code --]
				sourceBlock.renderData.Draw(param); // [!code --]
			} // [!code --]
			else // [!code --]
			{ // [!code --]
				sourceBlock.renderData.DrawRepeatTo(param, maxHeight, roomHeight, ref renderSetting.peakFixBlock); // [!code --]
			} // [!code --]
			break; // [!code --]
		} // [!code --]
	} // [!code --]
	if (this.cell.pcSync && EMono.player.lightPower > 0f && !cinemaMode) // [!code --]
	{ // [!code --]
		if (this.cell.room != null || !this.cell.IsRoomEdge || !showRoof) // [!code --]
		{ // [!code --]
			goto IL_6f52; // [!code --]
		} // [!code --]
		if (this.cell._block == 0 || !this.cell.sourceBlock.tileType.RepeatBlock) // [!code --]
		{ // [!code --]
			Room obj = this.cell.FrontRight.room; // [!code --]
			if (obj == null || !obj.HasRoof) // [!code --]
			{ // [!code --]
				goto IL_6f52; // [!code --]
			} // [!code --]
		} // [!code --]
	} // [!code --]
	goto IL_6fb2; // [!code --]
	IL_7b6d: // [!code --]
	if (detail.things.Count == 0 && detail.charas.Count == 0) // [!code --]
	{ // [!code --]
		return; // [!code --]
	} // [!code --]
	int num21 = 0; // [!code --]
	thingPos.x = 0f; // [!code --]
	thingPos.y = 0f; // [!code --]
	thingPos.z = 0f; // [!code --]
	freePos.x = (freePos.y = (freePos.z = 0f)); // [!code --]
	if (this.cell.HasRamp) // [!code --]
	{ // [!code --]
		Vector3 rampFix = sourceBlock.tileType.GetRampFix(this.cell.blockDir); // [!code --]
		param.x += rampFix.x; // [!code --]
		param.y += rampFix.y; // [!code --]
		param.z += rampFix.z; // [!code --]
		freePos.x += rampFix.x; // [!code --]
		freePos.y += rampFix.y; // [!code --]
		freePos.z += rampFix.z; // [!code --]
	} // [!code --]
	param.y += (flag ? 0f : ((this.cell._bridge != 0) ? this.cell.sourceBridge.tileType.FloorHeight : sourceFloor.tileType.FloorHeight)); // [!code --]
	orgPos.x = (orgX = param.x); // [!code --]
	orgPos.y = (orgY = param.y); // [!code --]
	orgPos.z = (orgZ = param.z); // [!code --]
	if (flag && liquidLv > 0) // [!code --]
	{ // [!code --]
		if (liquidLv > 10) // [!code --]
		{ // [!code --]
			liquidLv = TileType.FloorWaterShallow.LiquidLV * 10; // [!code --]
		} // [!code --]
		liquidLv -= (int)(floatY * 0.5f); // [!code --]
		param.liquidLv = liquidLv; // [!code --]
		param.y -= TileType.FloorWaterShallow.FloorHeight; // [!code --]
	} // [!code --]
	Thing thing = null; // [!code --]
	bool shadow = liquidLv == 0; // [!code --]
	float num22 = 0f; // [!code --]
	float num23 = 0f; // [!code --]
	bool flag10 = false; // [!code --]
	float num24 = 0f; // [!code --]
	bool flag11 = false; // [!code --]
	float num25 = 0f; // [!code --]
	if (detail.things.Count > 0 && isSeen) // [!code --]
	{ // [!code --]
		_ = zSetting.max1; // [!code --]
		float num26 = 0f; // [!code --]
		for (int m = 0; m < detail.things.Count; m++) // [!code --]
		{ // [!code --]
			Thing t = detail.things[m]; // [!code --]
			if ((fogged && !t.isRoofItem) || ((t.isHidden || t.trait.HideInAdv || t.isMasked) && !EMono.scene.actionMode.ShowMaskedThings) || (t.isRoofItem && ((this.room == null && !sourceBlock.tileType.IsFullBlock && !EMono._zone.IsPCFaction) || (lowBlock && !showFullWall && this.room != null) || (noRoofMode && currentRoom == null))) || (flag3 && !t.isRoofItem)) // [!code --]
			{ // [!code --]
				continue; // [!code --]
			} // [!code --]
			TileType tileType = t.trait.tileType; // [!code --]
			bool isInstalled = t.IsInstalled; // [!code --]
			SourcePref pref = t.Pref; // [!code --]
			if (!isInstalled && t.category.tileDummy != 0) // [!code --]
			{ // [!code --]
				pref = rendererObjDummy.shadowPref; // [!code --]
			} // [!code --]
			float num27 = ((tileType.UseMountHeight && isInstalled) ? 0f : ((pref.height < 0f) ? 0f : ((pref.height == 0f) ? 0.1f : pref.height))); // [!code --]
			if (t.ignoreStackHeight) // [!code --]
			{ // [!code --]
				thingPos.y -= num22; // [!code --]
			} // [!code --]
			shadow = thingPos.y < 0.16f && num25 < 0.16f; // [!code --]
			_ = pref.bypassShadow; // [!code --]
			param.shadowFix = 0f - thingPos.y; // [!code --]
			param.liquidLv = ((thingPos.y + (float)t.altitude < 0.1f) ? liquidLv : 0); // [!code --]
			if (t.isRoofItem) // [!code --]
			{ // [!code --]
				param.snow = isSnowCovered && !this.cell.isClearSnow; // [!code --]
				SetRoofHeight(param, this.cell, cx, cz); // [!code --]
				_actorPos.x = param.x; // [!code --]
				_actorPos.y = param.y; // [!code --]
				_actorPos.z = param.z + num26; // [!code --]
				if (this.room != null) // [!code --]
				{ // [!code --]
					param.color = GetRoofLight(this.room.lot); // [!code --]
				} // [!code --]
				shadow = false; // [!code --]
				param.liquidLv = 0; // [!code --]
			} // [!code --]
			else // [!code --]
			{ // [!code --]
				param.snow = snowed; // [!code --]
				_actorPos.x = orgX + num23; // [!code --]
				_actorPos.y = orgY; // [!code --]
				_actorPos.z = orgZ + num26 + thingPos.z; // [!code --]
				if (tileType.CanStack || !isInstalled) // [!code --]
				{ // [!code --]
					if (thing?.id != t.id) // [!code --]
					{ // [!code --]
						_actorPos.x += thingPos.x; // [!code --]
					} // [!code --]
					_actorPos.y += thingPos.y; // [!code --]
					if (t.trait.IgnoreLastStackHeight && (thing == null || !thing.trait.IgnoreLastStackHeight)) // [!code --]
					{ // [!code --]
						thingPos.y -= num22; // [!code --]
						if (thing != null) // [!code --]
						{ // [!code --]
							_actorPos.z -= 0.2f; // [!code --]
							thingPos.z -= 0.2f; // [!code --]
						} // [!code --]
						_actorPos.y -= num22; // [!code --]
					} // [!code --]
					_actorPos.z += renderSetting.thingZ + (float)m * -0.01f + zSetting.mod1 * thingPos.y; // [!code --]
				}
				if (isInstalled) // [!code --]
				if (!flag10 && !showRoof && this.cell.Left.HasWallOrFence && this.cell.Left.blockDir != 0 && !this.cell.isToggleWallPillar) // [!code ++]
				{
					if (t.TileType.IsRamp) // [!code --]
					{ // [!code --]
						Vector3 rampFix2 = t.TileType.GetRampFix(t.dir, pref); // [!code --]
						orgX += rampFix2.x; // [!code --]
						orgY += rampFix2.y; // [!code --]
						orgZ += rampFix2.z; // [!code --]
						freePos.x += rampFix2.x; // [!code --]
						freePos.y += rampFix2.y; // [!code --]
						freePos.z += rampFix2.z; // [!code --]
						if (!this.cell.IsTopWater || t.altitude > 0) // [!code --]
						{ // [!code --]
							num25 += rampFix2.y; // [!code --]
						} // [!code --]
						liquidLv -= (int)(rampFix2.y * 150f); // [!code --]
						if (liquidLv < 0) // [!code --]
						{ // [!code --]
							liquidLv = 0; // [!code --]
						} // [!code --]
					} // [!code --]
					else if (!flag11 && t.trait.IsChangeFloorHeight && !t.ignoreStackHeight) // [!code --]
					orgX = param.x; // [!code ++]
					param.tile = _sourceBlock._tiles[0] + ((flag10 && !this.tileType.IsFence && !flag9) ? 32 : 0) + (this.tileType.IsFence ? 32 : 64); // [!code ++]
					param.x += cornerWallFix3.x; // [!code ++]
					param.y += cornerWallFix3.y; // [!code ++]
					param.z += cornerWallFix3.z; // [!code ++]
					if (!flag9 && (roomHeight == 0f || flag10)) // [!code ++]
					{
						orgY += num27 + (float)t.altitude * altitudeFix.y; // [!code --]
						orgZ += (float)t.altitude * altitudeFix.z; // [!code --]
						freePos.y += num27 + (float)t.altitude * altitudeFix.y; // [!code --]
						if (!this.cell.IsTopWater || t.altitude > 0) // [!code --]
						{ // [!code --]
							num25 += num27 + (float)t.altitude * altitudeFix.y; // [!code --]
						} // [!code --]
						_actorPos.x += pref.x * (float)((!t.flipX) ? 1 : (-1)); // [!code --]
						_actorPos.z += pref.z; // [!code --]
						thingPos.z += pref.z; // [!code --]
						liquidLv -= (int)(num27 * 150f); // [!code --]
						if (liquidLv < 0) // [!code --]
						{ // [!code --]
							liquidLv = 0; // [!code --]
						} // [!code --]
						_sourceBlock.renderData.Draw(param); // [!code ++]
					}
					else
					{
						thingPos.y += num27; // [!code --]
						_actorPos.x += pref.x * (float)((!t.flipX) ? 1 : (-1)); // [!code --]
						_actorPos.z += pref.z; // [!code --]
						if (pref.height >= 0f) // [!code --]
						{ // [!code --]
							thingPos.z += pref.z; // [!code --]
						} // [!code --]
					} // [!code --]
					if (!tileType.UseMountHeight && m > 10) // [!code --]
					{ // [!code --]
						flag11 = true; // [!code --]
					} // [!code --]
				} // [!code --]
				else // [!code --]
				{ // [!code --]
					thingPos.y += num27; // [!code --]
					_actorPos.x += pref.x * (float)((!t.flipX) ? 1 : (-1)); // [!code --]
					_actorPos.z += pref.z; // [!code --]
					thingPos.z += pref.z; // [!code --]
				} // [!code --]
				if (t.isFloating && isWater && !hasBridge && !flag) // [!code --]
				{ // [!code --]
					flag = true; // [!code --]
					float num28 = ((this.cell._bridge != 0) ? sourceBridge.tileType.FloorHeight : sourceFloor.tileType.FloorHeight); // [!code --]
					orgY += 0.01f * floatY - num28; // [!code --]
					num24 = num27; // [!code --]
					_actorPos.y += 0.01f * floatY - num28; // [!code --]
					if (liquidLv > 10) // [!code --]
					{ // [!code --]
						liquidLv = TileType.FloorWaterShallow.LiquidLV * 10; // [!code --]
					} // [!code --]
					liquidLv -= (int)(floatY * 0.5f); // [!code --]
					if (liquidLv < 0) // [!code --]
					{ // [!code --]
						liquidLv = 0; // [!code --]
						_sourceBlock.renderData.DrawRepeatTo(param, maxHeight, roomHeight + cornerWallFix.y, ref renderSetting.peakFix); // [!code ++]
					}
					param.liquidLv = liquidLv; // [!code --]
				} // [!code --]
				num22 = num27; // [!code --]
				if (t.sourceCard.multisize && !t.trait.IsGround) // [!code --]
				{ // [!code --]
					num26 += zSetting.multiZ; // [!code --]
					param.x = orgX; // [!code ++]
				}
				orgZ += t.renderer.data.stackZ; // [!code --]
				if (param.liquidLv > 0) // [!code --]
				else if (this.cell.FrontLeft.HasWallOrFence && this.cell.FrontLeft.blockDir != 0 && (!flag10 || !this.cell.Left.HasWall) && !this.cell.isToggleWallPillar) // [!code ++]
				{
					param.liquidLv += pref.liquidMod; // [!code --]
					if (param.liquidLv < 1) // [!code --]
					orgX = param.x; // [!code ++]
					param.tile = _sourceBlock._tiles[0] + ((flag10 && !this.tileType.IsFence && !flag9) ? 32 : 0) + (this.tileType.IsFence ? 32 : 64); // [!code ++]
					param.x += cornerWallFix.x; // [!code ++]
					param.y += cornerWallFix.y; // [!code ++]
					param.z += cornerWallFix.z; // [!code ++]
					if (!flag9 && (roomHeight == 0f || flag10)) // [!code ++]
					{
						param.liquidLv = 1; // [!code --]
						_sourceBlock.renderData.Draw(param); // [!code ++]
					}
					else if (param.liquidLv > 99 + pref.liquidModMax) // [!code --]
					else // [!code ++]
					{
						param.liquidLv = 99 + pref.liquidModMax; // [!code --]
						_sourceBlock.renderData.DrawRepeatTo(param, maxHeight, roomHeight + cornerWallFix.y, ref renderSetting.peakFix); // [!code ++]
					}
					param.x = orgX; // [!code ++]
				}
			}
			if (isInstalled && tileType.UseMountHeight) // [!code --]
			if (blockDir == 1 || blockDir == 2) // [!code ++]
			{
				if (tileType != TileType.Illumination || !this.cell.HasObj) // [!code --]
				param.y = orgY; // [!code ++]
				param.z = orgZ; // [!code ++]
				param.dir = 1; // [!code ++]
				Room room4 = this.cell.Right.room ?? this.cell.room; // [!code ++]
				if (room4 != null && this.tileType.IsWall) // [!code ++]
				{
					if (noRoofMode && currentRoom == null && t.altitude >= lowWallObjAltitude) // [!code --]
					if (room4.lot.idDeco != 0 && !this.cell.hasDoor) // [!code ++]
					{
						continue; // [!code --]
						param.tile = -EMono.sources.blocks.rows[0].ConvertTile(1000 + room4.lot.idDeco); // [!code ++]
						param.matColor = room4.lot.colDeco; // [!code ++]
						param.y += (float)room4.lot.decoFix * 0.01f; // [!code ++]
						rendererWallDeco.Draw(param); // [!code ++]
						param.y = orgY; // [!code ++]
					}
					if (hideHang && (this.cell.room?.lot != currentLot || (!this.cell.lotWall && this.cell.room != currentRoom))) // [!code --]
					if (room4.lot.idDeco2 != 0 && roomHeight != 0f && !flag11 && (float)room4.lot.decoFix2 * 0.01f + heightLimitDeco < roomHeight + maxHeight - param.y) // [!code ++]
					{
						Room room5 = ((t.dir == 0) ? this.cell.Back.room : this.cell.Left.room); // [!code --]
						if (t.trait.AlwaysHideOnLowWall) // [!code --]
						{ // [!code --]
							if (room5 == null || !room5.data.showWallItem) // [!code --]
							{ // [!code --]
								continue; // [!code --]
							} // [!code --]
						} // [!code --]
						else if (t.altitude >= lowWallObjAltitude) // [!code --]
						{ // [!code --]
							continue; // [!code --]
						} // [!code --]
						param.tile = -EMono.sources.blocks.rows[0].ConvertTile(1000 + room4.lot.idDeco2); // [!code ++]
						param.matColor = room4.lot.colDeco2; // [!code ++]
						param.y += (float)room4.lot.decoFix2 * 0.01f; // [!code ++]
						param.z += (float)room4.lot.decoFix2 * 0.01f * heightModDeco; // [!code ++]
						rendererWallDeco.Draw(param); // [!code ++]
						param.y = orgY; // [!code ++]
						param.z = orgZ; // [!code ++]
					}
				}
				if (tileType.UseHangZFix) // [!code --]
				if (blockDir == 2 && this.cell.room == null && this.cell.Right.room != null) // [!code ++]
				{
					flag10 = true; // [!code --]
					Room room5 = this.cell.Right.room; // [!code ++]
					maxHeight = (float)(cz - cx) * screen.tileAlign.y + (float)room5.lot.mh * _heightMod.y; // [!code ++]
					if (showRoof) // [!code ++]
					{ // [!code ++]
						roomHeight = room5.lot.realHeight; // [!code ++]
					} // [!code ++]
					else if ((noRoofMode && currentRoom == null) || (_lowblock && !this.tileType.ForceRpeatBlock)) // [!code ++]
					{ // [!code ++]
						roomHeight = 0f; // [!code ++]
					} // [!code ++]
					else // [!code ++]
					{ // [!code ++]
						int num32 = ((room5.data.maxHeight == 0) ? 2 : room5.data.maxHeight); // [!code ++]
						roomHeight = EMono.setting.render.roomHeightMod * (float)((room5.lot.height < num32) ? room5.lot.height : num32) + 0.01f * (float)room5.lot.heightFix; // [!code ++]
					} // [!code ++]
				}
				tileType.GetMountHeight(ref _actorPos, Point.shared.Set(index), t.dir, t); // [!code --]
				shadow = false; // [!code --]
				param.liquidLv = 0; // [!code --]
				if (t.freePos) // [!code --]
				Cell back2 = this.cell.Back; // [!code ++]
				if (blockDir == 2 && back2.sourceBlock.tileType.IsWallOrFence && !this.cell.crossWall) // [!code ++]
				{
					_actorPos.x += t.fx; // [!code --]
					_actorPos.y += t.fy; // [!code --]
					_sourceBlock = back2.sourceBlock; // [!code ++]
					param.mat = back2.matBlock; // [!code ++]
				}
			} // [!code --]
			else // [!code --]
			{ // [!code --]
				if (t.altitude != 0) // [!code --]
				else // [!code ++]
				{
					_actorPos += altitudeFix * t.altitude; // [!code --]
					if (t.altitude > 2 && ((this.cell.Back.room != null && this.cell.Back.IsRoomEdge) || (this.cell.Left.room != null && this.cell.Left.IsRoomEdge)) && hideHang && (this.cell.room?.lot != currentLot || (!this.cell.lotWall && this.cell.room != currentRoom))) // [!code --]
					{ // [!code --]
						continue; // [!code --]
					} // [!code --]
					_sourceBlock = sourceBlock; // [!code ++]
					param.mat = matBlock; // [!code ++]
				}
				if (t.freePos) // [!code --]
				this.tileType = _sourceBlock.tileType; // [!code ++]
				param.tile = (tile = -_sourceBlock._tiles[0] + ((flag11 && !this.tileType.IsFence) ? (-32) : 0)); // [!code ++]
				if (_sourceBlock.useAltColor) // [!code ++]
				{
					_actorPos.x = orgX + t.fx - freePos.x; // [!code --]
					_actorPos.y = orgY + t.fy - freePos.y; // [!code --]
					param.matColor = ((_sourceBlock.colorMod == 0) ? 104025 : GetColorInt(ref param.mat.altColor, _sourceBlock.colorMod)); // [!code ++]
				}
				if (t.trait is TraitDoor && (t.trait as TraitDoor).IsOpen()) // [!code --]
				else // [!code ++]
				{
					_actorPos.z += -0.5f; // [!code --]
					param.matColor = ((_sourceBlock.colorMod == 0) ? 104025 : GetColorInt(ref param.mat.matColor, _sourceBlock.colorMod)); // [!code ++]
				}
			} // [!code --]
			if (!t.sourceCard.multisize || (t.pos.x == cx && t.pos.z == cz)) // [!code --]
			{ // [!code --]
				if (iconMode != 0) // [!code --]
				param.color += _rightWallShade; // [!code ++]
				if (roomHeight == 0f || flag11 || !this.tileType.RepeatBlock) // [!code ++]
				{
					int num29 = 0; // [!code --]
					switch (iconMode) // [!code --]
					{ // [!code --]
					case CardIconMode.Visibility: // [!code --]
						if (t.isMasked) // [!code --]
						{ // [!code --]
							num29 = 17; // [!code --]
						} // [!code --]
						break; // [!code --]
					case CardIconMode.State: // [!code --]
						if (t.placeState == PlaceState.installed) // [!code --]
						{ // [!code --]
							num29 = 18; // [!code --]
						} // [!code --]
						break; // [!code --]
					case CardIconMode.Deconstruct: // [!code --]
						if (t.isDeconstructing) // [!code --]
						{ // [!code --]
							num29 = 14; // [!code --]
						} // [!code --]
						break; // [!code --]
					} // [!code --]
					if (t.isNPCProperty && !EMono.debug.godBuild) // [!code --]
					{ // [!code --]
						num29 = 13; // [!code --]
					} // [!code --]
					if (num29 != 0) // [!code --]
					if (!this.cell.hasDoor) // [!code ++]
					{
						passGuideBlock.Add(_actorPos.x, _actorPos.y, _actorPos.z - 10f, num29); // [!code --]
						_sourceBlock.renderData.Draw(param); // [!code ++]
					}
				}
				t.SetRenderParam(param); // [!code --]
				if (_lowblock && t.trait.UseLowblock && !this.cell.HasFullBlock) // [!code --]
				else // [!code ++]
				{
					param.tile += ((param.tile < 0f) ? (-64) : 64); // [!code --]
					_sourceBlock.renderData.DrawRepeatTo(param, maxHeight, roomHeight, ref renderSetting.peakFix, this.cell.hasDoor, this.cell.effect?.FireAmount ?? 0); // [!code ++]
				}
				if (t.trait is TraitTrolley && EMono.pc.ai is AI_Trolley aI_Trolley && aI_Trolley.trolley.owner == t) // [!code --]
				if ((this.cell.Right.HasWallOrFence && this.cell.Right.blockDir != 1) != this.cell.isToggleWallPillar && (blockDir != 2 || !this.cell.isToggleWallPillar)) // [!code ++]
				{
					RenderParam _param = new RenderParam(param); // [!code --]
					EMono.core.actionsLateUpdate.Add(delegate // [!code --]
					if (this.cell.Left.IsSnowTile && this.cell.Front.IsSnowTile) // [!code ++]
					{
						t.SetRenderParam(_param); // [!code --]
						_actorPos.x = EMono.pc.renderer.position.x; // [!code --]
						_actorPos.y = EMono.pc.renderer.position.y - pref.height; // [!code --]
						_actorPos.z = EMono.pc.renderer.position.z + 0.02f; // [!code --]
						t.renderer.Draw(_param, ref _actorPos, !t.noShadow && (shadow || tileType.AlwaysShowShadow)); // [!code --]
					}); // [!code --]
				} // [!code --]
				else // [!code --]
				{ // [!code --]
					t.renderer.Draw(param, ref _actorPos, !t.noShadow && (shadow || tileType.AlwaysShowShadow)); // [!code --]
						param.snow = true; // [!code ++]
					} // [!code ++]
					orgX = param.x; // [!code ++]
					param.tile = _sourceBlock._tiles[0] + ((flag11 && !this.tileType.IsFence && !flag9) ? 32 : 0) + (this.tileType.IsFence ? 32 : 64); // [!code ++]
					if (!flag9 && (roomHeight == 0f || !this.tileType.RepeatBlock || flag11)) // [!code ++]
					{ // [!code ++]
						_sourceBlock.renderData.Draw(param); // [!code ++]
					} // [!code ++]
					else // [!code ++]
					{ // [!code ++]
						_sourceBlock.renderData.DrawRepeatTo(param, maxHeight, roomHeight, ref renderSetting.peakFix); // [!code ++]
					} // [!code ++]
					param.x = orgX; // [!code ++]
				}
			}
			if (isInstalled) // [!code --]
			{ // [!code --]
				num23 += pref.stackX * (float)((!t.flipX) ? 1 : (-1)); // [!code --]
			} // [!code --]
			param.x = orgX; // [!code --]
			param.y = orgY;
			param.z = orgZ;
			break; // [!code ++]
		} // [!code ++]
		case BlockRenderMode.HalfBlock: // [!code ++]
			param.color = floorLight;
			thing = t; // [!code --]
			if (pref.Float) // [!code --]
			_sourceBlock = ((sourceBlock.id == 5) ? EMono.sources.blocks.rows[matBlock.defBlock] : sourceBlock); // [!code ++]
			param.tile = _sourceBlock._tiles[0]; // [!code ++]
			param.matColor = ((_sourceBlock.colorMod == 0) ? 104025 : GetColorInt(ref matBlock.matColor, _sourceBlock.colorMod)); // [!code ++]
			param.tile2 = _sourceBlock.sourceAutoFloor._tiles[0]; // [!code ++]
			param.halfBlockColor = ((_sourceBlock.sourceAutoFloor.colorMod == 0) ? 104025 : GetColorInt(ref matBlock.matColor, _sourceBlock.sourceAutoFloor.colorMod)); // [!code ++]
			sourceBlock.renderData.Draw(param); // [!code ++]
			break; // [!code ++]
		case BlockRenderMode.Pillar: // [!code ++]
		{ // [!code ++]
			RenderData renderData2 = sourceBlock.renderData; // [!code ++]
			param.tile = sourceBlock._tiles[this.cell.blockDir % sourceBlock._tiles.Length]; // [!code ++]
			param.matColor = ((sourceBlock.colorMod == 0) ? 104025 : GetColorInt(ref matBlock.matColor, sourceBlock.colorMod)); // [!code ++]
			int num33 = this.cell.objDir + ((this.cell.objDir >= 7) ? this.cell.objDir : 0) + 1; // [!code ++]
			if (num33 == 0) // [!code ++]
			{
				liquidLv = 0; // [!code --]
				renderData2.Draw(param); // [!code ++]
			}
		} // [!code --]
	} // [!code --]
	orgY += num24; // [!code --]
	if (detail.charas.Count <= 0) // [!code --]
	{ // [!code --]
		return; // [!code --]
	} // [!code --]
	param.shadowFix = 0f - num25; // [!code --]
	param.color += 1310720f; // [!code --]
	float max = zSetting.max2; // [!code --]
	for (int n = 0; n < detail.charas.Count; n++) // [!code --]
	{ // [!code --]
		Chara chara = detail.charas[n]; // [!code --]
		if (chara.host != null || (chara != EMono.pc && chara != LayerDrama.alwaysVisible && (flag3 || fogged || (!showAllCards && !EMono.player.CanSee(chara))))) // [!code --]
		{ // [!code --]
			continue; // [!code --]
		} // [!code --]
		_actorPos.x = orgX; // [!code --]
		_actorPos.y = orgY; // [!code --]
		_actorPos.z = orgZ; // [!code --]
		chara.SetRenderParam(param); // [!code --]
		_ = chara.IsAliveInCurrentZone; // [!code --]
		if (chara.isRestrained) // [!code --]
		{ // [!code --]
			TraitShackle restrainer = chara.GetRestrainer(); // [!code --]
			if (restrainer != null) // [!code --]
			else // [!code ++]
			{
				Vector3 getRestrainPos = restrainer.GetRestrainPos; // [!code --]
				if (getRestrainPos != default(Vector3)) // [!code --]
				{ // [!code --]
					Vector3 position = restrainer.owner.renderer.position; // [!code --]
					float defCharaHeight = EMono.setting.render.defCharaHeight; // [!code --]
					float num30 = getRestrainPos.y + defCharaHeight - ((chara.Pref.height == 0f) ? defCharaHeight : chara.source.pref.height); // [!code --]
					_actorPos.x = position.x + getRestrainPos.x * (float)((restrainer.owner.dir % 2 == 0) ? 1 : (-1)); // [!code --]
					_actorPos.y = position.y + num30; // [!code --]
					_actorPos.z = position.z + getRestrainPos.z; // [!code --]
					param.liquidLv = 0; // [!code --]
					param.shadowFix = orgY - _actorPos.y; // [!code --]
					chara.renderer.SetFirst(first: true); // [!code --]
					chara.renderer.Draw(param, ref _actorPos, drawShadow: true); // [!code --]
					param.shadowFix = 0f; // [!code --]
					continue; // [!code --]
				} // [!code --]
				renderData2.DrawRepeat(param, num33, sourceBlock.tileType.RepeatSize); // [!code ++]
			}
			param.tile = renderData2.idShadow; // [!code ++]
			SourcePref shadowPref2 = renderData2.shadowPref; // [!code ++]
			int shadow4 = shadowPref2.shadow; // [!code ++]
			passShadow.AddShadow(param.x + renderData2.offsetShadow.x, param.y + renderData2.offsetShadow.y, param.z + renderData2.offsetShadow.z, ShadowData.Instance.items[shadow4], shadowPref2, 0, param.snow); // [!code ++]
			break; // [!code ++]
		}
		if (!chara.sourceCard.multisize || (chara.pos.x == cx && chara.pos.z == cz)) // [!code --]
		{ // [!code --]
			if (chara.IsDeadOrSleeping && chara.IsPCC) // [!code --]
		default: // [!code ++]
			param.color = floorLight; // [!code ++]
			param.tile = sourceBlock._tiles[this.cell.blockDir % sourceBlock._tiles.Length] + ((_lowblock && this.tileType.UseLowWallTiles) ? 3000000 : 0); // [!code ++]
			param.matColor = ((sourceBlock.colorMod == 0) ? 104025 : GetColorInt(ref matBlock.matColor, sourceBlock.colorMod)); // [!code ++]
			if (roomHeight == 0f) // [!code ++]
			{
				float num31 = chara.renderer.data.size.y * 0.3f; // [!code --]
				if (thingPos.y > max) // [!code --]
				{ // [!code --]
					thingPos.y = max; // [!code --]
				} // [!code --]
				float num32 = thingPos.y + num31; // [!code --]
				float num33 = (float)n * -0.01f; // [!code --]
				if (num32 > zSetting.thresh1) // [!code --]
				{ // [!code --]
					num33 = zSetting.mod1; // [!code --]
				} // [!code --]
				_actorPos.x += thingPos.x; // [!code --]
				_actorPos.y += thingPos.y; // [!code --]
				_actorPos.z += renderSetting.laydownZ + num33; // [!code --]
				param.liquidLv = ((thingPos.y == 0f && liquidLv > 0) ? 90 : 0); // [!code --]
				thingPos.y += num31 * 0.8f; // [!code --]
				chara.renderer.Draw(param, ref _actorPos, liquidLv == 0); // [!code --]
				sourceBlock.renderData.Draw(param); // [!code ++]
			}
			else
			{
				param.liquidLv = liquidLv; // [!code --]
				if (param.liquidLv > 0) // [!code --]
				{ // [!code --]
					param.liquidLv += chara.Pref.liquidMod; // [!code --]
					if (param.liquidLv < 1) // [!code --]
					{ // [!code --]
						param.liquidLv = 1; // [!code --]
					} // [!code --]
					else if (param.liquidLv > 99 + chara.Pref.liquidModMax) // [!code --]
					{ // [!code --]
						param.liquidLv = 99 + chara.Pref.liquidModMax; // [!code --]
					} // [!code --]
				} // [!code --]
				if (!chara.IsPC && !chara.renderer.IsMoving && detail.charas.Count > 1 && (detail.charas.Count != 2 || !detail.charas[0].IsDeadOrSleeping || !detail.charas[0].IsPCC)) // [!code --]
				{ // [!code --]
					_actorPos += renderSetting.charaPos[1 + ((num21 < 4) ? num21 : 3)]; // [!code --]
				} // [!code --]
				_actorPos.z += 0.01f * (float)n + renderSetting.charaZ; // [!code --]
				num21++; // [!code --]
				if (flag10) // [!code --]
				{ // [!code --]
					_actorPos.z += chara.renderer.data.hangedFixZ; // [!code --]
				} // [!code --]
				chara.renderer.Draw(param, ref _actorPos, liquidLv == 0); // [!code --]
				sourceBlock.renderData.DrawRepeatTo(param, maxHeight, roomHeight, ref renderSetting.peakFixBlock); // [!code ++]
			}
			break; // [!code ++]
		}
		param.x = orgX; // [!code --]
		param.y = orgY; // [!code --]
		param.z = orgZ; // [!code --]
	}
	return; // [!code --]
	IL_6f52: // [!code --]
	if (!showRoof || !roof || this.cell.room == null || this.cell.Front.room == null || this.cell.Right.room == null) // [!code --]
	if (this.cell.pcSync && EMono.player.lightPower > 0f && !cinemaMode) // [!code ++]
	{
		param.tile = num14; // [!code --]
		rendererFov.Draw(param); // [!code --]
		if (this.cell.room != null || !this.cell.IsRoomEdge || !showRoof) // [!code ++]
		{ // [!code ++]
			goto IL_6f65; // [!code ++]
		} // [!code ++]
		if (this.cell._block == 0 || !this.cell.sourceBlock.tileType.RepeatBlock) // [!code ++]
		{ // [!code ++]
			Room obj = this.cell.FrontRight.room; // [!code ++]
			if (obj == null || !obj.HasRoof) // [!code ++]
			{ // [!code ++]
				goto IL_6f65; // [!code ++]
			} // [!code ++]
		} // [!code ++]
	}
	goto IL_6fb2; // [!code --]
	goto IL_6fc5; // [!code ++]
	void Draw(int tile)
	{
		pass = passEdge;
```

## BuildMenu

[`@@ -138,7 +138,7 @@ public void OnActivate()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/BuildMenu.cs#L138-L144)
```cs:line-numbers=138
	}
	EMono.ui.HideFloats();
	this.SetActive(mode != Mode.None);
	transMain.SetActive(mode == Mode.Build && (EMono.debug.godBuild || EMono._zone.elements.Has(4005))); // [!code --]
	transMain.SetActive(mode == Mode.Build && (EMono.debug.godBuild || EMono._zone.elements.Has(4005) || (EMono._zone is Zone_Tent && EMono.pc.homeBranch.elements.Has(4005)))); // [!code ++]
	switch (mode)
	{
	case Mode.Build:
```

## Card

[`@@ -3801,6 +3801,14 @@ public void DamageHP(int dmg, int ele, int eleP = 100, AttackSource attackSource`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Card.cs#L3801-L3806)
```cs:line-numbers=3801
		{
			dmg = dmg * (100 - (int)Mathf.Min(80f, Mathf.Sqrt(LV - 50) * 2.5f)) / 100;
		}
		if (EClass.game.principal.enableDamageReduction && IsPCFaction) // [!code ++]
		{ // [!code ++]
			int num = ((origin != null) ? origin.LV : EClass._zone.DangerLv); // [!code ++]
			if (num > 50) // [!code ++]
			{ // [!code ++]
				dmg = dmg * (100 - (int)Mathf.Min(95f, Mathf.Sqrt(num - 50))) / 100; // [!code ++]
			} // [!code ++]
		} // [!code ++]
		dmg = dmg * Mathf.Max(0, 100 - Evalue((e == Element.Void || e.id == 926) ? 55 : 56)) / 100;
		if (origin != null && origin.IsPC && EClass.player.codex.Has(id))
		{
```

[`@@ -3820,26 +3828,26 @@ public void DamageHP(int dmg, int ele, int eleP = 100, AttackSource attackSource`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Card.cs#L3820-L3845)
```cs:line-numbers=3820
		}
		if (EClass.pc.HasElement(1207) && isChara)
		{
			int num = 0; // [!code --]
			int num2 = 0;
			int num3 = 0; // [!code ++]
			foreach (Condition condition2 in Chara.conditions)
			{
				if (condition2.Type == ConditionType.Buff)
				{
					num++; // [!code --]
					num2++; // [!code ++]
				}
				else if (condition2.Type == ConditionType.Debuff)
				{
					num2++; // [!code --]
					num3++; // [!code ++]
				}
			}
			if (IsPCParty)
			{
				dmg = dmg * 100 / Mathf.Min(100 + num * 5, 120); // [!code --]
				dmg = dmg * 100 / Mathf.Min(100 + num2 * 5, 120); // [!code ++]
			}
			else
			{
				dmg = dmg * Mathf.Min(100 + num2 * 5, 120) / 100; // [!code --]
				dmg = dmg * Mathf.Min(100 + num3 * 5, 120) / 100; // [!code ++]
			}
		}
		if (IsPCParty && EClass.pc.ai is GoalAutoCombat)
```

[`@@ -3856,10 +3864,10 @@ public void DamageHP(int dmg, int ele, int eleP = 100, AttackSource attackSource`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Card.cs#L3856-L3865)
```cs:line-numbers=3856
		}
		if (dmg >= MaxHP / 10 && Evalue(68) > 0)
		{
			int num3 = MaxHP / 10; // [!code --]
			int num4 = dmg - num3; // [!code --]
			num4 = num4 * 100 / (200 + Evalue(68) * 10); // [!code --]
			dmg = num3 + num4; // [!code --]
			int num4 = MaxHP / 10; // [!code ++]
			int num5 = dmg - num4; // [!code ++]
			num5 = num5 * 100 / (200 + Evalue(68) * 10); // [!code ++]
			dmg = num4 + num5; // [!code ++]
		}
	}
	if (origin != null && origin.IsPC && EClass.pc.Evalue(654) > 0)
```

[`@@ -3870,19 +3878,19 @@ public void DamageHP(int dmg, int ele, int eleP = 100, AttackSource attackSource`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Card.cs#L3870-L3888)
```cs:line-numbers=3870
	{
		dmg = 0;
	}
	int num5 = Mathf.Clamp(dmg * 6 / MaxHP, 0, 4) + ((dmg > 0) ? 1 : 0); // [!code --]
	int num6 = Mathf.Clamp(dmg * 6 / MaxHP, 0, 4) + ((dmg > 0) ? 1 : 0); // [!code ++]
	if (Evalue(1421) > 0)
	{
		int num6 = 0; // [!code --]
		int num7 = dmg; // [!code --]
		int num7 = 0; // [!code ++]
		int num8 = dmg; // [!code ++]
		if (hp > 0)
		{
			num7 = dmg - hp; // [!code --]
			num8 = dmg - hp; // [!code ++]
			hp -= dmg;
			num6 += dmg; // [!code --]
			num7 += dmg; // [!code ++]
			if (hp < 0 && Chara.mana.value >= 0)
			{
				num6 += hp; // [!code --]
				num7 += hp; // [!code ++]
				hp = 0;
			}
		}
```

[`@@ -3890,22 +3898,22 @@ public void DamageHP(int dmg, int ele, int eleP = 100, AttackSource attackSource`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Card.cs#L3890-L3911)
```cs:line-numbers=3890
		{
			if (Evalue(1421) >= 2)
			{
				num7 /= 2; // [!code --]
				num8 /= 2; // [!code ++]
			}
			dmg = num7; // [!code --]
			dmg = num8; // [!code ++]
			if (Chara.mana.value > 0)
			{
				num7 -= Chara.mana.value; // [!code --]
				num8 -= Chara.mana.value; // [!code ++]
				Chara.mana.value -= dmg;
				num6 += dmg; // [!code --]
				num7 += dmg; // [!code ++]
			}
			if (Chara.mana.value <= 0)
			{
				hp -= num7; // [!code --]
				num6 += num7; // [!code --]
				hp -= num8; // [!code ++]
				num7 += num8; // [!code ++]
			}
		}
		dmg = num6; // [!code --]
		dmg = num7; // [!code ++]
	}
	else
	{
```

[`@@ -3925,9 +3933,9 @@ public void DamageHP(int dmg, int ele, int eleP = 100, AttackSource attackSource`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Card.cs#L3925-L3933)
```cs:line-numbers=3925
				if (e != Element.Void)
				{
					c2 = EClass.Colors.elementColors.TryGetValue(e.source.alias);
					float num14 = (c2.r + c2.g + c2.b) / 3f; // [!code --]
					num14 = ((num14 > 0.5f) ? 0f : (0.6f - num14)); // [!code --]
					c2 = new Color(c2.r + num14, c2.g + num14, c2.b + num14, 1f); // [!code --]
					float num15 = (c2.r + c2.g + c2.b) / 3f; // [!code ++]
					num15 = ((num15 > 0.5f) ? 0f : (0.6f - num15)); // [!code ++]
					c2 = new Color(c2.r + num15, c2.g + num15, c2.b + num15, 1f); // [!code ++]
				}
				popper.SetText(dmg.ToString() ?? "", c2);
			}
```

[`@@ -3995,7 +4003,7 @@ public void DamageHP(int dmg, int ele, int eleP = 100, AttackSource attackSource`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Card.cs#L3995-L4001)
```cs:line-numbers=3995
					if (EClass.player.invlunerable)
					{
						EvadeDeath();
						goto IL_0a8f; // [!code --]
						goto IL_0af8; // [!code ++]
					}
				}
				if (IsPC && Evalue(1220) > 0 && Chara.stamina.value >= Chara.stamina.max / 2)
```

[`@@ -4007,8 +4015,8 @@ public void DamageHP(int dmg, int ele, int eleP = 100, AttackSource attackSource`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Card.cs#L4007-L4014)
```cs:line-numbers=4007
			}
		}
	}
	goto IL_0a8f; // [!code --]
	IL_0a8f: // [!code --]
	goto IL_0af8; // [!code ++]
	IL_0af8: // [!code ++]
	if (trait.CanBeAttacked)
	{
		renderer.PlayAnime(AnimeID.HitObj);
```

[`@@ -4141,20 +4149,20 @@ public void DamageHP(int dmg, int ele, int eleP = 100, AttackSource attackSource`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Card.cs#L4141-L4160)
```cs:line-numbers=4141
	}
	else if ((attackSource == AttackSource.Melee || attackSource == AttackSource.Range) && origin != null)
	{
		(IsPC ? EClass.pc : origin).Say("dmgMelee" + num5 + (IsPC ? "pc" : ""), origin, this); // [!code --]
		(IsPC ? EClass.pc : origin).Say("dmgMelee" + num6 + (IsPC ? "pc" : ""), origin, this); // [!code ++]
	}
	else if (isChara)
	{
		int num8 = ((attackSource != AttackSource.Condition && attackSource != AttackSource.WeaponEnchant) ? 1 : 2); // [!code --]
		if (num5 >= num8) // [!code --]
		int num9 = ((attackSource != AttackSource.Condition && attackSource != AttackSource.WeaponEnchant) ? 1 : 2); // [!code ++]
		if (num6 >= num9) // [!code ++]
		{
			if (e != Element.Void)
			{
				Say("dmg_" + e.source.alias, this);
			}
			if (e == Element.Void || num5 >= 2) // [!code --]
			if (e == Element.Void || num6 >= 2) // [!code ++]
			{
				Say("dmg" + num5, this); // [!code --]
				Say("dmg" + num6, this); // [!code ++]
			}
		}
	}
```

[`@@ -4199,15 +4207,15 @@ public void DamageHP(int dmg, int ele, int eleP = 100, AttackSource attackSource`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Card.cs#L4199-L4213)
```cs:line-numbers=4199
			elements.ModExp(123, a3);
		}
	}
	int num9 = ((EClass.rnd(2) == 0) ? 1 : 0); // [!code --]
	int num10 = ((EClass.rnd(2) == 0) ? 1 : 0); // [!code ++]
	if (attackSource == AttackSource.Condition)
	{
		num9 = 1 + EClass.rnd(2); // [!code --]
		num10 = 1 + EClass.rnd(2); // [!code ++]
	}
	if (num9 > 0) // [!code --]
	if (num10 > 0) // [!code ++]
	{
		bool flag = Chara.HasCondition<ConPoison>() || ((e.id == 915 || e.id == 923) && ResistLv(Evalue(955)) < 4);
		AddBlood(num9, flag ? 6 : (-1)); // [!code --]
		AddBlood(num10, flag ? 6 : (-1)); // [!code ++]
	}
	bool flag2 = true;
	switch (e.id)
```

[`@@ -4359,14 +4367,14 @@ public void DamageHP(int dmg, int ele, int eleP = 100, AttackSource attackSource`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Card.cs#L4359-L4372)
```cs:line-numbers=4359
	}
	if (IsPC)
	{
		float num10 = (float)hp / (float)MaxHP; // [!code --]
		float num11 = (float)hp / (float)MaxHP; // [!code ++]
		if (Evalue(1421) > 0)
		{
			num10 = (float)Chara.mana.value / (float)Chara.mana.max; // [!code --]
			num11 = (float)Chara.mana.value / (float)Chara.mana.max; // [!code ++]
		}
		if (num10 < 0.3f) // [!code --]
		if (num11 < 0.3f) // [!code ++]
		{
			PlaySound("heartbeat", 1f - num10 * 2f); // [!code --]
			PlaySound("heartbeat", 1f - num11 * 2f); // [!code ++]
		}
	}
	if (!IsPC && hp < MaxHP / 5 && Evalue(423) <= 0 && dmg * 100 / MaxHP + 10 > EClass.rnd(IsPowerful ? 400 : 150) && !HasCondition<ConFear>())
```

[`@@ -4439,29 +4447,29 @@ void ProcAbsorb()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Card.cs#L4439-L4467)
```cs:line-numbers=4439
			int valueOrDefault2 = (origin.Evalue(661) + weapon?.Evalue(661, ignoreGlobalElement: true)).GetValueOrDefault();
			if (valueOrDefault > 0 && attackSource == AttackSource.Melee && origin.isChara && Chara.IsHostile(origin as Chara))
			{
				int num11 = EClass.rnd(3 + Mathf.Clamp(dmg / 100, 0, valueOrDefault / 10)); // [!code --]
				origin.Chara.stamina.Mod(num11); // [!code --]
				int num12 = EClass.rnd(3 + Mathf.Clamp(dmg / 100, 0, valueOrDefault / 10)); // [!code ++]
				origin.Chara.stamina.Mod(num12); // [!code ++]
				if (IsAliveInCurrentZone)
				{
					Chara.stamina.Mod(-num11); // [!code --]
					Chara.stamina.Mod(-num12); // [!code ++]
				}
			}
			if (origin.HasElement(1350) && attackSource == AttackSource.Melee)
			{
				int num12 = EClass.rndHalf(2 + Mathf.Clamp(dmg / 10, 0, origin.Chara.GetPietyValue() + 10)); // [!code --]
				origin.Chara.mana.Mod(num12); // [!code --]
				int num13 = EClass.rndHalf(2 + Mathf.Clamp(dmg / 10, 0, origin.Chara.GetPietyValue() + 10)); // [!code ++]
				origin.Chara.mana.Mod(num13); // [!code ++]
				if (IsAliveInCurrentZone)
				{
					Chara.mana.Mod(-num12); // [!code --]
					Chara.mana.Mod(-num13); // [!code ++]
				}
			}
			if (valueOrDefault2 > 0 && attackSource == AttackSource.Melee)
			{
				int num13 = EClass.rnd(2 + Mathf.Clamp(dmg / 10, 0, valueOrDefault2 + 10)); // [!code --]
				origin.Chara.mana.Mod(num13); // [!code --]
				int num14 = EClass.rnd(2 + Mathf.Clamp(dmg / 10, 0, valueOrDefault2 + 10)); // [!code ++]
				origin.Chara.mana.Mod(num14); // [!code ++]
				if (IsAliveInCurrentZone)
				{
					Chara.mana.Mod(-num13); // [!code --]
					Chara.mana.Mod(-num14); // [!code ++]
				}
			}
		}
```

[`@@ -6099,7 +6107,7 @@ public void Say(string lang, Card c1, string ref1 = null, string ref2 = null)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Card.cs#L6099-L6105)
```cs:line-numbers=6099

	public string GetTalkText(string idTopic, bool stripPun = false, bool useDefault = true)
	{
		bool flag = isChara && Chara.IsHuman; // [!code --]
		bool flag = isChara && Chara.IsHumanSpeak; // [!code ++]
		string text = MOD.listTalk.GetTalk(c_idTalk.IsEmpty(id), idTopic, useDefault, flag);
		if (!text.IsEmpty())
		{
```

## Chara

[`@@ -2962,7 +2962,7 @@ public void TryPush(Point point)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Chara.cs#L2962-L2968)
```cs:line-numbers=2962
					c.ModCurrency(num);
					c.PlaySound("steal_money");
				}
				else if (IsPC && !c.IsPCParty && !c.IsUnique && c.IsHuman && EClass.rnd(5) == 0) // [!code --]
				else if (IsPC && !c.IsPCParty && !c.IsUnique && c.IsHumanSpeak && EClass.rnd(5) == 0) // [!code ++]
				{
					c.Talk("pushed");
				}
```

[`@@ -5429,6 +5429,17 @@ public bool UseAbility(Act a, Card tc = null, Point pos = null, bool pt = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Chara.cs#L5429-L5434)
```cs:line-numbers=5429
		return true;
	}
	bool flag2 = true;
	switch (a.id) // [!code ++]
	{ // [!code ++]
	case 9150: // [!code ++]
		EClass.player.forceTalk = true; // [!code ++]
		Talk("ab_meteor"); // [!code ++]
		break; // [!code ++]
	case 6662: // [!code ++]
		EClass.player.forceTalk = true; // [!code ++]
		Talk("ab_swarm"); // [!code ++]
		break; // [!code ++]
	} // [!code ++]
	if (pt)
	{
		Act.forcePt = true;
```

[`@@ -7645,14 +7656,14 @@ public void GiveLovePotion(Chara c, Thing t)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Chara.cs#L7645-L7658)
```cs:line-numbers=7645

	public void RequestProtection(Chara attacker, Action<Chara> action)
	{
		if (HasCondition<StanceTaunt>() || base.isRestrained || attacker == this || (host != null && host.isRestrained) || (IsPCFaction && attacker.IsPCFaction)) // [!code --]
		if (HasCondition<StanceTaunt>() || base.isRestrained || attacker == this || (host != null && host.isRestrained) || (base.IsPCFactionOrMinion && attacker.IsPCFactionOrMinion)) // [!code ++]
		{
			return;
		}
		bool flag = false;
		foreach (Chara chara in EClass._map.charas)
		{
			if (chara == attacker || chara.enemy == this || chara == this || chara.host != null || chara.IsDisabled || !chara.IsFriendOrAbove(this) || chara.conSuspend != null || (chara.IsPCParty && !IsPCParty) || (IsPCFaction && !chara.IsPCFaction)) // [!code --]
			if (chara == attacker || chara.enemy == this || chara == this || chara.host != null || chara.IsDisabled || !chara.IsFriendOrAbove(this) || chara.conSuspend != null || (chara.IsPCParty && !IsPCParty) || (IsPCFaction && !chara.IsPCFaction) || (attacker.IsPCFactionOrMinion && chara.IsPCFactionOrMinion)) // [!code ++]
			{
				continue;
			}
```

## DOMAIN

[`@@ -2,42 +2,42 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/DOMAIN.cs#L2-L43)
```cs:line-numbers=2

public class DOMAIN
{
	public const int domHealing = 811; // [!code --]
	public const int domOblivion = 813; // [!code ++]
 // [!code ++]
	public const int domWind = 807; // [!code ++]

	public const int domLuck = 810;

	public const int domMachine = 809;

	public const int domOblivion = 813; // [!code --]
 // [!code --]
	public const int domHarvest = 808; // [!code --]
	public const int domHarmony = 815; // [!code ++]

	public const int domEyth = 814;

	public const int domHarmony = 815; // [!code --]
	public const int domEarth = 812; // [!code ++]

	public const int domFaith = 802; // [!code --]
	public const int domHarvest = 808; // [!code ++]

	public const int domEarth = 812; // [!code --]
	public const int domComm = 805; // [!code ++]

	public const int domWind = 807; // [!code --]
	public const int domTest = 800; // [!code ++]

	public const int domElement = 806; // [!code --]
	public const int domHealing = 811; // [!code ++]

	public const int domComm = 805; // [!code --]
	public const int domElement = 806; // [!code ++]

	public const int domArcane = 804;

	public const int domMiracle = 803;

	public const int domSurvival = 801; // [!code --]
	public const int domFaith = 802; // [!code ++]

	public const int domTest = 800; // [!code --]
	public const int domSurvival = 801; // [!code ++]

	public static readonly int[] IDS = new int[16]
	{
		811, 810, 809, 813, 808, 814, 815, 802, 812, 807, // [!code --]
		806, 805, 804, 803, 801, 800 // [!code --]
		813, 807, 810, 809, 815, 814, 812, 808, 805, 800, // [!code ++]
		811, 806, 804, 803, 802, 801 // [!code ++]
	};
}
public class Domain : EClass
```

## DramaCustomSequence

[`@@ -39,7 +39,7 @@ public void Build(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/DramaCustomSequence.cs#L39-L45)
```cs:line-numbers=39
	_ = c.Name;
	string rumor = (c.IsPCParty ? GetTalk("sup") : GetRumor(c));
	Layer layer = null;
	bool flag3 = c.IsHuman || EClass.pc.HasElement(1640); // [!code --]
	bool flag3 = c.IsHumanSpeak || EClass.pc.HasElement(1640); // [!code ++]
	if (!flag)
	{
		Step("Resident");
```

## EClass

[`@@ -47,6 +47,14 @@ public class EClass`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/EClass.cs#L47-L52)
```cs:line-numbers=47

	public static CoreDebug debug => core.debug;

	public static int rndSeed(int a, int seed) // [!code ++]
	{ // [!code ++]
		Rand.SetSeed(seed); // [!code ++]
		int result = rnd(a); // [!code ++]
		Rand.SetSeed(); // [!code ++]
		return result; // [!code ++]
	} // [!code ++]
 // [!code ++]
	public static int rnd(int a)
	{
		return Rand.rnd(a);
```

## ELEMENT

[`@@ -5,27 +5,27 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ELEMENT.cs#L5-L31)
```cs:line-numbers=5

public class ELEMENT
{
	public const int purity = 759; // [!code --]
 // [!code --]
	public const int roasted = 762;

	public const int stimulant = 760; // [!code --]
	public const int antidote = 753; // [!code ++]

	public const int comfort = 750; // [!code --]
	public const int recharge = 761; // [!code ++]

	public const int rare = 751; // [!code --]
	public const int purity = 759; // [!code ++]

	public const int cute = 752; // [!code --]
	public const int hotspring = 756; // [!code ++]

	public const int antidote = 753; // [!code --]
	public const int blood = 755; // [!code ++]

	public const int nerve = 754;

	public const int blood = 755; // [!code --]
	public const int comfort = 750; // [!code ++]

	public const int recharge = 761; // [!code --]
	public const int rare = 751; // [!code ++]

	public const int hotspring = 756; // [!code --]
	public const int stimulant = 760; // [!code ++]
 // [!code ++]
	public const int cute = 752; // [!code ++]

	public const int _void = 0;

```

[`@@ -75,8 +75,8 @@ public class ELEMENT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ELEMENT.cs#L75-L82)
```cs:line-numbers=75

	public static readonly int[] IDS = new int[34]
	{
		759, 762, 760, 750, 751, 752, 753, 754, 755, 761, // [!code --]
		756, 0, 3, 1, 2, 5, 10, 11, 12, 13, // [!code --]
		762, 753, 761, 759, 756, 755, 754, 750, 751, 760, // [!code ++]
		752, 0, 3, 1, 2, 5, 10, 11, 12, 13, // [!code ++]
		14, 16, 17, 18, 15, 21, 22, 23, 24, 25,
		26, 29, 85, 20
	};
```

[`@@ -660,24 +660,36 @@ public void _WriteNote(UINote n, Chara c, Act act)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ELEMENT.cs#L660-L683)
```cs:line-numbers=660
		n.Space();
		n.AddText("isGlobalAct".lang());
	}
	if (cost.type != 0 && cost.cost != 0) // [!code --]
	if (cost.type == Act.CostType.None || cost.cost == 0) // [!code ++]
	{
		n.Space(4); // [!code --]
		UIItem uIItem = n.AddExtra<UIItem>("costPrice"); // [!code --]
		int num = cost.cost; // [!code --]
		if (cost.type == Act.CostType.MP && c.Evalue(483) > 0) // [!code --]
		return; // [!code ++]
	} // [!code ++]
	n.Space(4); // [!code ++]
	UIItem uIItem = n.AddExtra<UIItem>("costPrice"); // [!code ++]
	int num = cost.cost; // [!code ++]
	if (cost.type == Act.CostType.MP) // [!code ++]
	{ // [!code ++]
		if (c.Evalue(483) > 0) // [!code ++]
		{
			num = cost.cost * 100 / (100 + (int)Mathf.Sqrt(c.Evalue(483) * 10) * 3);
		}
		string text4 = cost.cost.ToString() ?? ""; // [!code --]
		if (num != cost.cost) // [!code --]
		if (c.IsPC && c.HasCondition<StanceManaCost>()) // [!code ++]
		{
			text4 = num + " (" + text4 + ")"; // [!code --]
			int num2 = c.Evalue(1657); // [!code ++]
			if (num2 > 0 && vPotential >= 2) // [!code ++]
			{ // [!code ++]
				num = num * (100 - num2 * 20) / 100; // [!code ++]
			} // [!code ++]
		}
		uIItem.text1.SetText(text4, (((cost.type == Act.CostType.MP) ? c.mana.value : c.stamina.value) >= num) ? FontColor.Good : FontColor.Bad); // [!code --]
		uIItem.image1.sprite = ((cost.type == Act.CostType.MP) ? EClass.core.refs.icons.mana : EClass.core.refs.icons.stamina); // [!code --]
		uIItem.image1.SetNativeSize(); // [!code --]
	}
	string text4 = cost.cost.ToString() ?? ""; // [!code ++]
	if (num != cost.cost) // [!code ++]
	{ // [!code ++]
		text4 = num + " (" + text4 + ")"; // [!code ++]
	} // [!code ++]
	uIItem.text1.SetText(text4, (((cost.type == Act.CostType.MP) ? c.mana.value : c.stamina.value) >= num) ? FontColor.Good : FontColor.Bad); // [!code ++]
	uIItem.image1.sprite = ((cost.type == Act.CostType.MP) ? EClass.core.refs.icons.mana : EClass.core.refs.icons.stamina); // [!code ++]
	uIItem.image1.SetNativeSize(); // [!code ++]
	string Calc()
	{
		Dice dice = Dice.Create(e, c);
```

## ENC

[`@@ -68,7 +68,7 @@ public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ENC.cs#L68-L74)
```cs:line-numbers=68

	public const int negateFear = 423;

	public const int negateBlind = 421; // [!code --]
	public const int negateParalysis = 422; // [!code ++]

	public const int negatePoison = 420;

```

[`@@ -114,7 +114,7 @@ public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ENC.cs#L114-L120)
```cs:line-numbers=114

	public const int sustain_STR = 440;

	public const int negateParalysis = 422; // [!code --]
	public const int negateBlind = 421; // [!code ++]

	public const int sustain_DEX = 442;

```

[`@@ -128,10 +128,10 @@ public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ENC.cs#L128-L137)
```cs:line-numbers=128

	public const int mod_reload = 601;

	public const int mod_ammo = 600; // [!code --]
 // [!code --]
	public const int sustain_END = 441;

	public const int slot_rune = 484; // [!code ++]
 // [!code ++]
	public const int optimizeMana = 483;

	public const int force_weapon = 482;
```

[`@@ -148,7 +148,7 @@ public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ENC.cs#L148-L154)
```cs:line-numbers=148

	public const int bane_machine = 465;

	public const int slot_rune = 484; // [!code --]
	public const int mod_ammo = 600; // [!code ++]

	public const int bane_animal = 463;

```

[`@@ -173,11 +173,11 @@ public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ENC.cs#L173-L183)
```cs:line-numbers=173
		653, 652, 651, 650, 641, 624, 621, 622, 623, 654,
		640, 655, 851, 660, 661, 662, 663, 664, 665, 666,
		850, 620, 865, 852, 656, 608, 464, 606, 428, 427,
		426, 425, 424, 423, 421, 420, 418, 417, 416, 415, // [!code --]
		426, 425, 424, 423, 422, 420, 418, 417, 416, 415, // [!code ++]
		414, 412, 411, 410, 409, 408, 407, 406, 405, 404,
		403, 402, 401, 400, 607, 429, 440, 422, 442, 605, // [!code --]
		604, 603, 602, 601, 600, 441, 483, 482, 481, 480, // [!code --]
		468, 467, 466, 465, 484, 463, 462, 461, 460, 447, // [!code --]
		403, 402, 401, 400, 607, 429, 440, 421, 442, 605, // [!code ++]
		604, 603, 602, 601, 441, 484, 483, 482, 481, 480, // [!code ++]
		468, 467, 466, 465, 600, 463, 462, 461, 460, 447, // [!code ++]
		446, 445, 444, 443
	};
}
```

## EffectId

[`@@ -113,5 +113,6 @@ public enum EffectId`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/EffectId.cs#L113-L117)
```cs:line-numbers=113
	Scream = 289,
	DropMine = 290,
	ThrowPotion = 291,
	DrainMana = 292 // [!code --]
	DrainMana = 292, // [!code ++]
	Swarm = 293 // [!code ++]
}
```

## FACTION

[`@@ -20,7 +20,7 @@ public class FACTION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/FACTION.cs#L20-L26)
```cs:line-numbers=20

	public const int fRation = 2207;

	public const int fLoyal = 2117; // [!code --]
	public const int fEducation = 2116; // [!code ++]

	public const int bfGeyser = 3701;

```

[`@@ -42,13 +42,13 @@ public class FACTION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/FACTION.cs#L42-L54)
```cs:line-numbers=42

	public const int fHeirloom = 2120;

	public const int fEducation = 2116; // [!code --]
	public const int fTaxEvasion = 2119; // [!code ++]

	public const int fAdmin = 2115;

	public const int fLuck = 2118; // [!code --]
	public const int fLoyal = 2117; // [!code ++]

	public const int fTaxEvasion = 2119; // [!code --]
	public const int fLuck = 2118; // [!code ++]

	public const int bfRuin = 3702;

```

[`@@ -110,9 +110,9 @@ public class FACTION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/FACTION.cs#L110-L118)
```cs:line-numbers=110

	public static readonly int[] IDS = new int[52]
	{
		3500, 3600, 3601, 3602, 3603, 3700, 3605, 2207, 2117, 3701, // [!code --]
		3604, 2206, 2202, 2204, 2203, 2003, 2201, 2200, 2120, 2116, // [!code --]
		2115, 2118, 2119, 3702, 2205, 3703, 3707, 3705, 4006, 4005, // [!code --]
		3500, 3600, 3601, 3602, 3603, 3700, 3605, 2207, 2116, 3701, // [!code ++]
		3604, 2206, 2202, 2204, 2203, 2003, 2201, 2200, 2120, 2119, // [!code ++]
		2115, 2117, 2118, 3702, 2205, 3703, 3707, 3705, 4006, 4005, // [!code ++]
		4004, 4003, 4002, 4001, 3704, 3900, 3805, 3804, 3803, 4000,
		3801, 3802, 3708, 3709, 3710, 3780, 3706, 3782, 3783, 3784,
		3800, 3781
```

## FEAT

[`@@ -59,7 +59,7 @@ public class FEAT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/FEAT.cs#L59-L65)
```cs:line-numbers=59

	public const int featChef = 1658;

	public const int featManaCost = 1657; // [!code --]
	public const int featScavenger = 1656; // [!code ++]

	public const int featModelBeliever = 1655;

```

[`@@ -103,7 +103,7 @@ public class FEAT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/FEAT.cs#L103-L109)
```cs:line-numbers=103

	public const int featReboot = 1410;

	public const int featScavenger = 1656; // [!code --]
	public const int featManaCost = 1657; // [!code ++]

	public const int featPaladin2 = 1408;

```

[`@@ -207,10 +207,12 @@ public class FEAT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/FEAT.cs#L207-L216)
```cs:line-numbers=207

	public const int featCosmicHorror = 1233;

	public const int featGod_moonshadow1 = 1350; // [!code --]
	public const int featWizard = 1402; // [!code ++]

	public const int featGod_trickery1 = 1345;

	public const int featGod_moonshadow1 = 1350; // [!code ++]
 // [!code ++]
	public const int featGod_strife1 = 1355;

	public const int featWarrior = 1400;
```

[`@@ -221,11 +223,9 @@ public class FEAT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/FEAT.cs#L221-L231)
```cs:line-numbers=221

	public const int featArcher = 1404;

	public const int featPianist = 1405; // [!code --]
 // [!code --]
	public const int featTourist = 1406;

	public const int featWizard = 1402; // [!code --]
	public const int featPianist = 1405; // [!code ++]

	public const int featPaladin = 1407;

```

[`@@ -233,16 +233,16 @@ public class FEAT`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/FEAT.cs#L233-L248)
```cs:line-numbers=233
	{
		1628, 1627, 1626, 1625, 1624, 1623, 1622, 1621, 1620, 1612,
		1412, 1610, 1421, 1420, 1419, 1418, 1417, 1416, 1415, 1414,
		1413, 1629, 1611, 1630, 1645, 1632, 1411, 1658, 1657, 1655, // [!code --]
		1413, 1629, 1611, 1630, 1645, 1632, 1411, 1658, 1656, 1655, // [!code ++]
		1654, 1653, 1652, 1651, 1650, 1649, 1631, 1648, 1646, 1644,
		1643, 1642, 1641, 1640, 1636, 1635, 1634, 1633, 1647, 1410,
		1656, 1408, 1225, 1226, 1227, 1228, 1229, 1230, 1231, 1232, // [!code --]
		1657, 1408, 1225, 1226, 1227, 1228, 1229, 1230, 1231, 1232, // [!code ++]
		1234, 1235, 1236, 1237, 1238, 1239, 1300, 1305, 1310, 1315,
		1320, 1325, 1330, 1224, 1223, 1222, 1221, 1409, 1200, 1201,
		1202, 1203, 1204, 1205, 1206, 1207, 1208, 1335, 1209, 1211,
		1212, 1213, 1214, 1215, 1216, 1217, 1218, 1219, 1220, 1210,
		1340, 1233, 1350, 1345, 1355, 1400, 1401, 1403, 1404, 1405, // [!code --]
		1406, 1402, 1407 // [!code --]
		1340, 1233, 1402, 1345, 1350, 1355, 1400, 1401, 1403, 1404, // [!code ++]
		1406, 1405, 1407 // [!code ++]
	};
}
public class Feat : Element
```

## FOOD

[`@@ -1,22 +1,22 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/FOOD.cs#L1-L22)
```cs:line-numbers=1
public class FOOD
{
	public const int food_CHA = 700; // [!code --]
	public const int food_poison = 702; // [!code ++]

	public const int food_cat = 701; // [!code --]
	public const int food_love = 703; // [!code ++]

	public const int food_god = 758; // [!code --]
	public const int food_bug = 704; // [!code ++]

	public const int justcooked = 757; // [!code --]
	public const int gainWeight = 705; // [!code ++]

	public const int food_poison = 702; // [!code --]
	public const int loseWeight = 706; // [!code ++]

	public const int gainWeight = 705; // [!code --]
	public const int justcooked = 757; // [!code ++]

	public const int food_bug = 704; // [!code --]
	public const int food_god = 758; // [!code ++]

	public const int food_love = 703; // [!code --]
	public const int food_cat = 701; // [!code ++]

	public const int loseWeight = 706; // [!code --]
	public const int food_CHA = 700; // [!code ++]

	public static readonly int[] IDS = new int[9] { 700, 701, 758, 757, 702, 705, 704, 703, 706 }; // [!code --]
	public static readonly int[] IDS = new int[9] { 702, 703, 704, 705, 706, 757, 758, 701, 700 }; // [!code ++]
}
```

## GamePrincipal

[`@@ -8,7 +8,8 @@ public class GamePrincipal : EClass`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/GamePrincipal.cs#L8-L14)
```cs:line-numbers=8
	public enum Type
	{
		Oath,
		Workaround // [!code --]
		Workaround, // [!code ++]
		Legacy // [!code ++]
	}

	public class Item
```

[`@@ -152,6 +153,9 @@ public void SetInt(int value)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/GamePrincipal.cs#L152-L157)
```cs:line-numbers=152
	[JsonProperty]
	public bool disableVoidBlessing;

	[JsonProperty] // [!code ++]
	public bool enableDamageReduction; // [!code ++]
 // [!code ++]
	[JsonProperty]
	public HashSet<string> modified = new HashSet<string>();

```

[`@@ -194,6 +198,10 @@ public List<Item> ListItems()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/GamePrincipal.cs#L194-L199)
```cs:line-numbers=194
	{
		petFeatExpMtp = a;
	}, (int a) => 0.5f + 0.5f * (float)a + "x", 3);
	Add(-1, Type.Legacy, "enableDamageReduction", () => enableDamageReduction, delegate(bool a) // [!code ++]
	{ // [!code ++]
		enableDamageReduction = a; // [!code ++]
	}); // [!code ++]
	return list;
	void Add(int grade, Type type, string id, Func<bool> _get, Action<bool> _set)
	{
```

## GenRoom

[`@@ -178,7 +178,7 @@ public void Fill()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/GenRoom.cs#L178-L184)
```cs:line-numbers=178
	BiomeProfile.TileFloor floor = group.floor;
	BiomeProfile.TileBlock block = group.block;
	int idMat = block.mat;
	if (zone is Zone_RandomDungeonNature && EClass.rnd(3) != 0) // [!code --]
	if (zone is Zone_RandomDungeonNature && EClass.rndSeed(3, zone.uid) != 0) // [!code ++]
	{
		block = EClass.core.refs.biomes.dict["Dungeon_Forest"].exterior.block;
		if (zone is Zone_RandomDungeonPlain)
```

## HotbarManager

[`@@ -129,6 +129,41 @@ public void ResetHotbar(int id)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/HotbarManager.cs#L129-L134)
```cs:line-numbers=129
		}
		else if (EClass._zone is Zone_Tent)
		{
			if (flag || EClass.pc.homeBranch.elements.Has(4006)) // [!code ++]
			{ // [!code ++]
				hotbar.SetItem(new HotItemActionMode // [!code ++]
				{ // [!code ++]
					id = "Inspect" // [!code ++]
				}).always = true; // [!code ++]
			} // [!code ++]
			if (flag || EClass.pc.homeBranch.elements.Has(4000)) // [!code ++]
			{ // [!code ++]
				hotbar.SetItem(new HotItemActionMode // [!code ++]
				{ // [!code ++]
					id = "Cut" // [!code ++]
				}); // [!code ++]
			} // [!code ++]
			if (flag || EClass.pc.homeBranch.elements.Has(4001)) // [!code ++]
			{ // [!code ++]
				hotbar.SetItem(new HotItemActionMode // [!code ++]
				{ // [!code ++]
					id = "Mine" // [!code ++]
				}); // [!code ++]
			} // [!code ++]
			if (flag || EClass.pc.homeBranch.elements.Has(4001)) // [!code ++]
			{ // [!code ++]
				hotbar.SetItem(new HotItemActionMode // [!code ++]
				{ // [!code ++]
					id = "Dig" // [!code ++]
				}); // [!code ++]
			} // [!code ++]
			if (flag || EClass.pc.homeBranch.elements.Has(4004)) // [!code ++]
			{ // [!code ++]
				hotbar.SetItem(new HotItemActionMode // [!code ++]
				{ // [!code ++]
					id = "Deconstruct" // [!code ++]
				}); // [!code ++]
			} // [!code ++]
			hotbar.SetItem(new HotItemActionMode
			{
				id = "Terrain"
```

## LayerUploader

[`@@ -144,7 +144,7 @@ public void Upload()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/LayerUploader.cs#L144-L150)
```cs:line-numbers=144
		string text2 = inputPassword.text;
		SaveID();
		ExportMap();
		Net.UploadFile(text, text2, ELayer.pc.NameBraced, ELayer._zone.Name, savePath, Lang.langCode); // [!code --]
		Net.UploadFile(text, text2, ELayer.pc.NameBraced, ELayer._zone.Name, savePath, Lang.langCode, (ELayer._zone is Zone_Tent) ? "Tent" : "Home"); // [!code ++]
		nextUpload = (int)Time.realtimeSinceStartup + limitSec;
	}
}
```

## LayerWorldSetting

[`@@ -141,6 +141,7 @@ public void Refresh()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/LayerWorldSetting.cs#L141-L146)
```cs:line-numbers=141
	if (ELayer.player.showWorkaround)
	{
		AddCategory(GamePrincipal.Type.Workaround);
		AddCategory(GamePrincipal.Type.Legacy); // [!code ++]
	}
	transCustom.RebuildLayout();
	void AddCategory(GamePrincipal.Type type)
```

[`@@ -169,9 +170,9 @@ void AddCategory(GamePrincipal.Type type)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/LayerWorldSetting.cs#L169-L177)
```cs:line-numbers=169
			}
			bool flag = item.id == "permadeath" && !IsEmbark && !item.WasSealed();
			b.mainText.SetText(("pp_" + item.id).lang());
			b.icon.SetActive(item.IsSealed() || item.WasSealed()); // [!code --]
			b.icon.SetActive(item.grade >= 0 && (item.IsSealed() || item.WasSealed())); // [!code ++]
			b.icon.SetAlpha(item.IsSealed() ? 1f : 0.3f);
			b.icon.sprite = sprites[item.grade]; // [!code --]
			b.icon.sprite = ((item.grade < 0) ? null : sprites[item.grade]); // [!code ++]
			b.icon.SetNativeSize();
			b.GetOrCreate<CanvasGroup>().alpha = (flag ? 0.5f : 1f);
			string text = "pp_" + item.id + "_hint";
```

[`@@ -186,7 +187,7 @@ void AddCategory(GamePrincipal.Type type)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/LayerWorldSetting.cs#L186-L192)
```cs:line-numbers=186
					pp.id = -1;
					RefreshTemplate();
				}
				b.icon.SetActive(item.IsSealed() || item.WasSealed()); // [!code --]
				b.icon.SetActive(item.grade >= 0 && (item.IsSealed() || item.WasSealed())); // [!code ++]
				b.icon.SetAlpha(item.IsSealed() ? 1f : 0.3f);
			});
		}
```

## MUTATION

[`@@ -1,32 +1,34 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/MUTATION.cs#L1-L32)
```cs:line-numbers=1
public class MUTATION
{
	public const int mutationDex = 1514; // [!code ++]
 // [!code ++]
	public const int mutationRegen = 1516;

	public const int mutationDexN = 1515; // [!code ++]
 // [!code ++]
	public const int etherPoisonHand = 1565;

	public const int mutationSkin = 1510; // [!code --]
	public const int mutationEye = 1512; // [!code ++]

	public const int mutationSkinN = 1511;

	public const int mutationEye = 1512; // [!code --]
	public const int mutationRegenN = 1517; // [!code ++]

	public const int mutationEyeN = 1513;

	public const int mutationDex = 1514; // [!code --]
	public const int mutationSpeed = 1518; // [!code ++]

	public const int mutationDexN = 1515; // [!code --]
	public const int mutationSkin = 1510; // [!code ++]

	public const int mutationRegenN = 1517; // [!code --]
	public const int mutationStr = 1520; // [!code ++]

	public const int etherManaBattery = 1564;

	public const int mutationSpeedN = 1519; // [!code --]
 // [!code --]
	public const int etherProvoke = 1563;

	public const int etherArmor = 1562;

	public const int mutationSpeed = 1518; // [!code --]
	public const int mutationSpeedN = 1519; // [!code ++]

	public const int etherWeak = 1560;

```

[`@@ -46,15 +48,11 @@ public class MUTATION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/MUTATION.cs#L46-L60)
```cs:line-numbers=46

	public const int etherFeet = 1552;

	public const int etherUgly = 1551; // [!code --]
 // [!code --]
	public const int etherStupid = 1561;

	public const int etherGravity = 1550; // [!code --]
 // [!code --]
	public const int mutationStr = 1520; // [!code --]
	public const int etherUgly = 1551; // [!code ++]

	public const int mutationCha = 1522; // [!code --]
	public const int mutationStrN = 1521; // [!code ++]

	public const int mutationChaN = 1523;

```

[`@@ -62,9 +60,9 @@ public class MUTATION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/MUTATION.cs#L62-L70)
```cs:line-numbers=62

	public const int mutationBrainN = 1525;

	public const int mutationStrN = 1521; // [!code --]
	public const int mutationCold = 1526; // [!code ++]

	public const int mutationColdN = 1527; // [!code --]
	public const int mutationCha = 1522; // [!code ++]

	public const int mutationLightning = 1528;

```

[`@@ -74,14 +72,16 @@ public class MUTATION`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/MUTATION.cs#L74-L87)
```cs:line-numbers=74

	public const int mutationBodyN = 1531;

	public const int mutationCold = 1526; // [!code --]
	public const int etherGravity = 1550; // [!code ++]
 // [!code ++]
	public const int mutationColdN = 1527; // [!code ++]

	public static readonly int[] IDS = new int[38]
	{
		1516, 1565, 1510, 1511, 1512, 1513, 1514, 1515, 1517, 1564, // [!code --]
		1519, 1563, 1562, 1518, 1560, 1559, 1558, 1557, 1556, 1555, // [!code --]
		1554, 1553, 1552, 1551, 1561, 1550, 1520, 1522, 1523, 1524, // [!code --]
		1525, 1521, 1527, 1528, 1529, 1530, 1531, 1526 // [!code --]
		1514, 1516, 1515, 1565, 1512, 1511, 1517, 1513, 1518, 1510, // [!code ++]
		1520, 1564, 1563, 1562, 1519, 1560, 1559, 1558, 1557, 1556, // [!code ++]
		1555, 1554, 1553, 1552, 1561, 1551, 1521, 1523, 1524, 1525, // [!code ++]
		1526, 1522, 1528, 1529, 1530, 1531, 1550, 1527 // [!code ++]
	};
}
public class Mutation : Feat
```

## MapGenDungen

[`@@ -36,7 +36,7 @@ protected override bool OnGenerateTerrain()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/MapGenDungen.cs#L36-L42)
```cs:line-numbers=36
	BiomeProfile.TileFloor floor = biome.exterior.floor;
	BiomeProfile.TileBlock block = biome.exterior.block;
	int idMat = -1;
	if (zone is Zone_RandomDungeonNature && EClass.rnd(3) != 0) // [!code --]
	if (zone is Zone_RandomDungeonNature && EClass.rndSeed(3, zone.uid) != 0) // [!code ++]
	{
		block = EClass.core.refs.biomes.dict["Dungeon_Forest"].exterior.block;
		if (zone is Zone_RandomDungeonPlain)
```

## ModManager

[`@@ -194,7 +194,7 @@ public IEnumerator RefreshMods(Action onComplete, bool syncMods)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/ModManager.cs#L194-L200)
```cs:line-numbers=194
	ListPluginObject.Clear();
	foreach (BaseModPackage package5 in packages)
	{
		if (package5.IsValidVersion()) // [!code --]
		if (package5.IsValidVersion() && (!disableMod || package5.builtin)) // [!code ++]
		{
			package5.Activate();
			if (package5.activated)
```

## Net

[`@@ -37,6 +37,8 @@ public class DownloadMeta`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Net.cs#L37-L42)
```cs:line-numbers=37

		public string path;

		public string cat; // [!code ++]
 // [!code ++]
		public string date;

		public int version;
```

[`@@ -98,7 +100,7 @@ public void ShowChat(string logs)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Net.cs#L98-L104)
```cs:line-numbers=98
		}
	}

	public static async UniTask<bool> UploadFile(string id, string password, string name, string title, string path, string idLang) // [!code --]
	public static async UniTask<bool> UploadFile(string id, string password, string name, string title, string path, string idLang, string cat = "Home") // [!code ++]
	{
		if (isUploading)
		{
```

[`@@ -117,7 +119,7 @@ public static async UniTask<bool> UploadFile(string id, string password, string`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Net.cs#L117-L123)
```cs:line-numbers=117
	wWWForm.AddField("id", id);
	wWWForm.AddField("name", name);
	wWWForm.AddField("title", title);
	wWWForm.AddField("cat", "Home"); // [!code --]
	wWWForm.AddField("cat", cat); // [!code ++]
	wWWForm.AddField("idLang", idLang);
	wWWForm.AddField("password", password);
	wWWForm.AddField("submit", "Send");
```

[`@@ -220,6 +222,7 @@ public static async UniTask<List<DownloadMeta>> GetFileList(string idLang)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Net.cs#L220-L225)
```cs:line-numbers=220
				id = array[1].Replace("\"", ""),
				name = array[2],
				title = array[3],
				cat = array[5], // [!code ++]
				date = array[6].Replace("\"", ""),
				version = ((array.Length >= 9) ? array[8].ToInt() : 0)
			});
```

## POLICY

[`@@ -3,9 +3,7 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/POLICY.cs#L3-L11)
```cs:line-numbers=3

public class POLICY
{
	public const int store_ripoff = 2816; // [!code --]
 // [!code --]
	public const int livestock_priv = 2715; // [!code --]
	public const int store_premium = 2817; // [!code ++]

	public const int home_discount = 2800;

```

[`@@ -21,11 +19,11 @@ public class POLICY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/POLICY.cs#L21-L31)
```cs:line-numbers=21

	public const int platinum_ticket = 2815;

	public const int store_premium = 2817; // [!code --]
	public const int store_ripoff = 2816; // [!code ++]

	public const int license_stolen = 2824; // [!code --]
	public const int license_food = 2818; // [!code ++]

	public const int license_furniture = 2819; // [!code --]
	public const int license_stolen = 2824; // [!code ++]

	public const int license_general = 2820;

```

[`@@ -35,7 +33,7 @@ public class POLICY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/POLICY.cs#L35-L41)
```cs:line-numbers=35

	public const int legendary_exhibition = 2823;

	public const int forcePanty = 2712; // [!code --]
	public const int livestock_priv = 2715; // [!code ++]

	public const int milk_fan = 2825;

```

[`@@ -45,31 +43,31 @@ public class POLICY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/POLICY.cs#L45-L75)
```cs:line-numbers=45

	public const int license_slaver = 2828;

	public const int license_food = 2818; // [!code --]
 // [!code --]
	public const int incomeTransfer = 2711; // [!code --]
 // [!code --]
	public const int nocturnal_life = 2508; // [!code --]
	public const int license_furniture = 2819; // [!code ++]

	public const int noAnimal = 2709; // [!code --]
	public const int forcePanty = 2712; // [!code ++]

	public const int wealth_tax = 2500; // [!code --]
	public const int vaccination = 2509; // [!code ++]

	public const int faith_tax = 2501; // [!code --]
	public const int noMother = 2710; // [!code ++]

	public const int food_for_people = 2502;

	public const int prohibition = 2503;

	public const int noMother = 2710; // [!code --]
	public const int impressment = 2504; // [!code ++]

	public const int legal_drug = 2505;

	public const int incomeTransfer = 2711; // [!code ++]
 // [!code ++]
	public const int faith_tax = 2501; // [!code ++]
 // [!code ++]
	public const int human_right = 2506;

	public const int inquisition = 2507;

	public const int vaccination = 2509; // [!code --]
	public const int nocturnal_life = 2508; // [!code ++]

	public const int ban_radio = 2510;

```

[`@@ -77,42 +75,44 @@ public class POLICY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/POLICY.cs#L77-L118)
```cs:line-numbers=77

	public const int resident_tax = 2512;

	public const int impressment = 2504; // [!code --]
	public const int resident_wanted = 2513; // [!code ++]

	public const int taxfree = 2514; // [!code --]
	public const int wealth_tax = 2500; // [!code ++]

	public const int noDM = 2708; // [!code --]
	public const int stop_growth = 2515; // [!code ++]

	public const int resident_wanted = 2513; // [!code --]
	public const int speed_growth = 2516; // [!code ++]

	public const int taxTransfer = 2705; // [!code --]
	public const int energy_conservation = 2700; // [!code ++]

	public const int weed_no = 2703; // [!code --]
	public const int noAnimal = 2709; // [!code ++]

	public const int trash_no = 2702; // [!code --]
	public const int trash_sort = 2701; // [!code ++]

	public const int demon_invocation = 2706; // [!code --]
	public const int trash_no = 2702; // [!code ++]

	public const int auto_farm = 2707; // [!code --]
	public const int weed_no = 2703; // [!code ++]

	public const int energy_conservation = 2700; // [!code --]
	public const int noDM = 2708; // [!code ++]

	public const int speed_growth = 2516; // [!code --]
	public const int auto_farm = 2707; // [!code ++]

	public const int stop_growth = 2515; // [!code --]
	public const int taxfree = 2514; // [!code ++]

	public const int trash_sort = 2701; // [!code --]
	public const int taxTransfer = 2705; // [!code ++]

	public const int border_watch = 2704;

	public const int demon_invocation = 2706; // [!code ++]
 // [!code ++]
	public static readonly int[] IDS = new int[51]
	{
		2816, 2715, 2800, 2810, 2811, 2812, 2813, 2814, 2815, 2817, // [!code --]
		2824, 2819, 2820, 2821, 2822, 2823, 2712, 2825, 2826, 2827, // [!code --]
		2828, 2818, 2711, 2508, 2709, 2500, 2501, 2502, 2503, 2710, // [!code --]
		2505, 2506, 2507, 2509, 2510, 2511, 2512, 2504, 2514, 2708, // [!code --]
		2513, 2705, 2703, 2702, 2706, 2707, 2700, 2516, 2515, 2701, // [!code --]
		2704 // [!code --]
		2817, 2800, 2810, 2811, 2812, 2813, 2814, 2815, 2816, 2818, // [!code ++]
		2824, 2820, 2821, 2822, 2823, 2715, 2825, 2826, 2827, 2828, // [!code ++]
		2819, 2712, 2509, 2710, 2502, 2503, 2504, 2505, 2711, 2501, // [!code ++]
		2506, 2507, 2508, 2510, 2511, 2512, 2513, 2500, 2515, 2516, // [!code ++]
		2700, 2709, 2701, 2702, 2703, 2708, 2707, 2514, 2705, 2704, // [!code ++]
		2706 // [!code ++]
	};
}
public class Policy : EClass
```

## SKILL

[`@@ -1,32 +1,32 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/SKILL.cs#L1-L32)
```cs:line-numbers=1
public class SKILL
{
	public const int armorLight = 120; // [!code --]
 // [!code --]
	public const int twohand = 130; // [!code --]
 // [!code --]
	public const int shield = 123;

	public const int armorHeavy = 122;

	public const int acidproof = 51; // [!code --]
	public const int armorLight = 120; // [!code ++]
 // [!code ++]
	public const int fireproof = 50; // [!code ++]

	public const int weaponScythe = 110;

	public const int weaponCrossbow = 109;

	public const int fireproof = 50; // [!code --]
	public const int twohand = 130; // [!code ++]

	public const int twowield = 131; // [!code --]
	public const int acidproof = 51; // [!code ++]

	public const int PDR = 55;

	public const int EDR = 56; // [!code ++]
 // [!code ++]
	public const int weaponBlunt = 111;

	public const int tactics = 132; // [!code --]
	public const int twowield = 131; // [!code ++]

	public const int evasion = 150; // [!code --]
	public const int strategy = 135; // [!code ++]

	public const int eyeofmind = 134; // [!code --]
	public const int marksman = 133; // [!code ++]

	public const int climbing = 242;

```

[`@@ -42,12 +42,10 @@ public class SKILL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/SKILL.cs#L42-L53)
```cs:line-numbers=42

	public const int parasite = 227;

	public const int marksman = 133; // [!code --]
	public const int tactics = 132; // [!code ++]

	public const int riding = 226;

	public const int mining = 220; // [!code --]
 // [!code --]
	public const int spotting = 210;

	public const int weightlifting = 207;
```

[`@@ -58,18 +56,22 @@ public class SKILL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/SKILL.cs#L58-L75)
```cs:line-numbers=58

	public const int evasionPlus = 151;

	public const int strategy = 135; // [!code --]
	public const int evasion = 150; // [!code ++]

	public const int lumberjack = 225; // [!code --]
	public const int eyeofmind = 134; // [!code ++]

	public const int EDR = 56; // [!code --]
	public const int mining = 220; // [!code ++]

	public const int throwing = 108; // [!code --]
	public const int lumberjack = 225; // [!code ++]
 // [!code ++]
	public const int martial = 100; // [!code ++]

	public const int weaponDagger = 107;

	public const int fishing = 245;

	public const int evasionPerfect = 57; // [!code ++]
 // [!code ++]
	public const int life = 60;

	public const int mana = 61;
```

[`@@ -94,11 +96,11 @@ public class SKILL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/SKILL.cs#L94-L104)
```cs:line-numbers=94

	public const int PER = 73;

	public const int LER = 74; // [!code --]
	public const int throwing = 108; // [!code ++]

	public const int evasionPerfect = 57; // [!code --]
	public const int LER = 74; // [!code ++]

	public const int WIL = 75; // [!code --]
	public const int MAG = 76; // [!code ++]

	public const int CHA = 77;

```

[`@@ -116,8 +118,6 @@ public class SKILL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/SKILL.cs#L116-L123)
```cs:line-numbers=116

	public const int antiMagic = 93;

	public const int martial = 100; // [!code --]
 // [!code --]
	public const int weaponAxe = 102;

	public const int weaponStaff = 103;
```

[`@@ -128,7 +128,7 @@ public class SKILL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/SKILL.cs#L128-L134)
```cs:line-numbers=128

	public const int weaponPolearm = 106;

	public const int MAG = 76; // [!code --]
	public const int WIL = 75; // [!code ++]

	public const int gathering = 250;

```

[`@@ -268,13 +268,13 @@ public class SKILL`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/SKILL.cs#L268-L280)
```cs:line-numbers=268

	public static readonly int[] IDS = new int[133]
	{
		120, 130, 123, 122, 51, 110, 109, 50, 131, 55, // [!code --]
		111, 132, 150, 134, 242, 241, 240, 237, 235, 230, // [!code --]
		227, 133, 226, 220, 210, 207, 200, 152, 151, 135, // [!code --]
		225, 56, 108, 107, 245, 60, 61, 62, 64, 65, // [!code --]
		66, 67, 68, 70, 71, 72, 73, 74, 57, 75, // [!code --]
		77, 78, 79, 80, 90, 91, 92, 93, 100, 102, // [!code --]
		103, 104, 105, 106, 76, 250, 101, 256, 916, 917, // [!code --]
		123, 122, 120, 50, 110, 109, 130, 51, 55, 56, // [!code ++]
		111, 131, 135, 133, 242, 241, 240, 237, 235, 230, // [!code ++]
		227, 132, 226, 210, 207, 200, 152, 151, 150, 134, // [!code ++]
		220, 225, 100, 107, 245, 57, 60, 61, 62, 64, // [!code ++]
		65, 66, 67, 68, 70, 71, 72, 73, 108, 74, // [!code ++]
		76, 77, 78, 79, 80, 90, 91, 92, 93, 102, // [!code ++]
		103, 104, 105, 106, 75, 250, 101, 256, 916, 917, // [!code ++]
		918, 919, 920, 921, 922, 923, 924, 925, 926, 950,
		951, 952, 915, 953, 955, 956, 957, 958, 959, 960,
		961, 962, 963, 964, 965, 970, 972, 255, 954, 914,
```

## TileTypeWallHang

[`@@ -114,6 +114,10 @@ public override void GetMountHeight(ref Vector3 v, Point p, int d, Card target =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/TileTypeWallHang.cs#L114-L119)
```cs:line-numbers=114
		{
			v.y += p.sourceBlock.tileType.MountHeight;
		}
		if (target != null) // [!code ++]
		{ // [!code ++]
			v.z += target.Pref.z; // [!code ++]
		} // [!code ++]
	}

	protected override HitResult HitTest(Point pos)
```

## Trait

[`@@ -1512,7 +1512,7 @@ public void OnBarter()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/Trait.cs#L1512-L1518)
```cs:line-numbers=1512
			{
			case CopyShopType.Item:
			{
				num4 = (1000 + owner.c_invest * 100) / (thing4.GetPrice() + 50); // [!code --]
				num4 = (1000 + owner.c_invest * 100) / (thing4.GetPrice(CurrencyType.Money, sell: false, PriceType.CopyShop) + 50); // [!code ++]
				int[] array = new int[4] { 701, 704, 703, 702 };
				foreach (int ele in array)
				{
```

## TraitMoongate

[`@@ -9,6 +9,18 @@ public class TraitMoongate : Trait`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/TraitMoongate.cs#L9-L14)
```cs:line-numbers=9
{
	public UniTask<bool> test;

	public virtual string AllowedCat // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			if (!(EClass._zone is Zone_Tent)) // [!code ++]
			{ // [!code ++]
				return "Home,Dungeon,Town"; // [!code ++]
			} // [!code ++]
			return "Tent"; // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public override bool CanUse(Chara c)
	{
		if (EClass._zone.IsInstance || EClass._zone.dateExpire != 0 || EClass._zone.IsRegion || !owner.IsInstalled)
```

[`@@ -46,31 +58,39 @@ public async UniTask<bool> UseMoongate()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/TraitMoongate.cs#L46-L76)
```cs:line-numbers=46
	Debug.Log(lang);
	try
	{
		List<Net.DownloadMeta> list = (await Net.GetFileList(lang)).Where((Net.DownloadMeta m) => m.IsValidVersion()).ToList(); // [!code --]
		if (list == null || list.Count == 0) // [!code --]
		List<Net.DownloadMeta> listOrg = await Net.GetFileList(lang); // [!code ++]
		listOrg = listOrg.Where((Net.DownloadMeta m) => m.IsValidVersion()).ToList(); // [!code ++]
		listOrg.ForeachReverse(delegate(Net.DownloadMeta m) // [!code ++]
		{ // [!code ++]
			if (!AllowedCat.Split(',').Contains(m.cat.IsEmpty("Home"))) // [!code ++]
			{ // [!code ++]
				listOrg.Remove(m); // [!code ++]
			} // [!code ++]
		}); // [!code ++]
		if (listOrg == null || listOrg.Count == 0) // [!code ++]
		{
			EClass.pc.SayNothingHappans();
			return false;
		}
		List<MapMetaData> list2 = ListSavedUserMap(); // [!code --]
		IList<Net.DownloadMeta> list3 = list.Copy(); // [!code --]
		foreach (MapMetaData item2 in list2) // [!code --]
		List<MapMetaData> list = ListSavedUserMap(); // [!code ++]
		IList<Net.DownloadMeta> list2 = listOrg.Copy(); // [!code ++]
		foreach (MapMetaData item2 in list) // [!code ++]
		{
			foreach (Net.DownloadMeta item3 in list3) // [!code --]
			foreach (Net.DownloadMeta item3 in list2) // [!code ++]
			{
				if (item3.id == item2.id && item3.version == item2.version)
				{
					list3.Remove(item3); // [!code --]
					list2.Remove(item3); // [!code ++]
					break;
				}
			}
		}
		Debug.Log(list3.Count); // [!code --]
		if (list3.Count == 0) // [!code --]
		Debug.Log(list2.Count); // [!code ++]
		if (list2.Count == 0) // [!code ++]
		{
			list3 = list.Copy(); // [!code --]
			list2 = listOrg.Copy(); // [!code ++]
		}
		Net.DownloadMeta item = list3.RandomItem(); // [!code --]
		Net.DownloadMeta item = list2.RandomItem(); // [!code ++]
		Zone_User zone_User = EClass.game.spatials.Find((Zone_User z) => z.id == item.id);
		if (zone_User != null)
		{
```

## TraitWaystone

[`@@ -1,3 +1,5 @@`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/TraitWaystone.cs#L1-L3)
```cs:line-numbers=1
using UnityEngine; // [!code ++]
 // [!code ++]
public class TraitWaystone : Trait
{
	public bool IsTemp => owner.id == "waystone_temp";
```

[`@@ -16,43 +18,70 @@ public override bool OnUse(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/TraitWaystone.cs#L16-L58)
```cs:line-numbers=16

	public override void TrySetAct(ActPlan p)
	{
		if (!EClass._zone.parent.IsRegion || (EClass._zone.IsInstance && !EClass._zone.IsUserZone) || EClass._zone is Zone_Dungeon || EClass._zone is Zone_Tent) // [!code --]
		{ // [!code --]
			return; // [!code --]
		} // [!code --]
		p.TrySetAct("actNewZone", delegate // [!code --]
		if (EClass._zone is Zone_Tent) // [!code ++]
		{
			if (IsTemp) // [!code --]
			p.TrySetAct("actNameZone", delegate // [!code ++]
			{ // [!code ++]
				Dialog.InputName("dialogChangeName", EClass._zone.Name, delegate(bool cancel, string text) // [!code ++]
				{ // [!code ++]
					if (!cancel) // [!code ++]
					{ // [!code ++]
						EClass._zone.name = text; // [!code ++]
						EClass._zone.idPrefix = 0; // [!code ++]
						WidgetDate.Refresh(); // [!code ++]
					} // [!code ++]
				}); // [!code ++]
				return false; // [!code ++]
			}, owner); // [!code ++]
			if (Application.isEditor || (!EClass._zone.name.IsEmpty() && !EClass.core.version.demo)) // [!code ++]
			{
				owner.ModNum(-1); // [!code --]
				p.TrySetAct("actUploadMap", delegate // [!code ++]
				{ // [!code ++]
					EClass.ui.AddLayer<LayerUploader>(); // [!code ++]
					return false; // [!code ++]
				}, owner); // [!code ++]
			}
			EClass.pc.MoveZone(EClass._zone.ParentZone); // [!code --]
			return false; // [!code --]
		}, owner, CursorSystem.MoveZone); // [!code --]
		if (!EClass._zone.IsPCFaction && !EClass._zone.IsTown) // [!code --]
		{ // [!code --]
			return; // [!code --]
		}
		if (EClass.player.spawnZone != EClass._zone) // [!code --]
		else // [!code ++]
		{
			p.TrySetAct("actSetSpawn", delegate // [!code --]
			if (!EClass._zone.parent.IsRegion || (EClass._zone.IsInstance && !EClass._zone.IsUserZone) || EClass._zone is Zone_Dungeon) // [!code ++]
			{
				Effect.Get("aura_heaven").Play(EClass.pc.pos); // [!code --]
				EClass.Sound.Play("worship"); // [!code --]
				EClass.player.spawnZone = EClass._zone; // [!code --]
				Msg.Say("setSpawn", owner); // [!code --]
				return true; // [!code --]
			}, owner); // [!code --]
		} // [!code --]
		else if (EClass.player.spawnZone != EClass.pc.homeZone || EClass._zone != EClass.pc.homeZone) // [!code --]
		{ // [!code --]
			p.TrySetAct("actUnsetSpawn", delegate // [!code --]
				return; // [!code ++]
			} // [!code ++]
			p.TrySetAct("actNewZone", delegate // [!code ++]
			{
				EClass.Sound.Play("trash"); // [!code --]
				EClass.player.spawnZone = EClass.pc.homeZone; // [!code --]
				Msg.Say("unsetSpawn", owner); // [!code --]
				return true; // [!code --]
			}, owner); // [!code --]
				if (IsTemp) // [!code ++]
				{ // [!code ++]
					owner.ModNum(-1); // [!code ++]
				} // [!code ++]
				EClass.pc.MoveZone(EClass._zone.ParentZone); // [!code ++]
				return false; // [!code ++]
			}, owner, CursorSystem.MoveZone); // [!code ++]
			if (!EClass._zone.IsPCFaction && !EClass._zone.IsTown) // [!code ++]
			{ // [!code ++]
				return; // [!code ++]
			} // [!code ++]
			if (EClass.player.spawnZone != EClass._zone) // [!code ++]
			{ // [!code ++]
				p.TrySetAct("actSetSpawn", delegate // [!code ++]
				{ // [!code ++]
					Effect.Get("aura_heaven").Play(EClass.pc.pos); // [!code ++]
					EClass.Sound.Play("worship"); // [!code ++]
					EClass.player.spawnZone = EClass._zone; // [!code ++]
					Msg.Say("setSpawn", owner); // [!code ++]
					return true; // [!code ++]
				}, owner); // [!code ++]
			} // [!code ++]
			else if (EClass.player.spawnZone != EClass.pc.homeZone || EClass._zone != EClass.pc.homeZone) // [!code ++]
			{ // [!code ++]
				p.TrySetAct("actUnsetSpawn", delegate // [!code ++]
				{ // [!code ++]
					EClass.Sound.Play("trash"); // [!code ++]
					EClass.player.spawnZone = EClass.pc.homeZone; // [!code ++]
					Msg.Say("unsetSpawn", owner); // [!code ++]
					return true; // [!code ++]
				}, owner); // [!code ++]
			} // [!code ++]
		}
	}
}
```

## WidgetSearch

[`@@ -108,7 +108,7 @@ public override void Search(string s)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/886f4dbca0b43681d5d33aab15791296d314d274/Elin/WidgetSearch.cs#L108-L114)
```cs:line-numbers=108
	HashSet<Card> newCards = new HashSet<Card>();
	if (!s.IsEmpty())
	{
		if (!encSearch && (EMono._zone.IsTown || EMono._zone.IsPCFaction || EMono._zone is Zone_Tent)) // [!code --]
		if (!encSearch && (EMono._zone.IsTown || EMono._zone.HasLaw || EMono._zone.IsPCFaction || EMono._zone is Zone_Tent)) // [!code ++]
		{
			foreach (Chara chara in EMono._map.charas)
			{
```

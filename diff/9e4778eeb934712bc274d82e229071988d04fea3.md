---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 39 files modified. 4 new files created.
version: EA 23.176 Nightly Patch 1
changes: ABILITY/AI_Fuck/AI_PlayMusic/AI_Slaughter/AI_Steal/AttackProcess/BaseListPeople/CTAG/Card/Chara/CharaRenderer/Core/CraftUtil/ELEMENT/ENC/ElementContainer/ElementContainerCard/FACTION/FoodEffect/GoalCombat/LayerEditSkin/Map/POLICY/QuestDeliver/QuestShowSupply/RecipeCard/SourcePref/+SpriteData/+SpriteReplacer/+SpriteReplacerAnimation/TaskChopWood/TaskCraft/TaskDig/TaskDrawWater/TaskMine/TaskPlow/TaskPourWater/Thing/Trait/TraitAltar/TraitScrollStatic/+TraitToolHammerStrip/Zone
---

# EA 23.176 Nightly Patch 1

August 7, 2025

39 files modified. 4 new files created.

## Important Changes

Possible breaking changes. Click the filename to view the chunk.
### [ElementContainer (1)](#elementcontainer)
```cs:no-line-numbers
public void ModExp(int ele, int a, bool chain = false) // [!code --]
public void ModExp(int ele, float a, bool chain = false) // [!code ++]
```
### [LayerEditSkin (1)](#layereditskin)
```cs:no-line-numbers
public void RefreshImage() // [!code --]
public void RefreshImage(SpriteData data = null) // [!code ++]
```
## ABILITY

[``](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/ABILITY.cs#L2-L12)
```cs:line-numbers=2

public class ABILITY
{
	public const int ActPick = 5047; // [!code --]
	public const int ActInstall = 5046; // [!code ++]

	public const int AI_Drink = 5045;

	public const int ActInstall = 5046; // [!code --]
	public const int ActPick = 5047; // [!code ++]

	public const int ActItem = 5048;

```

[`public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/ABILITY.cs#L242-L258)
```cs:line-numbers=242

	public const int ActLulwyTrick = 6902;

	public const int ActKizuamiTrick = 6903; // [!code --]
 // [!code --]
	public const int ActGazeMutation = 6622;

	public const int ActKizuamiTrick = 6903; // [!code ++]
 // [!code ++]
	public const int ActSwarm = 6662;

	public const int ActSteal = 6640;

	public static readonly int[] IDS = new int[124]
	{
		5047, 5045, 5046, 5048, 5049, 5050, 5051, 5052, 5053, 5054, // [!code --]
		5046, 5045, 5047, 5048, 5049, 5050, 5051, 5052, 5053, 5054, // [!code ++]
		5055, 6001, 6003, 6011, 6012, 5044, 6013, 6018, 6019, 6020,
		6050, 6400, 6410, 6420, 6450, 6500, 6601, 6602, 6603, 6604,
		6610, 6015, 6611, 5043, 5041, 5011, 5012, 5013, 5014, 5015,
```

[`public class ABILITY`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/ABILITY.cs#L264-L270)
```cs:line-numbers=264
		5006, 5007, 5008, 5009, 5010, 50215, 50200, 50211, 6904, 6631,
		6630, 6627, 6626, 6641, 6621, 6623, 6642, 6650, 6660, 7000,
		6661, 6663, 6664, 6700, 6720, 6750, 6751, 6900, 6901, 6902,
		6903, 6622, 6662, 6640 // [!code --]
		6622, 6903, 6662, 6640 // [!code ++]
	};
}
public class Ability : Act
```

## AI_Fuck

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/AI_Fuck.cs#L113-L123)
```cs:line-numbers=113
		case FuckType.tame:
		{
			int num = 100;
			if (!tc.race.IsAnimal) // [!code --]
			if (!tc.IsAnimal) // [!code ++]
			{
				num += 50;
			}
			if (tc.race.IsHuman) // [!code --]
			if (tc.IsHuman) // [!code ++]
			{
				num += 50;
			}
```

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/AI_Fuck.cs#L152-L166)
```cs:line-numbers=152
					num3 = -5 + ((!tc.IsPCFaction) ? Mathf.Clamp(num2 / 10, -30, 0) : 0);
					fails++;
				}
				int a = 20; // [!code --]
				int num4 = 20; // [!code ++]
				if (tc.IsPCFactionOrMinion && tc.affinity.CurrentStage >= Affinity.Stage.Love)
				{
					num3 = ((EClass.rnd(3) == 0) ? 4 : 0);
					a = 10; // [!code --]
					num4 = 10; // [!code ++]
				}
				totalAffinity += num3;
				tc.ModAffinity(EClass.pc, num3, show: true, showOnlyEmo: true);
				cc.elements.ModExp(237, a); // [!code --]
				cc.elements.ModExp(237, num4); // [!code ++]
				if (EClass.rnd(4) == 0)
				{
					cc.stamina.Mod(-1);
```

## AI_PlayMusic

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/AI_PlayMusic.cs#L320-L326)
```cs:line-numbers=320
									item2.Say("musicBad", item2, owner);
								}
								item2.ShowEmo(Emo.sad);
								owner.elements.ModExp(241, 10); // [!code --]
								owner.elements.ModExp(241, 10f); // [!code ++]
								if (EClass.rnd(5) == 0)
								{
									ThrowReward(item2, punish: true);
```

## AI_Slaughter

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/AI_Slaughter.cs#L105-L111)
```cs:line-numbers=105
			}
			if (owner != null)
			{
				owner.elements.ModExp(290, 200); // [!code --]
				owner.elements.ModExp(290, 200f); // [!code ++]
			}
			if (!EClass.pc.isDead)
			{
```

## AI_Steal

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/AI_Steal.cs#L190-L196)
```cs:line-numbers=190
				target.isStolen = true;
			}
			owner.Pick(target.Thing);
			owner.elements.ModExp(281, 50); // [!code --]
			owner.elements.ModExp(281, 50f); // [!code ++]
			if (EClass.rnd(2) == 0)
			{
				EClass.pc.stamina.Mod(-1);
```

## AttackProcess

[`public bool Perform(int count, bool hasHit, float dmgMulti = 1f, bool maxRoll =`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/AttackProcess.cs#L484-L500)
```cs:line-numbers=484
	int bane;
	if (TC?.Chara != null)
	{
		SourceRace.Row race = TC.Chara.race; // [!code --]
		bane = 0;
		AddBane(valid: true, 468, 50);
		AddBane(race.IsUndead, 461, 100); // [!code --]
		AddBane(race.IsAnimal, 463, 100); // [!code --]
		AddBane(race.IsHuman, 464, 100); // [!code --]
		AddBane(race.IsDragon, 460, 100); // [!code --]
		AddBane(race.IsGod, 466, 100); // [!code --]
		AddBane(race.IsMachine, 465, 100); // [!code --]
		AddBane(race.IsFish, 467, 100); // [!code --]
		AddBane(race.IsFairy, 462, 100); // [!code --]
		AddBane(TC.Chara.IsUndead, 461, 100); // [!code ++]
		AddBane(TC.Chara.IsAnimal, 463, 100); // [!code ++]
		AddBane(TC.Chara.IsHuman, 464, 100); // [!code ++]
		AddBane(TC.Chara.IsDragon, 460, 100); // [!code ++]
		AddBane(TC.Chara.IsGod, 466, 100); // [!code ++]
		AddBane(TC.Chara.IsMachine, 465, 100); // [!code ++]
		AddBane(TC.Chara.IsFish, 467, 100); // [!code ++]
		AddBane(TC.Chara.IsFairy, 462, 100); // [!code ++]
		if (bane != 0)
		{
			num = num * (100 + bane * 3) / 100;
```

## BaseListPeople

[`public override void OnClick(Chara c, ItemGeneral i)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/BaseListPeople.cs#L340-L345)
```cs:line-numbers=340
						}
						list.Refresh();
						SE.Click();
						WidgetRoster.SetDirty(); // [!code ++]
					});
				}
				else
```

[`public override void OnClick(Chara c, ItemGeneral i)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/BaseListPeople.cs#L364-L369)
```cs:line-numbers=364
							c.renderer.OnEnterScreen();
						}
						list.Refresh();
						WidgetRoster.SetDirty(); // [!code ++]
					});
				}
			}
```

## CTAG

[`public enum CTAG`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/CTAG.cs#L37-L41)
```cs:line-numbers=37
	noRandomEnc,
	noMix,
	bigFish,
	noSkinRecipe // [!code --]
	noSkinRecipe, // [!code ++]
	animal, // [!code ++]
	human, // [!code ++]
	undead, // [!code ++]
	machine, // [!code ++]
	horror, // [!code ++]
	fish, // [!code ++]
	fairy, // [!code ++]
	god, // [!code ++]
	dragon, // [!code ++]
	plant // [!code ++]
}
```

## Card

[`public enum MoveType`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Card.cs#L24-L29)
```cs:line-numbers=24

	public const int MaxWeight = 10000000;

	public const int SocketDiv = 1000; // [!code ++]
 // [!code ++]
	[JsonProperty(PropertyName = "A")]
	public int[] _ints = new int[30];

```

[`private void _OnSerializing(StreamingContext context)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Card.cs#L2616-L2622)
```cs:line-numbers=2616
		_ints[0] = _bits1.ToInt();
		_ints[2] = _bits2.ToInt();
		_placeState = placeState;
		version = 1; // [!code --]
		version = 2; // [!code ++]
		OnSerializing();
	}

```

[`protected virtual void OnSerializing()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Card.cs#L2627-L2632)
```cs:line-numbers=2627
[OnDeserialized]
private void _OnDeserialized(StreamingContext context)
{
	if (version < 2) // [!code ++]
	{ // [!code ++]
		if (sockets != null) // [!code ++]
		{ // [!code ++]
			for (int i = 0; i < sockets.Count; i++) // [!code ++]
			{ // [!code ++]
				sockets[i] = sockets[i] / 100 * 1000 + sockets[i] % 100; // [!code ++]
			} // [!code ++]
		} // [!code ++]
		version = 2; // [!code ++]
	} // [!code ++]
	_bits1.SetInt(_ints[0]);
	_bits2.SetInt(_ints[2]);
	placeState = _placeState;
```

[`public void ApplySocket(int id, int lv, Card mod = null)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Card.cs#L3422-L3432)
```cs:line-numbers=3422
	{
		if (sockets[i] == 0)
		{
			if (lv >= 100) // [!code --]
			if (lv >= 1000) // [!code ++]
			{
				lv = 99; // [!code --]
				lv = 999; // [!code ++]
			}
			sockets[i] = id * 100 + lv; // [!code --]
			sockets[i] = id * 1000 + lv; // [!code ++]
			elements.ModBase(id, lv);
			mod?.Destroy();
			break;
```

[`public void EjectSockets()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Card.cs#L3442-L3449)
```cs:line-numbers=3442
		if (num != 0)
		{
			Thing thing = ThingGen.Create(isCopy ? "ash3" : "mod_ranged");
			int ele = num / 100; // [!code --]
			int num2 = num % 100; // [!code --]
			int ele = num / 1000; // [!code ++]
			int num2 = num % 1000; // [!code ++]
			elements.ModBase(ele, -num2);
			if (!isCopy)
			{
```

[`public void SpawnLoot(Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Card.cs#L4852-L4858)
```cs:line-numbers=4852
	bool isUserZone = EClass._zone.IsUserZone;
	bool flag = EClass._zone is Zone_Music;
	List<Card> list = new List<Card>();
	SourceRace.Row race = Chara.race; // [!code --]
	if (!IsPCFaction && !isUserZone && sourceCard.idActor.IsEmpty())
	{
		int i2 = 500;
```

[`public void SpawnLoot(Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Card.cs#L4880-L4886)
```cs:line-numbers=4880
	}
	bool flag2 = Chara.race.corpse[1].ToInt() > EClass.rnd(1500) || (Chara.IsPowerful && !IsPCFaction) || EClass.debug.godFood;
	int num = 1;
	if (!IsMinion && Chara.race.IsAnimal && EClass.rnd(EClass._zone.IsPCFaction ? 3 : 5) == 0) // [!code --]
	if (!IsMinion && Chara.IsAnimal && EClass.rnd(EClass._zone.IsPCFaction ? 3 : 5) == 0) // [!code ++]
	{
		flag2 = true;
	}
```

[`public void SpawnLoot(Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Card.cs#L4894-L4904)
```cs:line-numbers=4894
		if (!flag2 && Chara.race.corpse[1].ToInt() > EClass.rnd(150000 / (100 + (int)Mathf.Sqrt(origin.Evalue(290)) * 5)))
		{
			flag2 = true;
			origin.elements.ModExp(290, 100); // [!code --]
			origin.elements.ModExp(290, 100f); // [!code ++]
		}
		else
		{
			origin.elements.ModExp(290, 5); // [!code --]
			origin.elements.ModExp(290, 5f); // [!code ++]
		}
	}
	if (id == "littleOne" && IsPCFactionOrMinion)
```

[`public void SpawnLoot(Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Card.cs#L4948-L4954)
```cs:line-numbers=4948
				list.Add(ThingGen.Create(array[0]).SetNum((num4 < 1000) ? 1 : (num4 / 1000 + ((EClass.rnd(1000) > num4 % 1000) ? 1 : 0))));
			}
		}
		if (race.IsMachine) // [!code --]
		if (Chara.IsMachine) // [!code ++]
		{
			if (chance(20))
			{
```

[`public void SpawnLoot(Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Card.cs#L4961-L4967)
```cs:line-numbers=4961
		}
		else
		{
			if (race.IsAnimal) // [!code --]
			if (Chara.IsAnimal) // [!code ++]
			{
				if (chance(15))
				{
```

[`public Card MakeFoodFrom(Card c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Card.cs#L5262-L5272)
```cs:line-numbers=5262
	}
	if (flag2)
	{
		if (race.IsHuman) // [!code --]
		if (c.Chara.IsHuman) // [!code ++]
		{
			elements.SetBase(708, 1);
		}
		if (race.IsUndead) // [!code --]
		if (c.Chara.IsUndead) // [!code ++]
		{
			elements.SetBase(709, 1);
		}
```

[`public Card MakeFoodFrom(Card c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Card.cs#L5292-L5298)
```cs:line-numbers=5292
		Tuple<int, int> tuple = list[i];
		elements.SetBase(tuple.Item1, tuple.Item2 * tuple.Item2 / 4);
	}
	if (race.IsUndead) // [!code --]
	if (c.Chara.IsUndead) // [!code ++]
	{
		elements.ModBase(73, -20);
	}
```

[`public virtual int GetPrice(CurrencyType currency = CurrencyType.Money, bool sel`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Card.cs#L6920-L6925)
```cs:line-numbers=6920
				return 500;
			case "whip_egg":
				return 3000;
			case "hammer_strip": // [!code ++]
				return 5000; // [!code ++]
			case "helm_chef":
				return 40000;
			}
```

## Chara

[`public override SourcePref Pref`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Chara.cs#L785-L791)
```cs:line-numbers=785
	{
		if (spriteReplacer != null)
		{
			return EClass.core.refs.prefs.replacer1; // [!code --]
			return spriteReplacer.data?.pref ?? EClass.core.refs.prefs.replacer1; // [!code ++]
		}
		if (base.idSkin > 0)
		{
```

[`public bool IsIdle`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Chara.cs#L859-L864)
```cs:line-numbers=859

	public bool IsInCombat => ai is GoalCombat;

	public bool IsAnimal // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			if (!race.IsAnimal) // [!code ++]
			{ // [!code ++]
				return HasTag(CTAG.animal); // [!code ++]
			} // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public bool IsHuman // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			if (!race.IsHuman) // [!code ++]
			{ // [!code ++]
				return HasTag(CTAG.human); // [!code ++]
			} // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public bool IsUndead // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			if (!race.IsUndead) // [!code ++]
			{ // [!code ++]
				return HasTag(CTAG.undead); // [!code ++]
			} // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public bool IsMachine // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			if (!race.IsMachine) // [!code ++]
			{ // [!code ++]
				return HasTag(CTAG.machine); // [!code ++]
			} // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public bool IsHorror // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			if (!race.IsHorror) // [!code ++]
			{ // [!code ++]
				return HasTag(CTAG.horror); // [!code ++]
			} // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public bool IsFish // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			if (!race.IsFish) // [!code ++]
			{ // [!code ++]
				return HasTag(CTAG.fish); // [!code ++]
			} // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public bool IsFairy // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			if (!race.IsFairy) // [!code ++]
			{ // [!code ++]
				return HasTag(CTAG.fairy); // [!code ++]
			} // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public bool IsGod // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			if (!race.IsGod) // [!code ++]
			{ // [!code ++]
				return HasTag(CTAG.god); // [!code ++]
			} // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public bool IsDragon // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			if (!race.IsDragon) // [!code ++]
			{ // [!code ++]
				return HasTag(CTAG.dragon); // [!code ++]
			} // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public bool IsPlant // [!code ++]
	{ // [!code ++]
		get // [!code ++]
		{ // [!code ++]
			if (!race.IsPlant) // [!code ++]
			{ // [!code ++]
				return HasTag(CTAG.plant); // [!code ++]
			} // [!code ++]
			return true; // [!code ++]
		} // [!code ++]
	} // [!code ++]
 // [!code ++]
	public int DestDist => tactics.DestDist;

	public bool HasNoGoal => ai.IsNoGoal;
```

[`public bool CanWitness`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Chara.cs#L867-L873)
```cs:line-numbers=867
{
	get
	{
		if (!race.IsHuman && !race.IsFairy && !race.IsGod) // [!code --]
		if (!IsHuman && !IsFairy && !IsGod) // [!code ++]
		{
			return race.id == "mutant";
		}
```

[`public bool CanWitness`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Chara.cs#L875-L882)
```cs:line-numbers=875
		}
	}

	public bool IsHuman => race.tag.Contains("human"); // [!code --]
 // [!code --]
	public bool IsHumanSpeak
	{
		get
```

[`public void TickConditions()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Chara.cs#L3648-L3659)
```cs:line-numbers=3648
		if (EClass.rnd(25) == 0 && base.hp < MaxHP)
		{
			HealHP(EClass.rnd(Evalue(300) / 3 + 1) + 1);
			elements.ModExp(300, 8); // [!code --]
			elements.ModExp(300, 8f); // [!code ++]
		}
		if (EClass.rnd(8) == 0 && mana.value < mana.max)
		{
			mana.Mod(EClass.rnd(Evalue(301) / 2 + 1) + 1);
			elements.ModExp(301, 8); // [!code --]
			elements.ModExp(301, 8f); // [!code ++]
		}
		if (EClass.rnd(20) == 0 && !IsPC && stamina.value < stamina.max)
		{
```

[`public void ApplyDeathPenalty()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Chara.cs#L4869-L4875)
```cs:line-numbers=4869
	{
		if (EClass.rnd(5) == 0 && value.IsMainAttribute)
		{
			EClass.pc.elements.ModExp(value.id, -500); // [!code --]
			EClass.pc.elements.ModExp(value.id, -500f); // [!code ++]
		}
	}
}
```

[`public override void Die(Element e = null, Card origin = null, AttackSource atta`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Chara.cs#L5044-L5050)
```cs:line-numbers=5044
			EClass.player.stats.allyDeath++;
		}
	}
	if (id == "mandrake") // [!code --]
	if (id == "mandrake" || HasElement(488)) // [!code ++]
	{
		Say("a_scream", this);
		ActEffect.ProcAt(EffectId.Scream, base.LV * 3 + 200, BlessedState.Normal, this, this, pos, isNeg: true);
```

[`public void GiveGift(Chara c, Thing t)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Chara.cs#L7772-L7781)
```cs:line-numbers=7772
		{
			Msg.Say("affinityNone", c, this);
			t.Destroy();
			elements.ModExp(291, 10); // [!code --]
			elements.ModExp(291, 10f); // [!code ++]
			return;
		}
		elements.ModExp(291, 50); // [!code --]
		elements.ModExp(291, 50f); // [!code ++]
	}
	if (t.id == "statue_weird")
	{
```

## CharaRenderer

[`public override void SetOwner(Card c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/CharaRenderer.cs#L69-L75)
```cs:line-numbers=69
		SpriteReplacer spriteReplacer = SpriteReplacer.dictSkins.TryGetValue(owner.c_idSpriteReplacer);
		if (spriteReplacer != null)
		{
			data = ResourceCache.Load<RenderData>("Scene/Render/Data/chara_custom"); // [!code --]
			data = ResourceCache.Load<RenderData>("Scene/Render/Data/chara_custom_" + ((spriteReplacer.data.GetSprite().texture.height <= 128) ? "128" : "256")); // [!code ++]
			owner.spriteReplacer = spriteReplacer;
		}
	}
```

## Core

[`public void OnApplicationFocus(bool focus)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Core.cs#L441-L462)
```cs:line-numbers=441
					}
					foreach (CardRow row in sources.cards.rows)
					{
						if (row.replacer.hasChacked && row.replacer.data != null) // [!code --]
						if (row.replacer.isChecked && row.replacer.data != null) // [!code ++]
						{
							row.replacer.data.GetSprite();
						}
					}
					foreach (SpriteReplacer value in SpriteReplacer.dictSkins.Values) // [!code ++]
					{ // [!code ++]
						value.data?.LoadPref(); // [!code ++]
					} // [!code ++]
					WidgetRoster.SetDirty(); // [!code ++]
				}
			});
		});
	}
	if (IsGameStarted && debug.enable)
	{
		foreach (PCC.Part value in pccs.allParts.Values) // [!code --]
		foreach (PCC.Part value2 in pccs.allParts.Values) // [!code ++]
		{
			foreach (ModItem<Texture2D> value2 in value.modTextures.Values) // [!code --]
			foreach (ModItem<Texture2D> value3 in value2.modTextures.Values) // [!code ++]
			{
				value2.ClearCache(); // [!code --]
				value3.ClearCache(); // [!code ++]
			}
		}
		CharaActorPCC[] array = UnityEngine.Object.FindObjectsOfType<CharaActorPCC>();
```

## CraftUtil

[`public static Card MixIngredients(Card product, List<Thing> ings, MixType type,`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/CraftUtil.cs#L267-L273)
```cs:line-numbers=267
			product.elements.SetTo(10, 1);
		}
	}
	if (creative) // [!code --]
	if (creative && isFood) // [!code ++]
	{
		product.elements.SetBase(764, 1);
	}
```

## ELEMENT

[`public void WriteNote()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/ELEMENT.cs#L210-L216)
```cs:line-numbers=210
				AddFix(100, EClass.sources.elements.map[663].GetName());
			}
		}
		if (!c.race.IsMachine && !(c.id == "android")) // [!code --]
		if (!c.IsMachine && !(c.id == "android")) // [!code ++]
		{
			return;
		}
```

## ENC

[`public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/ENC.cs#L8-L24)
```cs:line-numbers=8

	public const int r_DV = 650;

	public const int r_mana = 641; // [!code ++]
 // [!code ++]
	public const int mod_frustration = 624;

	public const int mod_flurry = 621; // [!code ++]
 // [!code ++]
	public const int mod_cleave = 622;

	public const int mod_feint = 623;

	public const int r_life = 640; // [!code --]
 // [!code --]
	public const int noDamage = 654;

	public const int r_mana = 641; // [!code --]
	public const int r_life = 640; // [!code ++]

	public const int onlyPet = 655;

```

[`public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/ENC.cs#L40-L46)
```cs:line-numbers=40

	public const int convertFire = 850;

	public const int mod_flurry = 621; // [!code --]
	public const int mod_chaser = 620; // [!code ++]

	public const int convertImpact = 865;

```

[`public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/ENC.cs#L48-L58)
```cs:line-numbers=48

	public const int permaCurse = 656;

	public const int mod_chaser = 620; // [!code --]
	public const int mod_talisman = 609; // [!code ++]

	public const int negateFear = 423;

	public const int mod_splash = 608; // [!code --]
	public const int mod_scatter = 607; // [!code ++]

	public const int negateShockwave = 430;

```

[`public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/ENC.cs#L94-L100)
```cs:line-numbers=94

	public const int corruption = 409;

	public const int mod_talisman = 609; // [!code --]
	public const int mod_splash = 608; // [!code ++]

	public const int travelSpeed = 407;

```

[`public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/ENC.cs#L134-L140)
```cs:line-numbers=134

	public const int revealFaith = 481;

	public const int mod_ammo = 600; // [!code --]
	public const int deathagony = 488; // [!code ++]
 // [!code ++]
	public const int mod_rapid = 602; // [!code ++]

	public const int mod_ammo_knockback = 603;

```

[`public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/ENC.cs#L144-L158)
```cs:line-numbers=144

	public const int mod_drill = 606;

	public const int mod_scatter = 607; // [!code --]
 // [!code --]
	public const int sustain_DEX = 442;

	public const int mod_reload = 601; // [!code --]
	public const int mod_ammo = 600; // [!code ++]

	public const int strongStomach = 480;

	public const int mod_rapid = 602; // [!code --]
	public const int mod_reload = 601; // [!code ++]

	public const int bane_fish = 467;

```

[`public class ENC`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/ENC.cs#L180-L195)
```cs:line-numbers=180

	public const int sustain_LER = 444;

	public static readonly int[] IDS = new int[90] // [!code --]
	public static readonly int[] IDS = new int[91] // [!code ++]
	{
		653, 652, 651, 650, 624, 622, 623, 640, 654, 641, // [!code --]
		655, 851, 660, 661, 662, 663, 664, 665, 666, 850, // [!code --]
		621, 865, 852, 656, 620, 423, 608, 430, 429, 428, // [!code --]
		427, 426, 425, 424, 422, 421, 420, 419, 418, 417, // [!code --]
		416, 415, 414, 412, 411, 410, 409, 609, 407, 406, // [!code --]
		405, 404, 403, 402, 401, 400, 440, 441, 408, 443, // [!code --]
		482, 483, 484, 485, 486, 487, 481, 600, 603, 604, // [!code --]
		605, 606, 607, 442, 601, 480, 602, 467, 468, 445, // [!code --]
		446, 447, 461, 462, 460, 463, 464, 465, 466, 444 // [!code --]
		653, 652, 651, 650, 641, 624, 621, 622, 623, 654, // [!code ++]
		640, 655, 851, 660, 661, 662, 663, 664, 665, 666, // [!code ++]
		850, 620, 865, 852, 656, 609, 423, 607, 430, 429, // [!code ++]
		428, 427, 426, 425, 424, 422, 421, 420, 419, 418, // [!code ++]
		417, 416, 415, 414, 412, 411, 410, 409, 608, 407, // [!code ++]
		406, 405, 404, 403, 402, 401, 400, 440, 441, 408, // [!code ++]
		443, 482, 483, 484, 485, 486, 487, 481, 488, 602, // [!code ++]
		603, 604, 605, 606, 442, 600, 480, 601, 467, 468, // [!code ++]
		445, 446, 447, 461, 462, 460, 463, 464, 465, 466, // [!code ++]
		444 // [!code ++]
	};
}
```

## ElementContainer

[`public void Train(int ele, int a = 10)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/ElementContainer.cs#L266-L274)
```cs:line-numbers=266
		ModTempPotential(ele, a);
	}

	public void ModExp(int ele, int a, bool chain = false) // [!code --]
	public void ModExp(int ele, float a, bool chain = false) // [!code ++]
	{
		if ((Card != null && Card.isChara && Card.Chara.isDead) || a == 0) // [!code --]
		if ((Card != null && Card.isChara && Card.Chara.isDead) || a == 0f) // [!code ++]
		{
			return;
		}
```

[`public void ModExp(int ele, int a, bool chain = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/ElementContainer.cs#L277-L315)
```cs:line-numbers=277
	{
		return;
	}
	if (!chain) // [!code --]
	if (a > 0f) // [!code ++]
	{
		if (a > 0 && Card != null && Card.isChara) // [!code --]
		if (!chain && Card != null && Card.isChara) // [!code ++]
		{
			a = a * Card.Chara.GetDaysTogetherBonus() / 100; // [!code --]
			a = a * (float)Card.Chara.GetDaysTogetherBonus() / 100f; // [!code ++]
		}
		if (element.source.parentFactor > 0f && Card != null && !element.source.aliasParent.IsEmpty()) // [!code --]
		if (element.UseExpMod) // [!code ++]
		{
			Element element2 = element.GetParent(Card); // [!code --]
			if (element2.CanGainExp) // [!code --]
			a = a * (float)Mathf.Clamp(element.UsePotential ? element.Potential : 100, 10, 1000) / (float)(100 + Mathf.Max(0, element.ValueWithoutLink) * 25); // [!code ++]
			if (EClass.rndf(1f) < a % 1f + 0.1f) // [!code ++]
			{
				ModExp(element2.id, (int)Math.Max(1f, (float)a * element.source.parentFactor / (float)(100 + Mathf.Max(0, element2.ValueWithoutLink * 5))), chain: true); // [!code --]
				a += 1f; // [!code ++]
			}
		}
	} // [!code --]
	if (element.UseExpMod && a >= 0) // [!code --]
	{ // [!code --]
		int value = (element.UsePotential ? element.Potential : 100); // [!code --]
		float num = (float)a * (float)Mathf.Clamp(value, 10, 1000) / (float)(100 + Mathf.Max(0, element.ValueWithoutLink) * 25); // [!code --]
		a = (int)num; // [!code --]
		if (EClass.rndf(1f) < num % 1f) // [!code --]
		if (!chain && element.source.parentFactor > 0f && Card != null && !element.source.aliasParent.IsEmpty()) // [!code ++]
		{
			a++; // [!code --]
			Element element2 = element.GetParent(Card); // [!code ++]
			if (element2.CanGainExp) // [!code ++]
			{ // [!code ++]
				ModExp(element2.id, Mathf.Clamp(a * element.source.parentFactor / 100f, 1f, 1000f), chain: true); // [!code ++]
			} // [!code ++]
		}
	}
	element.vExp += a; // [!code --]
	element.vExp += (int)a; // [!code ++]
	if (element.vExp >= element.ExpToNext)
	{
		int num2 = element.vExp - element.ExpToNext; // [!code --]
		int num = element.vExp - element.ExpToNext; // [!code ++]
		int vBase = element.vBase;
		ModBase(ele, 1);
		OnLevelUp(element, vBase);
		element.vExp = Mathf.Clamp(num2 / 2, 0, element.ExpToNext / 2); // [!code --]
		element.vExp = Mathf.Clamp(num / 2, 0, element.ExpToNext / 2); // [!code ++]
		if (element.vTempPotential > 0)
		{
			element.vTempPotential -= element.vTempPotential / 4 + EClass.rnd(5) + 5;
```

## ElementContainerCard

[`public override int ValueBonus(Element e)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/ElementContainerCard.cs#L216-L222)
```cs:line-numbers=216
				num = num * 2 + (e.ValueWithoutLink + e.vLink);
			}
		}
		if (e.id != 664 && (owner.Chara.race.IsMachine || owner.id == "android")) // [!code --]
		if (e.id != 664 && (owner.Chara.IsMachine || owner.id == "android")) // [!code ++]
		{
			int num4 = owner.Evalue(664);
			if (num4 > 0)
```

## FACTION

[`public bool HasMember(string id, bool includeReserve = true)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/FACTION.cs#L298-L304)
```cs:line-numbers=298

	public bool IsWearingPanty(Chara c)
	{
		if ((!c.IsUnique || c.bio.gender != 2) && (c.race.IsHuman || c.race.IsFairy) && !(c.trait is TraitMerchant)) // [!code --]
		if ((!c.IsUnique || c.bio.gender != 2) && (c.IsHuman || c.IsFairy) && !(c.trait is TraitMerchant)) // [!code ++]
		{
			return true;
		}
```

## FoodEffect

[`public static void Proc(Chara c, Thing food)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/FoodEffect.cs#L179-L185)
```cs:line-numbers=179
				}
				c.Say("little_eat", c);
				c.PlaySound("ding_potential");
				c.elements.ModExp(306, -1000); // [!code --]
				c.elements.ModExp(306, -1000f); // [!code ++]
				c.SetInt(117, int2 + 1);
				break;
			}
```

## GoalCombat

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/GoalCombat.cs#L163-L169)
```cs:line-numbers=163
		{
			tc.TrySetEnemy(owner);
		}
		if (!tc.IsMinion && EClass.rnd(10) == 0 && EClass.rnd(tc.DEX + 10) > owner.LV && tc.HasElement(1315) && !owner.HasElement(1315) && owner.race.IsMachine && owner.CanBeTempAlly(tc)) // [!code --]
		if (!tc.IsMinion && EClass.rnd(10) == 0 && EClass.rnd(tc.DEX + 10) > owner.LV && tc.HasElement(1315) && !owner.HasElement(1315) && owner.IsMachine && owner.CanBeTempAlly(tc)) // [!code ++]
		{
			owner.Say("dominate_machine", tc, owner);
			owner.PlayEffect("boost");
```

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/GoalCombat.cs#L173-L179)
```cs:line-numbers=173
			owner.MakeMinion(tc.IsPCParty ? EClass.pc : tc);
			yield return Success();
		}
		if (EClass.rnd(5) == 0 && tc.HasElement(1325) && owner.race.IsPlant && owner.CanBeTempAlly(tc)) // [!code --]
		if (EClass.rnd(5) == 0 && tc.HasElement(1325) && owner.IsPlant && owner.CanBeTempAlly(tc)) // [!code ++]
		{
			owner.Say("dominate_plant", tc, owner);
			owner.ShowEmo(Emo.love);
```

## LayerEditSkin

[`public class LayerEditSkin : ELayer`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/LayerEditSkin.cs#L11-L16)
```cs:line-numbers=11

	public UIDynamicList list;

	public SpriteData currentData; // [!code ++]
 // [!code ++]
	public void Activate(Chara _chara)
	{
		chara = _chara;
```

[`public void Activate(Chara _chara)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/LayerEditSkin.cs#L18-L31)
```cs:line-numbers=18
		RefreshList();
	}

	public void RefreshImage() // [!code --]
	public void RefreshImage(SpriteData data = null) // [!code ++]
	{
		data?.LoadPref(); // [!code ++]
		imageSkin.sprite = chara.GetSprite();
		imageSkin.SetNativeSize();
		if ((bool)WidgetRoster.Instance) // [!code --]
		{ // [!code --]
			WidgetRoster.Instance.Build(); // [!code --]
		} // [!code --]
		WidgetRoster.SetDirty(); // [!code ++]
		currentData = data ?? chara.spriteReplacer?.data; // [!code ++]
	}

	public void OnClickClear()
```

[`public void OnClickClear()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/LayerEditSkin.cs#L36-L41)
```cs:line-numbers=36
		RefreshImage();
	}

	public void OnClickEdit() // [!code ++]
	{ // [!code ++]
		if (currentData == null) // [!code ++]
		{ // [!code ++]
			SE.Beep(); // [!code ++]
			return; // [!code ++]
		} // [!code ++]
		string fileNameWithoutExtension = Path.GetFileNameWithoutExtension(currentData.path); // [!code ++]
		string text = CorePath.custom + "Skin/" + fileNameWithoutExtension + ".pref"; // [!code ++]
		if (!File.Exists(text)) // [!code ++]
		{ // [!code ++]
			(currentData.pref ?? chara.Pref).WriteIni(text); // [!code ++]
		} // [!code ++]
		SE.Click(); // [!code ++]
		Util.Run(text); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public void RefreshList()
	{
		list.Clear();
```

[`public void RefreshList()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/LayerEditSkin.cs#L47-L59)
```cs:line-numbers=47
			SE.Click();
			chara.c_idSpriteReplacer = Path.GetFileName(a.path);
			chara._CreateRenderer();
			RefreshImage(); // [!code --]
			RefreshImage(a); // [!code ++]
		},
		onRedraw = delegate(SpriteData a, UIButton b, int i)
		{
			b.mainText.SetText(Path.GetFileName(a.path));
			a.Init();
			b.icon.sprite = a.GetSprite();
			b.icon.SetNativeSize(); // [!code ++]
			b.tooltip.lang = a.path;
		},
		onList = delegate
```

[`public void RefreshList()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/LayerEditSkin.cs#L68-L71)
```cs:line-numbers=68
		};
		list.List();
	}
 // [!code ++]
	private void OnApplicationFocus(bool focus) // [!code ++]
	{ // [!code ++]
		if (focus && currentData != null) // [!code ++]
		{ // [!code ++]
			RefreshImage(currentData); // [!code ++]
		} // [!code ++]
	} // [!code ++]
}
```

## Map

[`public int CountWildAnimal()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Map.cs#L2468-L2474)
```cs:line-numbers=2468
	int num = 0;
	foreach (Chara chara in charas)
	{
		if (!chara.IsPCFaction && chara.race.IsAnimal) // [!code --]
		if (!chara.IsPCFaction && chara.IsAnimal) // [!code ++]
		{
			num++;
		}
```

## POLICY

[`public void SetOwner(FactionBranch _branch)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/POLICY.cs#L147-L153)
```cs:line-numbers=147

	public void OnAdvanceHour(VirtualDate date)
	{
		EClass._zone.elements.ModExp(id, 10); // [!code --]
		EClass._zone.elements.ModExp(id, 10f); // [!code ++]
	}

	public void RefreshEffect(UINote note = null)
```

## QuestDeliver

[`public class QuestDeliver : QuestDestZone`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/QuestDeliver.cs#L12-L18)
```cs:line-numbers=12

	private static List<SourceCategory.Row> _listDeliver = new List<SourceCategory.Row>();

	public virtual bool ConsumeGoods => true; // [!code --]
	public virtual bool ConsumeGoods => false; // [!code ++]

	public SourceThing.Row sourceThing => EClass.sources.things.map[idThing.IsEmpty("generator_snowman")];

```

[`public override bool Deliver(Chara c, Thing t = null)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/QuestDeliver.cs#L221-L227)
```cs:line-numbers=221
		}
		else
		{
			c.Pick(thing); // [!code --]
			thing = c.Pick(thing); // [!code ++]
			if (c.CanEat(thing)) // [!code ++]
			{ // [!code ++]
				c.SetAIImmediate(new AI_Eat // [!code ++]
				{ // [!code ++]
					target = thing // [!code ++]
				}); // [!code ++]
			} // [!code ++]
			else // [!code ++]
			{ // [!code ++]
				c.TryUse(thing); // [!code ++]
			} // [!code ++]
		}
		EClass.game.quests.Complete(this);
		c.quest = null;
```

## QuestShowSupply

[`public class QuestShowSupply : QuestSupply`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/QuestShowSupply.cs#L1-L4)
```cs:line-numbers=1
public class QuestShowSupply : QuestSupply
{
	public override bool ConsumeGoods => false; // [!code --]
}
```

## RecipeCard

[`public override void BuildIngredientList()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/RecipeCard.cs#L73-L79)
```cs:line-numbers=73
	{
		return;
	}
	if (EClass.pc.HasElement(487)) // [!code --]
	if (EClass.pc.HasElement(487) && !EClass.scene.actionMode.IsBuildMode) // [!code ++]
	{
		ingredients[0].ingType = IngType.CreativeFood;
	}
```

## SourcePref

[`using System;`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/SourcePref.cs#L1-L4)
```cs:line-numbers=1
using System;
using System.IO; // [!code ++]
using System.Text; // [!code ++]
using IniParser; // [!code ++]
using IniParser.Model; // [!code ++]
using Newtonsoft.Json;
using UnityEngine;

```

[`public void Validate()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/SourcePref.cs#L339-L342)
```cs:line-numbers=339
			Array.Resize(ref ints, 25);
		}
	}
 // [!code ++]
	public void WriteIni(string path) // [!code ++]
	{ // [!code ++]
		FileIniDataParser fileIniDataParser = new FileIniDataParser(); // [!code ++]
		if (File.Exists(path)) // [!code ++]
		{ // [!code ++]
			EClass.ui.Say("Ini file already exists."); // [!code ++]
			return; // [!code ++]
		} // [!code ++]
		File.CreateText(path).Close(); // [!code ++]
		IniData iniData = fileIniDataParser.ReadFile(path, Encoding.UTF8); // [!code ++]
		iniData.Global["x"] = ints[4].ToString() ?? ""; // [!code ++]
		iniData.Global["y"] = ints[5].ToString() ?? ""; // [!code ++]
		iniData.Global["z"] = ints[2].ToString() ?? ""; // [!code ++]
		iniData.Global["pivotX"] = pivotX.ToString() ?? ""; // [!code ++]
		iniData.Global["pivotY"] = pivotY.ToString() ?? ""; // [!code ++]
		iniData.Global["shadow"] = shadow.ToString() ?? ""; // [!code ++]
		iniData.Global["shadowX"] = shadowX.ToString() ?? ""; // [!code ++]
		iniData.Global["shadowY"] = shadowY.ToString() ?? ""; // [!code ++]
		iniData.Global["height"] = ints[3].ToString() ?? ""; // [!code ++]
		iniData.Global["scaleIcon"] = scaleIcon.ToString() ?? ""; // [!code ++]
		iniData.Global["liquidMod"] = liquidMod.ToString() ?? ""; // [!code ++]
		iniData.Global["hatY"] = ints[23].ToString() ?? ""; // [!code ++]
		iniData.Global["flags"] = ints[1].ToString() ?? ""; // [!code ++]
		fileIniDataParser.WriteFile(path, iniData); // [!code ++]
	} // [!code ++]
 // [!code ++]
	public static SourcePref ReadFromIni(string path) // [!code ++]
	{ // [!code ++]
		SourcePref sourcePref = new SourcePref(); // [!code ++]
		IniData iniData = new FileIniDataParser().ReadFile(path, Encoding.UTF8); // [!code ++]
		sourcePref.ints[4] = iniData.Global["x"].ToInt(); // [!code ++]
		sourcePref.ints[5] = iniData.Global["y"].ToInt(); // [!code ++]
		sourcePref.ints[2] = iniData.Global["z"].ToInt(); // [!code ++]
		sourcePref.pivotX = iniData.Global["pivotX"].ToInt(); // [!code ++]
		sourcePref.pivotY = iniData.Global["pivotY"].ToInt(); // [!code ++]
		sourcePref.shadow = iniData.Global["shadow"].ToInt(); // [!code ++]
		sourcePref.shadowX = iniData.Global["shadowX"].ToInt(); // [!code ++]
		sourcePref.shadowY = iniData.Global["shadowY"].ToInt(); // [!code ++]
		sourcePref.ints[3] = iniData.Global["height"].ToInt(); // [!code ++]
		sourcePref.scaleIcon = iniData.Global["scaleIcon"].ToInt(); // [!code ++]
		sourcePref.liquidMod = iniData.Global["liquidMod"].ToInt(); // [!code ++]
		sourcePref.ints[23] = iniData.Global["hatY"].ToInt(); // [!code ++]
		sourcePref.ints[1] = iniData.Global["flags"].ToInt(); // [!code ++]
		return sourcePref; // [!code ++]
	} // [!code ++]
}
```

## +SpriteData

::: details File Created
```cs
using System;
using System.Globalization;
using System.IO;
using System.Text;
using IniParser;
using IniParser.Model;
using UnityEngine;

public class SpriteData
{
	public DateTime date;

	public Texture2D tex;

	public Texture2D texSnow;

	public string path;

	public Sprite[] sprites;

	public Sprite[] spritesSnow;

	public SourcePref pref;

	public int frame = 1;

	public int scale = 50;

	public float time = 0.2f;

	public void Init()
	{
		try
		{
			if (File.Exists(path + ".ini"))
			{
				IniData iniData = new FileIniDataParser().ReadFile(path + ".ini", Encoding.UTF8);
				frame = int.Parse(iniData.GetKey("frame") ?? "1");
				scale = int.Parse(iniData.GetKey("scale") ?? "50");
				time = float.Parse(iniData.GetKey("time") ?? "0.2", CultureInfo.InvariantCulture);
			}
		}
		catch (Exception message)
		{
			Debug.Log(message);
			Debug.Log("exception: Failed to parse:" + path + ".ini");
			time = 0.2f;
			scale = 50;
		}
	}

	public Sprite[] GetSprites()
	{
		Validate();
		return sprites;
	}

	public void LoadPref()
	{
		pref = null;
		if (File.Exists(path + ".pref"))
		{
			pref = SourcePref.ReadFromIni(path + ".pref");
		}
	}

	public Sprite GetSprite(bool snow = false)
	{
		Validate();
		if (!snow || spritesSnow == null)
		{
			return sprites[0];
		}
		return spritesSnow[0];
	}

	public void Validate()
	{
		DateTime lastWriteTime = File.GetLastWriteTime(path + ".png");
		bool flag = date.Year != 1 && date == lastWriteTime;
		if (!flag)
		{
			Load(flag, ref tex, ref sprites, "");
			if (File.Exists(path + "_snow.png"))
			{
				Load(flag, ref texSnow, ref spritesSnow, "_snow");
			}
			date = lastWriteTime;
		}
	}

	public void Load(bool dateMatched, ref Texture2D tex, ref Sprite[] sprites, string suffix)
	{
		if (dateMatched && (bool)tex)
		{
			return;
		}
		if ((bool)tex)
		{
			Texture2D texture2D = IO.LoadPNG(path + suffix + ".png");
			if (texture2D.width != tex.width || texture2D.height != tex.height)
			{
				Debug.Log(texture2D.width + "/" + texture2D.height + "/" + path);
				tex.Reinitialize(texture2D.width, texture2D.height);
			}
			tex.SetPixels32(texture2D.GetPixels32());
			tex.Apply();
			UnityEngine.Object.Destroy(texture2D);
		}
		else
		{
			tex = IO.LoadPNG(path + suffix + ".png");
			int num = tex.width / frame;
			int height = tex.height;
			sprites = new Sprite[frame];
			for (int i = 0; i < frame; i++)
			{
				sprites[i] = Sprite.Create(tex, new Rect(i * num, 0f, num, height), new Vector2(0.5f, 0.5f), 100f, 0u, SpriteMeshType.FullRect);
			}
		}
		LoadPref();
	}
}
```

:::
## +SpriteReplacer

::: details File Created
```cs
using System;
using System.Collections.Generic;
using System.IO;
using UnityEngine;

public class SpriteReplacer
{
	public static Dictionary<string, SpriteReplacer> dictSkins = new Dictionary<string, SpriteReplacer>();

	public static Dictionary<string, string> dictModItems = new Dictionary<string, string>();

	public bool isChecked;

	public SpriteData data;

	public static Dictionary<string, SpriteReplacer> ListSkins()
	{
		List<string> list = new List<string>();
		foreach (KeyValuePair<string, SpriteReplacer> dictSkin in dictSkins)
		{
			if (!File.Exists(dictSkin.Value.data.path + ".png"))
			{
				list.Add(dictSkin.Key);
			}
		}
		foreach (string item in list)
		{
			dictSkins.Remove(item);
		}
		FileInfo[] files = new DirectoryInfo(CorePath.custom + "Skin").GetFiles();
		foreach (FileInfo fileInfo in files)
		{
			if (fileInfo.Extension == ".png")
			{
				string fileNameWithoutExtension = Path.GetFileNameWithoutExtension(fileInfo.FullName);
				if (!dictSkins.ContainsKey(fileNameWithoutExtension))
				{
					SpriteReplacer spriteReplacer = new SpriteReplacer();
					spriteReplacer.data = new SpriteData
					{
						path = fileInfo.GetFullFileNameWithoutExtension()
					};
					spriteReplacer.data.Init();
					dictSkins.Add(fileNameWithoutExtension, spriteReplacer);
				}
			}
		}
		return dictSkins;
	}

	public bool HasSprite(string id)
	{
		if (!isChecked)
		{
			try
			{
				if (dictModItems.ContainsKey(id))
				{
					Debug.Log(id + ":" + dictModItems[id]);
					data = new SpriteData
					{
						path = dictModItems[id]
					};
					data.Init();
				}
				else
				{
					string text = CorePath.packageCore + "Texture/Item/" + id;
					if (File.Exists(text + ".png"))
					{
						data = new SpriteData
						{
							path = text
						};
						data.Init();
					}
				}
				isChecked = true;
			}
			catch (Exception ex)
			{
				Debug.Log("Error during fetching spirte:" + ex);
			}
		}
		return data != null;
	}
}
```

:::
## +SpriteReplacerAnimation

::: details File Created
```cs
using System;
using System.Collections.Generic;
using UnityEngine;

public class SpriteReplacerAnimation : MonoBehaviour
{
	public enum Type
	{
		Default,
		Boat
	}

	public static Dictionary<string, SpriteData> dict = new Dictionary<string, SpriteData>();

	public Type type;

	public string id;

	public SpriteData data;

	[NonSerialized]
	public SpriteRenderer sr;

	private int index;

	private void Awake()
	{
		if (!id.IsEmpty())
		{
			SetData(id);
		}
	}

	public void SetData(string id)
	{
		this.id = id;
		string text = id.IsEmpty(base.name + "_anime");
		string path = CorePath.packageCore + "Texture/Item/" + text;
		data = dict.TryGetValue(text);
		if (data == null)
		{
			data = new SpriteData
			{
				path = path
			};
			data.Init();
			dict.Add(text, data);
		}
		sr = GetComponent<SpriteRenderer>();
		sr.sprite = data.GetSprite();
		if (type == Type.Default)
		{
			CancelInvoke();
			InvokeRepeating("Refresh", 0f, data.time);
		}
	}

	private void Refresh()
	{
		index++;
		if (index >= data.frame)
		{
			index = 0;
		}
		sr.sprite = data.GetSprites()[index];
	}
}
```

:::
## TaskChopWood

[`public override void OnCreateProgress(Progress_Custom p)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/TaskChopWood.cs#L68-L74)
```cs:line-numbers=68
		Thing thing = ThingGen.Create("plank", material.id).SetNum(1 + EClass.rnd(2));
		CraftUtil.MixIngredients(thing, new List<Thing> { log }, CraftUtil.MixType.General, 999);
		log.ModNum(-1);
		owner.elements.ModExp(225, 30); // [!code --]
		owner.elements.ModExp(225, 30f); // [!code ++]
		owner.stamina.Mod(-1);
		EClass._map.TrySmoothPick(pos, thing, EClass.pc);
	};
```

## TaskCraft

[`public override void OnProgress()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/TaskCraft.cs#L82-L88)
```cs:line-numbers=82
	{
		Element orCreateElement = owner.elements.GetOrCreateElement(recipe.source.GetReqSkill());
		owner.PlaySound(recipe.GetMainMaterial().GetSoundCraft(recipe.renderRow));
		owner.elements.ModExp(orCreateElement.id, 20); // [!code --]
		owner.elements.ModExp(orCreateElement.id, 20f); // [!code ++]
	}

	public override IEnumerable<Status> Run()
```

[`public override void OnProgressComplete()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/TaskCraft.cs#L155-L161)
```cs:line-numbers=155
			return;
		}
		recipe.Craft(blessed, i == 0);
		owner.elements.ModExp(orCreateElement.id, 200); // [!code --]
		owner.elements.ModExp(orCreateElement.id, 200f); // [!code ++]
		resources.Clear();
	}
	EClass.Sound.Play("craft");
```

## TaskDig

[`public override void OnCreateProgress(Progress_Custom p)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/TaskDig.cs#L71-L77)
```cs:line-numbers=71
		owner.PlaySound(row.GetSoundImpact());
		row.PlayHitEffect(pos);
		row.AddBlood(pos);
		owner.elements.ModExp(230, 5); // [!code --]
		owner.elements.ModExp(230, 5f); // [!code ++]
		owner.renderer.NextFrame();
		if (EClass._zone.IsCrime(owner, this))
		{
```

## TaskDrawWater

[`public override void OnCreateProgress(Progress_Custom p)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/TaskDrawWater.cs#L74-L80)
```cs:line-numbers=74
			break;
		}
		pot.owner.ModCharge(1);
		owner.elements.ModExp(286, 5); // [!code --]
		owner.elements.ModExp(286, 5f); // [!code ++]
		if (EClass.rnd(3) == 0)
		{
			owner.stamina.Mod(-1);
```

## TaskMine

[`public override void OnCreateProgress(Progress_Custom p)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/TaskMine.cs#L82-L88)
```cs:line-numbers=82
		pos.matBlock.PlayHitEffect(pos);
		pos.matBlock.AddBlood(pos);
		owner.renderer.NextFrame();
		owner.elements.ModExp(220, 5); // [!code --]
		owner.elements.ModExp(220, 5f); // [!code ++]
		if (EClass._zone.IsCrime(owner, this))
		{
			owner.pos.TryWitnessCrime(owner);
```

## TaskPlow

[`public override void OnCreateProgress(Progress_Custom p)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/TaskPlow.cs#L65-L71)
```cs:line-numbers=65
		{
			pos.SetFloor(pos.matFloor.id, 4);
		}
		owner.elements.ModExp(286, 30); // [!code --]
		owner.elements.ModExp(286, 30f); // [!code ++]
		if (owner.IsPC)
		{
			EClass.player.stats.plow++;
```

## TaskPourWater

[`public override void OnCreateProgress(Progress_Custom p)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/TaskPourWater.cs#L68-L74)
```cs:line-numbers=68
		{
			pot.owner.Dye(EClass.sources.materials.alias["void"]);
		}
		owner.elements.ModExp(286, 5); // [!code --]
		owner.elements.ModExp(286, 5f); // [!code ++]
		if (EClass.rnd(3) == 0)
		{
			owner.stamina.Mod(-1);
```

## Thing

[`public override void ApplyMaterial(bool remove = false)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Thing.cs#L436-L453)
```cs:line-numbers=436
		for (int i = 0; i < sockets.Count; i++)
		{
			int num2 = sockets[i];
			int num3 = num2 / 100; // [!code --]
			int num3 = num2 / 1000; // [!code ++]
			if (num3 == 67 && dmgSet)
			{
				elements.ModBase(67, num2 % 100); // [!code --]
				elements.ModBase(67, num2 % 1000); // [!code ++]
			}
			if (num3 == 66 && hitSet)
			{
				elements.ModBase(66, num2 % 100); // [!code --]
				elements.ModBase(66, num2 % 1000); // [!code ++]
			}
			if (num3 == 65 && pvSet)
			{
				elements.ModBase(65, num2 % 100); // [!code --]
				elements.ModBase(65, num2 % 1000); // [!code ++]
			}
		}
	}
```

[`public override void WriteNote(UINote n, Action<UINote> onWriteNote = null, IIns`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Thing.cs#L1242-L1248)
```cs:line-numbers=1242
		{
			foreach (int socket in sockets)
			{
				AddText((socket == 0) ? "emptySocket".lang() : "socket".lang(EClass.sources.elements.map[socket / 100].GetName(), (socket % 100).ToString() ?? ""), FontColor.Gray); // [!code --]
				AddText((socket == 0) ? "emptySocket".lang() : "socket".lang(EClass.sources.elements.map[socket / 1000].GetName(), (socket % 1000).ToString() ?? ""), FontColor.Gray); // [!code ++]
			}
		}
	}
```

## Trait

[`public void OnBarter()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Trait.cs#L1860-L1865)
```cs:line-numbers=1860
				Add("ecomark", 5, 0);
				Add("whip_egg", 1, 0);
				Add("helm_chef", 1, 0);
				Add("hammer_strip", 1, 0); // [!code ++]
				Add("1165", 1, 0);
				Add("plat", 100, 0);
				AddThing(ThingGen.CreateScroll(9160).SetNum(5));
```

## TraitAltar

[`public override bool CanOffer(Card c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/TraitAltar.cs#L79-L87)
```cs:line-numbers=79
	{
		return true;
	}
	if (base.CanOffer(c) && (EClass.pc.faith.GetOfferingValue(c as Thing) > 0 || c.id == "water")) // [!code --]
	if (base.CanOffer(c) && (EClass.pc.faith.GetOfferingValue(c as Thing) > 0 || c.id == "water") && !c.isCopy) // [!code ++]
	{
		return !c.isCopy; // [!code --]
		return !c.HasElement(764); // [!code ++]
	}
	return false;
}
```

## TraitScrollStatic

[`public override void OnRead(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/TraitScrollStatic.cs#L51-L56)
```cs:line-numbers=51
			n1 = N1,
			refThing = owner.Thing
		});
		c.elements.ModExp(285, 50); // [!code --]
		c.elements.ModExp(285, 50f); // [!code ++]
	}
}
```

## +TraitToolHammerStrip

::: details File Created
```cs
public class TraitToolHammerStrip : TraitTool
{
	public override bool IsTool => true;

	public override void TrySetHeldAct(ActPlan p)
	{
		p.pos.Things.ForEach(delegate(Thing t)
		{
			if (t.category.tag.Contains("enc") && t.encLV > 0)
			{
				p.TrySetAct("actHammerFurniture".lang(t.Name), delegate
				{
					Msg.Say("upgrade", t, owner.GetName(NameStyle.Full, 1));
					SE.Play("build_area");
					t.PlayEffect("buff");
					t.SetEncLv(0);
					return false;
				});
			}
		});
	}
}
```

:::
## Zone

[`public Chara SpawnMob(Point pos = null, SpawnSetting setting = null)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/9e4778eeb934712bc274d82e229071988d04fea3/Elin/Zone.cs#L2702-L2707)
```cs:line-numbers=2702
	if (ScaleMonsterLevel)
	{
		num = ((dangerLv - 1) % 50 + 5) * 150 / 100;
		if (num >= 20 && EClass.rnd(100) < num) // [!code ++]
		{ // [!code ++]
			num = dangerLv; // [!code ++]
		} // [!code ++]
	}
	CardRow cardRow = (setting.id.IsEmpty() ? spawnList.Select(num, setting.levelRange) : EClass.sources.cards.map[setting.id]);
	int num2 = ((setting.fixedLv == -1) ? cardRow.LV : setting.fixedLv);
```

---
exclude: true
aside: false
pageClass: diff-single-page
footer: false
editLink: false
lastUpdated: false
description: 6 files modified.
version: EA 23.196 Nightly Patch 1
changes: AI_PlayMusic/Card/CoreDebug/SourceElement/Thing/TraitIndulgence
---

# EA 23.196 Nightly Patch 1

September 8, 2025

6 files modified.

## Important Changes

Possible breaking changes. Click the filename to view the chunk.
### [Card (1)](#card)
```cs:no-line-numbers
public void ApplyElementEffect(Element e, int eleP, Card origin) // [!code --]
public void ApplyElementEffect(Element e, int eleP, Card origin, bool checkHostileAct = false) // [!code ++]
```
## AI_PlayMusic

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/81113d0c4959876c079d0fef9fcb1d1d1fece6dc/Elin/AI_PlayMusic.cs#L183-L189)
```cs:line-numbers=183
		Debug.Log(song.lv);
	}
	List<Chara> reacted = new List<Chara>();
	Progress_Custom seq = new Progress_Custom // [!code --]
	Progress_Custom progress = new Progress_Custom // [!code ++]
	{
		maxProgress = 15,
		cancelWhenMoved = false,
```

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/81113d0c4959876c079d0fef9fcb1d1d1fece6dc/Elin/AI_PlayMusic.cs#L300-L306)
```cs:line-numbers=300
								}
								if (value.source.categorySub == "eleAttack")
								{
									item2.ApplyElementEffect(value, value.Value * 10, owner); // [!code --]
									item2.ApplyElementEffect(value, value.Value * 10, owner, checkHostileAct: true); // [!code ++]
								}
							}
						}
```

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/81113d0c4959876c079d0fef9fcb1d1d1fece6dc/Elin/AI_PlayMusic.cs#L323-L328)
```cs:line-numbers=323
						if (EClass.rnd(num2 * num2) <= 30 && item2.pos.FirstChara == item2)
						{
							bool isMinion = item2.IsMinion;
							p.cancelWhenDamaged = false; // [!code ++]
							if (num < item2.LV && EClass.rnd(2) == 0)
							{
								reacted.Add(item2);
```

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/81113d0c4959876c079d0fef9fcb1d1d1fece6dc/Elin/AI_PlayMusic.cs#L370-L375)
```cs:line-numbers=370
								}
								num2++;
							}
							p.cancelWhenDamaged = true; // [!code ++]
						}
					}
				}
```

[`public override IEnumerable<Status> Run()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/81113d0c4959876c079d0fef9fcb1d1d1fece6dc/Elin/AI_PlayMusic.cs#L398-L404)
```cs:line-numbers=398
			Evaluate(success: true);
		}
	}.SetDuration(26);
	yield return Do(seq); // [!code --]
	yield return Do(progress); // [!code ++]
	if (progress.status == Status.Fail) // [!code ++]
	{ // [!code ++]
		yield return Cancel(); // [!code ++]
	} // [!code ++]
	void LevelSong(int a)
	{
		if (a > 0)
```

## Card

[`void ProcAbsorb()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/81113d0c4959876c079d0fef9fcb1d1d1fece6dc/Elin/Card.cs#L4692-L4710)
```cs:line-numbers=4692
		}
	}

	public void ApplyElementEffect(Element e, int eleP, Card origin) // [!code --]
	public void ApplyElementEffect(Element e, int eleP, Card origin, bool checkHostileAct = false) // [!code ++]
	{
		if (!isChara)
		{
			return;
		}
		bool flag = true;
		bool hostile = false; // [!code ++]
		switch (e.id)
		{
		case 910:
			if (Chance(30 + eleP / 5, 100))
			{
				Chara.AddCondition<ConBurning>(eleP); // [!code --]
				MarkHostile().AddCondition<ConBurning>(eleP); // [!code ++]
			}
			break;
		case 911:
```

[`public void ApplyElementEffect(Element e, int eleP, Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/81113d0c4959876c079d0fef9fcb1d1d1fece6dc/Elin/Card.cs#L4729-L4735)
```cs:line-numbers=4729
	case 915:
		if (Chance(30 + eleP / 5, 100))
		{
			Chara.AddCondition<ConPoison>(eleP); // [!code --]
			MarkHostile().AddCondition<ConPoison>(eleP); // [!code ++]
		}
		break;
	case 913:
```

[`public void ApplyElementEffect(Element e, int eleP, Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/81113d0c4959876c079d0fef9fcb1d1d1fece6dc/Elin/Card.cs#L4801-L4807)
```cs:line-numbers=4801
		}
		if (Chance(5 + eleP / 25, 40))
		{
			Chara.AddCondition<ConPoison>(eleP / 2); // [!code --]
			MarkHostile().AddCondition<ConPoison>(eleP / 2); // [!code ++]
		}
		if (Chance(5 + eleP / 25, 40))
		{
```

[`public void ApplyElementEffect(Element e, int eleP, Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/81113d0c4959876c079d0fef9fcb1d1d1fece6dc/Elin/Card.cs#L4819-L4825)
```cs:line-numbers=4819
	case 924:
		if (Chance(50 + eleP / 10, 100))
		{
			Chara.AddCondition<ConBleed>(eleP); // [!code --]
			MarkHostile().AddCondition<ConBleed>(eleP); // [!code ++]
		}
		break;
	case 923:
```

[`public void ApplyElementEffect(Element e, int eleP, Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/81113d0c4959876c079d0fef9fcb1d1d1fece6dc/Elin/Card.cs#L4836-L4845)
```cs:line-numbers=4836
		{
			Chara.conSleep.Kill();
		}
		if (checkHostileAct && hostile && origin != null && origin.isChara) // [!code ++]
		{ // [!code ++]
			origin.Chara.DoHostileAction(this); // [!code ++]
		} // [!code ++]
		static bool Chance(int a, int max)
		{
			return Mathf.Min(a, max) > EClass.rnd(100);
		}
		Chara MarkHostile() // [!code ++]
		{ // [!code ++]
			hostile = true; // [!code ++]
			return Chara; // [!code ++]
		} // [!code ++]
	}

	public virtual void Die(Element e = null, Card origin = null, AttackSource attackSource = AttackSource.None, Chara originalTarget = null)
```

[`public void SpawnLoot(Card origin)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/81113d0c4959876c079d0fef9fcb1d1d1fece6dc/Elin/Card.cs#L5053-L5061)
```cs:line-numbers=5053
				CardRow cardRow = EClass.sources.cards.map[array[0]];
				if (cardRow != null && cardRow.Category.slot != 0 && cardRow.quality == 0 && EClass.pc.Evalue(1660) * 25 > EClass.rnd(100))
				{
					CardBlueprint.SetRarity(Rarity.Legendary); // [!code --]
					CardBlueprint.SetRarity((EClass.rnd(20) == 0) ? Rarity.Mythical : Rarity.Legendary); // [!code ++]
				}
				list.Add(ThingGen.Create(array[0]).SetNum((num4 < 1000) ? 1 : (num4 / 1000 + ((EClass.rnd(1000) > num4 % 1000) ? 1 : 0)))); // [!code --]
				list.Add(ThingGen.Create(array[0], -1, LV).SetNum((num4 < 1000) ? 1 : (num4 / 1000 + ((EClass.rnd(1000) > num4 % 1000) ? 1 : 0)))); // [!code ++]
			}
		}
		if (Chara.IsMachine)
```

## CoreDebug

[`public void QuickStart()`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/81113d0c4959876c079d0fef9fcb1d1d1fece6dc/Elin/CoreDebug.cs#L459-L464)
```cs:line-numbers=459
		thing.AddCard(ThingGen.Create("mathammer", 33)).SetNum(10);
		thing.AddCard(ThingGen.Create("mathammer", 18)).SetNum(10);
		thing.AddCard(ThingGen.Create("mathammer", 10)).SetNum(99);
		thing.AddCard(ThingGen.Create("mathammer", 31)).SetNum(10); // [!code ++]
		thing.AddCard(ThingGen.Create("mathammer", 28)).SetNum(99); // [!code ++]
		EClass.pc.AddCard(thing);
		thing = ThingGen.Create("pouch");
		for (int l = 0; l < 30; l++)
```

## SourceElement

[`public bool IsMaterialEncAppliable(Thing t)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/81113d0c4959876c079d0fef9fcb1d1d1fece6dc/Elin/SourceElement.cs#L232-L238)
```cs:line-numbers=232
			}
			return true;
		}
		if (!t.IsEquipmentOrRangedOrAmmo && !t.IsThrownWeapon) // [!code --]
		if (!t.IsEquipmentOrRangedOrAmmo && !t.IsThrownWeapon && !(t.trait is TraitToolMusic)) // [!code ++]
		{
			return false;
		}
```

## Thing

[`public override void WriteNote(UINote n, Action<UINote> onWriteNote = null, IIns`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/81113d0c4959876c079d0fef9fcb1d1d1fece6dc/Elin/Thing.cs#L1240-L1246)
```cs:line-numbers=1240
	{
		AddText("isBed".lang(traitBed.MaxHolders.ToString() ?? ""), FontColor.Default);
	}
	bool flag3 = base.IsEquipmentOrRangedOrAmmo || base.IsThrownWeapon; // [!code --]
	bool flag3 = base.IsEquipmentOrRangedOrAmmo || base.IsThrownWeapon || trait is TraitToolMusic; // [!code ++]
	bool showTraits = !flag3 || base.ShowFoodEnc;
	bool infoMode = mode == IInspect.NoteMode.Info;
	List<Element> listTrait = ListValidTraits(isCraft: false, !infoMode);
```

[`public override void WriteNote(UINote n, Action<UINote> onWriteNote = null, IIns`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/81113d0c4959876c079d0fef9fcb1d1d1fece6dc/Elin/Thing.cs#L1269-L1275)
```cs:line-numbers=1269
				{
					return false;
				}
				if (e.source.categorySub == "eleAttack" && !base.IsWeapon && !base.IsRangedWeapon && !base.IsAmmo && !base.IsThrownWeapon) // [!code --]
				if (e.source.categorySub == "eleAttack" && !base.IsWeapon && !base.IsRangedWeapon && !base.IsAmmo && !base.IsThrownWeapon && !(trait is TraitToolMusic)) // [!code ++]
				{
					return false;
				}
```

## TraitIndulgence

[`public override void OnRead(Chara c)`](https://github.com/Elin-Modding-Resources/Elin-Decompiled/blob/81113d0c4959876c079d0fef9fcb1d1d1fece6dc/Elin/TraitIndulgence.cs#L4-L10)
```cs:line-numbers=4
{
	c.PlaySound("holyveil");
	c.PlayEffect("holyveil");
	Msg.Say("skillbook_noSkill", c); // [!code --]
	Msg.Say("indulgence", c); // [!code ++]
	if (c.IsPC)
	{
		EClass.player.ModKarma(20);
```
